#include <linux/kernel.h>
#include <linux/delay.h>
#include <linux/types.h>
#include <linux/module.h>
#include <linux/string.h>
#include <linux/device.h>
#include <linux/cdev.h>
#include <linux/slab.h>
#include <linux/fs.h>
#include <linux/platform_device.h>
#include <linux/mtd/mtd.h>
#include <linux/random.h>
#include <linux/uaccess.h>
#include <asm/cacheflush.h>
//#include <mach/RPCDriver.h>
#include <linux/pageremap.h>
#include <linux/kthread.h>
#ifdef CONFIG_ARM64
#include <asm/io.h>
#endif
#include <mach/rtk_platform.h>
/*some include about AP*/
#include <tvscalercontrol/scaler/scalercolorlib.h>
#include <tvscalercontrol/scaler/scalercolorlib_tv002.h>
#include <tvscalercontrol/scaler/scalercolorlib_tv010.h>
#include <tvscalercontrol/scaler/scalercolorlib_IPQ.h>
#include <tvscalercontrol/scaler/scalertimer.h>
#include <tvscalercontrol/io/ioregdrv.h>
#include "scaler_vpqmemcdev.h"
#include <tvscalercontrol/i3ddma/i3ddma_drv.h>
#include <tvscalercontrol/i3ddma/i3ddma.h>
/*some include about VIP Driver*/
#include <tvscalercontrol/vip/scalerColor.h>
#include <tvscalercontrol/vip/di_ma.h>
#include <tvscalercontrol/vip/peaking.h>
#include <tvscalercontrol/vip/icm.h>
#include <tvscalercontrol/vip/dcc.h>
#include <tvscalercontrol/vip/ultrazoom.h>
#include <tvscalercontrol/vip/color.h>
#include <tvscalercontrol/vip/xc.h>
#include <tvscalercontrol/vip/intra.h>
#include <tvscalercontrol/vip/nr.h>
#include <tvscalercontrol/vip/film.h>
#include <tvscalercontrol/vip/pq_adaptive.h>
#include <tvscalercontrol/vip/gibi_od.h>
#include <tvscalercontrol/vip/pcid.h>
#include <tvscalercontrol/vip/fcic.h>
#include <tvscalercontrol/vip/valc.h>
#include <tvscalercontrol/vdc/video.h>
#include <tvscalercontrol/vip/localdimming.h>
#include <tvscalercontrol/vip/localcontrast.h>
#include <tvscalercontrol/vip/frequency_detection.h>
#include <tvscalercontrol/vip/still_logo_detect.h>
#include <tvscalercontrol/vip/ST2094.h>
//#include <tvscalercontrol/libosr.h>//k6, gsr

#include "scaler_vbedev.h"
#include <tvscalercontrol/vip/pdf.h>
//====================20161027 START=======================================================
//juwen, 0627, TC
#include <tvscalercontrol/vip/tc_hdr.h>
//====================20161027 END=========================================================

#include <tvscalercontrol/vip/viptable.h>
#include <tvscalercontrol/vip/vip_reg_def.h>
#include <tvscalercontrol/vip/memc_mux.h>
/*some include about scaler*/

#ifdef CONFIG_KDRIVER_USE_NEW_COMMON
	#include <scaler/scalerDrvCommon.h>
#else
#include <scalercommon/scalerDrvCommon.h>
#endif

//#include <rbus/rbusHistogramReg.h>
#include <tvscalercontrol/scalerdrv/scalerdisplay.h>
#include <tvscalercontrol/scalerdrv/scalerdrv.h>
#include <tvscalercontrol/panel/panelapi.h>
/*some include about rbus*/
#include <rbus/vdtop_reg.h>
//#include <rbus/rbusScaledownReg.h>
//#include <rbus/rbusSRGBReg.h>
//#include <rbus/rbusBLUReg.h>
#include <rbus/ldspi_reg.h>
#include <rbus/pinmux_lvdsphy_reg.h>
#include <rbus/ppoverlay_reg.h>
#include <rbus/epi_reg.h>
#include <rbus/stb_reg.h>//juwen, LC, verB
#include <rbus/sys_reg_reg.h>
#include <rbus/ppoverlay_reg.h>
#include <rbus/vodma_reg.h>
//#include <rbus/kme_dm_top1_reg.h>
#ifndef CONFIG_MEMC_NOTSUPPORT
#include "memc_reg_def.h"
#endif
//#include <rbus/software1_reg.h>

/*some include about device driver*/
#include <tvscalercontrol/hdmirx/hdmifun.h>
#include <tvscalercontrol/hdmirx/hdmi_vfe.h>
#include <scaler_vscdev.h>
extern unsigned int vpq_project_id;
extern unsigned int vpqex_project_id;
//extern webos_info_t  webos_tooloption;
#include <tvscalercontrol/vip/scalerColor_tv006.h>
#include "tvscalercontrol/scalerdrv/scalermemory.h"
#include <tvscalercontrol/vip/ai_pq.h>

#include <rtd_log/rtd_module_log.h>
#include "rtk_vip_logger.h"

#include <tvscalercontrol/vip/srnn.h>
#include <rbus/srnn_reg.h>
//#define CONFIG_RTK_KDRV_GSR

#ifdef CONFIG_ENABLE_HDMITX
#include <tvscalercontrol/hdmitx/hdmitx.h>
#endif // #ifdef CONFIG_ENABLE_HDMITX

#undef VIPprintf
#define VIPprintf(fmt, args...)	VIPprintfPrivate(VIP_LOGLEVEL_DEBUG, VIP_LOGMODULE_VIP_COLOR_scaler_DEBUG, fmt, ##args)
#define	vip_malloc(x)	kmalloc(x, GFP_KERNEL)
#define	vip_free(x)	kfree(x)

struct semaphore ICM_Semaphore;
//struct semaphore I_RGB2YUV_Semaphore;	// use "VPQ_I_CSC_Semaphore"
struct semaphore Gamma_Semaphore;
struct semaphore ColorSpace_Semaphore;
struct semaphore Orbit_Semaphore;
struct semaphore LC_Semaphore;

_system_setting_info		 	*system_info_structure_table=NULL;
_RPC_system_setting_info		 	*RPC_system_info_structure_table=NULL;
SLR_VIP_TABLE		             *g_Share_Memory_VIP_TABLE_Struct_isr= NULL;
_clues *SmartPic_clue=NULL;
_RPC_clues *RPC_SmartPic_clue=NULL;
unsigned char *DCR_TABLE=NULL;
VIP_table_crc_value *vip_table_crc_isr = NULL;
unsigned char g_force_DeXC_disable=0;

extern int  rtice_Set_D_LUT_9to17(unsigned int *array);
extern void SLD_k6_HAL(int Y1, int Y2, int Y3, int gain_low,unsigned char UIsel_L);
int sld_static_gain = 1023;

UINT32 before_phyAddr = 0;
UINT32 after_phyAddr = 0;
char linedata_memcLog[961] = {0};	/* 120 byte + '\n'*/

unsigned char ColorFMT_601_in_IMD_Domain_Enable = 0;
unsigned char g_bIsRGB_FULL_Input_for_I3DDMA = FALSE;
/*#define OSD_Contrast_Compensation 1*/
unsigned char g_bUseMiddleWareOSDmap = 0; //for Driver Base MiddleWare OSD map
StructColorDataFacModeType g_curColorFacTableEx = {0}; //for Driver Base MiddleWare OSD map

extern unsigned int	 *dbDCCHisto_TABLE;
extern unsigned int	 *dbDCCCurve_TABLE;
/*#define complement2(arg) (((~arg)&0x7FF) + 1)*/

extern BOOL Low_ConBri_BrightnessBoost_Disable;
DRV_NR_Item	 *Manual_NR_TABLE = NULL;
DRV_IEdgeSmooth_Coef *IEdgeSmooth_Coef = NULL;
DRV_DEdgeSmooth_Coef *DEdgeSmooth_Coef = NULL;
static SLR_VIP_TABLE *gVip_Table = NULL;
RPC_DCC_LAYER_Array_Struct *g_DCC_LAYER_Array_Struct = NULL;
_clues *g_SmartPic_clue = NULL;
RPC_ICM_Global_Ctrl *g_ICM_Global_Ctrl_Struct = NULL;
SLR_VIP_TABLE *g_Share_Memory_VIP_TABLE_Struct = NULL;
RPC_SLR_VIP_TABLE *g_RPC_Share_Memory_VIP_TABLE_Struct = NULL;
/* === checksum ========== */
VIP_table_crc_value vip_table_crc = {0};
unsigned int vip_8vertex_temp[VIP_D_3D_LUT_UI_TBL_SIZE];
/* =========    Gamma  =============*/
unsigned int *tGAMMA_temp_R;
unsigned int *tGAMMA_temp_G;
unsigned int *tGAMMA_temp_B;
unsigned char g_GammaMode = 0;
#define Bin_Num_Gamma 1024 /*Mac2 = 256, Sirius = 1024 (jyyang_2013/12/25)*/
#define Vmax_Gamma 4095
#define Vmax_OutGamma 8191
#define Vmax_ingGamma 16383
UINT16 GOut_R[Bin_Num_Gamma + 1], GOut_G[Bin_Num_Gamma + 1], GOut_B[Bin_Num_Gamma + 1];
UINT8 gamma_bit_depth = 12;
UINT16 gamma_scale = (Vmax_Gamma + 1) / Bin_Num_Gamma;
unsigned char GammaEnable=1;

UINT16 HDR_GOut_R[Bin_Num_Gamma + 1], HDR_GOut_G[Bin_Num_Gamma + 1], HDR_GOut_B[Bin_Num_Gamma + 1];
UINT16 SDR_GOut_R[Bin_Num_Gamma + 1], SDR_GOut_G[Bin_Num_Gamma + 1], SDR_GOut_B[Bin_Num_Gamma + 1];

unsigned int final_GAMMA_R[Bin_Num_Gamma / 2], final_GAMMA_G[Bin_Num_Gamma / 2], final_GAMMA_B[Bin_Num_Gamma / 2]; // Num of index: Mac2=128, Sirius=512 (jyyang_2013/12/30)
unsigned int final_OutGAMMA_R[Bin_Num_Output_Gamma / 2], final_OutGAMMA_G[Bin_Num_Output_Gamma / 2], final_OutGAMMA_B[Bin_Num_Output_Gamma / 2];

extern unsigned short Power1div22Gamma[1025];

extern VIP_Output_Gamma Output_Gamma[Output_Gamma_TBL_MAX];
extern VIP_InvOutput_Gamma InvOutput_Gamma[InvOutput_Gamma_TBL_MAX];
/* =========    Gamma  =============*/

/* == == == ==Inv   Gamma == == == == == == =*/
extern unsigned short Power22InvGamma[1025];
extern unsigned short LinearInvGamma[1025];
unsigned int final_invGAMMA_R[Bin_Num_Gamma / 2], final_invGAMMA_G[Bin_Num_Gamma / 2], final_invGAMMA_B[Bin_Num_Gamma / 2]; // Num of index: Mac2=128, Sirius=512 (jyyang_2013/12/30)
/* == == == ==Inv    Gamma == == == == == == =*/

/* HDR Sub Gamma */
#define Bin_Num_HDR2_Gamma 256
unsigned int final_HDR2_GAMMA_R[Bin_Num_HDR2_Gamma / 2], final_HDR2_GAMMA_G[Bin_Num_HDR2_Gamma / 2], final_HDR2_GAMMA_B[Bin_Num_HDR2_Gamma / 2];

/*========== xvYcc ============*/
extern unsigned int t_inv_GAMMA[512];
extern unsigned short t_gamma_curve_22[1025];
/*============================*/

#if 1
/*========================= for INNX demura =================================*/
#if 0	/* use dynamic alloc*/
char INNX_Demura_DeLut1[INNX_Demura_h_271][INNX_Demura_W16]={0};
char INNX_Demura_DeLut2[INNX_Demura_h_271][INNX_Demura_W16]={0};
char INNX_Demura_DeLut3[INNX_Demura_h_271][INNX_Demura_W16]={0};
char INNX_Demura_DeLut4[INNX_Demura_h_271][INNX_Demura_W16]={0};
char INNX_Demura_DeLut5[INNX_Demura_h_271][INNX_Demura_W16]={0};
static unsigned char INNX_Demura_CodeLutALL_row[31][22]={0};
static unsigned char INNX_Demura_CodeLutAll[31*INNX_Demura_h_271][22]={0};
static unsigned char INNX_Demura_header_infor[INNX_Demura_size_header_infor];
static unsigned char INNX_Demura_DataByRow[22*5*31*271];
#else
unsigned int INNX_Demura_gray_setting[7];
static unsigned char *INNX_Demura_CodeLutALL_row;//[INNX_Demura_num_31][INNX_Demura_num_22]={0};
static unsigned char *INNX_Demura_CodeLutAll;//[INNX_Demura_num_31*INNX_Demura_h_271][INNX_Demura_num_22]={0};
static unsigned char *INNX_Demura_header_infor;//[INNX_Demura_size_header_infor];
static unsigned char *INNX_Demura_DataByRow;//[INNX_Demura_num_22*INNX_Demura_num_level*INNX_Demura_num_31*INNX_Demura_h_271];

#endif
/*========================= for INNX demura =================================*/
#endif

/*========== lc ============*/
#define GET_IC_VERSION()	IoReg_Read32(STB_SC_VerID_reg)
#define VERSION_A_REG_CODE	0x65050000//juwen, merlin3, verB
#define VERSION_B_REG_CODE	0x65050010

/*============================*/

unsigned char g_bHDR_is601 = false;

#ifdef CONFIG_HDR_SDR_SEAMLESS
HDR_SDR_SEAMLESS_PQ_STRUCT HDR_SDR_SEAMLESS_PQ = {{0}};
#endif

//====================20161027 START=======================================================
#if 0	/* juwen, move to "tc_hdr", elieli */
#define TCHDR_COEF_C_LUT_TBL_SIZE 33
#define TCHDR_COEF_I_LUT_TBL_SIZE 33
#define TCHDR_COEF_S_LUT_TBL_SIZE 33
#define TCHDR_COEF_P_LUT_TBL_SIZE 33
#define TCHDR_COEF_D_LUT_RED_TBL_SIZE 33
#define TCHDR_COEF_D_LUT_GREEN_TBL_SIZE 33
#define TCHDR_COEF_D_LUT_BLUE_TBL_SIZE 33
unsigned int TCHDR_COEF_C_LUT_TBL_ReadReg[TCHDR_COEF_C_LUT_TBL_SIZE];
unsigned int TCHDR_COEF_I_LUT_TBL_ReadReg[TCHDR_COEF_I_LUT_TBL_SIZE];
unsigned int TCHDR_COEF_S_LUT_TBL_ReadReg[TCHDR_COEF_S_LUT_TBL_SIZE];
unsigned int TCHDR_COEF_P_LUT_TBL_ReadReg[TCHDR_COEF_P_LUT_TBL_SIZE];
unsigned int TCHDR_COEF_D_LUT_RED_TBL_ReadReg[TCHDR_COEF_D_LUT_RED_TBL_SIZE];
unsigned int TCHDR_COEF_D_LUT_GREEN_TBL_ReadReg[TCHDR_COEF_D_LUT_GREEN_TBL_SIZE];
unsigned int TCHDR_COEF_D_LUT_BLUE_TBL_ReadReg[TCHDR_COEF_D_LUT_BLUE_TBL_SIZE];
#else
extern unsigned int TCHDR_COEF_C_LUT_TBL_ReadReg[TCHDR_COEF_C_LUT_TBL_SIZE];
extern unsigned int TCHDR_COEF_I_LUT_TBL_ReadReg[TCHDR_COEF_I_LUT_TBL_SIZE];
extern unsigned int TCHDR_COEF_S_LUT_TBL_ReadReg[TCHDR_COEF_S_LUT_TBL_SIZE];
extern unsigned int TCHDR_COEF_P_LUT_TBL_ReadReg[TCHDR_COEF_P_LUT_TBL_SIZE];
extern unsigned int TCHDR_COEF_D_LUT_RED_TBL_ReadReg[TCHDR_COEF_D_LUT_RED_TBL_SIZE];
extern unsigned int TCHDR_COEF_D_LUT_GREEN_TBL_ReadReg[TCHDR_COEF_D_LUT_GREEN_TBL_SIZE];
extern unsigned int TCHDR_COEF_D_LUT_BLUE_TBL_ReadReg[TCHDR_COEF_D_LUT_BLUE_TBL_SIZE];
#endif
//====================20161027 END=========================================================


/*========== POD & PCID ============*/
unsigned int PCID_RgnReadTbl[PCID_TBL_LEN*2] = {0}; // when 4x4 Region and 19x19 TableSize, we need to write 19x19x2 times
unsigned int PCID_RgnWriteTbl[PCID_TBL_LEN*2] = {0};
unsigned int PCID_SampleRgnTbl[PCID_TBL_LEN] = {0};
/*==================================*/

/*========== VALC ============*/
unsigned int VALC_ReadTbl[VALC_TBL_LEN] = {0};
unsigned int VALC_WriteTbl[VALC_TBL_LEN] = {0};
unsigned int VALC_SampleTbl[VALC_TBL_LEN] = {0};
/*==================================*/

/*==========HDR============*/
extern unsigned char HDR_demo_flag;
static int HDR_demo_sub_curve[Curve_num_Max] = {
0x0000, 0x0015, 0x002a, 0x003f,
0x0054, 0x0068, 0x007d, 0x0092,
0x00a7, 0x00bf, 0x00d7, 0x00ee,
0x0106, 0x011e, 0x0136, 0x014d,
0x0165, 0x017d, 0x0195, 0x01ad,
0x01c5, 0x01dc, 0x01f4, 0x020c,
0x0224, 0x0243, 0x0263, 0x0282,
0x02a1, 0x02c0, 0x02e0, 0x02ff,
0x031e, 0x033a, 0x0357, 0x0373,
0x038f, 0x03ab, 0x03c8, 0x03e4,
0x0400, 0x0421, 0x0442, 0x0462,
0x0483, 0x04a4, 0x04c5, 0x04e5,
0x0506, 0x052a, 0x054e, 0x0571,
0x0595, 0x05b9, 0x05dd, 0x0600,
0x0624, 0x0643, 0x0663, 0x0682,
0x06a1, 0x06c0, 0x06e0, 0x06ff,
0x071e, 0x0748, 0x0771, 0x079b,
0x07c5, 0x07ee, 0x0818, 0x0841,
0x086b, 0x088c, 0x08ad, 0x08cd,
0x08ee, 0x090f, 0x0930, 0x0950,
0x0971, 0x0995, 0x09b9, 0x09dc,
0x0a00, 0x0a24, 0x0a48, 0x0a6b,
0x0a8f, 0x0aae, 0x0ace, 0x0aed,
0x0b0c, 0x0b2b, 0x0b4b, 0x0b6a,
0x0b89, 0x0bad, 0x0bd1, 0x0bf4,
0x0c18, 0x0c3c, 0x0c60, 0x0c83,
0x0ca7, 0x0cd2, 0x0cfd, 0x0d28,
0x0d54, 0x0d7f, 0x0daa, 0x0dd5,
0x0e00, 0x0e25, 0x0e4b, 0x0e70,
0x0e95, 0x0eba, 0x0ee0, 0x0f05,
0x0f2a, 0x0f43, 0x0f5d, 0x0f76,
0x0f8f, 0x0fa8, 0x0fc2, 0x0fdb,
0x0FF4 };
/*=========================*/
/* =========    Dither =============*/
extern unsigned char tDITHER_SEQUENCE[VIP_DITHER_SEQUENCE_MAX][3][16];
extern unsigned char tDITHER_MAIN_LUT[VIP_DITHER_MAINTABLE_MAX][3][4][4] ;
extern unsigned char tDITHER_MEMC_LUT[VIP_DITHER_PANELTABLE_MAX][3][16][4] ;
extern unsigned char tDITHER_PANEL_LUT[VIP_DITHER_PANELTABLE_MAX][3][16][4] ;
extern unsigned char tDITHER_TEMPORAL[VIP_DITHER_TEMPORAL_MAX][16];
extern unsigned char tDDither_Coef[VIP_DYNAMIC_DITHERING_TABLE_MAX][15];
/*=========================*/
/* =========HDR sub  =============*/
extern  DRV_subHDR_YUV2RGB_CSMatrix HDR_sub_YUV2RGB[HDR_SUB_YUV2RGB_TABLE_Max];
extern DRV_Color_Mapping  HDR_sub_colorMap[HDR_SUB_TABLE_NUM];
/*=========================*/


/* =========    sRGB =============*/
//static UINT32 (*UV_Gains)[0][9] = NULL;
//static signed int sRGB_grid[9][Bin_Num_sRGB + 1];
/* =========    sRGB =============*/
/* =========     ICM =============*/
/*current elem tab from vip table*/
COLORELEM_TAB_T icm_tab_elem_of_vip_table;
COLORELEM_TAB_T icm_tab_elem_write;

/* =========     ICM =============*/
/* ======== histogram ============*/
unsigned char bForceHist3DCtrl;
/* ======== histogram ============*/

/* ========= ColorMatrix ==========*/
#if defined(ENABLE_HDMI_FORCE_LIMIT_RANGE)
#define FORCE_DATA_RANGE 1
#elif defined(ENABLE_HDMI_FORCE_FULL_RANGE)
#define FORCE_DATA_RANGE 2
#else
#define FORCE_DATA_RANGE 0
#endif

/* ================DM HDR 3D LUT===================*/
unsigned int DM_HDR_3D_DRV_LUT[VIP_DM_HDR_3D_LUT_DRV_TBL_SIZE];
/*unsigned int DM_HDR_3D_UI_LUT[VIP_DM_HDR_3D_LUT_UI_TBL_SIZE];*/
/* ================DM HDR 3D LUT===================*/

/* ================DM HDR 3D LUT===================*/
unsigned int D_3D_DRV_LUT[VIP_D_3D_LUT_DRV_TBL_SIZE];
/*unsigned int DM_HDR_3D_UI_LUT[VIP_DM_HDR_3D_LUT_UI_TBL_SIZE];*/
/* ================DM HDR 3D LUT===================*/

extern unsigned short tYUV2RGB_COEF_TVBOX_PAL[];
extern unsigned short tYUV2RGB_COEF_TVBOX_SD[];
extern unsigned short tYUV2RGB_COEF_TVBOX_HD[];
extern unsigned short tYUV2RGB_COEF_601_YCbCr_NOClampY[];
extern unsigned int YUV2RGB_Matrix_COEF_601_YCbCr[];
extern unsigned short tYUV2RGB_COEF[YUV2RGB_TBL_SELECT_ITEM_MAX][tUV2RGB_COEF_Items_Max];

extern unsigned short tRGB2YUV_COEF_709_YUV_0_255[];
extern unsigned short tRGB2YUV_COEF_709_YUV_16_235[];
extern unsigned short tRGB2YUV_COEF_709_YUV_16_235[];
extern unsigned short tRGB2YUV_COEF_709_RGB_0_255[];
extern unsigned short tRGB2YUV_COEF_709_RGB_16_235[];
extern unsigned short tRGB2YUV_COEF_709_RGB_16_235_HDMI[];
extern unsigned short tRGB2YUV_COEF_601_RGB_0_255[];
extern unsigned short tRGB2YUV_COEF_601_RGB_16_235[];
extern unsigned short tRGB2YUV_COEF_601_RGB_16_235_HDMI[];
extern unsigned short tRGB2YUV_COEF_601_YCbCr_0_255[];
extern unsigned short tRGB2YUV_COEF_601_YCbCr_16_235[];
extern unsigned short tRGB2YUV_COEF_601_YCbCr_16_255[];
extern unsigned short tRGB2YUV_COEF_TVBOX_SD[];
extern unsigned short tRGB2YUV_COEF_TVBOX_720[];
extern unsigned short tRGB2YUV_COEF_TVBOX_1080[];
/*extern unsigned short tRGB2YUV_COEF_BYPASS_NORMAL_GAIN[];*/
/*extern unsigned short tRGB2YUV_COEF_YCC601_0_255_TO_YCC601_16_235[];*/
/*extern unsigned short tRGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235[];*/
/*extern unsigned short tRGB2YUV_COEF_YCC709_0_255_TO_YCC601_16_235[];*/
/*extern unsigned short tRGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235[];*/
/*extern unsigned short tRGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235[];*/
extern unsigned short tRGB2YUV_COEF[RGB2YUV_COEF_MATRIX_MODE_Max][RGB2YUV_COEF_MATRIX_ITEMS_Max];

extern unsigned char RGB2YUV_if_RGB_mode;
extern unsigned char ConBriMapping_Offset_Table[16][VIP_YUV2RGB_LEVEL_SELECT_MAX][2];
extern unsigned char AVBlackLevelMapping_Table[8][3][4];
extern unsigned char ATVBlackLevelMapping_Table[8][3][4];

unsigned char g_DSE_en = 0;
VPQ_SAT_LUT_T g_sat_LUT = 	{{0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80},
							{0xf, 0x1f, 0x2f, 0x3f, 0x4f, 0x5f, 0x6f, 0x7f, 0x8f, 0x9f, 0xaf, 0xbf, 0xcf, 0xdf, 0xef, 0xff}};
VPQ_SAT_LUT_T g_sat_gain = 	{{0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80},
							{0xf, 0x1f, 0x2f, 0x3f, 0x4f, 0x5f, 0x6f, 0x7f, 0x8f, 0x9f, 0xaf, 0xbf, 0xcf, 0xdf, 0xef, 0xff}};
VPQ_SAT_LUT_T g_total_sat_gain = {{0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80},
							{0xf, 0x1f, 0x2f, 0x3f, 0x4f, 0x5f, 0x6f, 0x7f, 0x8f, 0x9f, 0xaf, 0xbf, 0xcf, 0xdf, 0xef, 0xff}};

extern bool g_bTV002_Dynamic_Processing;
short g_TV002_Con_Offset = 128, g_TV002_Bri_Offset = 128;
/* ========= ColorMatrix ==========*/

extern DRV_VipNewDcti_auto_adjust tVipNewDcti_auto_adjust[DCTI_TABLE_LEVEL_MAX];
//extern DRV_VipNewDDcti_Table gVipDNewDcti_Table[DCTI_TABLE_LEVEL_MAX];
//extern DRV_VipNewIDcti_Table gVipINewDcti_Table[DCTI_TABLE_LEVEL_MAX];
//extern DRV_D_vcti_t gVipVcti_Table[DCTI_TABLE_LEVEL_MAX];
extern DRV_D_vcti_lpf_t gVipVcti_lpf_Table[DCTI_TABLE_LEVEL_MAX];
extern DRV_VipUV_Delay_TOP_Table gVipUV_Delay_TOP_Table[]; //JZ add for CVBS NTSC

extern RPC_DCC_Advance_control_table Advance_control_table[Advance_control_table_MAX];
extern RPC_DCC_Curve_boundary_table Curve_boundary_table[Curve_boundary_table_MAX];
extern DRV_RPC_AutoMA_Flag S_RPC_AutoMA_Flag;

/*scaling down coef*/
extern DRV_ScalingDown_COEF_TAB ScaleDown_COEF_TAB;

/*profile coef*/
extern DRV_Vip_Profile_Table gVip_Profile_Table[PROFILE_TABLE_TOTAL];

/* vip pq bypass*/
extern VIP_PQ_ByPass_Struct PQ_ByPass_Struct[VIP_PQ_ByPass_TBL_Max];

/* for De XC */
extern VIP_I_De_XC_TBL I_De_XC_TBL[I_De_XC_TBL_Max];
/* for De Contour */
extern VIP_I_De_Contour_TBL I_De_Contour_TBL[I_De_Contour_TBL_Max];
/* for Block Decontour */
extern VIP_Block_DeContour_TBL Block_DeContour_TBL[I_De_Contour_TBL_Max];

/* MA I SNR and edge smooth*/
extern DRV_MA_SNR_IESM_Coef pq_misc_MA_SNR_IESM_TBL[MA_SNR_IESM_TBL_MAX];

/* PQ by pass*/
extern VIP_PQ_ByPass_Struct PQ_ByPass_Struct[VIP_PQ_ByPass_TBL_Max];

extern unsigned char vdc_power_status;
extern char vpq_v4l2_ai_nnsr_get_En(void);
#ifdef CONFIG_FORCE_RUN_I3DDMA
extern UINT8 get_nn_force_i3ddma_enable(void);
#endif
FILM_FW_ShareMem *g_Share_Memory_FILM_FW = NULL;
PQ_device_struct *g_Share_Memory_PQ_device_struct = NULL;

unsigned char bODInited = FALSE;
unsigned char bODTableLoaded = FALSE;
unsigned char bODPreEnable = FALSE;
unsigned int od_table_store[OD_table_length];
char od_table_mode_store = 0x7f;

VIP_SOURCE_TIMING fwif_PQSource = VIP_QUALITY_HDMI_1080I;

/* SQM releated*/
extern RTK_AI_PQ_mode aipq_mode; //SQM mode 0:off 1:on
extern int ai_resolution; //SQM status
unsigned char SQM_calMpde_index=0;//gain=1 or offset=0
unsigned char updateSQM_flag=0;
#ifdef SQM_OFFSET_TBL
short MBPK_TBL_forSQM[27]= {0};
short MFLTI_TBL_forSQM[5]= {0};
short TWODPK_TBL_forSQM[240]= {0};
#endif
unsigned short TV006DEMO_InvGamma[1025] = {
	0,
	22,
	72,
	107,
	147,
	201,
	241,
	298,
	337,
	387,
	433,
	472,
	528,
	567,
	620,
	659,
	696,
	750,
	787,
	831,
	875,
	911,
	963,
	997,
	1031,
	1082,
	1115,
	1148,
	1198,
	1231,
	1263,
	1311,
	1343,
	1374,
	1421,
	1452,
	1481,
	1529,
	1558,
	1588,
	1634,
	1662,
	1691,
	1728,
	1764,
	1792,
	1819,
	1864,
	1890,
	1918,
	1953,
	1987,
	2013,
	2039,
	2082,
	2107,
	2133,
	2158,
	2200,
	2224,
	2249,
	2275,
	2315,
	2338,
	2362,
	2388,
	2426,
	2449,
	2473,
	2496,
	2536,
	2558,
	2580,
	2602,
	2642,
	2664,
	2686,
	2711,
	2746,
	2767,
	2789,
	2809,
	2847,
	2868,
	2889,
	2910,
	2934,
	2968,
	2988,
	3008,
	3028,
	3058,
	3085,
	3105,
	3124,
	3143,
	3176,
	3199,
	3218,
	3237,
	3256,
	3288,
	3310,
	3329,
	3348,
	3366,
	3394,
	3419,
	3437,
	3456,
	3474,
	3495,
	3526,
	3543,
	3561,
	3579,
	3595,
	3628,
	3647,
	3664,
	3681,
	3698,
	3718,
	3749,
	3765,
	3782,
	3798,
	3814,
	3840,
	3865,
	3880,
	3897,
	3913,
	3928,
	3955,
	3978,
	3993,
	4009,
	4025,
	4039,
	4064,
	4088,
	4103,
	4118,
	4134,
	4148,
	4168,
	4196,
	4210,
	4225,
	4240,
	4255,
	4270,
	4299,
	4316,
	4330,
	4345,
	4359,
	4373,
	4392,
	4419,
	4433,
	4447,
	4461,
	4475,
	4488,
	4511,
	4534,
	4547,
	4561,
	4575,
	4589,
	4601,
	4624,
	4646,
	4659,
	4672,
	4686,
	4699,
	4712,
	4732,
	4756,
	4768,
	4781,
	4794,
	4807,
	4820,
	4834,
	4861,
	4875,
	4888,
	4901,
	4913,
	4926,
	4938,
	4959,
	4980,
	4992,
	5005,
	5017,
	5029,
	5041,
	5053,
	5077,
	5095,
	5106,
	5118,
	5131,
	5143,
	5154,
	5166,
	5190,
	5207,
	5218,
	5230,
	5242,
	5253,
	5265,
	5276,
	5297,
	5317,
	5327,
	5339,
	5350,
	5362,
	5373,
	5383,
	5399,
	5422,
	5434,
	5445,
	5456,
	5467,
	5478,
	5491,
	5515,
	5528,
	5539,
	5550,
	5560,
	5571,
	5582,
	5592,
	5607,
	5630,
	5642,
	5652,
	5662,
	5673,
	5684,
	5694,
	5704,
	5718,
	5740,
	5753,
	5762,
	5773,
	5783,
	5793,
	5804,
	5813,
	5824,
	5845,
	5861,
	5870,
	5881,
	5891,
	5901,
	5911,
	5921,
	5930,
	5945,
	5966,
	5977,
	5986,
	5996,
	6006,
	6016,
	6025,
	6035,
	6044,
	6061,
	6080,
	6090,
	6099,
	6109,
	6118,
	6128,
	6137,
	6147,
	6155,
	6172,
	6191,
	6201,
	6210,
	6219,
	6228,
	6238,
	6247,
	6256,
	6264,
	6277,
	6296,
	6310,
	6318,
	6327,
	6336,
	6345,
	6354,
	6363,
	6372,
	6380,
	6396,
	6415,
	6424,
	6433,
	6441,
	6450,
	6459,
	6468,
	6477,
	6485,
	6494,
	6510,
	6527,
	6537,
	6545,
	6553,
	6562,
	6570,
	6579,
	6588,
	6596,
	6604,
	6618,
	6636,
	6647,
	6654,
	6663,
	6671,
	6679,
	6688,
	6696,
	6704,
	6712,
	6722,
	6739,
	6754,
	6762,
	6770,
	6778,
	6786,
	6794,
	6802,
	6810,
	6818,
	6826,
	6837,
	6854,
	6867,
	6875,
	6883,
	6891,
	6898,
	6906,
	6914,
	6922,
	6930,
	6937,
	6947,
	6964,
	6978,
	6986,
	6993,
	7001,
	7008,
	7016,
	7024,
	7031,
	7039,
	7046,
	7054,
	7068,
	7085,
	7094,
	7101,
	7108,
	7116,
	7123,
	7131,
	7138,
	7146,
	7153,
	7160,
	7169,
	7184,
	7199,
	7207,
	7214,
	7221,
	7229,
	7236,
	7243,
	7251,
	7258,
	7265,
	7272,
	7280,
	7294,
	7309,
	7318,
	7325,
	7332,
	7339,
	7346,
	7353,
	7360,
	7367,
	7374,
	7381,
	7388,
	7399,
	7414,
	7426,
	7433,
	7440,
	7447,
	7453,
	7460,
	7467,
	7474,
	7481,
	7488,
	7494,
	7501,
	7514,
	7528,
	7539,
	7546,
	7552,
	7559,
	7566,
	7572,
	7579,
	7586,
	7593,
	7599,
	7605,
	7612,
	7623,
	7637,
	7649,
	7656,
	7662,
	7669,
	7675,
	7682,
	7689,
	7695,
	7702,
	7708,
	7715,
	7720,
	7728,
	7741,
	7755,
	7764,
	7770,
	7776,
	7783,
	7789,
	7796,
	7802,
	7808,
	7815,
	7821,
	7827,
	7833,
	7840,
	7853,
	7867,
	7876,
	7882,
	7888,
	7894,
	7900,
	7907,
	7913,
	7919,
	7925,
	7931,
	7938,
	7943,
	7950,
	7960,
	7974,
	7985,
	7992,
	7997,
	8003,
	8009,
	8015,
	8021,
	8027,
	8033,
	8039,
	8046,
	8051,
	8057,
	8064,
	8076,
	8088,
	8098,
	8104,
	8110,
	8116,
	8122,
	8127,
	8133,
	8139,
	8145,
	8150,
	8156,
	8165,
	8178,
	8190,
	8196,
	8200,
	8204,
	8208,
	8212,
	8217,
	8221,
	8226,
	8230,
	8235,
	8239,
	8243,
	8248,
	8252,
	8257,
	8261,
	8265,
	8270,
	8278,
	8288,
	8298,
	8305,
	8310,
	8314,
	8319,
	8323,
	8328,
	8332,
	8337,
	8342,
	8346,
	8351,
	8356,
	8360,
	8365,
	8370,
	8374,
	8378,
	8384,
	8394,
	8404,
	8414,
	8420,
	8425,
	8429,
	8433,
	8438,
	8443,
	8448,
	8453,
	8458,
	8463,
	8467,
	8472,
	8477,
	8482,
	8486,
	8491,
	8498,
	8508,
	8519,
	8528,
	8534,
	8538,
	8543,
	8548,
	8553,
	8558,
	8563,
	8568,
	8573,
	8578,
	8583,
	8588,
	8593,
	8598,
	8603,
	8610,
	8620,
	8631,
	8641,
	8646,
	8651,
	8656,
	8661,
	8666,
	8672,
	8677,
	8682,
	8687,
	8693,
	8698,
	8703,
	8708,
	8713,
	8719,
	8729,
	8740,
	8751,
	8757,
	8762,
	8767,
	8773,
	8778,
	8783,
	8789,
	8794,
	8800,
	8805,
	8811,
	8816,
	8821,
	8826,
	8833,
	8845,
	8856,
	8866,
	8872,
	8876,
	8882,
	8887,
	8893,
	8899,
	8904,
	8910,
	8916,
	8921,
	8927,
	8932,
	8937,
	8944,
	8955,
	8968,
	8977,
	8984,
	8989,
	8994,
	9000,
	9006,
	9011,
	9017,
	9023,
	9029,
	9035,
	9040,
	9046,
	9051,
	9060,
	9072,
	9085,
	9093,
	9098,
	9104,
	9109,
	9115,
	9121,
	9127,
	9133,
	9139,
	9145,
	9151,
	9157,
	9162,
	9170,
	9183,
	9196,
	9203,
	9207,
	9210,
	9212,
	9215,
	9219,
	9222,
	9226,
	9229,
	9233,
	9236,
	9240,
	9243,
	9247,
	9250,
	9254,
	9257,
	9261,
	9264,
	9267,
	9271,
	9274,
	9278,
	9284,
	9291,
	9299,
	9307,
	9313,
	9317,
	9320,
	9323,
	9327,
	9330,
	9334,
	9337,
	9341,
	9345,
	9348,
	9352,
	9356,
	9359,
	9363,
	9367,
	9370,
	9374,
	9378,
	9381,
	9384,
	9388,
	9393,
	9400,
	9408,
	9417,
	9423,
	9428,
	9432,
	9435,
	9438,
	9442,
	9446,
	9450,
	9454,
	9457,
	9461,
	9465,
	9469,
	9473,
	9476,
	9480,
	9484,
	9488,
	9491,
	9495,
	9499,
	9503,
	9510,
	9518,
	9527,
	9534,
	9539,
	9543,
	9547,
	9550,
	9554,
	9558,
	9562,
	9566,
	9570,
	9574,
	9578,
	9582,
	9586,
	9590,
	9594,
	9598,
	9602,
	9605,
	9609,
	9613,
	9619,
	9628,
	9636,
	9645,
	9651,
	9655,
	9658,
	9662,
	9666,
	9670,
	9674,
	9678,
	9682,
	9686,
	9691,
	9695,
	9699,
	9703,
	9707,
	9711,
	9715,
	9719,
	9723,
	9728,
	9736,
	9745,
	9754,
	9761,
	9766,
	9769,
	9773,
	9777,
	9781,
	9786,
	9790,
	9794,
	9798,
	9803,
	9807,
	9811,
	9815,
	9820,
	9824,
	9828,
	9832,
	9836,
	9842,
	9851,
	9860,
	9869,
	9875,
	9879,
	9883,
	9887,
	9892,
	9896,
	9900,
	9905,
	9909,
	9913,
	9918,
	9922,
	9927,
	9931,
	9935,
	9939,
	9943,
	9948,
	9954,
	9963,
	9973,
	9982,
	9988,
	9992,
	9996,
	10000,
	10005,
	10009,
	10014,
	10018,
	10023,
	10027,
	10032,
	10036,
	10041,
	10045,
	10050,
	10054,
	10058,
	10064,
	10072,
	10082,
	10092,
	10099,
	10103,
	10107,
	10112,
	10116,
	10121,
	10126,
	10130,
	10135,
	10139,
	10144,
	10149,
	10153,
	10158,
	10163,
	10167,
	10171,
	10178,
	10187,
	10197,
	10207,
	10212,
	10216,
	10220,
	10228,
	10240,
	10251,
	10262,
	10273,
	10283,
	10301,
	10322,
	10333,
	10343,
	10355,
	10366,
	10377,
	10387,
	10399,
	10421,
	10438,
	10448,
	10459,
	10470,
	10482,
	10493,
	10503,
	10518,
	10542,
	10554,
	10565,
	10576,
	10588,
	10599,
	10610,
	10621,
	10642,
	10661,
	10672,
	10683,
	10694,
	10706,
	10717,
	10728,
	10744,
	10768,
	10780,
	10791,
	10802,
	10814,
	10825,
	10836,
	10849,
	10873,
	10888,
	10899,
	10911,
	10923,
	10934,
	10948,
	10972,
	10986,
	10997,
	11009,
	11021,
	11032,
	11044,
	11056,
	11081,
	11096,
	11107,
	11119,
	11131,
	11143,
	11155,
	11167,
	11191,
	11208,
	11219,
	11231,
	11242,
	11261,
	11289,
	11324,
	11347,
	11370,
	11394,
	11433,
	11456,
	11479,
	11502,
	11543,
	11565,
	11589,
	11611,
	11652,
	11675,
	11699,
	11721,
	11762,
	11785,
	11809,
	11832,
	11873,
	11896,
	11920,
	11943,
	11983,
	12007,
	12031,
	12054,
	12095,
	12119,
	12143,
	12166,
	12207,
	12231,
	12255,
	12279,
	12320,
	16384,
};
#if IS_ENABLED(CONFIG_RTK_AI_DRV)
extern DRV_AI_SCENE_Ctrl_table ai_scene_ctrl;
extern unsigned int osd_con;
extern unsigned int osd_bri;
extern unsigned int osd_sat;
#endif

/*NNSR related definition*/
//unsigned short srnn_model_para_mode2_tmp[16][7380]={0};
unsigned short pout_array[35000]={0};
extern unsigned char weight_blending_ctrl[5];
extern unsigned char blending_ratio_ctrl[5];

/*End of NNSR related definition*/

VIP_SOURCE_TIMING fwif_Get_PQSource(void)
{
	return fwif_PQSource;
}

void fwif_Save_PQSource(VIP_SOURCE_TIMING src)
{
	fwif_PQSource = src;
}
char Osd_Outer_En=0;

/*
*	return value define in VipTable.h (system\project\tvsc_tv005\custom\vip_magellan)
*typedef enum _VIP_SOURCE_OPTION_TYPE {
*	VIP_SOURCE_TYPE_ATV = 0,
*	VIP_SOURCE_TYPE_AV,
*	VIP_SOURCE_TYPE_SV,
*	VIP_SOURCE_TYPE_YPP,
*	VIP_SOURCE_TYPE_SCART,
*	VIP_SOURCE_TYPE_DTV,
*	VIP_SOURCE_TYPE_HDMI,
*	VIP_SOURCE_TYPE_HDMI2,
*	VIP_SOURCE_TYPE_HDMI3,
*	VIP_SOURCE_TYPE_VGA,
*	VIP_SOURCE_TYPE_IDTV,
*	VIP_SOURCE_TYPE_PLAYBACK,
*	VIP_SOURCE_TYPE_YOUTUBE,
*	VIP_SOURCE_TYPE_MIRACAST,
*	VIP_SOURCE_TYPE_MAX_NUM,
*} VIP_SOURCE_OPTION_TYPE;
*/
/*SLR_MAIN_DISPLAY, SLR_SUB_DISPLAY for channel*/
UINT8 fwif_PQSource_main = 6;	/*VIP_SOURCE_TYPE_HDMI*/
UINT8 fwif_PQSource_sub = 6;	/*VIP_SOURCE_TYPE_HDMI*/
UINT8 fwif_Get_SWSourceByCH(SCALER_DISP_CHANNEL channel)
{
	if (channel == SLR_MAIN_DISPLAY)
		return fwif_PQSource_main;
	else
		return fwif_PQSource_sub;
}

UINT8 fwif_Get_SWSource(void)
{
	return fwif_Get_SWSourceByCH(SLR_MAIN_DISPLAY);
}

void fwif_Save_SWSource(UINT8 main_source, UINT8 sub_source)
{
	fwif_PQSource_main = main_source;
	fwif_PQSource_sub = sub_source;
}

/*other memory Endian*/
void fwif_color_ChangeUINT32Endian_Copy(unsigned int *pwTemp, int nSize, unsigned int *pwCopyTemp, unsigned char convert_endian_flag)
{
	int i;
	if (pwTemp && pwCopyTemp) {
		for (i = 0; i < (nSize); i++)
			pwCopyTemp[i] = convert_endian_flag?Scaler_ChangeUINT32Endian(pwTemp[i]):pwTemp[i];
	} else {
#ifdef CONFIG_ARM64 //ARM32 compatible
		VIPprintf("Warring!! %s's pwTemp = %lx, size = %d\n", __FUNCTION__, (unsigned long)pwTemp, nSize);
#else
		VIPprintf("Warring!! %s's pwTemp = %x, size = %d\n", __FUNCTION__, (unsigned int)pwTemp, nSize);
#endif
	}
}
void fwif_color_ChangeINT32Endian_Copy(int *pwTemp, int nSize, int *pwCopyTemp, unsigned char convert_endian_flag)
{
	int i;
	if (pwTemp && pwCopyTemp) {
		for (i = 0; i < (nSize); i++)
			pwCopyTemp[i] = convert_endian_flag?Scaler_ChangeUINT32Endian(pwTemp[i]):pwTemp[i];
	} else {
#ifdef CONFIG_ARM64 //ARM32 compatible
		VIPprintf("Warring!! %s's pwTemp = %lx, size = %d\n", __FUNCTION__, (unsigned long)pwTemp, nSize);
#else
		VIPprintf("Warring!! %s's pwTemp = %x, size = %d\n", __FUNCTION__, (unsigned int)pwTemp, nSize);
#endif
	}
}

void fwif_color_ChangeUINT16Endian_Copy(unsigned short *pwTemp, int nSize, unsigned short *pwCopyTemp, unsigned char convert_endian_flag)
{
	int i;
	if (pwTemp && pwCopyTemp) {
		for (i = 0; i < (nSize); i++)
			pwCopyTemp[i] = convert_endian_flag?Scaler_ChangeUINT16Endian(pwTemp[i]):pwTemp[i];
	} else {
#ifdef CONFIG_ARM64 //ARM32 compatible
		VIPprintf("Warring!! %s's pwTemp = %lx, size = %d\n", __FUNCTION__, (unsigned long)pwTemp, nSize);
#else
		VIPprintf("Warring!! %s's pwTemp = %x, size = %d\n", __FUNCTION__, (unsigned int)pwTemp, nSize);
#endif
	}
}
void fwif_color_ChangeINT16Endian_Copy(short *pwTemp, int nSize, short *pwCopyTemp, unsigned char convert_endian_flag)
{
	int i;
	if (pwTemp && pwCopyTemp) {
		for (i = 0; i < (nSize); i++)
			pwCopyTemp[i] = convert_endian_flag?Scaler_ChangeUINT16Endian(pwTemp[i]):pwTemp[i];
	} else {
#ifdef CONFIG_ARM64 //ARM32 compatible
		VIPprintf("Warring!! %s's pwTemp = %lx, size = %d\n", __FUNCTION__, (unsigned long)pwTemp, nSize);
#else
		VIPprintf("Warring!! %s's pwTemp = %x, size = %d\n", __FUNCTION__, (unsigned int)pwTemp, nSize);
#endif
	}
}

/* same memory Endian*/
void fwif_color_ChangeUINT32Endian(unsigned int *pwTemp, int nSize, unsigned char convert_endian_flag)
{
	int i;
	if (pwTemp) {
		if(convert_endian_flag) {
			for (i = 0; i < (nSize); i++)
				pwTemp[i] = Scaler_ChangeUINT32Endian(pwTemp[i]);
		}
	} else {
#ifdef CONFIG_ARM64 //ARM32 compatible
		VIPprintf("Warring!! %s's pwTemp = %lx, size = %d\n", __FUNCTION__, (unsigned long)pwTemp, nSize);
#else
		VIPprintf("Warring!! %s's pwTemp = %x, size = %d\n", __FUNCTION__, (unsigned int)pwTemp, nSize);
#endif
	}
}
void fwif_color_ChangeINT32Endian(int *pwTemp, int nSize, unsigned char convert_endian_flag)
{
	int i;
	if (pwTemp) {
		if(convert_endian_flag) {
			for (i = 0; i < (nSize); i++)
				pwTemp[i] = Scaler_ChangeUINT32Endian(pwTemp[i]);
		}
	} else {
#ifdef CONFIG_ARM64 //ARM32 compatible
		VIPprintf("Warring!! %s's pwTemp = %lx, size = %d\n", __FUNCTION__, (unsigned long)pwTemp, nSize);
#else
		VIPprintf("Warring!! %s's pwTemp = %x, size = %d\n", __FUNCTION__, (unsigned int)pwTemp, nSize);
#endif
	}
}

void fwif_color_ChangeUINT16Endian(unsigned short *pwTemp, int nSize, unsigned char convert_endian_flag)
{
	int i;
	if (pwTemp) {
		if(convert_endian_flag) {
			for (i = 0; i < (nSize); i++)
				pwTemp[i] = Scaler_ChangeUINT16Endian(pwTemp[i]);
		}
	} else {
#ifdef CONFIG_ARM64 //ARM32 compatible
		VIPprintf("Warring!! %s's pwTemp = %lx, size = %d\n", __FUNCTION__, (unsigned long)pwTemp, nSize);
#else
		VIPprintf("Warring!! %s's pwTemp = %x, size = %d\n", __FUNCTION__, (unsigned int)pwTemp, nSize);
#endif
	}
}
void fwif_color_ChangeINT16Endian(short  *pwTemp, int nSize, unsigned char convert_endian_flag)
{
	int i;
	if (pwTemp) {
		if(convert_endian_flag) {
			for (i = 0; i < (nSize); i++)
				pwTemp[i] = Scaler_ChangeUINT16Endian(pwTemp[i]);
		}
	} else {
#ifdef CONFIG_ARM64 //ARM32 compatible
		VIPprintf("Warring!! %s's pwTemp = %lx, size = %d\n", __FUNCTION__, (unsigned long)pwTemp, nSize);
#else
		VIPprintf("Warring!! %s's pwTemp = %x, size = %d\n", __FUNCTION__, (unsigned int)pwTemp, nSize);
#endif
	}
}

unsigned int fwif_color_ChangeOneUINT32Endian(unsigned int pwTemp, unsigned char convert_endian_flag)
{
	if(convert_endian_flag) {
		return Scaler_ChangeUINT32Endian(pwTemp);
	} else {
		return pwTemp;
	}
}

unsigned short fwif_color_ChangeOneUINT16Endian(unsigned short pwTemp, unsigned char convert_endian_flag)
{
	if(convert_endian_flag) {
		return Scaler_ChangeUINT16Endian(pwTemp);
	} else {
		return pwTemp;
	}
}


unsigned char fwif_color_Send_RPC_VIP_Table(SLR_VIP_TABLE *pVIPtable)
{
	int ret;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long virAddr = 0;
#else
	unsigned int virAddr = 0;
#endif
	extern VIP_MA_ChromaError MA_Chroma_Error_Table[t_MA_Chroma_Error_MAX];

	RPC_SLR_VIP_TABLE *pRPC_SLR_VIP_TABLE = NULL;
	VIP_MA_ChromaError *pMA_Chroma_Error_Table = MA_Chroma_Error_Table;

	extern VIP_MA_ChromaError MA_Chroma_Error_Table[t_MA_Chroma_Error_MAX];
	virAddr = Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_TABLE_STRUCT);

#ifdef CONFIG_ARM64 //ARM32 compatible
	VIPprintf("sizeof SLR_VIP_TABLE = %zu !!\n", sizeof(RPC_SLR_VIP_TABLE));
#else
	VIPprintf("sizeof SLR_VIP_TABLE = %d !!\n", sizeof(RPC_SLR_VIP_TABLE));
#endif
	if (0 == virAddr) {
		VIPprintf("GetShareMemVirAddr SCALERIOC_VIP_RPC_TABLE_STRUCT fail !!!\n");
		return FALSE;
	}
	pRPC_SLR_VIP_TABLE = (RPC_SLR_VIP_TABLE*)virAddr;

#ifdef CONFIG_ARM64
	memcpy_toio(pRPC_SLR_VIP_TABLE->VIP_QUALITY_Coef, pVIPtable->VIP_QUALITY_Coef, sizeof(unsigned char)*(VIP_QUALITY_SOURCE_NUM*VIP_QUALITY_Coef_MAX));
	memcpy_toio(pRPC_SLR_VIP_TABLE->MA_Chroma_Error_Table, pMA_Chroma_Error_Table, (sizeof(RPC_VIP_MA_ChromaError)*t_MA_Chroma_Error_MAX));
#else
	memcpy(pRPC_SLR_VIP_TABLE->VIP_QUALITY_Coef, pVIPtable->VIP_QUALITY_Coef, sizeof(unsigned char)*(VIP_QUALITY_SOURCE_NUM*VIP_QUALITY_Coef_MAX));
	memcpy(pRPC_SLR_VIP_TABLE->MA_Chroma_Error_Table, pMA_Chroma_Error_Table, (sizeof(RPC_VIP_MA_ChromaError)*t_MA_Chroma_Error_MAX));
#endif

	g_RPC_Share_Memory_VIP_TABLE_Struct = pRPC_SLR_VIP_TABLE;

	ret = Scaler_SendRPC(SCALERIOC_VIP_RPC_TABLE_STRUCT, 0, 0);
	if (0 !=  ret) {
		VIPprintf("ret = %d, Get SCALERIOC_VIP_TABLE_STRUCT fail !!!\n", ret);
		return FALSE;
	}

	return TRUE;
}


unsigned char fwif_color_Send_VIP_Table(SLR_VIP_TABLE *pVIPtable)
{
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long virAddr = 0;
#else
	unsigned int virAddr = 0;
#endif

#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long cluAddr = Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);
	unsigned long dcrAddr = Scaler_GetShareMemVirAddr(SCALERIOC_DCR_TABLE);
	unsigned long RPCcluAddr = Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_SMARTPIC_CLUS);
#else
	unsigned int cluAddr = Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);
	unsigned int dcrAddr = Scaler_GetShareMemVirAddr(SCALERIOC_DCR_TABLE);
	unsigned int RPCcluAddr = Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_SMARTPIC_CLUS);
#endif

	virAddr = Scaler_GetShareMemVirAddr(SCALERIOC_VIP_TABLE_STRUCT);

#ifdef CONFIG_ARM64 //ARM32 compatible
	VIPprintf("sizeof SLR_VIP_TABLE = %zu !!\n", sizeof(SLR_VIP_TABLE));
#else
	VIPprintf("sizeof SLR_VIP_TABLE = %d !!\n", sizeof(SLR_VIP_TABLE));
#endif
	if (0 == virAddr) {
		VIPprintf("GetShareMemVirAddr SCALERIOC_VIP_TABLE_STRUCT fail !!!\n");
		return FALSE;
	}
	memcpy((SLR_VIP_TABLE *)virAddr, pVIPtable, sizeof(SLR_VIP_TABLE));

	g_Share_Memory_VIP_TABLE_Struct = pVIPtable; //direct use global data
	fwif_color_Share_Memory_Access_VIP_TABLE_Struct((unsigned long)pVIPtable); //direct use global data
	
	//g_Share_Memory_VIP_TABLE_Struct = (SLR_VIP_TABLE *)virAddr; //nomore use non-cached sharememory for better performance
	//fwif_color_Share_Memory_Access_VIP_TABLE_Struct(virAddr); //nomore use non-cached sharememory for better performance

	SmartPic_clue = 	((_clues *)cluAddr);
	DCR_TABLE = ((unsigned char*)dcrAddr);
	RPC_SmartPic_clue = ((_RPC_clues *)RPCcluAddr);

	return TRUE;
}

/* === checksum ========== */
unsigned char fwif_color_Send_VIP_Table_crc(VIP_table_crc_value *pVIPtableCrc)
{
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long virAddr = 0;
#else
	unsigned int virAddr = 0;
#endif

	virAddr = Scaler_GetShareMemVirAddr(SCALERIOC_VIP_TABLE_CRC_STRUCT);

#ifdef CONFIG_ARM64 //ARM32 compatible
	VIPprintf("sizeof VIP_table_crc_value = %zu !!\n", sizeof(VIP_table_crc_value));
#else
	VIPprintf("sizeof VIP_table_crc_value = %d !!\n", sizeof(VIP_table_crc_value));
#endif
	if (0 == virAddr) {
		VIPprintf("GetShareMemVirAddr SCALERIOC_VIP_TABLE_CRC_STRUCT fail !!!\n");
		return FALSE;
	}
#ifdef CONFIG_ARM64
	memcpy_toio((VIP_table_crc_value *)virAddr, pVIPtableCrc, sizeof(VIP_table_crc_value));
#else
	memcpy((VIP_table_crc_value *)virAddr, pVIPtableCrc, sizeof(VIP_table_crc_value));
#endif

	fwif_color_Share_Memory_Access_VIP_TABLE_CRC_Struct(virAddr);

	return TRUE;
}
/*==========================*/

DRV_RPC_AutoMA_Flag *fwif_color_GetAutoMA_Struct(void)
{
	_system_setting_info *system_setting_info = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	return &(system_setting_info->S_RPC_AutoMA_Flag);
}

RPC_DCC_LAYER_Array_Struct *fwif_color_GetDCC_LAYER_Array_Struct(void)
{
	return g_DCC_LAYER_Array_Struct;
}
/*
RPC_DCC_FUNCTION_Enable* fwif_color_GetDCC_FUNCTION_Struct(void)
{
	return g_DCC_FUNCTION_Struct;
}
*/
RPC_ICM_Global_Ctrl *fwif_color_GetICM_Global_Ctrl_Struct(void)
{
	_system_setting_info *system_setting_info = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	g_ICM_Global_Ctrl_Struct = &(system_setting_info->PQ_Setting_Info.S_RPC_ICM_Global_Ctrl);
	return g_ICM_Global_Ctrl_Struct;
}
SLR_VIP_TABLE *fwif_color_GetShare_Memory_VIP_TABLE_Struct(void)
{
	return g_Share_Memory_VIP_TABLE_Struct;
}

RPC_DCC_Advance_control_table *fwif_color_GetShare_Memory_DCC_Advance_control_Struct(void)
{
	_system_setting_info *system_setting_info = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	return &(system_setting_info->PQ_Setting_Info.DCC_info_coef.DCC_Advance_control_table[0]);
}

_clues *fwif_color_GetShare_Memory_SmartPic_clue(void)
{
	g_SmartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);
	return g_SmartPic_clue;
}


void fwif_color_set_MPEG_init(void)
{
	int value = 1;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	if (((VIP_system_info_structure_table->Timing) >=  _MODE_1080I25) &&
		((VIP_system_info_structure_table->Timing) <=  _MODE_1080PM60)) {
		value = 3;
	} else {
		value = 1;
	}

	fwif_color_set_quality_init_value(QUALITY_INIT_MPEGNR, value);

}


void fwif_color_set_VIP_RPC_system_info_structure(void)
{
	int ret;
	_RPC_system_setting_info *RPC_system_setting_info = (_RPC_system_setting_info *) Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
#ifdef CONFIG_ARM64 //ARM32 compatible
#else
	unsigned int addr = Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
#endif

	if(RPC_system_setting_info == NULL){
		VIPprintf("[%s:%d] Warning here!! RPC_system_info=NULL! \n",__FILE__, __LINE__);
		return;
	}

	RPC_system_setting_info->SCPU_ISRIINFO_TO_VCPU.VGIP_ISR_IN_VCPU_flag = 1;
#ifdef CONFIG_ARM64
	memcpy_toio((unsigned char *)(&RPC_system_setting_info->ScalingDown_Setting_INFO.ScalingDown_COEF_TAB), (unsigned char *)&ScaleDown_COEF_TAB, sizeof(DRV_ScalingDown_COEF_TAB));
	memcpy_toio((unsigned char *)(&RPC_system_setting_info->I_De_XC_CTRL.De_XC_TBL[0]), (unsigned char*)&I_De_XC_TBL[0], sizeof(VIP_I_De_XC_TBL)*I_De_XC_TBL_Max);
	memcpy_toio((unsigned char *)(&RPC_system_setting_info->PQ_ByPass_Ctrl.PQ_ByPass_Struct[0]), (unsigned char*)&PQ_ByPass_Struct[0], sizeof(VIP_PQ_ByPass_Struct )*VIP_PQ_ByPass_TBL_Max);
#else
	memcpy((unsigned char *)(&RPC_system_setting_info->ScalingDown_Setting_INFO.ScalingDown_COEF_TAB), (unsigned char *)&ScaleDown_COEF_TAB, sizeof(DRV_ScalingDown_COEF_TAB));
	memcpy((unsigned char *)(&RPC_system_setting_info->I_De_XC_CTRL.De_XC_TBL[0]), (unsigned char*)&I_De_XC_TBL[0], sizeof(VIP_I_De_XC_TBL)*I_De_XC_TBL_Max);
	memcpy((unsigned char *)(&RPC_system_setting_info->PQ_ByPass_Ctrl.PQ_ByPass_Struct[0]), (unsigned char*)&PQ_ByPass_Struct[0], sizeof(VIP_PQ_ByPass_Struct )*VIP_PQ_ByPass_TBL_Max);
#endif

	RPC_system_setting_info->PQ_source_type_from_AP = PQ_SRC_From_AP_UNKNOW;

	ret = Scaler_SendRPC(SCALERIOC_VIP_RPC_system_info_structure, 0, 0);
	if (0 !=  ret) {
		VIPprintf("ret = %d, update SCALERIOC_VIP_RPC_system_info_structure to driver fail !!!\n", ret);
	}

#ifdef CONFIG_ARM64 //ARM32 compatible
	fwif_color_Set_RPC_system_info_structure_table((unsigned long)RPC_system_setting_info);
#else
	fwif_color_Set_RPC_system_info_structure_table(addr);
#endif

}




/*Init function : system info. from AP to video fw and include some pq_misc_table structure!!*/
void fwif_color_set_VIP_system_info_structure(void)/*init by AP, this function used for video fw init sharemeory address*/
{
#ifdef CONFIG_ARM64 //ARM32 compatible
#else
	unsigned int addr = Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
#endif
	_system_setting_info *system_setting_info = (_system_setting_info *) Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	/*memcpy(((unsigned char *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure)), &system_info_structure_table, sizeof(_system_setting_info));*/
	//system_setting_info->SCPU_ISRIINFO_TO_VCPU.VGIP_ISR_IN_VCPU_flag = 1;

	/*set PQ misc table to  share memory*/
#ifdef CONFIG_ARM64
	memcpy_toio((unsigned char *)(&system_setting_info->PQ_Setting_Info.I_D_Dcti_INFO.auto_adjust_Table[0]), (unsigned char*)&tVipNewDcti_auto_adjust[0], sizeof(DRV_VipNewDcti_auto_adjust)*DCTI_TABLE_LEVEL_MAX);
	//memcpy_toio((unsigned char *)(&system_setting_info->PQ_Setting_Info.I_D_Dcti_INFO.iDcti_Table[0]), (unsigned char *)&gVipINewDcti_Table[0], sizeof(DRV_VipNewIDcti_Table)*DCTI_TABLE_LEVEL_MAX);
	//memcpy_toio((unsigned char *)(&system_setting_info->PQ_Setting_Info.I_D_Dcti_INFO.dDcti_Table[0]), (unsigned char *)&gVipDNewDcti_Table[0], sizeof(DRV_VipNewDDcti_Table)*DCTI_TABLE_LEVEL_MAX);
	memcpy_toio((unsigned char *)(&system_setting_info->S_RPC_AutoMA_Flag), (unsigned char *)&S_RPC_AutoMA_Flag, sizeof(DRV_RPC_AutoMA_Flag));
	memcpy_toio((unsigned char *)(&system_setting_info->PQ_Setting_Info.DCC_info_coef.DCC_Advance_control_table[0]), (unsigned char *)&Advance_control_table[0], sizeof(RPC_DCC_Advance_control_table) * Advance_control_table_MAX);
	memcpy_toio((unsigned char *)(&system_setting_info->PQ_Setting_Info.DCC_info_coef.DCC_Curve_boundary_table[0]), (unsigned char *)&Curve_boundary_table[0], sizeof(RPC_DCC_Curve_boundary_table) * Curve_boundary_table_MAX);
	memcpy_toio((unsigned char *)(&system_setting_info->PQ_Setting_Info.Profile_Table_Coef.Vip_Profile_Table[0]), (unsigned char*)&gVip_Profile_Table[0], sizeof(DRV_Vip_Profile_Table)*PROFILE_TABLE_TOTAL);
	//memcpy_toio((unsigned char *)(&system_setting_info->PQ_Setting_Info.I_De_Contour_CTRL.De_Contour_TBL[0]), (unsigned char*)&I_De_Contour_TBL[0], sizeof(VIP_I_De_Contour_TBL)*I_De_Contour_TBL_Max);
	memcpy_toio((unsigned char *)(&system_setting_info->PQ_Setting_Info.sMA_SNR_IESM_Coef_CTRL.MA_SNR_IESM_TBL[0]), (unsigned char*)&pq_misc_MA_SNR_IESM_TBL[0], sizeof(DRV_MA_SNR_IESM_Coef)*MA_SNR_IESM_TBL_MAX);

	//tool ctrl, flow ctrl ini
	memset ((unsigned char*)&system_setting_info->PQ_Setting_Info.PQA_Setting_INFO.Flow_Ctrl_Input_Type_setFlag[0], 0, PQA_INPUT_TYPE_MAX*sizeof(char));
	memset ((unsigned char*)&system_setting_info->PQ_Setting_Info.PQA_Setting_INFO.Flow_Ctrl_Input_Item_setFlag[0], 0, PQA_INPUT_ITEM_MAX*sizeof(char));
#else
	memcpy((unsigned char *)(&system_setting_info->PQ_Setting_Info.I_D_Dcti_INFO.auto_adjust_Table[0]), (unsigned char*)&tVipNewDcti_auto_adjust[0], sizeof(DRV_VipNewDcti_auto_adjust)*DCTI_TABLE_LEVEL_MAX);
	//memcpy((unsigned char *)(&system_setting_info->PQ_Setting_Info.I_D_Dcti_INFO.iDcti_Table[0]), (unsigned char *)&gVipINewDcti_Table[0], sizeof(DRV_VipNewIDcti_Table)*DCTI_TABLE_LEVEL_MAX);
	//memcpy((unsigned char *)(&system_setting_info->PQ_Setting_Info.I_D_Dcti_INFO.dDcti_Table[0]), (unsigned char *)&gVipDNewDcti_Table[0], sizeof(DRV_VipNewDDcti_Table)*DCTI_TABLE_LEVEL_MAX);
	memcpy((unsigned char *)(&system_setting_info->S_RPC_AutoMA_Flag), (unsigned char *)&S_RPC_AutoMA_Flag, sizeof(DRV_RPC_AutoMA_Flag));
	memcpy((unsigned char *)(&system_setting_info->PQ_Setting_Info.DCC_info_coef.DCC_Advance_control_table[0]), (unsigned char *)&Advance_control_table[0], sizeof(RPC_DCC_Advance_control_table) * Advance_control_table_MAX);
	memcpy((unsigned char *)(&system_setting_info->PQ_Setting_Info.DCC_info_coef.DCC_Curve_boundary_table[0]), (unsigned char *)&Curve_boundary_table[0], sizeof(RPC_DCC_Curve_boundary_table) * Curve_boundary_table_MAX);
	//RPC//memcpy((unsigned char *)(&system_setting_info->PQ_Setting_Info.ScalingDown_Setting_INFO.ScalingDown_COEF_TAB), (unsigned char *)&ScaleDown_COEF_TAB, sizeof(DRV_ScalingDown_COEF_TAB));

	memcpy((unsigned char *)(&system_setting_info->PQ_Setting_Info.Profile_Table_Coef.Vip_Profile_Table[0]), (unsigned char*)&gVip_Profile_Table[0], sizeof(DRV_Vip_Profile_Table)*PROFILE_TABLE_TOTAL);

	//memcpy((unsigned char *)(&system_setting_info->PQ_Setting_Info.I_De_Contour_CTRL.De_Contour_TBL[0]), (unsigned char*)&I_De_Contour_TBL[0], sizeof(VIP_I_De_Contour_TBL)*I_De_Contour_TBL_Max);
	//RPC//memcpy((unsigned char *)(&system_setting_info->PQ_Setting_Info.I_De_XC_CTRL.De_XC_TBL[0]), (unsigned char*)&I_De_XC_TBL[0], sizeof(VIP_I_De_XC_TBL)*I_De_XC_TBL_Max);

	memcpy((unsigned char *)(&system_setting_info->PQ_Setting_Info.sMA_SNR_IESM_Coef_CTRL.MA_SNR_IESM_TBL[0]), (unsigned char*)&pq_misc_MA_SNR_IESM_TBL[0], sizeof(DRV_MA_SNR_IESM_Coef)*MA_SNR_IESM_TBL_MAX);
	//RPC//memcpy((unsigned char *)(&system_setting_info->PQ_Setting_Info.PQ_ByPass_Ctrl.PQ_ByPass_Struct[0]), (unsigned char*)&PQ_ByPass_Struct[0], sizeof(VIP_PQ_ByPass_Struct )*VIP_PQ_ByPass_TBL_Max);


	//tool ctrl, flow ctrl ini
	memset ((unsigned char*)&system_setting_info->PQ_Setting_Info.PQA_Setting_INFO.Flow_Ctrl_Input_Type_setFlag[0], 0, PQA_INPUT_TYPE_MAX*sizeof(char));
	memset ((unsigned char*)&system_setting_info->PQ_Setting_Info.PQA_Setting_INFO.Flow_Ctrl_Input_Item_setFlag[0], 0, PQA_INPUT_ITEM_MAX*sizeof(char));
#endif

#ifdef CONFIG_ARM64 //ARM32 compatible
	fwif_color_Set_system_info_structure_table((unsigned long)system_setting_info);
#else
	fwif_color_Set_system_info_structure_table(addr);
#endif
	/* ini value, some demo platform have no AP, give OSD value*/
	system_setting_info->OSD_Info.Contrast_Gain = 128;
	system_setting_info->OSD_Info.Brightness_Gain = 128;
	system_setting_info->OSD_Info.Saturation_Gain = 128;
	system_setting_info->OSD_Info.Hue_Gain = 0;
	system_setting_info->OSD_Info.Saturation_Cmps = 128;
	system_setting_info->OSD_Info.Brightness_Cmps = 0;

/* //RPC//
	ret = Scaler_SendRPC(SCALERIOC_VIP_system_info_structure, 0, 0);
	if (0 !=  ret) {
		VIPprintf("ret = %d, update fwif_color_set_VIP_system_info_structure to driver fail !!!\n", ret);
	}
*/

}


/*
_system_setting_info* fwif_color_Get_VIP_system_info_structure(void)
{
	return ((_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure));
}
*/


/*===================================================================================== //DCC CSFC 20140127*/
/*==Set About DCC =====*/
void fwif_color_D_hist_init(unsigned char display, unsigned short width, unsigned short height)
{
#ifdef VPQ_COMPILER_ERROR_ENABLE
	/*int ret = 0;*/
	d_histogram_d_hist_in_cselect_RBUS d_histogram_d_hist_in_cselect_reg;
	d_histogram_d_hist_in_range_hor_RBUS d_histogram_d_hist_in_range_hor_reg;
	d_histogram_d_hist_in_range_ver_RBUS d_histogram_d_hist_in_range_ver_reg;
#if 0	/*#ifdef CONFIG_DUAL_CHANNEL*/
	d_histogram_d_ich2_hist_in_cselect_RBUS d_ich2_hist_in_cselect_Reg;
	d_histogram_d_ich2_hist_in_range_hor_RBUS d_ich2_hist_in_range_hor_Reg;
	d_histogram_d_ich2_hist_in_range_ver_RBUS d_ich2_hist_in_range_ver_Reg;
#endif

	/*	unsigned short ret;*/
	unsigned char shift_bits = 0,BinMode = 0;
	unsigned int total_pixel;
	static unsigned int Main_total_pixel;/*, Sub_total_pixel = 0;*/

	_system_setting_info *VIP_system_info_structure_table = NULL;
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	if(VIP_RPC_system_info_structure_table == NULL || VIP_system_info_structure_table == NULL){
		VIPprintf("[%s:%d] Warning here!! RPC_system_info=NULL!(%p,%p) \n",__FILE__, __LINE__,VIP_RPC_system_info_structure_table,VIP_system_info_structure_table);
		return;
	}

	if (display == _MAIN_DISPLAY) {
		d_histogram_d_hist_in_cselect_reg.regValue = IoReg_Read32(D_HISTOGRAM_D_Hist_IN_CSELECT_reg);
		d_histogram_d_hist_in_cselect_reg.his_enable_histog = 0;

	/*o----Check & Modify Histogram Bin Mode, avoid setting error. 20160624 from Merlin2 -----o*/
		BinMode = Mode_128Bin;
		VIPprintf("D_Hist BinMode -> Mode_128Bin \n");

		/*~20120816 fix 3d en DCR*/
		IoReg_Write32(D_HISTOGRAM_D_Hist_IN_CSELECT_reg, d_histogram_d_hist_in_cselect_reg.regValue);

		Main_total_pixel = (width*height) + 1;
		total_pixel = Main_total_pixel;
		VIPprintf("\n$$$$[DCC] width = %d, height = %d, total_pixel = %d\n", width, height, total_pixel);

		if (total_pixel <=  0x10000) { /*(2^16)*/
			shift_bits = 0;
		} else if (total_pixel > 0x10000 && total_pixel <=  0x20000) {/*(2^16) ~ (2^17)*/
			shift_bits = 0;
		} else if (total_pixel > 0x20000 && total_pixel <=  0x40000) {/*(2^17) ~ (2^18)*/
			shift_bits = 1;
		} else if (total_pixel > 0x40000 && total_pixel <=  0x80000) {/*(2^18) ~ (2^19)*/
			shift_bits = 2;
		} else if (total_pixel > 0x80000 && total_pixel <=  0x100000) {/*(2^19) ~ (2^20)*/
			shift_bits = 3;
		} else if (total_pixel > 0x100000 && total_pixel <=  0x200000) {/*(2^20) ~ (2^21)*/
			shift_bits = 4;
		} else if (total_pixel > 0x200000 && total_pixel <=  0x400000) {/*(2^21) ~ (2^22)*/
			shift_bits = 5;
		} else if ((total_pixel > 0x400000 && total_pixel <=  0x800000)) {/*(2^22) ~ (2^23)*/
			shift_bits = 6;
		} else {
			shift_bits = 7;
		}

		/*=== 20140512 CSFC for vip video fw infomation ====*/
		VIP_RPC_system_info_structure_table->DCC_D_hist_shift_bit = shift_bits;
		VIP_RPC_system_info_structure_table->D_Histogram_Bin_Mode = BinMode;
		/*====================================*/

		/*Histogram init*/
		//NOTE: if DTG, Pip_swap_en = 1(b8028004[29]), D_histogram range follow pip_mixer setting and range_hor and range_ver no-used!
		d_histogram_d_hist_in_range_hor_reg.regValue = IoReg_Read32(D_HISTOGRAM_D_Hist_IN_Range_Hor_reg);
		d_histogram_d_hist_in_range_hor_reg.ch1_his_horend = width - 1;
		d_histogram_d_hist_in_range_hor_reg.ch1_his_horstart = 0;
		IoReg_Write32(D_HISTOGRAM_D_Hist_IN_Range_Hor_reg, d_histogram_d_hist_in_range_hor_reg.regValue);
		d_histogram_d_hist_in_range_ver_reg.regValue = IoReg_Read32(D_HISTOGRAM_D_Hist_IN_Range_Ver_reg);
		d_histogram_d_hist_in_range_ver_reg.ch1_his_verend = height - 1;
		d_histogram_d_hist_in_range_ver_reg.ch1_his_verstart = 0;
		IoReg_Write32(D_HISTOGRAM_D_Hist_IN_Range_Ver_reg, d_histogram_d_hist_in_range_ver_reg.regValue);
		d_histogram_d_hist_in_cselect_reg.regValue = IoReg_Read32(D_HISTOGRAM_D_Hist_IN_CSELECT_reg);
		//d_histogram_d_hist_in_cselect_reg.ch1_his_shift_sel = shift_bits;
		d_histogram_d_hist_in_cselect_reg.his_mode_sel = 1; // continuous mode
		d_histogram_d_hist_in_cselect_reg.his_yuv_sel = 0;
		d_histogram_d_hist_in_cselect_reg.his_enable_histog = 1;
		d_histogram_d_hist_in_cselect_reg.his_updatelockmode_en = 0;
		d_histogram_d_hist_in_cselect_reg.even_odd_sel_4k120 = 0;
		IoReg_Write32(D_HISTOGRAM_D_Hist_IN_CSELECT_reg, d_histogram_d_hist_in_cselect_reg.regValue);
		/*o-------------------------------------------------------------------------o*/
	}
#if 0	/*#ifdef CONFIG_DUAL_CHANNEL*/
	else {
		d_ich2_hist_in_cselect_Reg.regValue = IoReg_Read32(D_HISTOGRAM_D_ICH2_Hist_IN_CSELECT_reg);
		d_ich2_hist_in_cselect_Reg.ch2_his_enable_histog = 0;
		IoReg_Write32(D_HISTOGRAM_D_ICH2_Hist_IN_CSELECT_reg, d_ich2_hist_in_cselect_Reg.regValue);

		Sub_total_pixel = width*height;
		total_pixel = Sub_total_pixel;

		if (total_pixel <=  0x10000)
			shift_bits = 0;
		else if (total_pixel > 0x10000 && total_pixel <=  0x20000)
			shift_bits = 1;
		else if (total_pixel > 0x20000 && total_pixel <=  0x40000)
			shift_bits = 2;
		else if (total_pixel > 0x40000 && total_pixel <=  0x80000)
			shift_bits = 3;
		else if (total_pixel > 0x80000 && total_pixel <=  0x100000)
			shift_bits = 4;
		else
			shift_bits = 5;

		/*Histogram init*/
		d_ich2_hist_in_range_hor_Reg.regValue = IoReg_Read32(D_HISTOGRAM_D_ICH2_Hist_IN_Range_Hor_reg);
		d_ich2_hist_in_range_hor_Reg.ch2_his_horend = width - 1;
		d_ich2_hist_in_range_hor_Reg.ch2_his_horstart = 0;
		IoReg_Write32(D_HISTOGRAM_D_ICH2_Hist_IN_Range_Hor_reg, d_ich2_hist_in_range_hor_Reg.regValue);
		d_ich2_hist_in_range_ver_Reg.regValue = IoReg_Read32(D_HISTOGRAM_D_ICH2_Hist_IN_Range_Ver_reg);
		d_ich2_hist_in_range_ver_Reg.ch2_his_verend = height - 1;
		d_ich2_hist_in_range_ver_Reg.ch2_his_verstart = 0;
		IoReg_Write32(D_HISTOGRAM_D_ICH2_Hist_IN_Range_Ver_reg, d_ich2_hist_in_range_ver_Reg.regValue);
		d_ich2_hist_in_cselect_Reg.regValue = IoReg_Read32(D_HISTOGRAM_D_ICH2_Hist_IN_CSELECT_reg);
	  	d_ich2_hist_in_cselect_Reg.ch2_his_even_odd_pos_sel = 0;/*after scale down*/
		d_ich2_hist_in_cselect_Reg.ch2_his_shift_sel = shift_bits;
		d_ich2_hist_in_cselect_Reg.ch2_his_mode_sel = 1;
		d_ich2_hist_in_cselect_Reg.ch2_his_num_flds = 0;
		d_ich2_hist_in_cselect_Reg.ch2_his_enable_histog = 1;
		IoReg_Write32(D_HISTOGRAM_D_ICH2_Hist_IN_CSELECT_reg, d_ich2_hist_in_cselect_Reg.regValue);
	}
#endif
#endif
}

void fwif_color_hist_init(unsigned char display, unsigned short width, unsigned short height, Histogram_BIN_MODE BinMode)/*TO DO : Change to Table Base Driver!! CSFC, 20140822*/
{
	/*int ret = 0;*/
	histogram_ich1_hist_in_cselect_RBUS ich1_hist_in_cselect_Reg;
	histogram_ich1_hist_in_range_hor_RBUS ich1_hist_in_range_hor_Reg;
	histogram_ich1_hist_in_range_ver_RBUS ich1_hist_in_range_ver_Reg;
#if 0	/*#ifdef CONFIG_DUAL_CHANNEL*/
	ich2_hist_in_cselect_RBUS ich2_hist_in_cselect_Reg;
	ich2_hist_in_range_hor_RBUS ich2_hist_in_range_hor_Reg;
	ich2_hist_in_range_ver_RBUS ich2_hist_in_range_ver_Reg;
#endif

	/*	unsigned short ret;*/
	unsigned char shift_bits;
	unsigned int total_pixel;
	static unsigned int Main_total_pixel;/*, Sub_total_pixel = 0;*/

	_system_setting_info *VIP_system_info_structure_table = NULL;
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	if(VIP_RPC_system_info_structure_table == NULL || VIP_system_info_structure_table == NULL){
		VIPprintf("[%s:%d] Warning here!! RPC_system_info=NULL!(%p,%p) \n",__FILE__, __LINE__, VIP_RPC_system_info_structure_table,VIP_system_info_structure_table);
		return;
	}

	if (display == _MAIN_DISPLAY) {
		ich1_hist_in_cselect_Reg.regValue = IoReg_Read32(HISTOGRAM_ICH1_Hist_IN_CSELECT_reg);
		ich1_hist_in_cselect_Reg.ch1_his_enable_histog = 0;

	/*o----Check & Modify Histogram Bin Mode, avoid setting error. 20160624 from Merlin2 -----o*/
		if( COLOR_HISTOGRAM_LEVEL == 32 ) { //video fw bin detector = 32 bin
			ich1_hist_in_cselect_Reg.bin_mode = 0;
			if( BinMode == Mode_128to32Bin ) {
				VIPprintf("Warning!!! Hist BinMode setting missmatch!!\n");
				VIPprintf("Bin_Mode change from Mode_128to32Bin to Mode_Orig_32Bin \n");
				BinMode = Mode_Orig_32Bin;
			} else if( BinMode == Mode_128Bin ) {
				VIPprintf("Warning!!! Hist BinMode setting missmatch!!\n");
				VIPprintf("Bin_Mode change from Mode_128Bin to Mode_Orig_32Bin \n");
				BinMode = Mode_Orig_32Bin;
			} else {
				VIPprintf("Hist BinMode -> Mode_Orig_32Bin \n");
			}
		} else { //video fw bin detector = 128 bin
			ich1_hist_in_cselect_Reg.bin_mode = 1;
			if( BinMode == Mode_Orig_32Bin ) {
				VIPprintf("Warning!!! Hist BinMode setting missmatch!!\n");
				VIPprintf("Bin_Mode change from Mode_Orig_32Bin to Mode_128to32Bin \n");
				BinMode = Mode_128to32Bin;
			} else if (BinMode == Mode_128to32Bin ){
				VIPprintf("Hist BinMode -> Mode_128to32Bin \n");
			} else {
				VIPprintf("Hist BinMode -> Mode_128Bin \n");
			}
		}

		/*20120816 fix 3d en DCR*/
		if (Scaler_Disp3dGetInfo((SCALER_DISP_CHANNEL)display, SLR_DISP_3D_3DTYPE) == SLR_3D_FRAMESEQUENCE) {
			VIPprintf("fwif_color_hist_init, 3d_en\n");
			ich1_hist_in_cselect_Reg.ch1_3d_en = 1;
		} else {
			ich1_hist_in_cselect_Reg.ch1_3d_en = 0;
		}
		if (bForceHist3DCtrl)
			ich1_hist_in_cselect_Reg.ch1_3d_en = 1;

		/*~20120816 fix 3d en DCR*/
		IoReg_Write32(HISTOGRAM_ICH1_Hist_IN_CSELECT_reg, ich1_hist_in_cselect_Reg.regValue);

		Main_total_pixel = (width*height) + 1;
		total_pixel = Main_total_pixel;
		VIPprintf("\n$$$$[DCC] width = %d, height = %d, total_pixel = %d\n", width, height, total_pixel);

		if (total_pixel <  0x10000) { /*(2^16)*/
			shift_bits = 0;
		} else if (total_pixel <  0x20000) {/*(2^16) ~ (2^17)*/
			shift_bits = 1;
		} else if (total_pixel <  0x40000) {/*(2^17) ~ (2^18)*/
			shift_bits = 2;
		} else if (total_pixel <  0x80000) {/*(2^18) ~ (2^19)*/
			shift_bits = 3;
		} else if (total_pixel <  0x100000) {/*(2^19) ~ (2^20)*/
			shift_bits = 4;
		} else if (total_pixel <  0x200000) {/*(2^20) ~ (2^21)*/
			shift_bits = 5;
		} else if (total_pixel <  0x400000) {/*(2^21) ~ (2^22)*/
			shift_bits = 6;
		} else if (total_pixel <  0x800000) {/*(2^22) ~ (2^23)*/
			shift_bits = 7;
		} else {
			shift_bits = 7; //overflow
		}

		/*=== 20140512 CSFC for vip video fw infomation ====*/
		VIP_RPC_system_info_structure_table->DCC_hist_shift_bit = shift_bits;
		VIP_system_info_structure_table->Histogram_Bin_Mode = BinMode;
		/*====================================*/

		/*Histogram init*/
		ich1_hist_in_range_hor_Reg.regValue = IoReg_Read32(HISTOGRAM_ICH1_Hist_IN_Range_Hor_reg);
		ich1_hist_in_range_hor_Reg.ch1_his_horend = width - 1;
		ich1_hist_in_range_hor_Reg.ch1_his_horstart = 0;
		IoReg_Write32(HISTOGRAM_ICH1_Hist_IN_Range_Hor_reg, ich1_hist_in_range_hor_Reg.regValue);
		ich1_hist_in_range_ver_Reg.regValue = IoReg_Read32(HISTOGRAM_ICH1_Hist_IN_Range_Ver_reg);
		ich1_hist_in_range_ver_Reg.ch1_his_verend = height - 1;
		ich1_hist_in_range_ver_Reg.ch1_his_verstart = 0;
		IoReg_Write32(HISTOGRAM_ICH1_Hist_IN_Range_Ver_reg, ich1_hist_in_range_ver_Reg.regValue);
		ich1_hist_in_cselect_Reg.regValue = IoReg_Read32(HISTOGRAM_ICH1_Hist_IN_CSELECT_reg);
	  ich1_hist_in_cselect_Reg.ch1_his_even_odd_pos_sel = 0;/*after scale down*/
		ich1_hist_in_cselect_Reg.ch1_his_shift_sel = shift_bits;
		ich1_hist_in_cselect_Reg.ch1_his_mode_sel = 1;
		ich1_hist_in_cselect_Reg.ch1_his_num_flds = 0;
		ich1_hist_in_cselect_Reg.ch1_his_enable_histog = 1;
		IoReg_Write32(HISTOGRAM_ICH1_Hist_IN_CSELECT_reg, ich1_hist_in_cselect_Reg.regValue);
		/*o-------------------------------------------------------------------------o*/
	}
#if 0	/*#ifdef CONFIG_DUAL_CHANNEL*/
	else {
		ich2_hist_in_cselect_Reg.regValue = IoReg_Read32(HISTOGRAM_ICH2_HIST_IN_CSELECT_VADDR);
		ich2_hist_in_cselect_Reg.ch2_his_enable_histog = 0;
		IoReg_Write32(HISTOGRAM_ICH2_HIST_IN_CSELECT_VADDR, ich2_hist_in_cselect_Reg.regValue);

		Sub_total_pixel = width*height;
		total_pixel = Sub_total_pixel;

		if (total_pixel <=  0x10000)
			shift_bits = 0;
		else if (total_pixel > 0x10000 && total_pixel <=  0x20000)
			shift_bits = 1;
		else if (total_pixel > 0x20000 && total_pixel <=  0x40000)
			shift_bits = 2;
		else if (total_pixel > 0x40000 && total_pixel <=  0x80000)
			shift_bits = 3;
		else if (total_pixel > 0x80000 && total_pixel <=  0x100000)
			shift_bits = 4;
		else
			shift_bits = 5;

		/*Histogram init*/
		ich2_hist_in_range_hor_Reg.regValue = IoReg_Read32(HISTOGRAM_ICH2_HIST_IN_RANGE_HOR_VADDR);
		ich2_hist_in_range_hor_Reg.ch2_his_horend = width - 1;
		ich2_hist_in_range_hor_Reg.ch2_his_horstart = 0;
		IoReg_Write32(HISTOGRAM_ICH2_HIST_IN_RANGE_HOR_VADDR, ich2_hist_in_range_hor_Reg.regValue);
		ich2_hist_in_range_ver_Reg.regValue = IoReg_Read32(HISTOGRAM_ICH2_HIST_IN_RANGE_VER_VADDR);
		ich2_hist_in_range_ver_Reg.ch2_his_verend = height - 1;
		ich2_hist_in_range_ver_Reg.ch2_his_verstart = 0;
		IoReg_Write32(HISTOGRAM_ICH2_HIST_IN_RANGE_VER_VADDR, ich2_hist_in_range_ver_Reg.regValue);
		ich2_hist_in_cselect_Reg.regValue = IoReg_Read32(HISTOGRAM_ICH2_HIST_IN_CSELECT_VADDR);
	  ich2_hist_in_cselect_Reg.ch2_his_even_odd_pos_sel = 0;/*after scale down*/
		ich2_hist_in_cselect_Reg.ch2_his_shift_sel = shift_bits;
		ich2_hist_in_cselect_Reg.ch2_his_mode_sel = 1;
		ich2_hist_in_cselect_Reg.ch2_his_num_flds = 0;
		ich2_hist_in_cselect_Reg.ch2_his_enable_histog = 1;
		IoReg_Write32(HISTOGRAM_ICH2_HIST_IN_CSELECT_VADDR, ich2_hist_in_cselect_Reg.regValue);
	}
#endif
}

void fwif_color_set_hist_3d_en(unsigned char bEnable)
{
	histogram_ich1_hist_in_cselect_RBUS ich1_hist_in_cselect_Reg;
	ich1_hist_in_cselect_Reg.regValue = IoReg_Read32(HISTOGRAM_ICH1_Hist_IN_CSELECT_reg);

	ich1_hist_in_cselect_Reg.ch1_3d_en = bEnable;
	IoReg_Write32(HISTOGRAM_ICH1_Hist_IN_CSELECT_reg, ich1_hist_in_cselect_Reg.regValue);
}

/*o-----DCC init Process-------o*/
void fwif_color_set_DCC_Init(unsigned char display)/*AP DCC block HW Setting init process*/
{
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	drvif_color_dcc_Curve_init(display);
	if (VIP_system_info_structure_table->HDR_flag == 1) {
		fwif_color_set_dcc_Curve_Write(SLR_SUB_DISPLAY, 129, &HDR_demo_sub_curve[0]);
	}

	drvif_color_set_dcc_chroma_compensation_Init(display);
	drvif_color_set_dcc_Chroma_enhance();
}

/*o------Picture mode setting-------o*/
void fwif_color_set_dcc_OnOff(unsigned char src_idx, VIP_DCC_Disable_Mode Mode)
{
	/*=== 20140421 CSFC for vip video fw infomation ====*/
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	/*====================================*/

	/*0:DCC_HWOFF_Bypass, 1:DCC_FWOFF_NZ, 2:DCC_ON*/
	switch (Mode) {
	case DCC_HWOFF_Bypass:
			drvif_color_dcc_on(_DISABLE);
			VIP_system_info_structure_table->DCC_FW_ONOFF = _ENABLE;
			break;
	case DCC_FWOFF_NZ:
			drvif_color_dcc_on(_ENABLE);
			VIP_system_info_structure_table->DCC_FW_ONOFF = _DISABLE;
			break;
	case DCC_ON:
			drvif_color_dcc_on(_ENABLE);
			VIP_system_info_structure_table->DCC_FW_ONOFF = _ENABLE;
			break;
	case DCC_ON_APPLY_AP_CURVE:
			drvif_color_dcc_on(_ENABLE);
			VIP_system_info_structure_table->DCC_FW_ONOFF = _ENABLE;
			break;
	default:
			drvif_color_dcc_on(_DISABLE);
			VIP_system_info_structure_table->DCC_FW_ONOFF = _DISABLE;
			break;
	}
}


/*Set DCC Mode : off/low/middle/high/default*/
void fwif_color_set_dcc_mode(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;

	VIPprintf(" VIPDCCTable_Setting fwif_color_set_dcc_mode  = %d \n", value);

	/*=== 20140421 CSFC for vip video fw infomation ====*/
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	VIP_system_info_structure_table->OSD_Info.OSD_DCC_Mode = value;
	/*====================================*/

	switch (value) {
	case SLR_DCC_OFF:/*default -> DCC_FWOFF_NZ*/
			fwif_color_set_dcc_OnOff(src_idx, DCC_FWOFF_NZ);/*0:DCC_HWOFF_Bypass, 1:DCC_FWOFF_NZ, 2:DCC_ON, */
			break;
	case SLR_DCC_LOW:
	case SLR_DCC_MID:
	case SLR_DCC_HIGH:
	case SLR_DCC_Default:
			fwif_color_set_dcc_OnOff(src_idx, DCC_ON);
			break;
	default:
			fwif_color_set_dcc_OnOff(src_idx, DCC_HWOFF_Bypass);
			break;
	}
}

/*o-------for VIP table DCC info sync. to video fw-------o*/
void fwif_color_set_DCC_Boundary_Check_Table(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.Boundary_Check_Table = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_Level_and_Blend_Coef_Table(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.Level_and_Blend_Coef_Table = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}


void fwif_color_set_DCC_hist_adjust_table(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.hist_adjust_table = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_AdaptCtrl_Level_Table(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.AdaptCtrl_Level_Table = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_User_Curve_Table(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.User_Curve_Table = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_database_Table(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.database_DCC_Table = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_Picture_Mode_Weight(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.Picture_Mode_Weight = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCL_W(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.DCL_W_level = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*==============================*/
}

void fwif_color_set_DCL_B(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.DCL_B_level = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}


void fwif_color_set_DCC_W_expand(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.Expand_W_Level = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_B_expand(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.Expand_B_Level = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_Blending_DelayTime(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.Delay_time = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_Blending_Step(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.Step = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

/*o------- for AP eng. menu level sync. -------o*/
void fwif_color_set_dcc_table_select(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.DCC_Table = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

#if 0
void fwif_color_set_dcc_level(unsigned char src_idx, unsigned char value, unsigned char SceneChange)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.DCC_Level = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_Sindex(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.DCC_SCurve_index = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_Shigh(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.DCC_SCurve_high = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_Slow(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.DCC_SCurve_low = value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}
#endif

void fwif_color_set_DCC_SC_for_Coef_Change(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}

void fwif_color_set_DCC_histogram_gain(unsigned char src_idx, unsigned char value, unsigned char bin_num)
{

	unsigned char Main_DCC_Hist_adjust_table = 0;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	SLR_VIP_TABLE *prt = NULL;
	VIP_DCC_Hist_Factor_Table *g_DCCHist_Factor_Table = NULL;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get _system_setting_info Error! return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	Main_DCC_Hist_adjust_table = VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.hist_adjust_table;

	prt = fwif_color_GetShare_Memory_VIP_TABLE_Struct();
	if (prt == NULL) {
		VIPprintf("~get share mem vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	g_DCCHist_Factor_Table = &(prt->DCC_Control_Structure.DCCHist_Factor_Table[Main_DCC_Hist_adjust_table]);

	g_DCCHist_Factor_Table->gain[bin_num] = value;
	/*=== 201408 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/


}

void fwif_color_set_DCC_histogram_offset(unsigned char src_idx, unsigned char value, unsigned char bin_num)
{

	unsigned char Main_DCC_Hist_adjust_table = 0;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	SLR_VIP_TABLE *prt = NULL;
	VIP_DCC_Hist_Factor_Table *g_DCCHist_Factor_Table = NULL;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get _system_setting_info Error! return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	Main_DCC_Hist_adjust_table = VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.hist_adjust_table;

	prt = fwif_color_GetShare_Memory_VIP_TABLE_Struct();
	if (prt == NULL) {
		VIPprintf("~get share mem vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	g_DCCHist_Factor_Table = &(prt->DCC_Control_Structure.DCCHist_Factor_Table[Main_DCC_Hist_adjust_table]);

	g_DCCHist_Factor_Table->offset[bin_num] = value;
	/*=== 201408 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/

}

void fwif_color_set_DCC_histogram_limit(unsigned char src_idx, unsigned char value, unsigned char bin_num)
{
	unsigned char Main_DCC_Hist_adjust_table = 0;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	SLR_VIP_TABLE *prt = NULL;
	VIP_DCC_Hist_Factor_Table *g_DCCHist_Factor_Table = NULL;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get _system_setting_info Error! return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	Main_DCC_Hist_adjust_table = VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.hist_adjust_table;

	prt = fwif_color_GetShare_Memory_VIP_TABLE_Struct();
	if (prt == NULL) {
		VIPprintf("~get share mem vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	g_DCCHist_Factor_Table = &(prt->DCC_Control_Structure.DCCHist_Factor_Table[Main_DCC_Hist_adjust_table]);

	g_DCCHist_Factor_Table->limit[bin_num] = value;
	/*=== 201408 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	/*===============================*/
}


UINT8 DEBUG_DCC_CURVE_SETECT = 0;
unsigned char fwif_color_Debug_Get_UserCurveDCC_Curve_Select(void)
{
	return DEBUG_DCC_CURVE_SETECT;
}

unsigned char fwif_color_Debug_Get_HIST_MEAN_VALUE(void)
{
	_clues *smartPic_clue;
	unsigned int pwCopyTemp = 0;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);
	fwif_color_ChangeUINT32Endian_Copy(&smartPic_clue->Hist_Y_Mean_Value, 1, &pwCopyTemp, 0);
	return pwCopyTemp;
}

unsigned char fwif_color_Debug_Get_Pure_Color_Flag(void)
{
	_clues *smartPic_clue;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);
	return smartPic_clue->PureColor;
}

unsigned char fwif_color_Debug_Get_Skin_Tone_Found_Flag(void)
{
	_clues *smartPic_clue;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);
	return smartPic_clue->skintoneflag;
}

unsigned char fwif_color_Debug_Get_UserCurveDCC_Curve_Weighting(unsigned char table_select)
{
	unsigned char return_ret = 0;

	return return_ret;
}

unsigned char fwif_color_Debug_Get_UserCurveDCC_Curve_Weighting_Skin(unsigned char table_select)
{
	unsigned char return_ret = 0;

	return return_ret;
}

void fwif_color_Debug_Set_UserCurveDCC_Curve_Apply(unsigned char table_select, unsigned char value)
{


}

void fwif_color_Debug_Set_UserCurveDCC_Curve_Select(unsigned char value)
{
	DEBUG_DCC_CURVE_SETECT = value;
}

void fwif_color_Debug_Set_UserCurveDCC_Curve_Weighting(unsigned char table_select, unsigned char value)
{

}

void fwif_color_Debug_Set_UserCurveDCC_Curve_Weighting_Skin(unsigned char table_select, unsigned char value)
{

}


/*Set System Fw Layer Driver*/
void fwif_color_set_dcc_chroma_compensation_driver(unsigned char src_idx, unsigned char value)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	VIP_DCC_Chroma_Compensation_TABLE *Chroma_Compensation_TABLE = NULL;
	//VIP_DCC_Chroma_Compensation_TABLE Chroma_Compensation_disabled = {{0}};

	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	if (value >= DCC_Chroma_Compensation_TABLE_MAX)
		value = 0;
		//Chroma_Compensation_TABLE = &(Chroma_Compensation_disabled);

	Chroma_Compensation_TABLE = &(gVip_Table->DCC_Control_Structure.DCC_Chroma_Compensation_Table[value]);

	// setting some information to sharememory
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.DCC_Chroma_Comp_Table= value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	//===============================

	VIPprintf("fwif_color_set_dcc_chroma_compensation Table = %d\n",value);
	drvif_color_set_dcc_chroma_compensation_Curve_Mode(_MAIN_DISPLAY, Chroma_Compensation_TABLE);
}

void fwif_color_set_dcc_Color_Independent_driver(unsigned char src_idx, unsigned char value)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	VIP_DCC_Color_Independent_Blending_Table *Color_Independent_Blending_Table = NULL;
	VIP_DCC_Color_Independent_Blending_Table Color_Independent_disabled = {{0}};

	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	if (value >= Color_Independent_Blending_Table_MAX)
		Color_Independent_Blending_Table = &(Color_Independent_disabled);
	else
	Color_Independent_Blending_Table = &(gVip_Table->DCC_Control_Structure.Color_Independent_Blending_Table[value]);

	// setting some information to sharememory
	VIP_system_info_structure_table->PQ_Setting_Info.DCC_info_coef.DCC_Color_Dep_Table= value;
	VIP_system_info_structure_table->DCC_Status_Change = 1;
	//===============================

	drvif_color_set_dcc_Color_Independent(Color_Independent_Blending_Table);
}


/*======== Set DCC =============*/
/*===============================================================================================	//DCC CSFC 20140127*/



/*===============================================================================================	//PictureMode CSFC 20140128*/
/*==== set picture mode*/
void fwif_color_set_set_picture_mode(unsigned char src_idx, unsigned char value)
{

	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	/*=== 20140722 CSFC for vip video fw infomation ====*/
	/*setting some information to sharememory*/
	VIP_system_info_structure_table->OSD_Info.Picture_mode = value;
	/*===============================*/


/*
	int ret;

	//copy to RPC share memory
	//memcpy((unsigned char *)Scaler_GetShareMemVirAddr(SCALERIOC_SET_PICTURE_MODE), &value, sizeof(unsigned char));
	if ((ret = Scaler_SendRPC(SCALERIOC_SET_PICTURE_MODE, value, RPC_SEND_VALUE_ONLY)) < 0)
	{
		VIPprintf("ret = %d, set picture mode to driver fail !!!\n", ret);
		return;
	}
*/
	/*Scaler_set_picmode_init_value(PICMODE_INIT_PICTURE_MODE, value);*/
}

/*==== set picture mode*/
/*===============================================================================================	//PictureMode CSFC 20140128*/

int fwif_color_setCon_Bri_Color_Tint(unsigned char src_idx, unsigned char display, int Con, int Bri, int Color, int Tint)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	SLR_VIP_TABLE *gVip_Table = NULL;

	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t = {{0}};
	unsigned char coef_level;
	unsigned char RGB_level;
	unsigned char tbl_select;
	unsigned char i, j, k; /*, Y_Clamp;*/
	int contrast, bri, color, tint, deg_tint;
	/*unsigned short *table_idx[3][3];*/
	unsigned short table_idx[3][3][VIP_YUV2RGB_Y_Seg_Max];
	short satTmp[3][3], hueTmp[3][3], kTmp[3][3], kTmp1[3][3];
	unsigned short satCmps;
	short cmps = 0;
	unsigned char Input_mode;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (VIP_system_info_structure_table == NULL || gVip_Table == NULL) {
		VIPprintf("~get shareMem | gvipTbl error return~\n");
		return -1;
	}

	memset(satTmp, 0, sizeof(satTmp));
	memset(hueTmp, 0, sizeof(hueTmp));
	memset(kTmp, 0, sizeof(kTmp));
	memset(kTmp1, 0, sizeof(kTmp1));

	coef_level = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.CoefByY_CtrlItem_Level;
	RGB_level = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.RGB_Offset_Level;
	tbl_select = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_TBL_Select;

	if (coef_level >=  VIP_YUV2RGB_LEVEL_SELECT_MAX || RGB_level >=  VIP_YUV2RGB_LEVEL_SELECT_MAX || tbl_select >=  YUV2RGB_TBL_Num) {
		VIPprintf("~level or table select Error return, level = %d, table select = %d, %s->%d, %s~\n", coef_level, tbl_select, __FILE__, __LINE__, __FUNCTION__);
		return -1;
	}

	Input_mode = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode;

	/*cal mapping gain.*/
	/*fwif_color_CalContrast_Gain(Con, &contrast, &Y_Clamp);*/
	contrast = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_CONTRAST, Con);
	bri = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_BRIGHTNESS, Bri);
	color = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_SATURTUION, Color);
	tint = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_HUE, Tint);
	tint = tint - 128;
	if (tint >=  0)
		deg_tint = tint;
	else
		deg_tint = 360 - (tint * (-1));
	VIPprintf("~gain, con = %d, bri = %d, color = %d, tint = %d~\n", contrast, bri, color, deg_tint);

	/*contrast compensation*/
	if (OSD_Contrast_Compensation) {
		fwif_color_CalContrast_Compensation(display, contrast, VIP_system_info_structure_table);
		cmps = fwif_color_ChangeOneUINT16Endian(VIP_system_info_structure_table->OSD_Info.Brightness_Cmps, 0);
		satCmps = fwif_color_ChangeOneUINT16Endian(VIP_system_info_structure_table->OSD_Info.Saturation_Cmps, 0);
		VIPprintf("fwif_color_setSaturation:::com_Saturation = %d, Saturation_Cmps = %d\n", color, satCmps);
	} else {
		cmps = 0;
		satCmps = 128;
	}
	/*Euler's formula*/
	hueTmp[0][0] = 1024;
	hueTmp[1][1] = CAdjustCosine(deg_tint);
	hueTmp[1][2] = CAdjustSine(deg_tint) * (-1);
	hueTmp[2][1] = CAdjustSine(deg_tint);
	hueTmp[2][2] = CAdjustCosine(deg_tint);

	/*restrict for sat, refernece to spec for k32.*/
	color = (color * satCmps) >> 7;
	color = (color > 128) ?  75 + (color*53 / 128) : color;
	satTmp[0][0] = 128;	/*128  = 1*/
	satTmp[1][1] = color;
	satTmp[2][2] = color;

	/*get vip table info for k coeff.*/	/* get table from pq misc, vip table is for coef gain*/
	/*table_idx[0][0] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[tbl_select].COEF_By_Y.K11[0]);
	table_idx[0][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[tbl_select].COEF_By_Y.K12[0]);
	table_idx[0][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[tbl_select].COEF_By_Y.K13[0]);
	table_idx[1][0] = table_idx[0][0];
	table_idx[1][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[tbl_select].COEF_By_Y.K22[0]);
	table_idx[1][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[tbl_select].COEF_By_Y.K23[0]);
	table_idx[2][0] = table_idx[0][0];
	table_idx[2][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[tbl_select].COEF_By_Y.K32[0]);
	table_idx[2][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[tbl_select].COEF_By_Y.K33[0]);*/
	for (i = 0; i < VIP_YUV2RGB_Y_Seg_Max; i++) {
		table_idx[0][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
		table_idx[0][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K12];
		table_idx[0][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K13];
		table_idx[1][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
		table_idx[1][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K22];
		table_idx[1][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K23];
		table_idx[2][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
		table_idx[2][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K32];
		table_idx[2][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K33];
	}

	/*matrix computation for contrast, sat and hue*/
	for (i = 0; i < VIP_YUV2RGB_Y_Seg_Max; i++) {
		for (j = 0; j < 3; j++) {
			for (k = 0; k < 3; k++) {
				kTmp[j][k] = table_idx[j][k][i];
				/*bigger than 0x3FF  = >neg*/
				if (j ==0) {	/* Y */
					if (kTmp[j][k] > VIP_YUV2RGB_K_Y_NEG_BND) {
						kTmp[j][k] = VIP_YUV2RGB_K_Y_NEG_CHANGE(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				} else { /* C */
					if (kTmp[j][k] > VIP_YUV2RGB_K_C_NEG_BND) {
						kTmp[j][k] = VIP_YUV2RGB_K_C_NEG_CHANGE(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				}
			}
		}

		/*3x3 matrix multiply*/
		for (j = 0; j < 3; j++)
			for (k = 0; k < 3; k++)
				kTmp1[j][k] = (kTmp[j][0] * hueTmp[0][k] + kTmp[j][1] * hueTmp[1][k] + kTmp[j][2] * hueTmp[2][k]) >> 10;

		for (j = 0; j < 3; j++)
			for (k = 0; k < 3; k++)
				kTmp[j][k] = (kTmp1[j][0] * satTmp[0][k] + kTmp1[j][1] * satTmp[1][k] + kTmp1[j][2] * satTmp[2][k]) >> 7;

		kTmp[0][0] = (kTmp[0][0] * contrast) >> 7;

		drv_vipCSMatrix_t.COEF_By_Y.K11[i] = kTmp[0][0];/*juwen, Merlin3, K11:S(11,8)->S(15,12)*//* juwen, by modifying pq_misc_table value*/
		drv_vipCSMatrix_t.COEF_By_Y.K12[i] = kTmp[0][1];
		drv_vipCSMatrix_t.COEF_By_Y.K13[i] = kTmp[0][2];
		drv_vipCSMatrix_t.COEF_By_Y.K22[i] = kTmp[1][1];
		drv_vipCSMatrix_t.COEF_By_Y.K23[i] = kTmp[1][2];
		drv_vipCSMatrix_t.COEF_By_Y.K32[i] = kTmp[2][1];
		drv_vipCSMatrix_t.COEF_By_Y.K33[i] = kTmp[2][2];
	}

	/*RGB offset setting for brightness*/
	drv_vipCSMatrix_t.RGB_Offset.R_offset = (((bri - 128) << 5) + (cmps << 4)) & 0x1ffff; /*20140220 roger for sync the brightness step with Mac, Magellen	modified by Flora, for Sirius; re - modified by Elsie 20140205*/
	drv_vipCSMatrix_t.RGB_Offset.G_offset = (((bri - 128) << 5) + (cmps << 4)) & 0x1ffff; /*cmps: 4bit fraction*/
	drv_vipCSMatrix_t.RGB_Offset.B_offset = (((bri - 128) << 5) + (cmps << 4)) & 0x1ffff;

	/*Clamp setting*/
	drv_vipCSMatrix_t.CTRL_ITEM.Y_Clamp = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.CTRL_ITEM.Y_Clamp;

	/*share memory setting*/
#ifdef CONFIG_ARM64
	memcpy_toio(&VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y, &drv_vipCSMatrix_t.COEF_By_Y, sizeof(DRV_VIP_YUV2RGB_COEF_By_Y));
	memcpy_toio(&VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset, &drv_vipCSMatrix_t.RGB_Offset, sizeof(DRV_VIP_YUV2RGB_RGB_Offset));
#else
	memcpy(&VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y, &drv_vipCSMatrix_t.COEF_By_Y, sizeof(DRV_VIP_YUV2RGB_COEF_By_Y));
	memcpy(&VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset, &drv_vipCSMatrix_t.RGB_Offset, sizeof(DRV_VIP_YUV2RGB_RGB_Offset));
#endif
	fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K11[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K12[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K13[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K22[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K23[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K32[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K33[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT32Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset.R_offset), 1, 0);
	fwif_color_ChangeUINT32Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset.G_offset), 1, 0);
	fwif_color_ChangeUINT32Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset.B_offset), 1, 0);
	VIP_system_info_structure_table->OSD_Info.Contrast_Gain = fwif_color_ChangeOneUINT16Endian((UINT16)contrast, 0);
	VIP_system_info_structure_table->OSD_Info.OSD_Contrast = Con;
	VIP_system_info_structure_table->OSD_Info.OSD_Hue = Tint;
	VIP_system_info_structure_table->OSD_Info.Hue_Gain = fwif_color_ChangeOneUINT16Endian(deg_tint, 0);
	VIP_system_info_structure_table->OSD_Info.OSD_Saturation = Color;
	VIP_system_info_structure_table->OSD_Info.Saturation_Gain = fwif_color_ChangeOneUINT16Endian(color, 0);
	VIP_system_info_structure_table->OSD_Info.OSD_Brightness = Bri;
	VIP_system_info_structure_table->OSD_Info.Brightness_Gain = fwif_color_ChangeOneUINT16Endian(bri, 0);

	if (display == SLR_MAIN_DISPLAY) {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Y_Clamp, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_Y_Only, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_C_Only, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Offset_Only, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	}
#ifdef VIP_CONFIG_DUAL_CHENNEL
	else {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Y_Clamp, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_Y_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_C_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Offset_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
	}
#endif
	return 0;
}

#if IS_ENABLED(CONFIG_RTK_AI_DRV)
extern short bri_10bit;
void fwif_color_setCon_Bri_Color_Tint_inYUV2RGB_from_OSD_Gain_AI(unsigned char src_idx, unsigned char display,  _system_setting_info *system_info_struct/*, int Con, int Bri, int Color*/)
{
	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t;
	unsigned short table_idx[3][3][VIP_YUV2RGB_Y_Seg_Max];
	short satTmp[3][3], hueTmp[3][3], kTmp[3][3], kTmp1[3][3];
	unsigned int satCmps;
	short cmps = 0;
	unsigned char Input_mode, YUV2RGB_TBL_Idx;

	UINT32 contrast, bri, color, deg_tint;
	int tbl_offset_R, tbl_offset_G, tbl_offset_B;

	UINT8 i, j, k;

	unsigned char bt2020_Constant_En;
	int bt2020_k13, bt2020_k32;

	Input_mode = system_info_struct->using_YUV2RGB_Matrix_Info.Input_Data_Mode;
	YUV2RGB_TBL_Idx = fwif_color_get_Decide_YUV2RGB_TBL_Index(src_idx, display, Input_mode);

	if (display == SLR_MAIN_DISPLAY) {
		contrast = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Contrast_Gain, 0);
		bri = bri_10bit;//fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Brightness_Gain, 0);
		color = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Saturation_Gain, 0);
		deg_tint = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Hue_Gain, 0);
		/*contrast compensation*/
		if (OSD_Contrast_Compensation) {
			cmps = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Brightness_Cmps, 0);
			satCmps = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Saturation_Cmps, 0);
			VIPprintf("fwif_color_setSaturation:::com_Saturation = %d, Saturation_Cmps = %d\n", color, satCmps);
		} else {
			cmps = 0;
			satCmps = 128;
		}
		/* for K13_2, K32_2*/
		if (system_info_struct->BT2020_CTRL.Enable_Flag == 1 && system_info_struct->BT2020_CTRL.Mode == BT2020_MODE_Constant)
			bt2020_Constant_En = 1;
		else
			bt2020_Constant_En = 0;
	} else {
		contrast = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Contrast_Gain_Sub, 0);
		bri = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Brightness_Gain_Sub, 0);
		color = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Saturation_Gain_Sub, 0);
		deg_tint = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Hue_Gain_Sub, 0);
		/*contrast compensation*/
		if (OSD_Contrast_Compensation) {
			cmps = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Brightness_Cmps_Sub, 0);
			satCmps = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Saturation_Cmps_Sub, 0);
			VIPprintf("fwif_color_setSaturation:::com_Saturation_sub = %d, Saturation_Cmps_Sub = %d\n", color, satCmps);
		} else {
			cmps = 0;
			satCmps = 128;
		}
		/* for K13_2, K32_2*/
		if (system_info_struct->BT2020_CTRL.Enable_Flag_Sub == 1 && system_info_struct->BT2020_CTRL.Mode_Sub == BT2020_MODE_Constant)
			bt2020_Constant_En = 1;
		else
			bt2020_Constant_En = 0;
	}

	VIPprintf("[vpq][%s][%d]contrast = %d, bri = %d, color = %d, deg_tint = %d\n", __FUNCTION__, __LINE__, contrast, bri, color, deg_tint);
	memset(satTmp, 0, sizeof(satTmp));
	memset(hueTmp, 0, sizeof(hueTmp));
	memset(kTmp, 0, sizeof(kTmp));
	memset(kTmp1, 0, sizeof(kTmp1));

	/* no hue function while bt2020_Constant_En*/
	if (bt2020_Constant_En == 1)
		deg_tint = 0;
	/*Euler's formula*/
	hueTmp[0][0] = 1024;
	hueTmp[1][1] = CAdjustCosine(deg_tint);
	hueTmp[1][2] = CAdjustSine(deg_tint) * (-1);
	hueTmp[2][1] = CAdjustSine(deg_tint);
	hueTmp[2][2] = CAdjustCosine(deg_tint);
	/*restrict for sat, refernece to spec for k32.*/
	#if 1 //lesley
	color = (color * satCmps) >> 7;
	//color = (color > 128) ?  75 + (color*53 / 128) : color;
	#endif
	satTmp[0][0] = 128;	/*128  = 1*/
	satTmp[1][1] = color;
	satTmp[2][2] = color;

	for (i = 0; i < VIP_YUV2RGB_Y_Seg_Max; i++) {
		table_idx[0][0][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K11];
		table_idx[0][1][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K12];
		table_idx[0][2][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K13];
		table_idx[1][0][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K11];
		table_idx[1][1][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K22];
		table_idx[1][2][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K23];
		table_idx[2][0][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K11];
		table_idx[2][1][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K32];
		table_idx[2][2][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K33];
	}

	/*matrix computation for contrast, sat and hue*/
	for (i = 0; i < VIP_YUV2RGB_Y_Seg_Max; i++) {
		for (j = 0; j < 3; j++) {
			for (k = 0; k < 3; k++) {
				kTmp[j][k] = table_idx[j][k][i];
				/*bigger than 0x3FF  = >neg*/
				if (j == 0) {
					if ((kTmp[j][k] > VIP_YUV2RGB_K_Y_NEG_BND)){
						kTmp[j][k] = VIP_YUV2RGB_K_Y_NEG_CHANGE(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				} else {
					if ((kTmp[j][k] > VIP_YUV2RGB_K_C_NEG_BND)){
						kTmp[j][k] = VIP_YUV2RGB_K_C_NEG_CHANGE(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				}
			}
		}
		/*3x3 matrix multiply*/
		for (j = 0; j < 3; j++)
			for (k = 0; k < 3; k++)
				kTmp1[j][k] = (kTmp[j][0] * hueTmp[0][k] + kTmp[j][1] * hueTmp[1][k] + kTmp[j][2] * hueTmp[2][k]) >> 10;

		for (j = 0; j < 3; j++)
			for (k = 0; k < 3; k++)
				kTmp[j][k] = (kTmp1[j][0] * satTmp[0][k] + kTmp1[j][1] * satTmp[1][k] + kTmp1[j][2] * satTmp[2][k]) >> 7;

		kTmp[0][0] = (kTmp[0][0] * contrast) >> 7;

		drv_vipCSMatrix_t.COEF_By_Y.K11[i] = kTmp[0][0];
		drv_vipCSMatrix_t.COEF_By_Y.K12[i] = kTmp[0][1];
		drv_vipCSMatrix_t.COEF_By_Y.K13[i] = kTmp[0][2];
		drv_vipCSMatrix_t.COEF_By_Y.K22[i] = kTmp[1][1];
		drv_vipCSMatrix_t.COEF_By_Y.K23[i] = kTmp[1][2];
		drv_vipCSMatrix_t.COEF_By_Y.K32[i] = kTmp[2][1];
		drv_vipCSMatrix_t.COEF_By_Y.K33[i] = kTmp[2][2];
	}

	/* bt2020_Constant_En,  for bt 2020 k13, k32*/
	if (bt2020_Constant_En == 1) {
		bt2020_k13 =  tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K13_2];
		bt2020_k32 =  tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K32_2];
		if (bt2020_k13 > VIP_YUV2RGB_K_C_NEG_BND) {
			bt2020_k13 = VIP_YUV2RGB_K_C_NEG_CHANGE(bt2020_k13);
			bt2020_k13 = bt2020_k13 * (-1);
		}
		if (bt2020_k32 > VIP_YUV2RGB_K_C_NEG_BND) {
			bt2020_k32 = VIP_YUV2RGB_K_C_NEG_CHANGE(bt2020_k32);
			bt2020_k32 = bt2020_k32 * (-1);
		}
		/* no hue function while bt 2020, only saturation*/
		bt2020_k13 = (bt2020_k13 * satTmp[1][1])>>7;
		bt2020_k32 = (bt2020_k32 * satTmp[1][1])>>7;
		/* driver for bt 2020*/
		drv_vipCSMatrix_t.COEF_By_Y.bt2020_K13= bt2020_k13;
		drv_vipCSMatrix_t.COEF_By_Y.bt2020_K32= bt2020_k32;
	}

	/*RGB offset setting for brightness*/
	/*Roffset, Goffset, Boffset: S(15,2)*//*bigger than 0x3FFF  = >neg*/
	tbl_offset_R = (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_R_Offset] > VIP_YUV2RGB_OFFSET_NEG_BND) ? (VIP_YUV2RGB_OFFSET_NEG_CHANGE(tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_R_Offset])) : (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_R_Offset]);
	tbl_offset_G = (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_G_Offset] > VIP_YUV2RGB_OFFSET_NEG_BND) ? (VIP_YUV2RGB_OFFSET_NEG_CHANGE(tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_G_Offset])) : (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_G_Offset]);
	tbl_offset_B = (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_B_Offset] > VIP_YUV2RGB_OFFSET_NEG_BND) ? (VIP_YUV2RGB_OFFSET_NEG_CHANGE(tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_B_Offset])) : (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_B_Offset]);
	#if 1 // lesley, bri 10 bits
	drv_vipCSMatrix_t.RGB_Offset.R_offset = (((bri - (128<<2)) << (5-2)) + (cmps << 4) + tbl_offset_R) & 0x1ffff; /*20140220 roger for sync the brightness step with Mac, Magellen	modified by Flora, for Sirius; re - modified by Elsie 20140205*/
	drv_vipCSMatrix_t.RGB_Offset.G_offset = (((bri - (128<<2)) << (5-2)) + (cmps << 4) + tbl_offset_G) & 0x1ffff; /*cmps: 4bit fraction*/
	drv_vipCSMatrix_t.RGB_Offset.B_offset = (((bri - (128<<2)) << (5-2)) + (cmps << 4) + tbl_offset_B) & 0x1ffff;
	#else // bri 8 bits
	drv_vipCSMatrix_t.RGB_Offset.R_offset = (((bri - 128) << 5) + (cmps << 4) + tbl_offset_R) & 0x1ffff; /*20140220 roger for sync the brightness step with Mac, Magellen	modified by Flora, for Sirius; re - modified by Elsie 20140205*/
	drv_vipCSMatrix_t.RGB_Offset.G_offset = (((bri - 128) << 5) + (cmps << 4) + tbl_offset_G) & 0x1ffff; /*cmps: 4bit fraction*/
	drv_vipCSMatrix_t.RGB_Offset.B_offset = (((bri - 128) << 5) + (cmps << 4) + tbl_offset_B) & 0x1ffff;
	#endif

	VIPprintf("[vpq][%s][%d]Input_mode = %d, YUV2RGB_TBL_Idx = %d, cmps = %d\n", __FUNCTION__, __LINE__, Input_mode, YUV2RGB_TBL_Idx, cmps);
	VIPprintf("[vpq][%s][%d]tbl_offset_R = %d, RGB_Offset.R_offset = %d\n", __FUNCTION__, __LINE__, tbl_offset_R, drv_vipCSMatrix_t.RGB_Offset.R_offset);
	VIPprintf("[vpq][%s][%d]tbl_offset_G = %d, RGB_Offset.G_offset = %d\n", __FUNCTION__, __LINE__, tbl_offset_G, drv_vipCSMatrix_t.RGB_Offset.G_offset);
	VIPprintf("[vpq][%s][%d]tbl_offset_B = %d, RGB_Offset.B_offset = %d\n", __FUNCTION__, __LINE__, tbl_offset_B, drv_vipCSMatrix_t.RGB_Offset.B_offset);

#ifdef ENABLE_xvYcc
	/* sync YUV2RGB flow*/
#endif

	/*Clamp setting*/
	/*drv_vipCSMatrix_t.CTRL_ITEM.Y_Clamp = Y_Clamp;*/
	drv_vipCSMatrix_t.CTRL_ITEM.Y_Clamp = system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.CTRL_ITEM.Y_Clamp;

	if (display == SLR_MAIN_DISPLAY) {
		/*share memory setting*/
#ifdef CONFIG_ARM64
		memcpy_toio(&system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y, &drv_vipCSMatrix_t.COEF_By_Y, sizeof(DRV_VIP_YUV2RGB_COEF_By_Y));
		memcpy_toio(&system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset, &drv_vipCSMatrix_t.RGB_Offset, sizeof(DRV_VIP_YUV2RGB_RGB_Offset));
#else
		memcpy(&system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y, &drv_vipCSMatrix_t.COEF_By_Y, sizeof(DRV_VIP_YUV2RGB_COEF_By_Y));
		memcpy(&system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset, &drv_vipCSMatrix_t.RGB_Offset, sizeof(DRV_VIP_YUV2RGB_RGB_Offset));
#endif
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K11[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K12[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K13[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K22[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K23[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K32[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K33[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT32Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset.R_offset), 1, 0);
		fwif_color_ChangeUINT32Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset.G_offset), 1, 0);
		fwif_color_ChangeUINT32Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset.B_offset), 1, 0);
		/*drv setting*/
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Y_Clamp, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_Y_Only, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_C_Only, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Offset_Only, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		/* bt2020_Constant_En,  for bt 2020 k13, k32*/
		if (bt2020_Constant_En == 1) {
			/*drv setting*/
			drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_BT2020_Only, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
			/*memory setting*/
			fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.bt2020_K13), 1, 0);
			fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.bt2020_K32), 1, 0);
		}
	}
/*#ifdef VIP_CONFIG_DUAL_CHENNEL*/
	else {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Y_Clamp, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_Y_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_C_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Offset_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		/* bt2020_Constant_En,  for bt 2020 k13, k32*/
		if (bt2020_Constant_En == 1)
			drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_BT2020_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
	}
/*#endif*/
	return;

}
#endif

int fwif_color_setCon_Bri_Color_Tint_from_System_Info(unsigned char src_idx, unsigned char display)
{
	int Con, Bri, Color, Tint;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL || gVip_Table == NULL) {
		VIPprintf("~get shareMem | return~\n");
		return  -1;
	}

	Con = VIP_system_info_structure_table->OSD_Info.OSD_Contrast;
	Bri = VIP_system_info_structure_table->OSD_Info.OSD_Brightness;
	Color = VIP_system_info_structure_table->OSD_Info.OSD_Saturation;
	Tint = VIP_system_info_structure_table->OSD_Info.OSD_Hue;
	VIPprintf("set pic From Sys = %d, %d, %d, %d\n", Con, Bri, Color, Tint);
	return fwif_color_setCon_Bri_Color_Tint(src_idx, display, Con, Bri, Color, Tint);

}

int fwif_color_get_ConBriMapping_Offset_Value(unsigned char HAL_Src_Idx, unsigned char UI_Level, unsigned char *Contrast, unsigned char *Brightness)
{
	unsigned char maxTBL_size;

	maxTBL_size = sizeof(ConBriMapping_Offset_Table) / (sizeof(char) * VIP_YUV2RGB_LEVEL_SELECT_MAX * 2);
	if (HAL_Src_Idx >=  maxTBL_size || UI_Level >=  VIP_YUV2RGB_LEVEL_SELECT_MAX) {
		VIPprintf("ConBriMapping_ReDefine Table size Error\n");
		return  -1;
	}

	*Contrast = ConBriMapping_Offset_Table[HAL_Src_Idx][UI_Level][0];
	*Brightness = ConBriMapping_Offset_Table[HAL_Src_Idx][UI_Level][1];
	VIPprintf("get_ConBriMapping_Offset = %d, %d\n", *Contrast, *Brightness);
	return 0;
}

int fwif_color_setConBri_FacMappingValue(unsigned char Contrast, unsigned char Brightness)
{
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	StructColorDataFacModeType *pColorFacTable = NULL;
	pColorFacTable = fwif_color_get_color_fac_mode(VIP_system_info_structure_table->color_fac_src_idx, 0);
	if (pColorFacTable == NULL) {
		VIPprintf("pColorFacTable = NULL\n");
		return  -1;
	}

	pColorFacTable->Brightness_50 = Brightness;
	pColorFacTable->Contrast_100 = Contrast;
	pColorFacTable->Contrast_50 = Contrast >> 1;
	return 0;
}

int fwif_color_get_VDBlackLevel_MappingValue(unsigned char HAL_Src_Idx, unsigned char UI_Level,
	unsigned char *Contrast, unsigned char *Brightness, unsigned char *Hue, unsigned char *Sat)
{
	unsigned char VDSatandard = 1; /*PAL*/
	unsigned char input_src_type;
	unsigned char input_src_form;
	unsigned char input_timming_info;
	unsigned char vdc_ColorStandard = VDC_MODE_NO_SIGNAL;

	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	if (!vdc_power_status) {
		VIPprintf("VDBlackLevel_MappingValue Error, VD power off\n");
		return -1;
	}

	if (HAL_Src_Idx > 1 || UI_Level > 2) {
		VIPprintf("VDBlackLevel_MappingValue Error\n");
		return  -1;
	}

	input_src_type = VIP_system_info_structure_table->Input_src_Type;
	input_src_form = VIP_system_info_structure_table->Input_src_Form;
	input_timming_info = VIP_system_info_structure_table->Timing;

	if (input_src_form == _SRC_FROM_VDC) {
		vdc_ColorStandard = drvif_module_vdc_ReadMode(VDC_SET);

		if (input_src_type == _SRC_TV) {
			switch (input_timming_info) {
			case _MODE_480I: /*NTSC*/
				if (vdc_ColorStandard == VDC_MODE_PALM)
					VDSatandard = 4; /*PAL - M*/
				else if (vdc_ColorStandard == VDC_MODE_NTSC443)
					VDSatandard = 3; /*NTSC - 443*/
				else if (vdc_ColorStandard == VDC_MODE_PAL60)
					VDSatandard = 6; /*PAL - 60*/
				else
					VDSatandard = 0; /*NTSC*/
				break;
			case _MODE_576I: /*PAL*/
				if (vdc_ColorStandard == VDC_MODE_SECAM)
					VDSatandard = 2; /*SECAM*/
				else if (vdc_ColorStandard == VDC_MODE_PALN)
					VDSatandard = 5; /*PAL - N*/
				else if (vdc_ColorStandard == VDC_MODE_PAL60)
					VDSatandard = 6; /*PAL - 60*/
				else if (vdc_ColorStandard == VDC_MODE_NTSC50)
					VDSatandard = 7; /*PAL - Nc*/
				else
					VDSatandard = 1; /*PAL*/
				break;
			default:		/*PAL*/
				return -1;
				/*VDSatandard = 1*/
				break;
			}
		} else if (input_src_type == _SRC_CVBS) {
			switch (input_timming_info) {
			case _MODE_480I: /*NTSC*/
				if (vdc_ColorStandard == VDC_MODE_PALM)
					VDSatandard = 4; /*PAL - M*/
				else if (vdc_ColorStandard == VDC_MODE_NTSC443)
					VDSatandard = 3; /*NTSC - 443*/
				else if (vdc_ColorStandard == VDC_MODE_PAL60)
					VDSatandard = 6; /*PAL - 60*/
				else
					VDSatandard = 0; /*NTSC*/
				break;
			case _MODE_576I: /*PAL*/
				if (vdc_ColorStandard == VDC_MODE_SECAM)
					VDSatandard = 2; /*SECAM*/
				else if (vdc_ColorStandard == VDC_MODE_PALN)
					VDSatandard = 5; /*PAL - N*/
				else if (vdc_ColorStandard == VDC_MODE_PAL60)
					VDSatandard = 6; /*PAL - 60*/
				else if (vdc_ColorStandard == VDC_MODE_NTSC50)
					VDSatandard = 7; /*PAL - Nc*/
				else
					VDSatandard = 1; /*PAL*/
				break;
			default:		/*PAL*/
				return -1;
				/*VDSatandard = 1;*/
				break;
			}
		}  else {
				return -1;
		}
	} else {
		return -1;
	}

	if (0 == HAL_Src_Idx) {/*ATV*/
		*Contrast = ATVBlackLevelMapping_Table[VDSatandard][UI_Level][0];
		*Brightness = ATVBlackLevelMapping_Table[VDSatandard][UI_Level][1];
		*Hue = ATVBlackLevelMapping_Table[VDSatandard][UI_Level][2];
		*Sat = ATVBlackLevelMapping_Table[VDSatandard][UI_Level][3];



	} else {/*AV*/
		*Contrast = AVBlackLevelMapping_Table[VDSatandard][UI_Level][0];
		*Brightness = AVBlackLevelMapping_Table[VDSatandard][UI_Level][1];
		*Hue = AVBlackLevelMapping_Table[VDSatandard][UI_Level][2];
		*Sat = AVBlackLevelMapping_Table[VDSatandard][UI_Level][3];

	}
	/*VIPprintf("Get VD Con = %d, Bri = %d\n", *Contrast, *Brightness);*/
	return 0;
}

int fwif_color_set_VDBlackLevel(unsigned char Contrast, unsigned char Brightness, unsigned char Hue, unsigned char Sat)
{
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	if ((VIP_system_info_structure_table->Input_src_Form) !=  _SRC_FROM_VDC) {
		VIPprintf("Warning!! It's not vdc Src !!");
		return  -1;
	}
	fwif_color_WaitFor_DEN_STOP_UZUDTG();
	drvif_module_vdc_SetContrast(Contrast);
	drvif_module_vdc_SetBrightness(Brightness);

	drvif_module_vdc_SetHue(Hue);
	drvif_module_vdc_SetSaturation(Sat);


	return 0;
}


/*===============================================================================================	//ConBri CSFC 20140128*/
/*========Set Con/Bri=============*/

void fwif_color_setCon_Bri_Color_Tint_inYUV2RGB_from_OSD_Gain(unsigned char src_idx, unsigned char display,  _system_setting_info *system_info_struct)
{
	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t = {{0}};
	unsigned short table_idx[3][3][VIP_YUV2RGB_Y_Seg_Max];
	short satTmp[3][3], hueTmp[3][3], kTmp[3][3], kTmp1[3][3];
	unsigned int satCmps;
	short cmps = 0;
	unsigned char Input_mode, YUV2RGB_TBL_Idx;

	UINT32 contrast, bri, color, deg_tint;
	int tbl_offset_R, tbl_offset_G, tbl_offset_B;

	UINT8 i, j, k;

	unsigned char bt2020_Constant_En;
	int bt2020_k13, bt2020_k32;
	unsigned int con_gain_max, color_gain_max;

	Input_mode = system_info_struct->using_YUV2RGB_Matrix_Info.Input_Data_Mode;
	YUV2RGB_TBL_Idx = fwif_color_get_Decide_YUV2RGB_TBL_Index(src_idx, display, Input_mode);

	if (display == SLR_MAIN_DISPLAY) {
		contrast = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Contrast_Gain, 0);
		bri = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Brightness_Gain, 0);
		color = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Saturation_Gain, 0);
		deg_tint = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Hue_Gain, 0);
		/*contrast compensation*/
		if (OSD_Contrast_Compensation) {
			cmps = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Brightness_Cmps, 0);
			satCmps = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Saturation_Cmps, 0);
			VIPprintf("fwif_color_setSaturation:::com_Saturation = %d, Saturation_Cmps = %d\n", color, satCmps);
		} else {
			cmps = 0;
			satCmps = 128;
		}
		/* for K13_2, K32_2*/
		if (system_info_struct->BT2020_CTRL.Enable_Flag == 1 && system_info_struct->BT2020_CTRL.Mode == BT2020_MODE_Constant)
			bt2020_Constant_En = 1;
		else
			bt2020_Constant_En = 0;
	} else {
		contrast = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Contrast_Gain_Sub, 0);
		bri = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Brightness_Gain_Sub, 0);
		color = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Saturation_Gain_Sub, 0);
		deg_tint = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Hue_Gain_Sub, 0);
		/*contrast compensation*/
		if (OSD_Contrast_Compensation) {
			cmps = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Brightness_Cmps_Sub, 0);
			satCmps = fwif_color_ChangeOneUINT16Endian(system_info_struct->OSD_Info.Saturation_Cmps_Sub, 0);
			VIPprintf("fwif_color_setSaturation:::com_Saturation_sub = %d, Saturation_Cmps_Sub = %d\n", color, satCmps);
		} else {
			cmps = 0;
			satCmps = 128;
		}
		/* for K13_2, K32_2*/
		if (system_info_struct->BT2020_CTRL.Enable_Flag_Sub == 1 && system_info_struct->BT2020_CTRL.Mode_Sub == BT2020_MODE_Constant)
			bt2020_Constant_En = 1;
		else
			bt2020_Constant_En = 0;
	}

	VIPprintf("[vpq][%s][%d]contrast = %d, bri = %d, color = %d, deg_tint = %d\n", __FUNCTION__, __LINE__, contrast, bri, color, deg_tint);
	memset(satTmp, 0, sizeof(satTmp));
	memset(hueTmp, 0, sizeof(hueTmp));
	memset(kTmp, 0, sizeof(kTmp));
	memset(kTmp1, 0, sizeof(kTmp1));

	/* no hue function while bt2020_Constant_En*/
	if (bt2020_Constant_En == 1)
		deg_tint = 0;
	/*Euler's formula*/
	hueTmp[0][0] = 1024;
	hueTmp[1][1] = CAdjustCosine(deg_tint);
	hueTmp[1][2] = CAdjustSine(deg_tint) * (-1);
	hueTmp[2][1] = CAdjustSine(deg_tint);
	hueTmp[2][2] = CAdjustCosine(deg_tint);
	/*restrict for sat, refernece to spec for k32.*/
	color = (color * satCmps) >> 7;
	//color = (color > 128) ?  75 + (color*53 / 128) : color;
	satTmp[0][0] = 128;	/*128  = 1*/
	satTmp[1][1] = color;
	satTmp[2][2] = color;

	for (i = 0; i < VIP_YUV2RGB_Y_Seg_Max; i++) {
		table_idx[0][0][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K11];
		table_idx[0][1][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K12];
		table_idx[0][2][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K13];
		table_idx[1][0][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K11];
		table_idx[1][1][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K22];
		table_idx[1][2][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K23];
		table_idx[2][0][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K11];
		table_idx[2][1][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K32];
		table_idx[2][2][i] = tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_K33];
	}

	/*matrix computation for contrast, sat and hue*/
	for (i = 0; i < VIP_YUV2RGB_Y_Seg_Max; i++) {

		if (display == SLR_MAIN_DISPLAY)
					satTmp[2][2] = satTmp[1][1] = (color * g_sat_LUT.uSaturationY[i]) >> 7;
				else
					satTmp[2][2] = satTmp[1][1] = color;

		for (j = 0; j < 3; j++) {
			for (k = 0; k < 3; k++) {
				kTmp[j][k] = table_idx[j][k][i];
				/*bigger than 0x3FF  = >neg*/
				if (j == 0) {
					if ((kTmp[j][k] > VIP_YUV2RGB_K_Y_NEG_BND)){
						kTmp[j][k] = VIP_YUV2RGB_K_Y_NEG_CHANGE(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				} else {
					if ((kTmp[j][k] > VIP_YUV2RGB_K_C_NEG_BND)){
						kTmp[j][k] = VIP_YUV2RGB_K_C_NEG_CHANGE(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				}
			}
		}

		/* get max coef for max color gain calculation*/
		color_gain_max = 0;
		for (j = 0; j < 3; j++) {
			for (k = 1; k < 3; k++) {
				if (kTmp[j][k] >= 0) {
					if (kTmp[j][k] > color_gain_max)
						color_gain_max = kTmp[j][k];
				} else {
					if ((kTmp[j][k] * (-1)) > color_gain_max)
						color_gain_max = (kTmp[j][k] * (-1));
				}
			}
		}
		con_gain_max = kTmp[0][0];
		//VIPprintf("~max coef,%d,%d\n", con_gain_max, color_gain_max);

		/* max contrast gain and color gain calculation*/
		con_gain_max = (VIP_YUV2RGB_K_Y_NEG_BND << 7) / con_gain_max;		/*(0x3FF/con_gain_max) << 7;*/	/* Max Gain : Kxx: S(11, 8) */

		if (color_gain_max == 0)
			color_gain_max = satTmp[1][1];
		else
			color_gain_max = (VIP_YUV2RGB_K_C_NEG_BND << 7) / color_gain_max;	/*(0x3FF/color_gain_max) << 7;*/	/* Max Gain : Kxx: S(11, 8) */

		/* check gain by max gain*/
		if (contrast > con_gain_max)
			contrast = con_gain_max;
		if (satTmp[1][1] > color_gain_max) {
			satTmp[1][1] = color_gain_max;
			satTmp[2][2] = color_gain_max;
		}
		/* record final sat gain curve for tool, elieli*/
		g_total_sat_gain.uSaturationY[i] = satTmp[1][1];
		//VIPprintf("~f_G,%d,%d,%d\n", contrast, satTmp[1][1], satTmp[2][2]);

		/*3x3 matrix multiply*/
		for (j = 0; j < 3; j++)
			for (k = 0; k < 3; k++)
				kTmp1[j][k] = (kTmp[j][0] * hueTmp[0][k] + kTmp[j][1] * hueTmp[1][k] + kTmp[j][2] * hueTmp[2][k]) >> 10;

		for (j = 0; j < 3; j++)
			for (k = 0; k < 3; k++)
				kTmp[j][k] = (kTmp1[j][0] * satTmp[0][k] + kTmp1[j][1] * satTmp[1][k] + kTmp1[j][2] * satTmp[2][k]) >> 7;

		kTmp[0][0] = (kTmp[0][0] * contrast) >> 7;

		drv_vipCSMatrix_t.COEF_By_Y.K11[i] = kTmp[0][0];
		drv_vipCSMatrix_t.COEF_By_Y.K12[i] = kTmp[0][1];
		drv_vipCSMatrix_t.COEF_By_Y.K13[i] = kTmp[0][2];
		drv_vipCSMatrix_t.COEF_By_Y.K22[i] = kTmp[1][1];
		drv_vipCSMatrix_t.COEF_By_Y.K23[i] = kTmp[1][2];
		drv_vipCSMatrix_t.COEF_By_Y.K32[i] = kTmp[2][1];
		drv_vipCSMatrix_t.COEF_By_Y.K33[i] = kTmp[2][2];
	}

	/* bt2020_Constant_En,  for bt 2020 k13, k32*/
	if (bt2020_Constant_En == 1) {
		bt2020_k13 =  tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K13_2];
		bt2020_k32 =  tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K32_2];
		if (bt2020_k13 > VIP_YUV2RGB_K_C_NEG_BND) {
			bt2020_k13 = VIP_YUV2RGB_K_C_NEG_CHANGE(bt2020_k13);
			bt2020_k13 = bt2020_k13 * (-1);
		}
		if (bt2020_k32 > VIP_YUV2RGB_K_C_NEG_BND) {
			bt2020_k32 = VIP_YUV2RGB_K_C_NEG_CHANGE(bt2020_k32);
			bt2020_k32 = bt2020_k32 * (-1);
		}
		/* no hue function while bt 2020, only saturation*/
		bt2020_k13 = (bt2020_k13 * satTmp[1][1])>>7;
		bt2020_k32 = (bt2020_k32 * satTmp[1][1])>>7;
		/* driver for bt 2020*/
		drv_vipCSMatrix_t.COEF_By_Y.bt2020_K13= bt2020_k13;
		drv_vipCSMatrix_t.COEF_By_Y.bt2020_K32= bt2020_k32;
	}

	/*RGB offset setting for brightness*/
	/*Roffset, Goffset, Boffset: S(15,2)*//*bigger than 0x3FFF  = >neg*/
	tbl_offset_R = (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_R_Offset] > VIP_YUV2RGB_OFFSET_NEG_BND) ? (VIP_YUV2RGB_OFFSET_NEG_CHANGE(tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_R_Offset])) : (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_R_Offset]);
	tbl_offset_G = (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_G_Offset] > VIP_YUV2RGB_OFFSET_NEG_BND) ? (VIP_YUV2RGB_OFFSET_NEG_CHANGE(tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_G_Offset])) : (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_G_Offset]);
	tbl_offset_B = (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_B_Offset] > VIP_YUV2RGB_OFFSET_NEG_BND) ? (VIP_YUV2RGB_OFFSET_NEG_CHANGE(tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_B_Offset])) : (tYUV2RGB_COEF[YUV2RGB_TBL_Idx][tUV2RGB_COEF_B_Offset]);
	drv_vipCSMatrix_t.RGB_Offset.R_offset = (((bri - 128) << 5) + (cmps << 4) + tbl_offset_R) & 0x1ffff; /*20140220 roger for sync the brightness step with Mac, Magellen	modified by Flora, for Sirius; re - modified by Elsie 20140205*/
	drv_vipCSMatrix_t.RGB_Offset.G_offset = (((bri - 128) << 5) + (cmps << 4) + tbl_offset_G) & 0x1ffff; /*cmps: 4bit fraction*/
	drv_vipCSMatrix_t.RGB_Offset.B_offset = (((bri - 128) << 5) + (cmps << 4) + tbl_offset_B) & 0x1ffff;

	VIPprintf("[vpq][%s][%d]Input_mode = %d, YUV2RGB_TBL_Idx = %d, cmps = %d\n", __FUNCTION__, __LINE__, Input_mode, YUV2RGB_TBL_Idx, cmps);
	VIPprintf("[vpq][%s][%d]tbl_offset_R = %d, RGB_Offset.R_offset = %d\n", __FUNCTION__, __LINE__, tbl_offset_R, drv_vipCSMatrix_t.RGB_Offset.R_offset);
	VIPprintf("[vpq][%s][%d]tbl_offset_G = %d, RGB_Offset.G_offset = %d\n", __FUNCTION__, __LINE__, tbl_offset_G, drv_vipCSMatrix_t.RGB_Offset.G_offset);
	VIPprintf("[vpq][%s][%d]tbl_offset_B = %d, RGB_Offset.B_offset = %d\n", __FUNCTION__, __LINE__, tbl_offset_B, drv_vipCSMatrix_t.RGB_Offset.B_offset);

#ifdef ENABLE_xvYcc
	/* sync YUV2RGB flow*/
#endif

	/*Clamp setting*/
	/*drv_vipCSMatrix_t.CTRL_ITEM.Y_Clamp = Y_Clamp;*/
	drv_vipCSMatrix_t.CTRL_ITEM.Y_Clamp = system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.CTRL_ITEM.Y_Clamp;

	if (display == SLR_MAIN_DISPLAY) {
		/*share memory setting*/
#ifdef CONFIG_ARM64
		memcpy_toio(&system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y, &drv_vipCSMatrix_t.COEF_By_Y, sizeof(DRV_VIP_YUV2RGB_COEF_By_Y));
		memcpy_toio(&system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset, &drv_vipCSMatrix_t.RGB_Offset, sizeof(DRV_VIP_YUV2RGB_RGB_Offset));
#else
		memcpy(&system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y, &drv_vipCSMatrix_t.COEF_By_Y, sizeof(DRV_VIP_YUV2RGB_COEF_By_Y));
		memcpy(&system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset, &drv_vipCSMatrix_t.RGB_Offset, sizeof(DRV_VIP_YUV2RGB_RGB_Offset));
#endif
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K11[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K12[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K13[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K22[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K23[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K32[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K33[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
		fwif_color_ChangeUINT32Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset.R_offset), 1, 0);
		fwif_color_ChangeUINT32Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset.G_offset), 1, 0);
		fwif_color_ChangeUINT32Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.RGB_Offset.B_offset), 1, 0);
		/*drv setting*/
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Y_Clamp, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_Y_Only, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_C_Only, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Offset_Only, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		/* bt2020_Constant_En,  for bt 2020 k13, k32*/
		if (bt2020_Constant_En == 1) {
			/*drv setting*/
			drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_BT2020_Only, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
			/*memory setting*/
			fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.bt2020_K13), 1, 0);
			fwif_color_ChangeUINT16Endian(&(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.bt2020_K32), 1, 0);
		}

		if (g_DSE_en) {
			for (j = 0; j < VIP_YUV2RGB_Y_Seg_Max-1; j++) {
				drv_vipCSMatrix_t.COEF_By_Y.Y_index[j] = g_sat_LUT.uSaturationX[j];
				system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.Y_index[j] = g_sat_LUT.uSaturationX[j];
			}
			drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_CoefByY_Index, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		}
	}
/*#ifdef VIP_CONFIG_DUAL_CHENNEL*/
	else {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Y_Clamp, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_Y_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_C_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Offset_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		/* bt2020_Constant_En,  for bt 2020 k13, k32*/
		if (bt2020_Constant_En == 1)
			drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_BT2020_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
	}
/*#endif*/
	return;

}
/*extern UINT8 OPC_contrastbrightness = 0; */ /*add by lichun_zhao for OPC*/
/**
 * fwif_color_setContrast
 * Setting contrast control
 *
 * @param { display: Main or sub }
 * @return { none }
 *
 */
void fwif_color_setContrast(unsigned char src_idx, unsigned char display, unsigned char value)
{
	unsigned char Y_Clamp, /*osd_contrast, */contrast;
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	//osd_contrast = value;

	fwif_color_CalContrast_Gain(value, &contrast, &Y_Clamp);

	if (g_bTV002_Dynamic_Processing) {
		short tmp;

		tmp = contrast+(g_TV002_Con_Offset-128);
		if (tmp < 0)
			tmp = 0;
		else if (tmp > 255)
			tmp = 255;
		contrast = tmp;
	}

	if (OSD_Contrast_Compensation) {
		fwif_color_CalContrast_Compensation(display, contrast, VIP_system_info_structure_table);
	}

	if (display == SLR_MAIN_DISPLAY) {
		VIP_system_info_structure_table->OSD_Info.Contrast_Gain = fwif_color_ChangeOneUINT16Endian((UINT16)contrast, 0);
#if IS_ENABLED(CONFIG_RTK_AI_DRV)
		osd_con = fwif_color_ChangeOneUINT16Endian((UINT16)contrast, 0);
		/* return function when AI scene enable */
		if(ai_scene_ctrl.ai_scene_global.scene_en == 1)
			return;
#endif
		VIP_system_info_structure_table->OSD_Info.OSD_Contrast = value;
	} else {
		VIP_system_info_structure_table->OSD_Info.Contrast_Gain_Sub= fwif_color_ChangeOneUINT16Endian((UINT16)contrast, 0);
		VIP_system_info_structure_table->OSD_Info.OSD_Contrast_Sub = value;
	}

	fwif_color_setCon_Bri_Color_Tint_inYUV2RGB_from_OSD_Gain(src_idx, display, VIP_system_info_structure_table);
}

 #if 0
void fwif_color_setContrast(unsigned char src_idx, unsigned char display, unsigned char value)
{
	unsigned char Drv_Skip_Flag = 0;
	/*unsigned char centerMode = 0;*/

	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();

	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t;
	/*unsigned short *table_idx;*/
	unsigned short table_idx[VIP_YUV2RGB_Y_Seg_Max];
	unsigned char i, y_idx_max, Y_Clamp;
	unsigned char contrast = 0;
	unsigned char level;
	unsigned char tbl_select;
	unsigned char Input_mode;

	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	level = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.CoefByY_CtrlItem_Level;
	tbl_select = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_TBL_Select;
	Input_mode = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode;

	if (level >= VIP_YUV2RGB_LEVEL_SELECT_MAX || tbl_select >= YUV2RGB_TBL_Num) {
		VIPprintf("~level or table select Error return, level = %d, table select = %d, %s->%d, %s~\n", level, tbl_select, __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	Drv_Skip_Flag = gVip_Table->DrvSetting_Skip_Flag[DrvSetting_Skip_Flag_coefByY];

	/* Contrast gain calculate*/
	fwif_color_CalContrast_Gain(value, &contrast, &Y_Clamp);

	y_idx_max = VIP_YUV2RGB_Y_Seg_Max;
	/*table_idx = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K11[0]);*/	/* get table from pq misc, vip table is for coef gain*/
	for (i = 0; i < y_idx_max; i++)
		table_idx[i] =  tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];

	if (display == SLR_MAIN_DISPLAY) {
#ifdef ENABLE_xvYcc
		unsigned char xvYcc_en_flag = 0;
		/*get xvYcc mode flag*/
		/*_system_setting_info *VIP_system_info_structure_table = NULL;*/
		/*VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);*/
		if ((VIP_system_info_structure_table->xvYcc_flag == 1) || (VIP_system_info_structure_table->xvYcc_auto_mode_flag == 1)) {
			xvYcc_en_flag = 1;
		} else {
			xvYcc_en_flag = 0;
		}

		VIPprintf("fwif_color_setContrast, xvYcc_en_flag =%d\n", xvYcc_en_flag);

		if (xvYcc_en_flag) {
			for (i = 0; i < y_idx_max; i++) {
				if (table_idx[i] > 0x3ff) {
					drv_vipCSMatrix_t.COEF_By_Y.K11[i] = complement2((complement2(table_idx[i]*contrast)>>7)>>1);
				} else {
					drv_vipCSMatrix_t.COEF_By_Y.K11[i] = ((table_idx[i]*contrast)>>7)>>1;
				}
				/*	set reg value to share memory.*/
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K11[i] = drv_vipCSMatrix_t.COEF_By_Y.K11[i];
				fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K11[i]), 1, 0);
			}
		} else {
			for (i = 0; i < y_idx_max; i++) {
				drv_vipCSMatrix_t.COEF_By_Y.K11[i] = (table_idx[i]*contrast)>>7;
				/*	set reg value to share memory.*/
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K11[i] = drv_vipCSMatrix_t.COEF_By_Y.K11[i];
				fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K11[i]), 1, 0);
			}
		}
#else
		/*contrast is a mapping gain.*/
		/*drv_vipCSMatrix_t.K11[VIP_CSMatrix_Index_0]= (2 * contrast) & 0x1ff;	*/ /*20140219 roger, back the coef first*/
		for (i = 0; i < y_idx_max; i++) {
			drv_vipCSMatrix_t.COEF_By_Y.K11[i] = (table_idx[i]*contrast)>>7;
			/*	set reg value to share memory.*/
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K11[i] = drv_vipCSMatrix_t.COEF_By_Y.K11[i];
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K11[i]), 1, 0);
		}
#endif
		/*o------------- contrast ------------o*/

		drv_vipCSMatrix_t.CTRL_ITEM.Y_Clamp = Y_Clamp;

		VIP_system_info_structure_table->OSD_Info.Contrast_Gain = fwif_color_ChangeOneUINT16Endian((UINT16)contrast, 0);
		VIP_system_info_structure_table->OSD_Info.OSD_Contrast = value;

		/* compensation*/
		if (OSD_Contrast_Compensation) {
			/*if (pData == NULL) {
				VIPprintf("~SLR_PICTURE_MODE_DATA = NULL, fwif_color_setContrast, Return\n~");
				return;
			}*/
			fwif_color_CalContrast_Compensation(display, contrast, VIP_system_info_structure_table);
			fwif_color_setBrightness(src_idx, display, VIP_system_info_structure_table->OSD_Info.OSD_Brightness);
			fwif_color_setSaturation(src_idx, display, VIP_system_info_structure_table->OSD_Info.OSD_Saturation);
		}
	} else {
		/*contrast is a mapping gain.*/
		/*drv_vipCSMatrix_t.K11[VIP_CSMatrix_Index_0]= (2 * contrast) & 0x1ff;	*/ /*20140219 roger, back the coef first*/
		for (i = 0; i < y_idx_max; i++) {
			drv_vipCSMatrix_t.COEF_By_Y.K11[i] = (table_idx[i]*contrast)>>7;
		}
		/*o------------- contrast ------------o*/

		drv_vipCSMatrix_t.CTRL_ITEM.Y_Clamp = Y_Clamp;

		VIP_system_info_structure_table->OSD_Info.Contrast_Gain_Sub= fwif_color_ChangeOneUINT16Endian((UINT16)contrast, 0);
		VIP_system_info_structure_table->OSD_Info.OSD_Contrast_Sub= value;

		/* compensation*/
		if (OSD_Contrast_Compensation) {
			/*if (pData == NULL) {
				VIPprintf("~SLR_PICTURE_MODE_DATA = NULL, fwif_color_setContrast, Return\n~");
				return;
			}*/
			fwif_color_CalContrast_Compensation(display, contrast, VIP_system_info_structure_table);
			fwif_color_setBrightness(src_idx, display, VIP_system_info_structure_table->OSD_Info.OSD_Brightness_Sub);
			fwif_color_setSaturation(src_idx, display, VIP_system_info_structure_table->OSD_Info.OSD_Saturation_Sub);
		}
	}

	/* skip driver setting*/
	if (Drv_Skip_Flag == 1)
		return;

	if (display == SLR_MAIN_DISPLAY) {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Y_Clamp, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_Y_Only, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	}
	else {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Y_Clamp, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_Y_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
	}
}
#endif

void fwif_color_CalContrast_Gain(unsigned char OSD_Contrast, unsigned char *Contrast_Gain, unsigned char *Y_Clamp)
{
	unsigned char briConIdx = 0;
	unsigned char contrast = 0;
	UINT16 temp;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = NULL;
	UINT8 vip_source;
	/*VIP_QUALITY_Extend2_Coef* pVipCoefArray = NULL;*/
	unsigned char *pVipCoefArray = NULL;
	UINT8 csp_control;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	if (VIP_system_info_structure_table == NULL || VIP_RPC_system_info_structure_table == NULL) {
		/*VIPprintf("~VIP_system_info_structure_table||pVipCoefArray = NULL, fwif_color_CalContrast_Gain, Return\n~");*/
		VIPprintf("~table NULL, [%s:%d], Return\n~", __FILE__, __LINE__);
		return;
	}
	vip_source = VIP_RPC_system_info_structure_table->VIP_source;

	/*pVipCoefArray = fwif_color_get_VIP_Extend2_CoefArray(vip_source);*/
	pVipCoefArray = (unsigned char *)fwif_color_get_VIP_Extend2_CoefArray(vip_source);
	if (pVipCoefArray == NULL) {
		/*VIPprintf("~VIP_system_info_structure_table||pVipCoefArray = NULL, fwif_color_CalContrast_Gain, Return\n~");*/
		VIPprintf("~table NULL, [%s:%d], Return\n~", __FILE__, __LINE__);
		return;
	}
	/*csp_control = pVipCoefArray->ColorSpace_control;*/
	csp_control = pVipCoefArray[VIP_QUALITY_FUNCTION_ColorSpace_Control];
	printk("csp_control = %d, vip_source = %d\n", csp_control, vip_source);

	/*o------------- contrast ------------o*/
	briConIdx = OSD_Contrast;

	temp = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_CONTRAST, briConIdx);
	if (temp > 255)
		contrast = 255;
	else
		contrast = (UINT8)(temp);

#ifdef CONFIG_HDR_DEMO
#else
	/*20140220 roger for new mode START================================*/
	if (csp_control == RGB2YUV_OUT_DATA_16_235) {
		if (contrast < (255 - 21))
			contrast = contrast + 21;
		else
			contrast = 255;
		*Y_Clamp = 1;
	} else {
		*Y_Clamp = 0;
	}
	/*20140220 roger for new mode END================================*/
	VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.CTRL_ITEM.Y_Clamp = *Y_Clamp;
#endif

	*Contrast_Gain = contrast;

	printk("fwif_color_setContrast:::OSD_contrast = %d, contrast = %d\n", briConIdx, contrast);

}

void fwif_color_CalContrast_Compensation(unsigned char display, unsigned char Contrast_Gain, _system_setting_info *system_info_struct)
{
	short sat_cmps_tmp, bri_cmps_tmp;
	unsigned short sat_cmps_gain = 128, bri_cmps_gain = 128;

	if (system_info_struct == NULL) {
#ifdef CONFIG_ARM64 //ARM32 compatible
		VIPprintf("~table NULL TBL=%lx,[%s:%d], Return\n~", (unsigned long)system_info_struct, __FILE__, __LINE__);
#else
		VIPprintf("~table NULL TBL=%x,[%s:%d], Return\n~", (unsigned int)system_info_struct, __FILE__, __LINE__);
#endif
		return;
	}

	/* center is always at 128*/
	/*o-----------Saturation Compensation-------------o*/
 	/*matrix is 16~235/16~240 to 16~235, so sat_cmps_gain = 128.*/ /*y:16-236, C:16-240, (235-16)/(240-16) ~= 0.9777 ~= (125>>7)*/ /*change "sat_cmps_gain" to adjust compensation effect*/
	sat_cmps_tmp = (Contrast_Gain * sat_cmps_gain) >> 7;

	/*o-----------Brightness Compensation-------------o*/
	if ((fwif_color_ChangeOneUINT16Endian(system_info_struct->RGB2YUV_COEF_CSMatrix.Y_gain, 0) != 0x0100) ||
		(system_info_struct->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.CTRL_ITEM.Y_Clamp == 1) ||
		(system_info_struct->HDMI_data_range == MODE_RAG_FULL) || (system_info_struct->HDMI_video_format == COLOR_RGB) ||
		(system_info_struct->Input_src_Type == _SRC_VGA))
		bri_cmps_tmp = 0;
	else {
		bri_cmps_tmp = 64 - ((64*Contrast_Gain)>>7); /* calculted in 10 bit*/
		bri_cmps_tmp = (bri_cmps_tmp*bri_cmps_gain)>>7; /*adjust compensation by bri_cmps_gain.*/
	}

	if (display == SLR_MAIN_DISPLAY) {
		system_info_struct->OSD_Info.Saturation_Cmps = fwif_color_ChangeOneUINT16Endian(sat_cmps_tmp, 0);
		system_info_struct->OSD_Info.Brightness_Cmps = fwif_color_ChangeOneUINT16Endian(bri_cmps_tmp, 0);
	} else {
		system_info_struct->OSD_Info.Saturation_Cmps_Sub = fwif_color_ChangeOneUINT16Endian(sat_cmps_tmp, 0);
		system_info_struct->OSD_Info.Brightness_Cmps_Sub = fwif_color_ChangeOneUINT16Endian(bri_cmps_tmp, 0);
	}

	VIPprintf("~ch=%d,Contrast_Gain=%d, Saturation_Cmps=%d,sat_cmps_tmp=%d, Brightness_Cmps=%d, bri_cmps_tmp=%d,\n~",
		display, Contrast_Gain, system_info_struct->OSD_Info.Saturation_Cmps, sat_cmps_tmp,
		system_info_struct->OSD_Info.Brightness_Cmps, bri_cmps_tmp);
}


void fwif_color_SetDataFormatHandler(SCALER_DISP_CHANNEL display, unsigned short mode, unsigned short channel, unsigned char en_422to444,
	unsigned char InputSrcGetType)
{
	unsigned char nMode = 0;
	_system_setting_info *system_info_struct = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	drvif_color_set422to444(channel, en_422to444);
	if (InputSrcGetType == _SRC_YPBPR) {
		if ((mode !=  _MODE_480I)
			&& (mode !=  _MODE_480P)
			&& (mode !=  _MODE_576I)
			&& (mode !=  _MODE_576P))
			nMode = 1;
	} else if ( InputSrcGetType == _SRC_VO || InputSrcGetType == _SRC_HDMI || InputSrcGetType == _SRC_DISPLAYPORT ) {
		if ((mode !=  _MODE_480I)
			&& (mode !=  _MODE_480P)
			&& (mode !=  _MODE_576I)
			&& (mode !=  _MODE_576P))
			nMode = 1;
	}

/*	VIPprintf("Enter Set DataFormat Handler, info->IPH_ACT_WID  = %d\n", info->IPV_ACT_LEN);*/
/*#if !TEST_PATTERN_GEN*/
	//down(&I_RGB2YUV_Semaphore);
	fwif_color_colorspacergb2yuvtransfer(channel, InputSrcGetType, nMode, 1, 0);
	//up(&I_RGB2YUV_Semaphore);
/*#endif*/
	/*drvif_color_colorspaceyuv2rgbtransfer(display, InputSrcGetType, 1);*/	 /*Erin 20100415 for compile temporarily*/
	/*initialization in quality handler, mark thiss function. elieli*/
	/*fwif_color_colorspaceyuv2rgbtransfer(display, InputSrcGetType, 1);*/

	/* update YUV2RGB for driver base*/
	fwif_color_setCon_Bri_Color_Tint_inYUV2RGB_from_OSD_Gain(0, display, system_info_struct);
}

void fwif_color_setBrightness(unsigned char src_idx, unsigned char display, unsigned char value)
{
	unsigned char bri, osd_bri;
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	osd_bri = value;

	bri = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_BRIGHTNESS, osd_bri);

	if (g_bTV002_Dynamic_Processing) {
		short tmp;

		tmp = bri+(g_TV002_Bri_Offset-128);
		if (tmp < 0)
			tmp = 0;
		else if (tmp > 255)
			tmp = 255;
		bri = tmp;
	} else {
		if (bri > 255)
			bri = 255;
	}

	if (display == SLR_MAIN_DISPLAY) {
		VIP_system_info_structure_table->OSD_Info.OSD_Brightness = value;
		VIP_system_info_structure_table->OSD_Info.Brightness_Gain = fwif_color_ChangeOneUINT16Endian((UINT16)bri, 0);
#if IS_ENABLED(CONFIG_RTK_AI_DRV)
		osd_bri = fwif_color_ChangeOneUINT16Endian((UINT16)bri, 0);
		/* return function when AI scene enable */
		if(ai_scene_ctrl.ai_scene_global.scene_en == 1)
			return;
#endif
	} else {
		VIP_system_info_structure_table->OSD_Info.OSD_Brightness_Sub= value;
		VIP_system_info_structure_table->OSD_Info.Brightness_Gain_Sub = fwif_color_ChangeOneUINT16Endian((UINT16)bri, 0);
	}

	fwif_color_setCon_Bri_Color_Tint_inYUV2RGB_from_OSD_Gain(src_idx, display, VIP_system_info_structure_table);
}

void fwif_update_TV002_ConBri_Offset(short Con_Offset, short Bri_Offset)
{
	unsigned char Y_Clamp, osd_con, con;
	unsigned char bri, osd_bri;
	short tmp;
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	if (VIP_system_info_structure_table == NULL)
		return;

	//Contrast
	g_TV002_Con_Offset = Con_Offset;
	osd_con = VIP_system_info_structure_table->OSD_Info.OSD_Contrast;
	fwif_color_CalContrast_Gain(osd_con, &con, &Y_Clamp);
	tmp = con+(Con_Offset-128);
	if (tmp < 0)
		tmp = 0;
	else if (tmp > 255)
		tmp = 255;
	con = tmp;

	if (OSD_Contrast_Compensation) {
		fwif_color_CalContrast_Compensation(SLR_MAIN_DISPLAY, con, VIP_system_info_structure_table);
	}
	VIP_system_info_structure_table->OSD_Info.Contrast_Gain = con;

	//Brightness
	g_TV002_Bri_Offset = Bri_Offset;
	osd_bri = VIP_system_info_structure_table->OSD_Info.OSD_Brightness;
	bri = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_BRIGHTNESS, osd_bri);

	tmp = bri+(Bri_Offset-128);
	if (tmp < 0)
		tmp = 0;
	else if (tmp > 255)
		tmp = 255;
	bri = tmp;
	VIP_system_info_structure_table->OSD_Info.Brightness_Gain = bri;

	fwif_color_setCon_Bri_Color_Tint_inYUV2RGB_from_OSD_Gain(0, SLR_MAIN_DISPLAY, VIP_system_info_structure_table);
}

unsigned char WB_BL_ON = 0;
unsigned int WBBL_GAIN_R = 0, WBBL_GAIN_G = 0, WBBL_GAIN_B = 0;
void fwif_WBBL_TV002()
{
	extern ST_WBBL WBBL_table;
	unsigned char Brightness_UI_Value = 0;
	unsigned short SBC_BL_BTM = WBBL_table.SBC_BL[WBBL_BTM], SBC_BL_MID = WBBL_table.SBC_BL[WBBL_MID], SBC_BL_TOP = WBBL_table.SBC_BL[WBBL_TOP];
	unsigned short WB_BL_GAIN_R_TOP = WBBL_table.WBBL_Gain[WBBL_TOP][WBBL_R],WB_BL_GAIN_R_CEN = WBBL_table.WBBL_Gain[WBBL_CEN][WBBL_R], WB_BL_GAIN_R_BTM = WBBL_table.WBBL_Gain[WBBL_BTM][WBBL_R];
	unsigned short WB_BL_GAIN_G_TOP = WBBL_table.WBBL_Gain[WBBL_TOP][WBBL_G],WB_BL_GAIN_G_CEN = WBBL_table.WBBL_Gain[WBBL_CEN][WBBL_G], WB_BL_GAIN_G_BTM = WBBL_table.WBBL_Gain[WBBL_BTM][WBBL_G];
	unsigned short WB_BL_GAIN_B_TOP = WBBL_table.WBBL_Gain[WBBL_TOP][WBBL_B],WB_BL_GAIN_B_CEN = WBBL_table.WBBL_Gain[WBBL_CEN][WBBL_B], WB_BL_GAIN_B_BTM = WBBL_table.WBBL_Gain[WBBL_BTM][WBBL_B];
	int SBC_GAIN = 0;
	WB_BL_ON = WBBL_table.WBBL_enable;

	Brightness_UI_Value = Scaler_GetBacklight();
	SBC_GAIN = (Brightness_UI_Value*1024)/50;
	if((WB_BL_ON == 1) && (SBC_BL_BTM < SBC_BL_MID) && (SBC_BL_MID < SBC_BL_TOP))
	{
		if (SBC_GAIN > SBC_BL_TOP)
			SBC_GAIN = SBC_BL_TOP;
		else if (SBC_GAIN  < SBC_BL_BTM)
			SBC_GAIN = SBC_BL_BTM;

		if(SBC_GAIN >= SBC_BL_MID)
		{
			//mutipled by 100 and it will be divided by 100 after (fwif_RGB_gain_offset_TV002()), thats for accuracy of the final WB_SUM_GAIN_R to the second decimal number
			WBBL_GAIN_R = 4 * WB_BL_GAIN_R_TOP + (4 * (WB_BL_GAIN_R_CEN - WB_BL_GAIN_R_TOP) * (SBC_BL_TOP - SBC_GAIN)) / (SBC_BL_TOP - SBC_BL_MID);
			WBBL_GAIN_G = 4 * WB_BL_GAIN_G_TOP + (4 * (WB_BL_GAIN_G_CEN - WB_BL_GAIN_G_TOP) * (SBC_BL_TOP - SBC_GAIN)) / (SBC_BL_TOP - SBC_BL_MID);
			WBBL_GAIN_B = 4 * WB_BL_GAIN_B_TOP + (4 * (WB_BL_GAIN_B_CEN - WB_BL_GAIN_B_TOP) * (SBC_BL_TOP - SBC_GAIN)) / (SBC_BL_TOP - SBC_BL_MID);
		}
		else
		{
			WBBL_GAIN_R = 4 * WB_BL_GAIN_R_BTM + (4 * (WB_BL_GAIN_R_CEN - WB_BL_GAIN_R_BTM) * (SBC_BL_BTM - SBC_GAIN)) / (SBC_BL_BTM - SBC_BL_MID);
			WBBL_GAIN_G = 4 * WB_BL_GAIN_G_BTM + (4 * (WB_BL_GAIN_G_CEN - WB_BL_GAIN_G_BTM) * (SBC_BL_BTM - SBC_GAIN)) / (SBC_BL_BTM - SBC_BL_MID);
			WBBL_GAIN_B = 4 * WB_BL_GAIN_B_BTM + (4 * (WB_BL_GAIN_B_CEN - WB_BL_GAIN_B_BTM) * (SBC_BL_BTM - SBC_GAIN)) / (SBC_BL_BTM - SBC_BL_MID);
		}
	}
	else// means No Change (bypass WBBL)
	{
		WBBL_GAIN_R = 4 * 512;
		WBBL_GAIN_G = 4 * 512;
		WBBL_GAIN_B = 4 * 512;
	}
	fwif_RGB_gain_offset_TV002();
}
unsigned short WB_A_Gain_R = 512, WB_A_Gain_G = 512, WB_A_Gain_B = 512;
unsigned short WB_A_Offset_R = 512, WB_A_Offset_G = 512, WB_A_Offset_B = 512;
void fwif_Blue_Stretch_TV002()
{
	extern ST_WB_BS Blue_Stretch;
	bool WB_BS_ON = FALSE;
	_system_setting_info *VIP_system_info_structure_table=NULL;
	VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if(VIP_system_info_structure_table == NULL)
	{
		rtd_pr_vpq_emerg("fwif_Blue_Stretch_TV002, get NULL pointer\n");
		return;
	}
	if(VIP_system_info_structure_table->HDR_flag == 0)
		WB_BS_ON = TRUE;
	else
		WB_BS_ON = FALSE;

	rtd_pr_vpq_info("fwif_Blue_Stretch_TV002, WB_BS_ON = %d\n", WB_BS_ON);

	if(WB_BS_ON == TRUE)
	{
		WB_A_Gain_R = Blue_Stretch.WB_A_Gain[WB_R];
		WB_A_Gain_G = Blue_Stretch.WB_A_Gain[WB_G];
		WB_A_Gain_B = Blue_Stretch.WB_A_Gain[WB_B];
		WB_A_Offset_R = Blue_Stretch.WB_A_Offset[WB_R];
		WB_A_Offset_G = Blue_Stretch.WB_A_Offset[WB_G];
		WB_A_Offset_B = Blue_Stretch.WB_A_Offset[WB_B];
	}
	else
	{
		WB_A_Gain_R = 512;
		WB_A_Gain_G = 512;
		WB_A_Gain_B = 512;
		WB_A_Offset_R = 512;
		WB_A_Offset_G = 512;
		WB_A_Offset_B = 512;
	}

	fwif_RGB_gain_offset_TV002();
}

void fwif_RGB_gain_offset_TV002()
{
	int WB_SUM_GAIN_R, WB_SUM_GAIN_G, WB_SUM_GAIN_B;
	int WB_SUM_OFST1_R, WB_SUM_OFST1_G, WB_SUM_OFST1_B;
	extern ST_WB_BS Blue_Stretch;

	// Sum of Gain
	WB_SUM_GAIN_R = 4*512 + (WBBL_GAIN_R - 4*512) + 4*(WB_A_Gain_R - 512);
	WB_SUM_GAIN_G = 4*512 + (WBBL_GAIN_G - 4*512) + 4*(WB_A_Gain_G - 512);
	WB_SUM_GAIN_B = 4*512 + (WBBL_GAIN_B - 4*512) + 4*(WB_A_Gain_B - 512);

	// Sum of Offset1
	WB_SUM_OFST1_R = WB_A_Offset_R;
	WB_SUM_OFST1_G = WB_A_Offset_G;
	WB_SUM_OFST1_B = WB_A_Offset_B;

	//drvif_color_setrgbcontrast_by_BS(WB_SUM_GAIN_R,WB_SUM_GAIN_G,WB_SUM_GAIN_B);
	//drvif_color_setrgbbrightness_by_BS(WB_SUM_OFST1_R,WB_SUM_OFST1_G,WB_SUM_OFST1_B);

	//scaling
	WB_SUM_OFST1_R = 4*WB_SUM_OFST1_R - 2048;
	WB_SUM_OFST1_G = 4*WB_SUM_OFST1_G - 2048;
	WB_SUM_OFST1_B = 4*WB_SUM_OFST1_B - 2048;


	drvif_color_setrgbcolortemp_en(WB_BL_ON);
	drvif_color_setrgbcolortemp_contrast(WB_SUM_GAIN_R,WB_SUM_GAIN_G,WB_SUM_GAIN_B);
	drvif_color_setrgbcolortemp_bright(WB_SUM_OFST1_R,WB_SUM_OFST1_G,WB_SUM_OFST1_B);
}

#if defined(CONFIG_TTX_TOSHIBA_PATCH)
void fwif_color_setcontrastbrightness_half(unsigned char display, BOOL sRGB_User_Sat_En, BOOL sRGB_User_Sat_Mapping)
{
#if defined(IS_TV05_STYLE_PICTUREMODE)/*TODO: need to fix, CSFC*/
	/*CF 20070831, for Hisense brightness/contrast curve adjustment*/
	/*Contrast*/
	unsigned char briConIdx = 0;
	unsigned char contrast = 0, brightness = 0;
	short startPoint = 0, endPoint = 0;
	UINT16 temp;
	/*Color*/
	short hue = 0, sat = 0, intensity = 0;
	unsigned char osdHue = 0;
	UINT8 osdCon  = 0;
	UINT16 osdSat = 0;
	StructColorDataFacModeType *pColorFacTable;
	pColorFacTable = Scaler_color_get_color_fac_mode(Scaler_DispGetInputInfoByDisp((SCALER_DISP_CHANNEL)display, SLR_INPUT_DATA_ARRAY_IDX), 0);
	if (pColorFacTable == NULL)
		return;
/*---------------*/
/*	Contrast half*/
/*---------------*/
	briConIdx = Scaler_GetContrast();
	VIPprintf("fwif_color_setcontrastbrightness:::OSD_contrast = %d\n", briConIdx);

	if (briConIdx < 50) {
		startPoint = pColorFacTable->Contrast_0;
		endPoint = pColorFacTable->Contrast_50;
	} else {
		startPoint = pColorFacTable->Contrast_50;
		endPoint = pColorFacTable->Contrast_100;
		briConIdx - =  50;
	}

	temp = startPoint + (endPoint - startPoint) * briConIdx / 50;/*+OPC_contrastbrightness;*/
	if (temp > 255)
		contrast = 255;
	else
		contrast = (UINT8)(temp / 2);

	/*briConIdx = Scaler_GetBrightness(Scaler_DispGetInputInfoByDisp((SCALER_DISP_CHANNEL)display, SLR_INPUT_DATA_ARRAY_IDX));*/

	briConIdx = Scaler_GetBrightness();
	VIPprintf("fwif_color_setcontrastbrightness:::OSD_brightness = %d\n", briConIdx);

	if (briConIdx < 50) {
		startPoint = pColorFacTable->Brightness_0;
		endPoint = pColorFacTable->Brightness_50;
	} else {
		startPoint = pColorFacTable->Brightness_50;
		endPoint = pColorFacTable->Brightness_100;
		briConIdx - =  50;
	}

	temp = startPoint + (endPoint - startPoint) * briConIdx / 50;/*+OPC_contrastbrightness;*/
	if (temp > 255)
		brightness = 255;
	else
		brightness = (UINT8)(temp);

	fwif_color_setycontrastbrightness(display, contrast, brightness); /*Brightness map 0~100 to 0~255, */

/*------------*/
/*	Color half*/
/*------------*/
	if (contrast < 128) {
		osdHue = Scaler_GetHue();
		VIPprintf("fwif_color_seticmhuesat:::::osdHue = %d\n", osdHue);

		if (osdHue < 50) {
			startPoint = pColorFacTable->Hue_0;
			endPoint = pColorFacTable->Hue_50;
		} else {
			startPoint = pColorFacTable->Hue_50;
			endPoint = pColorFacTable->Hue_100;
			osdHue - =  50;
		}
		hue = (unsigned char)(startPoint + (endPoint - startPoint) * osdHue / 50);
		hue - =  128;
		osdSat = Scaler_GetSaturation();
		VIPprintf("fwif_color_seticmhuesat:::::osdSat = %d\n", osdSat);


		/*USER: Vincent_Lee  DATE: 2011/10/26  TODO: calcu sat by factory data*/
		if (osdSat < 50) {
			startPoint = pColorFacTable->Saturation_0;
			endPoint = pColorFacTable->Saturation_50;
			sat = osdSat;
		} else {
			startPoint = pColorFacTable->Saturation_50;
			endPoint = pColorFacTable->Saturation_100;
			sat = osdSat - 50;
		}
		sat = (unsigned char)(startPoint + (endPoint - startPoint) * sat / 50);

#if  defined(IS_TV05_STYLE_PICTUREMODE)
		sat = (sat*contrast) >> 7;
#endif
		/*map 0~100 to  - 2048~2047*/
		/*tensity = (short)((Scaler_color_get_intensity(Scaler_DispGetInputInfoByDisp((SCALER_DISP_CHANNEL)display, SLR_INPUT_DATA_ARRAY_IDX)) *40.95)  - 2048);*/
		intensity = (short)((Scaler_GetIntensity() * 40.95) - 2048);

		drvif_color_setuv_sat(display, sat);/*20100726 modify sat adj.  from sRGB to uv, csfanchiang*/
		/*drvif_color_seticmhsi(display, hue, 0, intensity);*/ /*20090305 haifu del saturation in ICM*/
		drvif_color_seticmhsi(display, hue, ICM_Global_hue); /*set ICM global hue, original only hue can work*/
		//fwif_sRGB_SetHueSat(display, 0, 50, sRGB_User_Sat_En, sRGB_User_Sat_Mapping); /*20090305 haifu add saturation in sRGB*/
	}
#endif	/*for IS_TV05_STYLE_PICTUREMODE*/
}

#endif /*CONFIG_TTX_TOSHIBA_PATCH*/

/*======== Set Con/Bri =============*/
/*===============================================================================================	//ConBri CSFC 20140128*/


/*===============================================================================================	//ConBri CSFC 20140128*/
/*======== Set hue/sat =============*/

/*
 * fwif_color_icmhuesat
 * Setting hue sat control
 *
 * @param { display: Main or sub }
 * @return { none }
 *
 */

void fwif_color_setHue(unsigned char src_idx, unsigned char display, unsigned char value)
{
	short hue = 0, deg_hue = 0;
	unsigned char osdHue = value;
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	hue = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_HUE, osdHue);
	hue -=  128;
	if (hue >=  0)
		deg_hue = hue;
	else
		deg_hue = 360 - (hue * (-1));

	if (display == SLR_MAIN_DISPLAY) {
		VIP_system_info_structure_table->OSD_Info.Hue_Gain = fwif_color_ChangeOneUINT16Endian(deg_hue, 0);
		VIP_system_info_structure_table->OSD_Info.OSD_Hue = osdHue;
	} else {
		VIP_system_info_structure_table->OSD_Info.Hue_Gain_Sub= fwif_color_ChangeOneUINT16Endian(deg_hue, 0);
		VIP_system_info_structure_table->OSD_Info.OSD_Hue_Sub = osdHue;
	}

	fwif_color_setCon_Bri_Color_Tint_inYUV2RGB_from_OSD_Gain(src_idx, display, VIP_system_info_structure_table);
}

#if 0
void fwif_color_setHue(unsigned char src_idx, unsigned char display, unsigned char value)
{
	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t;
	/*short hueBnd_deg = _HUE_MAX_Deg;*/
	unsigned short satCmps, sat;
	short hue = 0, deg_hue = 0;
	unsigned char osdHue = value;
	short satTmp[3][3], hueTmp[3][3], kTmp[3][3], kTmp1[3][3];
	unsigned char i, j, k, y_idx_max;
	/*unsigned short *table_idx[3][3];*/
	unsigned short table_idx[3][3][VIP_YUV2RGB_Y_Seg_Max];
	unsigned char level;
	unsigned char tbl_select;
	unsigned char Input_mode;
	unsigned char Drv_Skip_Flag = 0;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	level = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.CoefByY_CtrlItem_Level;
	tbl_select = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_TBL_Select;
	y_idx_max = VIP_YUV2RGB_Y_Seg_Max;
	Input_mode = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode;
	Drv_Skip_Flag = gVip_Table->DrvSetting_Skip_Flag[DrvSetting_Skip_Flag_coefByY];

	if (level >=  VIP_YUV2RGB_LEVEL_SELECT_MAX || tbl_select >=  YUV2RGB_TBL_Num) {
		VIPprintf("~level or table select Error return, level = %d, table select = %d, %s->%d, %s~\n", level, tbl_select, __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	memset(satTmp, 0, sizeof(satTmp));
	memset(hueTmp, 0, sizeof(hueTmp));
	memset(kTmp, 0, sizeof(kTmp));
	memset(kTmp1, 0, sizeof(kTmp1));

	if (display == SLR_MAIN_DISPLAY) {	/*	hue calculate..*/
		VIP_system_info_structure_table->OSD_Info.OSD_Hue = osdHue;
		hue = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_HUE, osdHue);
		hue -=  128;
		if (hue >=  0)
			/*deg_hue = (unsigned short)((hue * hueBnd_deg) >> 7);*/
			deg_hue = hue;
		else
			/*deg_hue = (unsigned short)(360 - ((hue * (-1) * hueBnd_deg) >> 7));*/
			deg_hue = 360 - (hue * (-1));
		VIP_system_info_structure_table->OSD_Info.Hue_Gain = fwif_color_ChangeOneUINT16Endian(deg_hue, 0);
		/*Euler's formula*/
		hueTmp[0][0] = 1024;
		hueTmp[1][1] = CAdjustCosine(deg_hue);
		hueTmp[1][2] = CAdjustSine(deg_hue)*(-1);
		hueTmp[2][1] = CAdjustSine(deg_hue);
		hueTmp[2][2] = CAdjustCosine(deg_hue);
		VIPprintf("fwif_color_set hue:::::osdHue = %d, Hue = %d, %d\n", osdHue, hue, deg_hue);

		/*get sat info*/
		sat = fwif_color_ChangeOneUINT16Endian(VIP_system_info_structure_table->OSD_Info.Saturation_Gain, 0);
		/*compensation*/
		if (OSD_Contrast_Compensation) {
			satCmps = fwif_color_ChangeOneUINT16Endian(VIP_system_info_structure_table->OSD_Info.Saturation_Cmps, 0);
			sat = (sat * satCmps) >> 7;
			VIPprintf("fwif_color_setSaturation:::com_Saturation = %d, Saturation_Cmps = %d\n", sat, VIP_system_info_structure_table->OSD_Info.Saturation_Cmps);
		}
		/*restrict for sat, refernece to spec for k32.*/
		sat = (sat > 128) ?  75 + (sat * 53 / 128) : sat;
		satTmp[0][0] = 128;	/*128  = 1*/
		satTmp[1][1] = sat;
		satTmp[2][2] = sat;

		/*get vip table info for k coeff.*/	/* get table from pq misc, vip table is for coef gain*/
		/*table_idx[0][0] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K11[0]);
		table_idx[0][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K12[0]);
		table_idx[0][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K13[0]);
		table_idx[1][0] = table_idx[0][0];
		table_idx[1][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K22[0]);
		table_idx[1][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K23[0]);
		table_idx[2][0] = table_idx[0][0];
		table_idx[2][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K32[0]);
		table_idx[2][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K33[0]);*/
		for (i = 0; i < y_idx_max; i++) {
			table_idx[0][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[0][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K12];
			table_idx[0][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K13];
			table_idx[1][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[1][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K22];
			table_idx[1][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K23];
			table_idx[2][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[2][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K32];
			table_idx[2][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K33];
		}

#ifdef ENABLE_xvYcc
		unsigned char xvYcc_en_flag = 0;
		/*get xvYcc mode flag*/
		/*_system_setting_info *VIP_system_info_structure_table = NULL;*/
		/*VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);*/
		if ((VIP_system_info_structure_table->xvYcc_flag == 1) || (VIP_system_info_structure_table->xvYcc_auto_mode_flag == 1)) {
			xvYcc_en_flag = 1;
		} else {
			xvYcc_en_flag = 0;
		}

		VIPprintf("fwif_color_setHue, xvYcc_en_flag =%d\n", xvYcc_en_flag);

		for (i = 0; i < y_idx_max; i++) {
			for (j = 0; j < 3; j++) {
				for (k = 0; k < 3; k++) {
					kTmp[j][k] = table_idx[j][k][i];
					/* bigger than 0x3FF =>neg*/
					if (kTmp[j][k] > 0x3FF) {
						kTmp[j][k] = complement2(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				}
			}

			/* 3x3 matrix multiply*/
			for (j = 0; j < 3; j++)
				for (k = 0; k < 3; k++)
					kTmp1[j][k] = (kTmp[j][0] * hueTmp[0][k] + kTmp[j][1] * hueTmp[1][k] + kTmp[j][2] * hueTmp[2][k])>>10;

			for (j = 0; j < 3; j++) {
				for (k = 0; k < 3; k++) {
					kTmp[j][k] = (kTmp1[j][0] * satTmp[0][k] + kTmp1[j][1] * satTmp[1][k] + kTmp1[j][2] * satTmp[2][k])>>7;
					if (xvYcc_en_flag) {
						kTmp[j][k] = kTmp[j][k]/2;
					}
				}
			}

			drv_vipCSMatrix_t.COEF_By_Y.K12[i] = kTmp[0][1];
			drv_vipCSMatrix_t.COEF_By_Y.K13[i] = kTmp[0][2];
			drv_vipCSMatrix_t.COEF_By_Y.K22[i] = kTmp[1][1];
			drv_vipCSMatrix_t.COEF_By_Y.K23[i] = kTmp[1][2];
			drv_vipCSMatrix_t.COEF_By_Y.K32[i] = kTmp[2][1];
			drv_vipCSMatrix_t.COEF_By_Y.K33[i] = kTmp[2][2];

			/*	set reg value to share memory.*/
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K12[i] = drv_vipCSMatrix_t.COEF_By_Y.K12[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K13[i] = drv_vipCSMatrix_t.COEF_By_Y.K13[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K22[i] = drv_vipCSMatrix_t.COEF_By_Y.K22[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K23[i] = drv_vipCSMatrix_t.COEF_By_Y.K23[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K32[i] = drv_vipCSMatrix_t.COEF_By_Y.K32[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K33[i] = drv_vipCSMatrix_t.COEF_By_Y.K33[i];
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K12[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K13[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K22[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K23[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K32[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K33[i]), 1, 0);
		}
#else
		for (i = 0; i < y_idx_max; i++) {
			for (j = 0; j < 3; j++) {
				for (k = 0; k < 3; k++) {
					kTmp[j][k] = table_idx[j][k][i];
					/*bigger than 0x3FF  = >neg*/
					if (kTmp[j][k] > 0x3FF) {
						kTmp[j][k] = complement2(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				}
			}

			/*3x3 matrix multiply*/
			for (j = 0; j <  3; j++)
				for (k = 0; k < 3; k++)
					kTmp1[j][k] = (kTmp[j][0] * hueTmp[0][k] + kTmp[j][1] * hueTmp[1][k] + kTmp[j][2] * hueTmp[2][k]) >> 10;

			for (j = 0; j < 3; j++)
				for (k = 0; k  < 3; k++)
					kTmp[j][k] = (kTmp1[j][0] * satTmp[0][k] + kTmp1[j][1] * satTmp[1][k] + kTmp1[j][2] * satTmp[2][k]) >> 7;

			drv_vipCSMatrix_t.COEF_By_Y.K12[i] = kTmp[0][1];
			drv_vipCSMatrix_t.COEF_By_Y.K13[i] = kTmp[0][2];
			drv_vipCSMatrix_t.COEF_By_Y.K22[i] = kTmp[1][1];
			drv_vipCSMatrix_t.COEF_By_Y.K23[i] = kTmp[1][2];
			drv_vipCSMatrix_t.COEF_By_Y.K32[i] = kTmp[2][1];
			drv_vipCSMatrix_t.COEF_By_Y.K33[i] = kTmp[2][2];

			/*	set reg value to share memory.*/
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K12[i] = drv_vipCSMatrix_t.COEF_By_Y.K12[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K13[i] = drv_vipCSMatrix_t.COEF_By_Y.K13[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K22[i] = drv_vipCSMatrix_t.COEF_By_Y.K22[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K23[i] = drv_vipCSMatrix_t.COEF_By_Y.K23[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K32[i] = drv_vipCSMatrix_t.COEF_By_Y.K32[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K33[i] = drv_vipCSMatrix_t.COEF_By_Y.K33[i];
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K12[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K13[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K22[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K23[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K32[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K33[i]), 1, 0);
		}
#endif
	} else {	/*	hue calculate..*/
		VIP_system_info_structure_table->OSD_Info.OSD_Hue_Sub = osdHue;
		hue = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_HUE, osdHue);
		hue -=  128;
		if (hue >=  0)
			/*deg_hue = (unsigned short)((hue * hueBnd_deg) >> 7);*/
			deg_hue = hue;
		else
			/*deg_hue = (unsigned short)(360 - ((hue * (-1) * hueBnd_deg) >> 7));*/
			deg_hue = 360 - (hue * (-1));
		VIP_system_info_structure_table->OSD_Info.Hue_Gain_Sub = fwif_color_ChangeOneUINT16Endian(deg_hue, 0);
		/*Euler's formula*/
		hueTmp[0][0] = 1024;
		hueTmp[1][1] = CAdjustCosine(deg_hue);
		hueTmp[1][2] = CAdjustSine(deg_hue)*(-1);
		hueTmp[2][1] = CAdjustSine(deg_hue);
		hueTmp[2][2] = CAdjustCosine(deg_hue);
		VIPprintf("sub fwif_color_set hue:::::osdHue = %d, Hue = %d, %d\n", osdHue, hue, deg_hue);

		/*get sat info*/
		sat = fwif_color_ChangeOneUINT16Endian(VIP_system_info_structure_table->OSD_Info.Saturation_Gain_Sub, 0);
		/*compensation*/
		if (OSD_Contrast_Compensation) {
			satCmps = fwif_color_ChangeOneUINT16Endian(VIP_system_info_structure_table->OSD_Info.Saturation_Cmps_Sub, 0);
			sat = (sat * satCmps) >> 7;
			VIPprintf("sub fwif_color_setSaturation:::com_Saturation = %d, Saturation_Cmps = %d\n", sat, VIP_system_info_structure_table->OSD_Info.Saturation_Cmps);
		}
		/*restrict for sat, refernece to spec for k32.*/
		sat = (sat > 128) ?  75 + (sat * 53 / 128) : sat;
		satTmp[0][0] = 128;	/*128  = 1*/
		satTmp[1][1] = sat;
		satTmp[2][2] = sat;

		/*get vip table info for k coeff.*/	/* get table from pq misc, vip table is for coef gain*/
		/*table_idx[0][0] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K11[0]);
		table_idx[0][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K12[0]);
		table_idx[0][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K13[0]);
		table_idx[1][0] = table_idx[0][0];
		table_idx[1][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K22[0]);
		table_idx[1][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K23[0]);
		table_idx[2][0] = table_idx[0][0];
		table_idx[2][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K32[0]);
		table_idx[2][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K33[0]);*/
		for (i = 0; i < y_idx_max; i++) {
			table_idx[0][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[0][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K12];
			table_idx[0][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K13];
			table_idx[1][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[1][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K22];
			table_idx[1][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K23];
			table_idx[2][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[2][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K32];
			table_idx[2][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K33];
		}

		for (i = 0; i < y_idx_max; i++) {
			for (j = 0; j < 3; j++) {
				for (k = 0; k < 3; k++) {
					kTmp[j][k] = table_idx[j][k][i];
					/*bigger than 0x3FF  = >neg*/
					if (kTmp[j][k] > 0x3FF) {
						kTmp[j][k] = complement2(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				}
			}

			/*3x3 matrix multiply*/
			for (j = 0; j <  3; j++)
				for (k = 0; k < 3; k++)
					kTmp1[j][k] = (kTmp[j][0] * hueTmp[0][k] + kTmp[j][1] * hueTmp[1][k] + kTmp[j][2] * hueTmp[2][k]) >> 10;

			for (j = 0; j < 3; j++)
				for (k = 0; k  < 3; k++)
					kTmp[j][k] = (kTmp1[j][0] * satTmp[0][k] + kTmp1[j][1] * satTmp[1][k] + kTmp1[j][2] * satTmp[2][k]) >> 7;

			drv_vipCSMatrix_t.COEF_By_Y.K12[i] = kTmp[0][1];
			drv_vipCSMatrix_t.COEF_By_Y.K13[i] = kTmp[0][2];
			drv_vipCSMatrix_t.COEF_By_Y.K22[i] = kTmp[1][1];
			drv_vipCSMatrix_t.COEF_By_Y.K23[i] = kTmp[1][2];
			drv_vipCSMatrix_t.COEF_By_Y.K32[i] = kTmp[2][1];
			drv_vipCSMatrix_t.COEF_By_Y.K33[i] = kTmp[2][2];
		}
	}

	// skip driver setting
	if (Drv_Skip_Flag == 1)
		return;

	if (display == SLR_MAIN_DISPLAY) {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_C_Only, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	}
	else {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_C_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
	}
}
#endif

void fwif_color_setSaturation(unsigned char src_idx, unsigned char display, unsigned char value)
{
	unsigned short sat;
	unsigned char osdSat;
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	osdSat = value;
	sat = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_SATURTUION, osdSat);

	if (display == SLR_MAIN_DISPLAY) {
#if IS_ENABLED(CONFIG_RTK_AI_DRV)
		osd_sat = fwif_color_ChangeOneUINT16Endian(sat, 0);
		/* return function when AI scene enable */
		if(ai_scene_ctrl.ai_scene_global.scene_en == 1)
			return;
#endif
		VIP_system_info_structure_table->OSD_Info.Saturation_Gain = fwif_color_ChangeOneUINT16Endian(sat, 0);
		VIP_system_info_structure_table->OSD_Info.OSD_Saturation = osdSat;
	} else {
		VIP_system_info_structure_table->OSD_Info.Saturation_Gain_Sub= fwif_color_ChangeOneUINT16Endian(sat, 0);
		VIP_system_info_structure_table->OSD_Info.OSD_Saturation_Sub = osdSat;
	}

	fwif_color_setCon_Bri_Color_Tint_inYUV2RGB_from_OSD_Gain(src_idx, display, VIP_system_info_structure_table);
}

#if 0
void fwif_color_setSaturation(unsigned char src_idx, unsigned char display, unsigned char value)
{
	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t;
	short deg_hue;
	short satTmp[3][3], hueTmp[3][3], kTmp[3][3], kTmp1[3][3];
	unsigned char i, j, k, y_idx_max;
	unsigned short sat = 0;
	UINT16 osdSat = 0, cmps;
	unsigned short table_idx[3][3][VIP_YUV2RGB_Y_Seg_Max];/*unsigned short *table_idx[3][3];*/
	unsigned char level;
	unsigned char tbl_select;
	unsigned char Input_mode;
	unsigned char Drv_Skip_Flag;

	_system_setting_info *VIP_system_info_structure_table = NULL;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	level = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.CoefByY_CtrlItem_Level;
	tbl_select = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_TBL_Select;
	y_idx_max = VIP_YUV2RGB_Y_Seg_Max;
	Input_mode = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode;
	Drv_Skip_Flag = gVip_Table->DrvSetting_Skip_Flag[DrvSetting_Skip_Flag_coefByY];

	if (level >=  VIP_YUV2RGB_LEVEL_SELECT_MAX || tbl_select >=  YUV2RGB_TBL_Num) {
		VIPprintf("~level or table select Error return, level = %d, table select = %d, %s->%d, %s~\n", level, tbl_select, __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	memset(satTmp, 0, sizeof(satTmp));
	memset(hueTmp, 0, sizeof(hueTmp));
	memset(kTmp, 0, sizeof(kTmp));
	memset(kTmp1, 0, sizeof(kTmp1));

	if (display == SLR_MAIN_DISPLAY) {
		VIP_system_info_structure_table->OSD_Info.OSD_Saturation = value;

		/*sat gain cal.*/
		osdSat = value;
		sat = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_SATURTUION, osdSat);
		VIP_system_info_structure_table->OSD_Info.Saturation_Gain = fwif_color_ChangeOneUINT16Endian(sat, 0);

		/*compensation*/
		if (OSD_Contrast_Compensation) {
			cmps = fwif_color_ChangeOneUINT16Endian(VIP_system_info_structure_table->OSD_Info.Saturation_Cmps, 0);
			sat = (sat * cmps) >> 7;
			VIPprintf("fwif_color_setSaturation:::com_Saturation = %d, Saturation_Cmps = %d\n", sat, VIP_system_info_structure_table->OSD_Info.Saturation_Cmps);
		}
		/*restrict for sat, refernece to spec for k32.*/
		sat = (sat > 128) ?  75 + (sat * 53 / 128) : sat;
		satTmp[0][0] = 128; /*128  = 1*/
		satTmp[1][1] = sat;
		satTmp[2][2] = sat;
		VIPprintf("\nfwif_color_seticmhuesat:::osdSat = %d, sat = %d\n", osdSat, sat);

		/*	get hue info..*/
		deg_hue = fwif_color_ChangeOneUINT16Endian(VIP_system_info_structure_table->OSD_Info.Hue_Gain, 0);
		/*Euler's formula*/
		hueTmp[0][0] = 1024;
		hueTmp[1][1] = CAdjustCosine(deg_hue);
		hueTmp[1][2] = CAdjustSine(deg_hue) * (-1);
		hueTmp[2][1] = CAdjustSine(deg_hue);
		hueTmp[2][2] = CAdjustCosine(deg_hue);
		VIPprintf("fwif_color_set sat:::::degHue = %d\n", deg_hue);

		/*get vip table info for k coeff.*/		/* get table from pq misc, vip table is for coef gain*/
		/*table_idx[0][0] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K11[0]);
		table_idx[0][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K12[0]);
		table_idx[0][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K13[0]);
		table_idx[1][0] = table_idx[0][0];
		table_idx[1][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K22[0]);
		table_idx[1][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K23[0]);
		table_idx[2][0] = table_idx[0][0];
		table_idx[2][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K32[0]);
		table_idx[2][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K33[0]);*/
		for (i = 0; i < y_idx_max; i++) {
			table_idx[0][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[0][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K12];
			table_idx[0][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K13];
			table_idx[1][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[1][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K22];
			table_idx[1][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K23];
			table_idx[2][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[2][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K32];
			table_idx[2][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K33];
		}

#ifdef ENABLE_xvYcc
		unsigned char xvYcc_en_flag = 0;
		/*get xvYcc mode flag*/
		/*_system_setting_info *VIP_system_info_structure_table = NULL;*/
		/*VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);*/
		if ((VIP_system_info_structure_table->xvYcc_flag == 1) || (VIP_system_info_structure_table->xvYcc_auto_mode_flag == 1)) {
			xvYcc_en_flag = 1;
		} else {
			xvYcc_en_flag = 0;
		}

		VIPprintf("fwif_color_setSaturation, xvYcc_en_flag =%d\n", xvYcc_en_flag);

		for (i = 0; i < y_idx_max; i++) {
			for (j = 0; j < 3; j++) {
				for (k = 0; k < 3; k++) {
					kTmp[j][k] = table_idx[j][k][i];
					/* bigger than 0x3FF =>neg*/
					if (kTmp[j][k] > 0x3FF) {
						kTmp[j][k] = complement2(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				}
			}

			/* 3x3 matrix multiply*/
			for (j = 0; j < 3; j++)
				for (k = 0; k < 3; k++)
					kTmp1[j][k] = (kTmp[j][0] * hueTmp[0][k] + kTmp[j][1] * hueTmp[1][k] + kTmp[j][2] * hueTmp[2][k]) >> 10;

			for (j = 0; j < 3; j++) {
				for (k = 0; k < 3; k++) {
					kTmp[j][k] = (kTmp1[j][0] * satTmp[0][k] + kTmp1[j][1] * satTmp[1][k] + kTmp1[j][2] * satTmp[2][k]) >> 7;
					if (xvYcc_en_flag) {
						kTmp[j][k] = kTmp[j][k]/2;
					}
				}
			}

			drv_vipCSMatrix_t.COEF_By_Y.K12[i] = kTmp[0][1];
			drv_vipCSMatrix_t.COEF_By_Y.K13[i] = kTmp[0][2];
			drv_vipCSMatrix_t.COEF_By_Y.K22[i] = kTmp[1][1];
			drv_vipCSMatrix_t.COEF_By_Y.K23[i] = kTmp[1][2];
			drv_vipCSMatrix_t.COEF_By_Y.K32[i] = kTmp[2][1];
			drv_vipCSMatrix_t.COEF_By_Y.K33[i] = kTmp[2][2];

			/*	set reg value to share memory.*/
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K12[i] = drv_vipCSMatrix_t.COEF_By_Y.K12[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K13[i] = drv_vipCSMatrix_t.COEF_By_Y.K13[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K22[i] = drv_vipCSMatrix_t.COEF_By_Y.K22[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K23[i] = drv_vipCSMatrix_t.COEF_By_Y.K23[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K32[i] = drv_vipCSMatrix_t.COEF_By_Y.K32[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K33[i] = drv_vipCSMatrix_t.COEF_By_Y.K33[i];
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K12[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K13[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K22[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K23[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K32[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K33[i]), 1, 0);
		}
#else
		for (i = 0; i < y_idx_max; i++) {
			for (j = 0; j < 3; j++) {
				for (k = 0; k < 3; k++) {
					kTmp[j][k] = table_idx[j][k][i];
					/* bigger than 0x3FF =>neg*/
					if (kTmp[j][k] > 0x3FF) {
						kTmp[j][k] = complement2(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				}
			}

			/* 3x3 matrix multiply*/
			for (j = 0; j < 3; j++)
				for (k = 0; k < 3; k++)
					kTmp1[j][k] = (kTmp[j][0] * hueTmp[0][k] + kTmp[j][1] * hueTmp[1][k] + kTmp[j][2] * hueTmp[2][k])>>10;

			for (j = 0; j < 3; j++)
				for (k = 0; k < 3; k++)
					kTmp[j][k] = (kTmp1[j][0] * satTmp[0][k] + kTmp1[j][1] * satTmp[1][k] + kTmp1[j][2] * satTmp[2][k])>>7;

			drv_vipCSMatrix_t.COEF_By_Y.K12[i] = kTmp[0][1];
			drv_vipCSMatrix_t.COEF_By_Y.K13[i] = kTmp[0][2];
			drv_vipCSMatrix_t.COEF_By_Y.K22[i] = kTmp[1][1];
			drv_vipCSMatrix_t.COEF_By_Y.K23[i] = kTmp[1][2];
			drv_vipCSMatrix_t.COEF_By_Y.K32[i] = kTmp[2][1];
			drv_vipCSMatrix_t.COEF_By_Y.K33[i] = kTmp[2][2];

			/*	set reg value to share memory.*/
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K12[i] = drv_vipCSMatrix_t.COEF_By_Y.K12[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K13[i] = drv_vipCSMatrix_t.COEF_By_Y.K13[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K22[i] = drv_vipCSMatrix_t.COEF_By_Y.K22[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K23[i] = drv_vipCSMatrix_t.COEF_By_Y.K23[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K32[i] = drv_vipCSMatrix_t.COEF_By_Y.K32[i];
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K33[i] = drv_vipCSMatrix_t.COEF_By_Y.K33[i];
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K12[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K13[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K22[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K23[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K32[i]), 1, 0);
			fwif_color_ChangeUINT16Endian(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.COEF_By_Y.K33[i]), 1, 0);
		}
#endif
	} else {
		VIP_system_info_structure_table->OSD_Info.OSD_Saturation_Sub= value;

		/*sat gain cal.*/
		osdSat = value;
		sat = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_SATURTUION, osdSat);
		VIP_system_info_structure_table->OSD_Info.Saturation_Gain_Sub= fwif_color_ChangeOneUINT16Endian(sat, 0);

		/*compensation*/
		if (OSD_Contrast_Compensation) {
			cmps = fwif_color_ChangeOneUINT16Endian(VIP_system_info_structure_table->OSD_Info.Saturation_Cmps_Sub, 0);
			sat = (sat * cmps) >> 7;
			VIPprintf("fwif_color_setSaturation:::com_Saturation = %d, Saturation_Cmps = %d\n", sat, VIP_system_info_structure_table->OSD_Info.Saturation_Cmps_Sub);
		}
		/*restrict for sat, refernece to spec for k32.*/
		sat = (sat > 128) ?  75 + (sat * 53 / 128) : sat;
		satTmp[0][0] = 128; /*128  = 1*/
		satTmp[1][1] = sat;
		satTmp[2][2] = sat;
		VIPprintf("sub fwif_color_seticmhuesat:::osdSat = %d, sat = %d\n", osdSat, sat);

		/*	get hue info..*/
		deg_hue = fwif_color_ChangeOneUINT16Endian(VIP_system_info_structure_table->OSD_Info.Hue_Gain_Sub, 0);
		/*Euler's formula*/
		hueTmp[0][0] = 1024;
		hueTmp[1][1] = CAdjustCosine(deg_hue);
		hueTmp[1][2] = CAdjustSine(deg_hue) * (-1);
		hueTmp[2][1] = CAdjustSine(deg_hue);
		hueTmp[2][2] = CAdjustCosine(deg_hue);
		VIPprintf("sub fwif_color_set sat:::::degHue = %d\n", deg_hue);

		/*get vip table info for k coeff.*/		/* get table from pq misc, vip table is for coef gain*/
		/*table_idx[0][0] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K11[0]);
		table_idx[0][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K12[0]);
		table_idx[0][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K13[0]);
		table_idx[1][0] = table_idx[0][0];
		table_idx[1][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K22[0]);
		table_idx[1][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K23[0]);
		table_idx[2][0] = table_idx[0][0];
		table_idx[2][1] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K32[0]);
		table_idx[2][2] = &(gVip_Table->YUV2RGB_CSMatrix_Table[tbl_select].YUV2RGB_CSMatrix[level].COEF_By_Y.K33[0]);*/
		for (i = 0; i < y_idx_max; i++) {
			table_idx[0][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[0][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K12];
			table_idx[0][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K13];
			table_idx[1][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[1][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K22];
			table_idx[1][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K23];
			table_idx[2][0][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K11];
			table_idx[2][1][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K32];
			table_idx[2][2][i] = tYUV2RGB_COEF[Input_mode][tUV2RGB_COEF_K33];
		}

		for (i = 0; i < y_idx_max; i++) {
			for (j = 0; j < 3; j++) {
				for (k = 0; k < 3; k++) {
					kTmp[j][k] = table_idx[j][k][i];
					/* bigger than 0x3FF =>neg*/
					if (kTmp[j][k] > 0x3FF) {
						kTmp[j][k] = complement2(kTmp[j][k]);
						kTmp[j][k] = kTmp[j][k] * (-1);
					}
				}
			}

			/* 3x3 matrix multiply*/
			for (j = 0; j < 3; j++)
				for (k = 0; k < 3; k++)
					kTmp1[j][k] = (kTmp[j][0] * hueTmp[0][k] + kTmp[j][1] * hueTmp[1][k] + kTmp[j][2] * hueTmp[2][k])>>10;

			for (j = 0; j < 3; j++)
				for (k = 0; k < 3; k++)
					kTmp[j][k] = (kTmp1[j][0] * satTmp[0][k] + kTmp1[j][1] * satTmp[1][k] + kTmp1[j][2] * satTmp[2][k])>>7;

			drv_vipCSMatrix_t.COEF_By_Y.K12[i] = kTmp[0][1];
			drv_vipCSMatrix_t.COEF_By_Y.K13[i] = kTmp[0][2];
			drv_vipCSMatrix_t.COEF_By_Y.K22[i] = kTmp[1][1];
			drv_vipCSMatrix_t.COEF_By_Y.K23[i] = kTmp[1][2];
			drv_vipCSMatrix_t.COEF_By_Y.K32[i] = kTmp[2][1];
			drv_vipCSMatrix_t.COEF_By_Y.K33[i] = kTmp[2][2];
		}
	}

	// skip driver setting
	if (Drv_Skip_Flag==1)
		return;

	if (display==SLR_MAIN_DISPLAY) {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_C_Only, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	} else {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_C_Only, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
	}
}
#endif

char fwif_color_set_DSE(unsigned char display, VPQ_SAT_LUT_T *satLUT)
{
	int ret = 0;
	_system_setting_info *system_info_struct = NULL;

	system_info_struct = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (system_info_struct == NULL) {
		VIPprintf("~get shareMem | gvipTbl error return~\n");
		return -1;
	}

	if (display != SLR_MAIN_DISPLAY) {
		VIPprintf("~only main channel for DSE return~\n");
		return -1;
	}

	if (g_DSE_en == 0) {
		yuv2rgb_d_yuv2rgbbyy_control_RBUS d_yuv2rgbbyy_control_REG;

		g_DSE_en = 1;
		d_yuv2rgbbyy_control_REG.regValue = IoReg_Read32(YUV2RGB_D_YUV2RGBBYY_CONTROL_reg);
		d_yuv2rgbbyy_control_REG.yuv2rgbbymode_main_en = 2;
		d_yuv2rgbbyy_control_REG.yuv2rgb_coef_by_sat_mode = 1;
		IoReg_Write32(YUV2RGB_D_YUV2RGBBYY_CONTROL_reg, d_yuv2rgbbyy_control_REG.regValue);
		IoReg_SetBits(YUV2RGB_D_YUV2RGB_Control_1_reg, YUV2RGB_D_YUV2RGB_Control_1_yuv2rgb_db_apply_mask);
	}

	if (g_bTV002_Dynamic_Processing) {
		g_sat_LUT = *satLUT;
	} else {
		/* set sat gain into share mem*/
		//ret = fwif_color_access_SaturationLUT(display, satLUT, ACCESS_MODE_SET);
		if (memcmp(&g_sat_LUT, satLUT, sizeof(VPQ_SAT_LUT_T)) == 0)
			return 0;
		else
			g_sat_LUT = *satLUT;

		if (vpq_project_id == 0x00060000 && vpqex_project_id == 0x00060000)
			ret = fwif_color_setCon_Bri_Color_Tint_tv006(display, system_info_struct); /* only main channel*/
		else
			fwif_color_setCon_Bri_Color_Tint_inYUV2RGB_from_OSD_Gain(0, display, system_info_struct); /* only main channel*/
	}

	return ret;
}

unsigned char fwif_color_icm_ini2elemtable(unsigned short *tICM_ini, unsigned char which_table, COLORELEM_TAB_T *st_icm_tab)
{
	int h, si;
	int h_sta, h_end, si_sta, si_end;
	int LayerSize;

	unsigned int baseAddr			= which_table * VIP_ICM_TBL_Y * VIP_ICM_TBL_Z;
	unsigned int baseAddr_hue_tab	= baseAddr + (2 + SATSEGMAX * ITNSEGMAX * 0) * VIP_ICM_TBL_Z;		/*hue table*/
	unsigned int baseAddr_sat_tab	= baseAddr + (2 + SATSEGMAX * ITNSEGMAX * 1) * VIP_ICM_TBL_Z;		/*sat table*/
	unsigned int baseAddr_itn_tab	= baseAddr + (2 + SATSEGMAX * ITNSEGMAX * 2) * VIP_ICM_TBL_Z;		/*itn table*/

	VIPprintf("fwif_color_icm_ini2elemtable Initialize  which_table = %d\n", which_table);

	if (which_table >= VIP_ICM_TBL_X) /*overflow*/
		return false;

	/* icm table, hue/sat/itn*/
	h_sta = 0;
	h_end = HUESEGMAX - 1;
	si_sta = 0;
	si_end = SATSEGMAX - 1;
	LayerSize = HUESEGMAX * SATSEGMAX;

	for (si = si_sta; si <= si_end; si++) {
		for (h = h_sta; h <= h_end; h++) {

			st_icm_tab->elem[0][si][h].H = tICM_ini[baseAddr_hue_tab + LayerSize * 0  + si * HUESEGMAX + h];
			st_icm_tab->elem[0][si][h].S = tICM_ini[baseAddr_sat_tab + LayerSize * 0  + si * HUESEGMAX + h];
			st_icm_tab->elem[0][si][h].I = tICM_ini[baseAddr_itn_tab + LayerSize * 0  + si * HUESEGMAX + h];
			st_icm_tab->elem[1][si][h].H = tICM_ini[baseAddr_hue_tab + LayerSize * 1  + si * HUESEGMAX + h];
			st_icm_tab->elem[1][si][h].S = tICM_ini[baseAddr_sat_tab + LayerSize * 1  + si * HUESEGMAX + h];
			st_icm_tab->elem[1][si][h].I = tICM_ini[baseAddr_itn_tab + LayerSize * 1  + si * HUESEGMAX + h];
			st_icm_tab->elem[2][si][h].H = tICM_ini[baseAddr_hue_tab + LayerSize * 2  + si * HUESEGMAX + h];
			st_icm_tab->elem[2][si][h].S = tICM_ini[baseAddr_sat_tab + LayerSize * 2  + si * HUESEGMAX + h];
			st_icm_tab->elem[2][si][h].I = tICM_ini[baseAddr_itn_tab + LayerSize * 2  + si * HUESEGMAX + h];
			st_icm_tab->elem[3][si][h].H = tICM_ini[baseAddr_hue_tab + LayerSize * 3  + si * HUESEGMAX + h];
			st_icm_tab->elem[3][si][h].S = tICM_ini[baseAddr_sat_tab + LayerSize * 3  + si * HUESEGMAX + h];
			st_icm_tab->elem[3][si][h].I = tICM_ini[baseAddr_itn_tab + LayerSize * 3  + si * HUESEGMAX + h];
			st_icm_tab->elem[4][si][h].H = tICM_ini[baseAddr_hue_tab + LayerSize * 4  + si * HUESEGMAX + h];
			st_icm_tab->elem[4][si][h].S = tICM_ini[baseAddr_sat_tab + LayerSize * 4  + si * HUESEGMAX + h];
			st_icm_tab->elem[4][si][h].I = tICM_ini[baseAddr_itn_tab + LayerSize * 4  + si * HUESEGMAX + h];
			st_icm_tab->elem[5][si][h].H = tICM_ini[baseAddr_hue_tab + LayerSize * 5  + si * HUESEGMAX + h];
			st_icm_tab->elem[5][si][h].S = tICM_ini[baseAddr_sat_tab + LayerSize * 5  + si * HUESEGMAX + h];
			st_icm_tab->elem[5][si][h].I = tICM_ini[baseAddr_itn_tab + LayerSize * 5  + si * HUESEGMAX + h];
			st_icm_tab->elem[6][si][h].H = tICM_ini[baseAddr_hue_tab + LayerSize * 6  + si * HUESEGMAX + h];
			st_icm_tab->elem[6][si][h].S = tICM_ini[baseAddr_sat_tab + LayerSize * 6  + si * HUESEGMAX + h];
			st_icm_tab->elem[6][si][h].I = tICM_ini[baseAddr_itn_tab + LayerSize * 6  + si * HUESEGMAX + h];
			st_icm_tab->elem[7][si][h].H = tICM_ini[baseAddr_hue_tab + LayerSize * 7  + si * HUESEGMAX + h];
			st_icm_tab->elem[7][si][h].S = tICM_ini[baseAddr_sat_tab + LayerSize * 7  + si * HUESEGMAX + h];
			st_icm_tab->elem[7][si][h].I = tICM_ini[baseAddr_itn_tab + LayerSize * 7  + si * HUESEGMAX + h];

		}
	}
	return true;
}

unsigned char fwif_color_icm_global_adjust_on_elem_table(COLORELEM_TAB_T *st_icm_tab_in, int g_dhue_cur, int *g_dsatbysat_cur, int *g_ditnbyitn_cur, COLORELEM_TAB_T *st_icm_tab_out)
{
	int h, s, i;
	int h_sta, h_end, s_sta, s_end, i_sta, i_end;;

	if (NULL == st_icm_tab_in || NULL == g_dsatbysat_cur || NULL == g_ditnbyitn_cur || NULL == st_icm_tab_out)
		return false;

	h_sta = 0;
	h_end = HUESEGMAX - 1;
	s_sta = 0;
	s_end = SATSEGMAX - 1;
	i_sta = 0;
	i_end = ITNSEGMAX - 1;

	for (i = i_sta; i <= i_end; i++) {
		for (s = s_sta; s <= s_end; s++) {
			for (h = h_sta; h <= h_end; h++) {

				st_icm_tab_out->elem[i][s][h].H = (st_icm_tab_in->elem[i][s][h].H + g_dhue_cur + HUERANGE) % HUERANGE;
				st_icm_tab_out->elem[i][s][h].S = CLIP(0, SATRANGEEX, st_icm_tab_in->elem[i][s][h].S + g_dsatbysat_cur[s]);
				st_icm_tab_out->elem[i][s][h].I = CLIP(0, ITNRANGEEX, st_icm_tab_in->elem[i][s][h].I + g_ditnbyitn_cur[i]);
			}
		}
	}

	return true;
}

unsigned char fwif_color_icm_global_gain_access(unsigned int access_mode, unsigned char hsi_sel, short* pValue)
{
	static short hue_gain = 128;//128 = 1
	static short sat_gain = 128;//128 = 1
	static short itn_gain = 128;//128 = 1

	if (pValue == NULL)
		return -1;
	if (access_mode == 0) {//read
		switch(hsi_sel) {
		case ICM_Global_hue:
			*pValue = hue_gain;
			break;
		case ICM_Global_Sat:
			*pValue = sat_gain;
			break;
		case ICM_Global_Itn:
			*pValue = itn_gain;
			break;
		default:
			return -1;
		}
	} else if (access_mode == 1) {//write
		switch(hsi_sel) {
		case ICM_Global_hue:
			hue_gain = *pValue;
			break;
		case ICM_Global_Sat:
			sat_gain = *pValue;
			break;
		case ICM_Global_Itn:
			itn_gain = *pValue;
			break;
		default:
			return -1;
		}
	} else if (access_mode == 2) {//reset
		hue_gain = sat_gain = itn_gain = 128;
	}

	return 0;
}

void fwif_color_icm_global_gain_calc(int *g_dhue_cur, int *g_dsatbysat_cur, int *g_ditnbyitn_cur)
{
	short gain;//128 = 1
	int i;

	// hue
	fwif_color_icm_global_gain_access(0/*read*/, ICM_Global_hue, &gain);
	*g_dhue_cur = ((*g_dhue_cur)*gain)>>7;

	// sat
	fwif_color_icm_global_gain_access(0/*read*/, ICM_Global_Sat, &gain);
	for (i = 0; i < SATSEGMAX; i++)
		g_dsatbysat_cur[i] = (g_dsatbysat_cur[i]*gain)>>7;

	// itn
	fwif_color_icm_global_gain_access(0/*read*/, ICM_Global_Itn, &gain);
	for (i = 0; i < ITNSEGMAX; i++)
		g_ditnbyitn_cur[i] = (g_ditnbyitn_cur[i]*gain)>>7;
}

void fwif_color_Icm_table_select(unsigned char display, unsigned short *tICM_ini, unsigned char which_table)
{
	/*COLORELEM_TAB_T icm_tab_elem_write;*/
	int dhue;
	int dsatbysat[SATSEGMAX];
	int ditnbyitn[ITNSEGMAX];

	/*Global Setting*/
	unsigned int baseAddr			 = which_table * VIP_ICM_TBL_Y * VIP_ICM_TBL_Z;
	unsigned int baseAddr_global	 = baseAddr + 0 * VIP_ICM_TBL_Z;		/*global control*/
	unsigned int baseAddr_hue_pillar	= baseAddr + 1 * VIP_ICM_TBL_Z;		/*hue pillar*/

	unsigned short *tICM_ini_ctrl = &tICM_ini[baseAddr_global];
	unsigned short *tICM_ini_uv_coring = &tICM_ini[baseAddr_global + 4];
	unsigned short *tICM_ini_global_adj = &tICM_ini[baseAddr_global + 6];
	unsigned char tICM_ini_h_pillar_num = tICM_ini[baseAddr_global + 31];
	unsigned char tICM_ini_s_pillar_num = tICM_ini[baseAddr_global + 32];
	unsigned char tICM_ini_i_pillar_num = tICM_ini[baseAddr_global + 33];
	unsigned short *tICM_ini_s_pillar = &tICM_ini[baseAddr_global + 34];
	unsigned short *tICM_ini_i_pillar = &tICM_ini[baseAddr_global + 44];
	unsigned short *tICM_ini_h_pillar = &tICM_ini[baseAddr_hue_pillar];

	if (which_table >=  VIP_ICM_TBL_X) {
		drvif_color_Icm_Enable(0);
		return;
	}

	if (display == SLR_MAIN_DISPLAY) {
		drvif_color_Icm_Enable(1);
		drvif_color_icm_save_global_of_viptable(tICM_ini_global_adj[0], &tICM_ini_global_adj[1], &tICM_ini_global_adj[13]);
		drvif_color_icm_Get_Global_Ctrl(TRUE, &dhue, dsatbysat, ditnbyitn);
		drvif_color_icm_Set_global(dhue, dsatbysat, ditnbyitn);

		fwif_color_icm_ini2elemtable(tICM_ini, which_table, &icm_tab_elem_of_vip_table);
		fwif_color_icm_global_adjust_on_elem_table(&icm_tab_elem_of_vip_table, dhue, dsatbysat, ditnbyitn, &icm_tab_elem_write);
		/*memcpy(&icm_tab_elem_write, &icm_tab_elem_of_vip_table, sizeof(COLORELEM_TAB_T));*/

		drvif_color_icm_set_ctrl(tICM_ini_ctrl[0], tICM_ini_ctrl[1], tICM_ini_ctrl[2], tICM_ini_ctrl[3]);
		drvif_color_icm_set_uv_coring(tICM_ini_uv_coring[0], tICM_ini_uv_coring[1]);
		drvif_color_icm_set_pillar(tICM_ini_h_pillar, tICM_ini_s_pillar, tICM_ini_i_pillar, tICM_ini_h_pillar_num, tICM_ini_s_pillar_num, tICM_ini_i_pillar_num);

		drvif_color_icm_Write3DTable(icm_tab_elem_write.elem);
		/*drvif_color_Icm_Enable(1);*/
	}
}
void fwif_color_Icm_table_select_By_DMA(unsigned char display, unsigned short *tICM_ini, unsigned char which_table)
{
	unsigned int addr = 0, size;
	unsigned int  *pVir_addr = NULL;
	char ret;
	int dhue;
	int dsatbysat[SATSEGMAX];
	int ditnbyitn[ITNSEGMAX];
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif
	/*COLORELEM_TAB_T icm_tab_elem_write;*/

	/*Global Setting*/
	unsigned int baseAddr			 = which_table * VIP_ICM_TBL_Y * VIP_ICM_TBL_Z;
	unsigned int baseAddr_global	 = baseAddr + 0 * VIP_ICM_TBL_Z;		/*global control*/
	unsigned int baseAddr_hue_pillar	= baseAddr + 1 * VIP_ICM_TBL_Z;		/*hue pillar*/

	unsigned short *tICM_ini_ctrl = &tICM_ini[baseAddr_global];
	unsigned short *tICM_ini_uv_coring = &tICM_ini[baseAddr_global + 4];
	unsigned short *tICM_ini_global_adj = &tICM_ini[baseAddr_global + 6];
	unsigned char tICM_ini_h_pillar_num = tICM_ini[baseAddr_global + 31];
	unsigned char tICM_ini_s_pillar_num = tICM_ini[baseAddr_global + 32];
	unsigned char tICM_ini_i_pillar_num = tICM_ini[baseAddr_global + 33];
	unsigned short *tICM_ini_s_pillar = &tICM_ini[baseAddr_global + 34];
	unsigned short *tICM_ini_i_pillar = &tICM_ini[baseAddr_global + 44];
	unsigned short *tICM_ini_h_pillar = &tICM_ini[baseAddr_hue_pillar];
	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_ICM);

	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(VIP_DMAto3DTable_ICM_SIZE, (1 << 12));


	if (addr == 0) {
		rtd_pr_vpq_emerg("ICM fwif_color_Icm_table_select_By_DMA, addr = NULL\n");
		return;
	}


	if (which_table >=  VIP_ICM_TBL_X) {
		drvif_color_Icm_Enable(0);
		return;
	}

	if (display == SLR_MAIN_DISPLAY) {
		drvif_color_Icm_Enable(1);
		drvif_color_icm_save_global_of_viptable(tICM_ini_global_adj[0], &tICM_ini_global_adj[1], &tICM_ini_global_adj[13]);
		drvif_color_icm_Get_Global_Ctrl(TRUE, &dhue, dsatbysat, ditnbyitn);
		drvif_color_icm_Set_global(dhue, dsatbysat, ditnbyitn);

		fwif_color_icm_ini2elemtable(tICM_ini, which_table, &icm_tab_elem_of_vip_table);
		fwif_color_icm_global_adjust_on_elem_table(&icm_tab_elem_of_vip_table, dhue, dsatbysat, ditnbyitn, &icm_tab_elem_write);
		/*memcpy(&icm_tab_elem_write, &icm_tab_elem_of_vip_table, sizeof(COLORELEM_TAB_T));*/

		drvif_color_icm_set_ctrl(tICM_ini_ctrl[0], tICM_ini_ctrl[1], tICM_ini_ctrl[2], tICM_ini_ctrl[3]);
		drvif_color_icm_set_uv_coring(tICM_ini_uv_coring[0], tICM_ini_uv_coring[1]);
		drvif_color_icm_set_pillar(tICM_ini_h_pillar, tICM_ini_s_pillar, tICM_ini_i_pillar, tICM_ini_h_pillar_num, tICM_ini_s_pillar_num, tICM_ini_i_pillar_num);

		pVir_addr = dvr_remap_uncached_memory(addr, size, __builtin_return_address(0));

		size_aligned = size;
		addr_aligned = addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
		va_temp = (unsigned long)pVir_addr;
#else
		va_temp = (unsigned int)pVir_addr;
#endif
		pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
		size_aligned = dvr_size_alignment(size);
		addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
		va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
		va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
		pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

		ret = drvif_color_icm_Write3DTable_By_DMA(icm_tab_elem_write.elem, addr_aligned, (unsigned int*)pVir_addr_aligned, tICM_ini_h_pillar_num, tICM_ini_s_pillar_num, tICM_ini_i_pillar_num);

		rtd_pr_vpq_info("ICM, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
			addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);

		if(ret ==false)
		{
			//drvif_color_Icm_Enable(0);

			rtd_pr_vpq_emerg("ICM : load icm fail set icm=disable \n");

		}
		dvr_unmap_memory((void *)pVir_addr, size);


		/*drvif_color_Icm_Enable(1);*/





	}
}


void fwif_color_ICM_RGB_Offset_Table_Select(unsigned char display, unsigned char which_table)
{
	extern ICM_RGB_Offset_table tICM_RGB_Offset[VIP_ICM_TBL_X];

	if (which_table >=  VIP_ICM_TBL_X) {
		drvif_color_icm_Set_RGB_Offset_Enable(0);
		return;
	}

	if (display == SLR_MAIN_DISPLAY) {
		drvif_color_icm_Set_RGB_Offset_Enable(tICM_RGB_Offset[which_table].RGB_offset_en);
		drvif_color_icm_Set_RGB_Offset_Table(tICM_RGB_Offset[which_table].RGB_offset_curve, tICM_RGB_Offset[which_table].RGB_offset_S_gain, tICM_RGB_Offset[which_table].RGB_offset_I_gain);
	}
}

void fwif_color_D_LUT_By_DMA(unsigned char display, unsigned char enable, unsigned int *pArray)
{
	//char ret;
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif
	//unsigned short v_sta, v_len, line_cnt, v_end;
	//unsigned short delay1, delay2;
	//delay1 = 30;

	fwif_color_D_3dLUT_Encode(pArray, D_3D_DRV_LUT);

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_D_3D_LUT);

	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(VIP_DMAto3DTable_D_3D_LUT_SIZE, (1 << 12));

	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_D_LUT_By_DMA, addr = NULL\n");
		return;
	}
#if 0
	ret = drvif_Get_VO_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_D_LUT_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_D_LUT_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			//return -1;
		}
	}
#endif
	pVir_addr = dvr_remap_uncached_memory(addr, size, __builtin_return_address(0));

	size_aligned = size;
	addr_aligned = addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	rtd_pr_vpq_info("D_3D LUT, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
		addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);

	drvif_Wait_UZUDTG_start(10, -200);
	drvif_color_D_3dLUT_By_DMA(enable, &D_3D_DRV_LUT[0], addr_aligned, (unsigned int*) pVir_addr_aligned);
	dvr_unmap_memory((void *)pVir_addr, size);

	return;

}

char fwif_color_D_LUT_By_DMA_16(unsigned char display, unsigned char enable, unsigned short *pArray)
{
	//char ret;
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif
	//unsigned short v_sta, v_len, line_cnt, v_end;
	//unsigned short delay1, delay2;
	//delay1 = 30;

	fwif_color_D_3dLUT_Encode_16(pArray, D_3D_DRV_LUT);

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_D_3D_LUT);

	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(VIP_DMAto3DTable_D_3D_LUT_SIZE, (1 << 12));

	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_D_LUT_By_DMA, addr = NULL\n");
		return -1;
	}
#if 0
	ret = drvif_Get_VO_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_D_LUT_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_D_LUT_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			//return -1;
		}
	}
#endif
	pVir_addr = dvr_remap_uncached_memory(addr, size, __builtin_return_address(0));

	size_aligned = size;
	addr_aligned = addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	rtd_pr_vpq_info("D_3D LUT_16, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
		addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);

	drvif_Wait_UZUDTG_start(10, -200);
	drvif_color_D_3dLUT_By_DMA(enable, &D_3D_DRV_LUT[0], addr_aligned, (unsigned int*) pVir_addr_aligned);
	dvr_unmap_memory((void *)pVir_addr, size);

	return 0;

}

void fwif_color_set_ICM_table(unsigned char src_idx, unsigned char value)
{
	StructColorDataType *pTable = fwif_color_get_color_data(src_idx, 0);
	if (pTable == NULL)
		return;
	pTable->ICM_Table = value;

	down(&ICM_Semaphore);
	fwif_color_set_ICM_table_driver(src_idx, value);
	up(&ICM_Semaphore);
}

void fwif_color_set_ICM_table_driver(unsigned char src_idx, unsigned char value)
{
	int dhue;
	int dsatbysat[SATSEGMAX];
	int ditnbyitn[ITNSEGMAX];
	UINT8 nIndex = 0;
	int *pwINT32Temp = NULL;

	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	//fwif_color_Icm_table_select(_MAIN_DISPLAY, &(gVip_Table->tICM_ini)[0][0][0], value);
	fwif_color_Icm_table_select_By_DMA(_MAIN_DISPLAY, &(gVip_Table->tICM_ini)[0][0][0], value);
	fwif_color_ICM_RGB_Offset_Table_Select(_MAIN_DISPLAY, value);

	drvif_color_icm_Get_Global_Ctrl(FALSE, &dhue, dsatbysat, ditnbyitn);
/*
	drvif_color_icm_table_select(_MAIN_DISPLAY, &(gVip_Table->tICM_ini)[0][0][0], value);

	//global ctrl read from ICM Table
	drvif_color_icm_Get_Global_Ctrl(TRUE, &dhue, dsatbysat, ditnbyitn);

	drvif_color_icm_global_adjust(dhue, dsatbysat, ditnbyitn, FALSE);
*/


	/*====   global ctrl write  to share memory  =====*/
	pwINT32Temp = (int *)&dhue;
	fwif_color_ChangeINT32Endian(pwINT32Temp, 1, 0);
	pwINT32Temp = (int *)&dsatbysat;
	fwif_color_ChangeINT32Endian(pwINT32Temp, SATSEGMAX, 0);
	pwINT32Temp = (int *)&ditnbyitn;
	fwif_color_ChangeINT32Endian(pwINT32Temp, ITNSEGMAX, 0);

	if (NULL !=  fwif_color_GetICM_Global_Ctrl_Struct()) {
		fwif_color_GetICM_Global_Ctrl_Struct()->dHue = dhue;
		for (nIndex = 0; nIndex < SATSEGMAX; nIndex++) {
			(fwif_color_GetICM_Global_Ctrl_Struct()->dSatBySat)[nIndex] = dsatbysat[nIndex];
		}
		for (nIndex = 0; nIndex < ITNSEGMAX; nIndex++) {
			(fwif_color_GetICM_Global_Ctrl_Struct()->dItnByItn)[nIndex] = ditnbyitn[nIndex];
		}
	}
	/*==============*/
}
void fwif_color_set_ICM_Global_Adjust(int dhue_cur, int dsatbysat_cur[SATSEGMAX], int ditnbyitn_cur[ITNSEGMAX], bool bSubtractPrevious)
{
	drvif_color_icm_global_adjust(dhue_cur, dsatbysat_cur, ditnbyitn_cur, bSubtractPrevious);
}
bool fwif_color_icm_SramBlockAccessSpeedup(unsigned int *buf, bool if_write_ic, int h_sta, int h_end, int s_sta, int s_end, int i_sta, int i_end)
{
	return drvif_color_icm_SramBlockAccessSpeedup(buf, if_write_ic,  h_sta,  h_end,  s_sta,  s_end,  i_sta,  i_end);
}
void  fwif_color_icm_enhancement(unsigned char display, unsigned char which_table, unsigned char value)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	/*drvif_color_icm_enhancement(SLR_MAIN_DISPLAY, &(gVip_Table->tICM_ini)[0][0][0], which_table, value);*/
}
void  fwif_color_ChannelColourSet(unsigned char display, unsigned char which_table,  signed char value)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	/*drvif_color_ChannelColourSet(SLR_MAIN_DISPLAY, &(gVip_Table->tICM_ini)[0][0][0], which_table, value);*/
}

void fwif_color_icm_user_function(unsigned char display, unsigned char which_table, unsigned char skin_tone, unsigned char color_wheel, unsigned char detail_enhance, unsigned dynamic_tint)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	drvif_color_icm_user_function(display, &(gVip_Table->tICM_ini)[0][0][0], which_table, skin_tone, color_wheel, detail_enhance, dynamic_tint);
}

void fwif_color_get_icm_table_Adjust_Block(unsigned char display, unsigned short *tICM_ini, unsigned char which_table,
																						int *SR, unsigned int *buf)
{
	int h, s, i;
/*	int h_sta, h_end, si_sta, si_end;*/
/*	bool if_write_ic;*/
/*	int timeout;*/
	int LayerSize;

	int hlen, slen;//, ilen;

	unsigned char ICM_Num_Limite	= 255;/*30;*/ /*planck changed to 255 for the max of icm tables.20101111*/

	/* Global Setting*/
	unsigned int baseAddr			= which_table * VIP_ICM_TBL_Y * VIP_ICM_TBL_Z;
	/*unsigned int baseAddr_global	= baseAddr + 0 * VIP_ICM_TBL_Z;*/		/*global control*/
	/*unsigned int baseAddr_pillar	= baseAddr + 1 * VIP_ICM_TBL_Z;*/		/*pillar*/

	unsigned int baseAddr_hue_tab	= baseAddr + (2 + SATSEGMAX * ITNSEGMAX * 0) * VIP_ICM_TBL_Z;		/*hue table*/
	unsigned int baseAddr_sat_tab	= baseAddr + (2 + SATSEGMAX * ITNSEGMAX * 1) * VIP_ICM_TBL_Z;		/*sat table*/
	unsigned int baseAddr_itn_tab	= baseAddr + (2 + SATSEGMAX * ITNSEGMAX * 2) * VIP_ICM_TBL_Z;		/*itn table*/


	hlen = SR[h_end] - SR[h_sta] + 1;
	slen = SR[s_end] - SR[s_sta] + 1;
	//ilen = SR[i_end] - SR[i_sta] + 1;

	if (which_table >= ICM_Num_Limite) /*overflow*/
		return;
	if (display == SLR_MAIN_DISPLAY) {
		LayerSize = HUESEGMAX * SATSEGMAX;

		for (i = SR[i_sta]; i <= SR[i_end]; i++) {
			for (s = SR[s_sta]; s <= SR[s_end]; s++) {
				for (h = SR[h_sta]; h <= SR[h_end]; h++) {
					buf[(((i - SR[i_sta]) * slen + (s - SR[s_sta])) * hlen + (h - SR[h_sta])) * 2 + 0] = (tICM_ini[baseAddr_hue_tab + LayerSize * i  + s * HUESEGMAX + h] << 16)+(tICM_ini[baseAddr_sat_tab + LayerSize * i  + s * HUESEGMAX + h]);
					buf[(((i - SR[i_sta]) * slen + (s - SR[s_sta])) * hlen + (h - SR[h_sta])) * 2 + 1] = (tICM_ini[baseAddr_itn_tab + LayerSize * i  + s * HUESEGMAX + h]);
				}
			}
		}


	}   /* end main*/
}

void fwif_color_modify_icm_table_Adjust_Block(unsigned int *buf, unsigned char color, ICM_OSD_table *ICM_OSD_Table, int *SR, unsigned char *OSD)
{
	int h = 0, s = 0, i = 0;
	int hlen, slen;//, ilen;
	int org_hue, org_sat, org_int;

	hlen = SR[h_end] - SR[h_sta] + 1;
	slen = SR[s_end] - SR[s_sta] + 1;
	//ilen = SR[i_end] - SR[i_sta] + 1;

	for (h = SR[h_sta]; h <= SR[h_end]; h++) {
		for (s = SR[s_sta]; s <= SR[s_end]; s++) {
			for (i = SR[i_sta]; i <= SR[i_end]; i++) {
				if ((ICM_OSD_Table->ICM_OSD_index[i][s][h]) == color) {
					org_hue = (buf[(((i - SR[i_sta]) * slen + (s - SR[s_sta])) * hlen + (h - SR[h_sta])) * 2 + 0]>>16 & 0xffff) + (unsigned int)(OSD[_HUE_ELEM]*(ICM_OSD_Table->ICM_OSD_weight[i][s][h]));
					org_hue = drvif_color_icm_FormatValue(org_hue, _HUE_ELEM, 0, 1);
					org_sat = (buf[(((i - SR[i_sta]) * slen + (s - SR[s_sta])) * hlen + (h - SR[h_sta])) * 2 + 0] & 0xffff) + (unsigned int)((OSD[_SAT_ELEM]*(ICM_OSD_Table->ICM_OSD_weight[i][s][h])) << 2);
					org_sat = drvif_color_icm_FormatValue(org_sat, _SAT_ELEM, 0, 1);
					org_int = (buf[(((i - SR[i_sta]) * slen + (s - SR[s_sta])) * hlen + (h - SR[h_sta])) * 2 + 1] & 0xffff) + (unsigned int)((OSD[_ITN_ELEM]*(ICM_OSD_Table->ICM_OSD_weight[i][s][h])) << 2);
					org_int = drvif_color_icm_FormatValue((org_int-ITN_SUBTRACT_CONST), _ITN_ELEM, 0, 1);
					buf[(((i - SR[i_sta]) * slen + (s - SR[s_sta])) * hlen + (h - SR[h_sta])) * 2 + 0] = (org_hue << 16)+org_sat;
					buf[(((i - SR[i_sta]) * slen + (s - SR[s_sta])) * hlen + (h - SR[h_sta])) * 2 + 1] = org_int;
				}
			}
		}
	}
}

void fwif_color_icm_OSD_color(unsigned char display, unsigned char which_table, ICM_OSD_table *ICM_OSD_Table, unsigned char *ICM_OSD_value, unsigned char color)
{
	/*
	display 		:	main/sub
	which_table		:	timming use ICM table
	ICM_OSD_Table	:	ICM OSD index/weight/Search range
	color			:	Action color
	*/
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	/*int i = 0, offset = 0, sta = 0, end = 0, h_total;*/
	unsigned int *buf;
	int SR[6];

	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	memcpy(SR, &(ICM_OSD_Table->ICM_SR[color][0]), sizeof(int)*6);
	if (SR[h_end] >= SR[h_sta]) {
		buf = (unsigned int *)vip_malloc(((SR[i_end] - SR[i_sta] + 1) * (SR[s_end] - SR[s_sta] + 1) * (SR[h_end] - SR[h_sta] + 1) * 2) * sizeof(unsigned int));
		if (buf != NULL) {
			fwif_color_get_icm_table_Adjust_Block(display, &(gVip_Table->tICM_ini)[0][0][0], which_table, SR, buf);
			fwif_color_modify_icm_table_Adjust_Block(buf, (color+1), ICM_OSD_Table, SR, &ICM_OSD_value[color*3]);
			drvif_color_icm_SramBlockAccessSpeedup(buf, 1,  SR[h_sta],  SR[h_end],  SR[s_sta],  SR[s_end],  SR[i_sta],  SR[i_end]);
			/*free(buf);*/
			vip_free((void *)buf);
		}
	} else {		/*if hue step over 0*/
		memcpy(SR, &(ICM_OSD_Table->ICM_SR[color][0]), sizeof(int)*6);
		SR[h_end] = ICM_OSD_Table->h_Total_axis;		/* h_sta ~ h_Total_axis*/
		buf = (unsigned int *)vip_malloc(((SR[i_end] - SR[i_sta] + 1) * (SR[s_end] - SR[s_sta] + 1) * (SR[h_end] - SR[h_sta] + 1) * 2) * sizeof(unsigned int));
		if (buf != NULL) {
			fwif_color_get_icm_table_Adjust_Block(display, &(gVip_Table->tICM_ini)[0][0][0], which_table, SR, buf);
			fwif_color_modify_icm_table_Adjust_Block(buf, (color+1), ICM_OSD_Table, SR, &ICM_OSD_value[color*3]);
			drvif_color_icm_SramBlockAccessSpeedup(buf, 1,  SR[h_sta],  SR[h_end],  SR[s_sta],  SR[s_end],  SR[i_sta],  SR[i_end]);
			/*free(buf);*/
			vip_free((void *)buf);
		}

		memcpy(SR, &(ICM_OSD_Table->ICM_SR[color][0]), sizeof(int)*6);
		SR[h_sta] = 0;		/* 0 ~ h_end*/
		buf = (unsigned int *)vip_malloc(((SR[i_end] - SR[i_sta] + 1) * (SR[s_end] - SR[s_sta] + 1) * (SR[h_end] - SR[h_sta] + 1) * 2) * sizeof(unsigned int));
		if (buf != NULL) {
			fwif_color_get_icm_table_Adjust_Block(display, &(gVip_Table->tICM_ini)[0][0][0], which_table, SR, buf);
			fwif_color_modify_icm_table_Adjust_Block(buf, (color+1), ICM_OSD_Table, SR, &ICM_OSD_value[color*3]);
			drvif_color_icm_SramBlockAccessSpeedup(buf, 1,  SR[h_sta],  SR[h_end],  SR[s_sta],  SR[s_end],  SR[i_sta],  SR[i_end]);
			/*free(buf);*/
			vip_free((void *)buf);
		}
	}
}


/*============== ICM  =====*/


/*=============================================================================//VDC ConBri CSFC 20140210*/
/*===  VDC Contrast / Brightness ================*/

void fwif_color_module_vdc_SetConBriHueSat(unsigned char src_idx, unsigned char value)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	drvif_module_vdc_SetContrast(gVip_Table->VD_ConBriHueSat[value].VD_contrast);
	drvif_module_vdc_SetBrightness(gVip_Table->VD_ConBriHueSat[value].VD_brightness);
	drvif_module_vdc_SetHue(gVip_Table->VD_ConBriHueSat[value].VD_hue);
	drvif_module_vdc_SetSaturation(gVip_Table->VD_ConBriHueSat[value].VD_saturation);
}

/*===  VDC Contrast / Brightness ================*/
/*=============================================================================//VDC ConBri CSFC 20140210*/

/*======== Set color temp=============*/
void fwif_color_setrgbcontrast(unsigned char display, unsigned short Red, unsigned short Green, unsigned short Blue, unsigned char  BlendRatio, unsigned char Overlay)
{
	VIPprintf("fwif_color_setrgbcontrast: display = %d, R = %d, G = %d, B = %d, BlendRatio = %d, Overlay = %d\n", display, Red, Green, Blue, BlendRatio, Overlay);

	/*USER:LewisLee DATE:2010/08/04*/
	/*at power on eye guard mode, we need set contrast later*/
	/*
	if (_TRUE == Scaler_Get_During_Power_On_EyeGuard_Adjust(SLR_EYE_GUARD_CONTRAST)) {
		Scaler_Set_Contrast_During_Power_On_EyeGuard(SLR_EYE_GUARD_CINTRAST_R, Red);
		Scaler_Set_Contrast_During_Power_On_EyeGuard(SLR_EYE_GUARD_CINTRAST_G, Green);
		Scaler_Set_Contrast_During_Power_On_EyeGuard(SLR_EYE_GUARD_CINTRAST_B, Blue);
	}
	elseif (_FALSE == Scaler_Get_During_Power_On_EyeGuard_Adjust(SLR_EYE_GUARD_CONTRAST))
	*/

		drvif_color_setrgbcontrast(
			display,
			Red,
			Green,
			Blue,
			BlendRatio,
			Overlay);

}

void fwif_color_setrgbbrightness(unsigned char display, unsigned short Red, unsigned short Green, unsigned short Blue)
{
	VIPprintf("drvif_color_setrgbbrightness: display = %d, R = %d, G = %d, B = %d\n", display, Red, Green, Blue);

	/*USER:LewisLee DATE:2010/08/04*/
	/*at power on eye guard mode, we need set brightness later*/
	/*
	if (_TRUE == Scaler_Get_During_Power_On_EyeGuard_Adjust(SLR_EYE_GUARD_BRIGHTNESS))
	{
		Scaler_Set_Contrast_During_Power_On_EyeGuard(SLR_EYE_GUARD_CINTRAST_R, Red);
		Scaler_Set_Contrast_During_Power_On_EyeGuard(SLR_EYE_GUARD_CINTRAST_G, Green);
		Scaler_Set_Contrast_During_Power_On_EyeGuard(SLR_EYE_GUARD_CINTRAST_B, Blue);
	}
	elseif (_FALSE == Scaler_Get_During_Power_On_EyeGuard_Adjust(SLR_EYE_GUARD_BRIGHTNESS))
	*/

		drvif_color_setrgbbrightness(
			display,
			Red,
			Green,
			Blue);

}

void fwif_color_Gamma_Curve_Write(unsigned int *Gamma_Encode, VIP_GAMMA_CHANNEL_RGB RGB_chanel_idx)
{
	drvif_color_Gamma_Curve_Write(Gamma_Encode, RGB_chanel_idx);
}

void fwif_color_setgamma(unsigned char display, unsigned char Mode)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	if (Mode > 9) {
		VIPprintf("fwif_color_setgamma error");
		return;
	}

	drvif_color_setgamma(display, Mode, &gVip_Table->tGAMMA[Mode]);

}
void fwif_color_setrgbcontrast_Identity(UINT8 isOverlay/* = 0*/)
{
	fwif_color_setrgbcontrast(
		_MAIN_DISPLAY,
		512,
		512,
		512,
		Scaler_PipGetInfo(SLR_PIP_BLENDING), isOverlay);
}

void fwif_color_setrgbbrightness_Identity()
{

	fwif_color_setrgbbrightness(
		_MAIN_DISPLAY,
		512,
		512,
		512);
}

void fwif_color_setrgbcontrast_By_Table(unsigned short R, unsigned short G, unsigned short B, UINT8 isOverlay/* = 0*/)
{
	VIPprintf("fwif_color_setrgbcontrast_By_Table: R = %d, G = %d, B = %d\n", R, G, B);
	fwif_color_setrgbcontrast(_MAIN_DISPLAY,
		R,
		G,
		B,
		Scaler_PipGetInfo(SLR_PIP_BLENDING), isOverlay);
}

void fwif_color_setrgbbrightness_By_Table(unsigned short R, unsigned short G, unsigned short B)
{
	VIPprintf("fwif_color_setrgbbrightness_By_Table: R = %d, G = %d, B = %d\n", R, G, B);
	fwif_color_setrgbbrightness(_MAIN_DISPLAY,
		R,
		G,
		B);
}


void fwif_color_gamma_control_front(unsigned char display)
{
	drvif_color_gamma_control_front(display);
}

void fwif_color_gamma_control_back(unsigned char display, unsigned char ucWriteEnable)
{
	drvif_color_gamma_control_back(display, ucWriteEnable);
}

void fwif_color_gamma_enable_patch(unsigned char ucEbable)
{
	int ret;
	ret = Scaler_SendRPC(SCALERIOC_GAMMA_ENABLE_PATCH, ucEbable, RPC_SEND_VALUE_ONLY);
	if (0 != ret) {
		VIPprintf("ret = %d, SCALERIOC_GAMMA_ENABLE_PATCH fail !!!\n", ret);
		return;
	}
}
void fwif_color_inv_gamma_enable_patch(unsigned char ucEbable)
{
	int ret;
	ret = Scaler_SendRPC(SCALERIOC_GAMMA_ENABLE_PATCH, ucEbable, RPC_SEND_VALUE_ONLY);
	if (0 != ret) {
		VIPprintf("ret = %d, SCALERIOC_GAMMA_ENABLE_PATCH fail !!!\n", ret);
		return;
	}
}


UINT32 Identity_Gamma[512] = {
	0x00000404, 0x00080404, 0x00100404, 0x00180404, 0x00200404, 0x00280404, 0x00300404, 0x00380404, /*Identity	1~	8*/
	0x00400404, 0x00480404, 0x00500404, 0x00580404, 0x00600404, 0x00680404, 0x00700404, 0x00780404, /*Identity	9~ 16*/
	0x00800404, 0x00880404, 0x00900404, 0x00980404, 0x00a00404, 0x00a80404, 0x00b00404, 0x00b80404, /*Identity  17~ 24*/
	0x00c00404, 0x00c80404, 0x00d00404, 0x00d80404, 0x00e00404, 0x00e80404, 0x00f00404, 0x00f80404, /*Identity  25~ 32*/
	0x01000404, 0x01080404, 0x01100404, 0x01180404, 0x01200404, 0x01280404, 0x01300404, 0x01380404, /*Identity  33~ 40*/
	0x01400404, 0x01480404, 0x01500404, 0x01580404, 0x01600404, 0x01680404, 0x01700404, 0x01780404, /*Identity  41~ 48*/
	0x01800404, 0x01880404, 0x01900404, 0x01980404, 0x01a00404, 0x01a80404, 0x01b00404, 0x01b80404, /*Identity  49~ 56*/
	0x01c00404, 0x01c80404, 0x01d00404, 0x01d80404, 0x01e00404, 0x01e80404, 0x01f00404, 0x01f80404, /*Identity  57~ 64*/
	0x02000404, 0x02080404, 0x02100404, 0x02180404, 0x02200404, 0x02280404, 0x02300404, 0x02380404, /*Identity  65~ 72*/
	0x02400404, 0x02480404, 0x02500404, 0x02580404, 0x02600404, 0x02680404, 0x02700404, 0x02780404, /*Identity  73~ 80*/
	0x02800404, 0x02880404, 0x02900404, 0x02980404, 0x02a00404, 0x02a80404, 0x02b00404, 0x02b80404, /*Identity  81~ 88*/
	0x02c00404, 0x02c80404, 0x02d00404, 0x02d80404, 0x02e00404, 0x02e80404, 0x02f00404, 0x02f80404, /*Identity  89~ 96*/
	0x03000404, 0x03080404, 0x03100404, 0x03180404, 0x03200404, 0x03280404, 0x03300404, 0x03380404, /*Identity  97~104*/
	0x03400404, 0x03480404, 0x03500404, 0x03580404, 0x03600404, 0x03680404, 0x03700404, 0x03780404, /*Identity 105~112*/
	0x03800404, 0x03880404, 0x03900404, 0x03980404, 0x03a00404, 0x03a80404, 0x03b00404, 0x03b80404, /*Identity 113~120*/
	0x03c00404, 0x03c80404, 0x03d00404, 0x03d80404, 0x03e00404, 0x03e80404, 0x03f00404, 0x03f80404, /*Identity 121~128*/
	0x04000404, 0x04080404, 0x04100404, 0x04180404, 0x04200404, 0x04280404, 0x04300404, 0x04380404, /*Identity 129~136*/
	0x04400404, 0x04480404, 0x04500404, 0x04580404, 0x04600404, 0x04680404, 0x04700404, 0x04780404, /*Identity 137~144*/
	0x04800404, 0x04880404, 0x04900404, 0x04980404, 0x04a00404, 0x04a80404, 0x04b00404, 0x04b80404, /*Identity 145~152*/
	0x04c00404, 0x04c80404, 0x04d00404, 0x04d80404, 0x04e00404, 0x04e80404, 0x04f00404, 0x04f80404, /*Identity 153~160*/
	0x05000404, 0x05080404, 0x05100404, 0x05180404, 0x05200404, 0x05280404, 0x05300404, 0x05380404, /*Identity 161~168*/
	0x05400404, 0x05480404, 0x05500404, 0x05580404, 0x05600404, 0x05680404, 0x05700404, 0x05780404, /*Identity 169~176*/
	0x05800404, 0x05880404, 0x05900404, 0x05980404, 0x05a00404, 0x05a80404, 0x05b00404, 0x05b80404, /*Identity 177~184*/
	0x05c00404, 0x05c80404, 0x05d00404, 0x05d80404, 0x05e00404, 0x05e80404, 0x05f00404, 0x05f80404, /*Identity 185~192*/
	0x06000404, 0x06080404, 0x06100404, 0x06180404, 0x06200404, 0x06280404, 0x06300404, 0x06380404, /*Identity 193~200*/
	0x06400404, 0x06480404, 0x06500404, 0x06580404, 0x06600404, 0x06680404, 0x06700404, 0x06780404, /*Identity 201~208*/
	0x06800404, 0x06880404, 0x06900404, 0x06980404, 0x06a00404, 0x06a80404, 0x06b00404, 0x06b80404, /*Identity 209~216*/
	0x06c00404, 0x06c80404, 0x06d00404, 0x06d80404, 0x06e00404, 0x06e80404, 0x06f00404, 0x06f80404, /*Identity 217~224*/
	0x07000404, 0x07080404, 0x07100404, 0x07180404, 0x07200404, 0x07280404, 0x07300404, 0x07380404, /*Identity 225~232*/
	0x07400404, 0x07480404, 0x07500404, 0x07580404, 0x07600404, 0x07680404, 0x07700404, 0x07780404, /*Identity 233~240*/
	0x07800404, 0x07880404, 0x07900404, 0x07980404, 0x07a00404, 0x07a80404, 0x07b00404, 0x07b80404, /*Identity 241~248*/
	0x07c00404, 0x07c80404, 0x07d00404, 0x07d80404, 0x07e00404, 0x07e80404, 0x07f00404, 0x07f80404, /*Identity 249~256*/
	0x08000404, 0x08080404, 0x08100404, 0x08180404, 0x08200404, 0x08280404, 0x08300404, 0x08380404, /*Identity 257~264*/
	0x08400404, 0x08480404, 0x08500404, 0x08580404, 0x08600404, 0x08680404, 0x08700404, 0x08780404, /*Identity 265~272*/
	0x08800404, 0x08880404, 0x08900404, 0x08980404, 0x08a00404, 0x08a80404, 0x08b00404, 0x08b80404, /*Identity 273~280*/
	0x08c00404, 0x08c80404, 0x08d00404, 0x08d80404, 0x08e00404, 0x08e80404, 0x08f00404, 0x08f80404, /*Identity 281~288*/
	0x09000404, 0x09080404, 0x09100404, 0x09180404, 0x09200404, 0x09280404, 0x09300404, 0x09380404, /*Identity 289~296*/
	0x09400404, 0x09480404, 0x09500404, 0x09580404, 0x09600404, 0x09680404, 0x09700404, 0x09780404, /*Identity 297~304*/
	0x09800404, 0x09880404, 0x09900404, 0x09980404, 0x09a00404, 0x09a80404, 0x09b00404, 0x09b80404, /*Identity 305~312*/
	0x09c00404, 0x09c80404, 0x09d00404, 0x09d80404, 0x09e00404, 0x09e80404, 0x09f00404, 0x09f80404, /*Identity 313~320*/
	0x0a000404, 0x0a080404, 0x0a100404, 0x0a180404, 0x0a200404, 0x0a280404, 0x0a300404, 0x0a380404, /*Identity 321~328*/
	0x0a400404, 0x0a480404, 0x0a500404, 0x0a580404, 0x0a600404, 0x0a680404, 0x0a700404, 0x0a780404, /*Identity 329~336*/
	0x0a800404, 0x0a880404, 0x0a900404, 0x0a980404, 0x0aa00404, 0x0aa80404, 0x0ab00404, 0x0ab80404, /*Identity 337~344*/
	0x0ac00404, 0x0ac80404, 0x0ad00404, 0x0ad80404, 0x0ae00404, 0x0ae80404, 0x0af00404, 0x0af80404, /*Identity 345~352*/
	0x0b000404, 0x0b080404, 0x0b100404, 0x0b180404, 0x0b200404, 0x0b280404, 0x0b300404, 0x0b380404, /*Identity 353~360*/
	0x0b400404, 0x0b480404, 0x0b500404, 0x0b580404, 0x0b600404, 0x0b680404, 0x0b700404, 0x0b780404, /*Identity 361~368*/
	0x0b800404, 0x0b880404, 0x0b900404, 0x0b980404, 0x0ba00404, 0x0ba80404, 0x0bb00404, 0x0bb80404, /*Identity 369~376*/
	0x0bc00404, 0x0bc80404, 0x0bd00404, 0x0bd80404, 0x0be00404, 0x0be80404, 0x0bf00404, 0x0bf80404, /*Identity 377~384*/
	0x0c000404, 0x0c080404, 0x0c100404, 0x0c180404, 0x0c200404, 0x0c280404, 0x0c300404, 0x0c380404, /*Identity 385~392*/
	0x0c400404, 0x0c480404, 0x0c500404, 0x0c580404, 0x0c600404, 0x0c680404, 0x0c700404, 0x0c780404, /*Identity 393~400*/
	0x0c800404, 0x0c880404, 0x0c900404, 0x0c980404, 0x0ca00404, 0x0ca80404, 0x0cb00404, 0x0cb80404, /*Identity 401~408*/
	0x0cc00404, 0x0cc80404, 0x0cd00404, 0x0cd80404, 0x0ce00404, 0x0ce80404, 0x0cf00404, 0x0cf80404, /*Identity 409~416*/
	0x0d000404, 0x0d080404, 0x0d100404, 0x0d180404, 0x0d200404, 0x0d280404, 0x0d300404, 0x0d380404, /*Identity 417~424*/
	0x0d400404, 0x0d480404, 0x0d500404, 0x0d580404, 0x0d600404, 0x0d680404, 0x0d700404, 0x0d780404, /*Identity 425~432*/
	0x0d800404, 0x0d880404, 0x0d900404, 0x0d980404, 0x0da00404, 0x0da80404, 0x0db00404, 0x0db80404, /*Identity 433~440*/
	0x0dc00404, 0x0dc80404, 0x0dd00404, 0x0dd80404, 0x0de00404, 0x0de80404, 0x0df00404, 0x0df80404, /*Identity 441~448*/
	0x0e000404, 0x0e080404, 0x0e100404, 0x0e180404, 0x0e200404, 0x0e280404, 0x0e300404, 0x0e380404, /*Identity 449~456*/
	0x0e400404, 0x0e480404, 0x0e500404, 0x0e580404, 0x0e600404, 0x0e680404, 0x0e700404, 0x0e780404, /*Identity 457~464*/
	0x0e800404, 0x0e880404, 0x0e900404, 0x0e980404, 0x0ea00404, 0x0ea80404, 0x0eb00404, 0x0eb80404, /*Identity 465~472*/
	0x0ec00404, 0x0ec80404, 0x0ed00404, 0x0ed80404, 0x0ee00404, 0x0ee80404, 0x0ef00404, 0x0ef80404, /*Identity 473~480*/
	0x0f000404, 0x0f080404, 0x0f100404, 0x0f180404, 0x0f200404, 0x0f280404, 0x0f300404, 0x0f380404, /*Identity 481~488*/
	0x0f400404, 0x0f480404, 0x0f500404, 0x0f580404, 0x0f600404, 0x0f680404, 0x0f700404, 0x0f780404, /*Identity 489~496*/
	0x0f800404, 0x0f880404, 0x0f900404, 0x0f980404, 0x0fa00404, 0x0fa80404, 0x0fb00404, 0x0fb80404, /*Identity 497~504*/
	0x0fc00404, 0x0fc80404, 0x0fd00404, 0x0fd80404, 0x0fe00404, 0x0fe80404, 0x0ff00404, 0x0ff80404, /*Identity 505~512*/
};

void fwif_color_set_gamma_Identity(void)
{
	VIPprintf("fwif_color_set_gamma_Identity\n");

	drvif_color_gamma_control_front(0);

	fwif_color_Gamma_Curve_Write(Identity_Gamma, GAMMA_CHANNEL_R);	/*R*/
	fwif_color_Gamma_Curve_Write(Identity_Gamma, GAMMA_CHANNEL_G);	/*G*/
	fwif_color_Gamma_Curve_Write(Identity_Gamma, GAMMA_CHANNEL_B);	/*B*/
	drvif_color_gamma_control_back(0, 1);
}


void fwif_color_get_gamma_default(unsigned char Gamma_Mode, unsigned int **In_R, unsigned int **In_G, unsigned int **In_B)
{
	unsigned short OSD_Color_temp, OSD_Color_name;

	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	g_GammaMode = Gamma_Mode;
	OSD_Color_name = scaler_get_color_temp_level_type(GET_UI_SOURCE_FROM_PCB());
	switch (OSD_Color_name) {
	case SLR_COLORTEMP_USER:
	case SLR_COLORTEMP_NORMAL:
			OSD_Color_temp = 2;
			break;
	case SLR_COLORTEMP_WARMER:
	case SLR_COLORTEMP_WARM:
			OSD_Color_temp = 1;
			break;
	case SLR_COLORTEMP_COOL:
	case SLR_COLORTEMP_COOLER:
			OSD_Color_temp = 3;
			break;
	default:
			VIPprintf("ERROR!! Scaler_color_get_gamma_default get the wrong color temp!!");
			OSD_Color_temp = 3;
			break;
		/*return;*/
	}

	VIPprintf("Scaler_color_get_gamma_default, Mode = %d\n", Gamma_Mode);
	if (Gamma_Mode !=  0) {
		switch (Gamma_Mode) {
		case 1:
				Gamma_Mode = OSD_Color_temp;
				break;
		case 2:
				Gamma_Mode = OSD_Color_temp + 3;
				break;
		default:
				VIPprintf("ERROR!! Scaler_color_get_gamma_default get the wrong mode!!");
				Gamma_Mode = OSD_Color_temp;
				break;
		}
	}

	VIPprintf("Scaler_color_get_gamma_default, OSD_Color_temp = %d, OSD_Color_name = %d, Mode = %d\n", OSD_Color_temp, OSD_Color_name, Gamma_Mode);

	switch (Gamma_Mode) {
	case 0:
			*In_R = Identity_Gamma;
			*In_G = Identity_Gamma;
			*In_B = Identity_Gamma;
		break;
	case 1:
	default:
			*In_R = gVip_Table->tGAMMA[0].R;
			*In_G = gVip_Table->tGAMMA[0].G;
			*In_B = gVip_Table->tGAMMA[0].B;
			break;
	case 2:
			*In_R = gVip_Table->tGAMMA[1].R;
			*In_G = gVip_Table->tGAMMA[1].G;
			*In_B = gVip_Table->tGAMMA[1].B;
			break;
	case 3:/*cool 2.2*/
			*In_R = gVip_Table->tGAMMA[4].R;
			*In_G = gVip_Table->tGAMMA[4].G;
			*In_B = gVip_Table->tGAMMA[4].B;
			break;
	case 4:/*warm 2.4*/
			*In_R = gVip_Table->tGAMMA[5].R;
			*In_G = gVip_Table->tGAMMA[5].G;
			*In_B = gVip_Table->tGAMMA[5].B;
			break;
	case 5:/*standard 2.4*/
			*In_R = gVip_Table->tGAMMA[6].R;
			*In_G = gVip_Table->tGAMMA[6].G;
			*In_B = gVip_Table->tGAMMA[6].B;
			break;
	case 6:/*cool 2.4*/
			*In_R = gVip_Table->tGAMMA[7].R;
			*In_G = gVip_Table->tGAMMA[7].G;
			*In_B = gVip_Table->tGAMMA[7].B;
			break;
	}
}

void fwif_color_encode_gamma_debug(UINT8 type)
{
	UINT16 i;

	switch (type) {
	case 1:
			VIPprintf("======choose encode gamma data result======\n");
			for (i = 0; i < Bin_Num_Gamma / 2; i++) {
				if ((i < 10) || (i > ((Bin_Num_Gamma / 2) - 10)))
					/*VIPprintf("tGAMMA_temp_R[%d] = 0x%x\n", i, tGAMMA_temp_R[i]);*/
					VIPprintf("tGAMMA_temp_R[%d] = %x, tGAMMA_temp_G[%d] = %x, tGAMMA_temp_B[%d] = %x\n", i, tGAMMA_temp_R[i], i, tGAMMA_temp_G[i], i, tGAMMA_temp_B[i]);
			}
			break;
	case 2:
			VIPprintf("======after encode======\n");
			for (i = 0; i < Bin_Num_Gamma / 2; i++) {
				if ((i < 10) || (i > ((Bin_Num_Gamma / 2) - 10)))
					/*VIPprintf("tGAMMA_temp_R[%d] = 0x%x\n", i, tGAMMA_temp_R[i]);*/
					VIPprintf("final_GAMMA_R[%d] = %x, final_GAMMA_G[%d] = %x, final_GAMMA_B[%d] = %x\n", i, final_GAMMA_R[i], i, final_GAMMA_G[i], i, final_GAMMA_B[i]);
			}
			break;
	default:
			/*VIPprintf("======   ======\n");*/
			break;
	}
	/*VIPprintf("bin_num = %d\n", Bin_Num_Gamma);*/
}

void fwif_color_gamma_decode(UINT16 *Out_R, UINT16 *Out_G, UINT16 *Out_B, unsigned int *In_R, unsigned int *In_G, unsigned int *In_B)
{
	UINT16 i;

	Out_R[0] = 0;
	Out_G[0] = 0;
	Out_B[0] = 0;

	for (i = 0; i < Bin_Num_Gamma; i++) {
		if (i % 2 == 0) {
			/*VIPprintf("0x%08x\n", tGAMMA_1_G[i/2]);*/

			Out_R[i] = (In_R[i / 2] >> 16);

			Out_R[i + 1] = (Out_R[i] + ((In_R[i / 2] & 0x7F00) >> 8));

			Out_G[i] = (In_G[i / 2] >> 16);
			Out_G[i + 1] = (Out_G[i] + ((In_G[i / 2] & 0x7F00) >> 8));

			Out_B[i] = (In_B[i / 2] >> 16);
			Out_B[i + 1] = (Out_B[i] + ((In_B[i / 2] & 0x7F00) >> 8));
		}
	}

	/*data protect*/
	Out_R[Bin_Num_Gamma] = Out_R[Bin_Num_Gamma - 1];
	Out_G[Bin_Num_Gamma] = Out_G[Bin_Num_Gamma - 1];
	Out_B[Bin_Num_Gamma] = Out_B[Bin_Num_Gamma - 1];
}

void fwif_color_decode_gamma_debug(UINT8 type)
{
	UINT16 i;
	/*VIPprintf("bin_num = %d\n", Bin_Num_Gamma);*/

	switch (type) {
	case 1:
			VIPprintf("======gamma_decode======\n");
			break;
	case 2:
			VIPprintf("======gamma_blending_S_curve======\n");
			break;
	default:
			/*VIPprintf("======   ======\n");*/
			break;
	}

	for (i = 0; i < Bin_Num_Gamma; i++) {
		if ((i < 10) || (i > (Bin_Num_Gamma - 10)))
			VIPprintf("GOut_R[%d] = %d, GOut_G[%d] = %d, GOut_B[%d] = %d\n", i, GOut_R[i], i, GOut_G[i], i, GOut_B[i]);
	}

}

void fwif_color_gamma_blending_S_curve(UINT16 index, UINT16 C_gain1, UINT16 C_gain0)
{
#if 0
	UINT16 G0[Bin_Num_Gamma + 1], G1[Bin_Num_Gamma + 1], Gz[Bin_Num_Gamma + 1];
	UINT8 Curve = 1;
	UINT16 i;

	VIPprintf("fwif_color_gamma_blending_S_curve, index = %d, C_gain1 = %d, C_gain0 = %d\n", index, C_gain1, C_gain0);
	if (C_gain1 == 0 && C_gain0 == 0)
		return;

	/*	for gamma >1: index = 1023, gain0 = (0.5 - 0.5^gamma)*400; (20140526_jyyang)*/
	FLOAT32 C_gain0f = (float)(C_gain0 / 100.);
	FLOAT32 C_gain1f = (float)(C_gain1 / 100.);

	if (index <=  0)
		index = 1;

	for (i = 0; i <=  Bin_Num_Gamma; i++) {
		G0[i] = i * gamma_scale;
		/*if (i !=  0 && G0[i] < G0[i - 1])*/
			/*VIPprintf("G0[%d] = %d\n", i, G0[i]);*/
	}

	for (i = 0; i <=  Bin_Num_Gamma; i++) {
		if (Curve == 1) {
			if (i <=  index)
				G1[i] = (unsigned short)(((float)i * i / index) * gamma_scale + 0.5);
			else
				G1[i] = (unsigned short)(((float)(i - Bin_Num_Gamma)*(i - Bin_Num_Gamma)/(index - Bin_Num_Gamma) + Bin_Num_Gamma) * gamma_scale + 0.5);
		} else {
			if (i <=  index)
				G1[i] = (unsigned short)(((float)(i - index) * (i - index) / (0 - index) + index) * gamma_scale + 0.5);
			else
				G1[i] = (unsigned short)(((float)(i - index) * (i - index) / (Bin_Num_Gamma - index) + index) * gamma_scale + 0.5);
		}
		/*if (i !=  0 && G1[i] < G1[i - 1])*/
			/*VIPprintf("G1[%d] = %d\n", i, G1[i]);*/
	}

	Gz[0] = 0;
	for (i = 0; i <=  Bin_Num_Gamma; i++) {
		if (i <=  index)
			Gz[i] = (unsigned short)((G1[i] - G0[i]) * C_gain0f + G0[i] + 0.5);
		else
			Gz[i] = (unsigned short)((G1[i] - G0[i]) * C_gain1f + G0[i] + 0.5);
		/*if (i !=  0 && Gz[i] < Gz[i - 1])*/
			/*VIPprintf("Gz[%d] = %d, index = %d, C_gain0f = %f, C_gain1f = %f\n", i, Gz[i], index, C_gain0f, C_gain1f);*/
	}

	for (i = 1; i < Bin_Num_Gamma; i++) {
		/*VIPprintf("=============%d========%d===in\n", i, GOut_R[i]);*/
		/*if (((i <=  index) && (Gz[i + 1] < GOut_R[i])) || ((i > index) && (Gz[i + 1] > GOut_R[i])))*/
			GOut_R[i] = GOut_R[i] * Gz[i + 1] / ((i + 1) * gamma_scale);
		/*if (((i <=  index) && (Gz[i + 1] < GOut_G[i])) || ((i > index) && (Gz[i + 1] > GOut_G[i]))*/)
			GOut_G[i] = GOut_G[i] * Gz[i + 1] / ((i + 1) * gamma_scale);
		/*if (((i <=  index) && (Gz[i + 1] < GOut_B[i])) || ((i > index) && (Gz[i + 1] > GOut_B[i]))*/)
			GOut_B[i] = GOut_B[i] * Gz[i + 1] / ((i + 1) * gamma_scale);

		#if 0
		if (i !=  0 && GOut_R[i] < GOut_R[i - 1]) {
			GOut_R[i] = GOut_R[i - 1];
			/*VIPprintf("GOut_R[%d] = %d\n", i, GOut_R[i]);*/
		}
		if (i !=  0 && GOut_G[i] < GOut_G[i - 1]) {
			GOut_G[i] = GOut_G[i - 1];
			/*VIPprintf("GOut_G[%d] = %d\n", i, GOut_G[i]);*/
		}
		if (i !=  0 && GOut_B[i] < GOut_B[i - 1]) {
			GOut_B[i] = GOut_B[i - 1];
			/*VIPprintf("GOut_B[%d] = %d\n", i, GOut_B[i]);*/
		}
		#endif
		/*VIPprintf("GOut_R[%d] = %d, GOut_G[%d] = %d, GOut_B[%d] = %d\n", i, GOut_R[i], i, GOut_G[i], i, GOut_B[i]);*/
	}

	GOut_R[Bin_Num_Gamma] = GOut_R[Bin_Num_Gamma - 1];
	GOut_G[Bin_Num_Gamma] = GOut_G[Bin_Num_Gamma - 1];
	GOut_B[Bin_Num_Gamma] = GOut_B[Bin_Num_Gamma - 1];

#endif
}


void fwif_color_gamma_curve_data_protect(UINT16 *Out_R, UINT16 *Out_G, UINT16 *Out_B)
{
	UINT16 i;
	UINT16 err_cnt = 0;

	/*gamma data protect*/
	Out_R[Bin_Num_Gamma] = Out_R[Bin_Num_Gamma - 1];
	Out_G[Bin_Num_Gamma] = Out_G[Bin_Num_Gamma - 1];
	Out_B[Bin_Num_Gamma] = Out_B[Bin_Num_Gamma - 1];

	/*R, make sure gamma curve is always increasing, and smaller than upper bound*/
	for (i = 0; i < Bin_Num_Gamma; i++) {
		if (Out_R[i] > Out_R[i + 1]) {
			if (err_cnt < 30)
				VIPprintf("Gamma curve ERROR!! Out_R[%d] = %d BIGGER than Out_R[%d] = %d\n", i, Out_R[i], i + 1, Out_R[i + 1]);
			/*Out_R[i + 1] = Out_R[i];*/
			err_cnt++;
		}
		if (Out_R[i] > Vmax_Gamma) {
			if (err_cnt < 30)
				VIPprintf("Gamma curve warning!! Out_R[%d] = %d BIGGER than Vmax_Gamma = %d\n", i, Out_R[i], Vmax_Gamma);
			Out_R[i] = Vmax_Gamma;
			err_cnt++;
		}
	}

	/*G, make sure gamma curve is always increasing, and smaller than upper bound*/
	for (i = 0; i < Bin_Num_Gamma; i++) {
		if (Out_G[i] > Out_G[i + 1]) {
			if (err_cnt < 30)
				VIPprintf("Gamma curve ERROR!! Out_G[%d] = %d BIGGER than Out_G[%d] = %d\n", i, Out_G[i], i + 1, Out_G[i + 1]);
			/*Out_G[i + 1] = Out_G[i];*/
			err_cnt++;
		}
		if (Out_G[i] > Vmax_Gamma) {
			if (err_cnt < 30)
				VIPprintf("Gamma curve warning!! Out_G[%d] = %d BIGGER than Vmax_Gamma = %d\n", i, Out_G[i], Vmax_Gamma);
			Out_G[i] = Vmax_Gamma;
			err_cnt++;
		}
	}

	/*B, make sure gamma curve is always increasing, and smaller than upper bound*/
	for (i = 0; i < Bin_Num_Gamma; i++) {
		if (Out_B[i] > Out_B[i + 1]) {
			if (err_cnt < 30)
				VIPprintf("Gamma curve ERROR!! Out_B[%d] = %d BIGGER than Out_B[%d] = %d\n", i, Out_B[i], i + 1, Out_B[i + 1]);
			/*Out_B[i + 1] = Out_B[i];*/
			err_cnt++;
		}

		if (Out_B[i] > Vmax_Gamma) {
			if (err_cnt < 30)
				VIPprintf("Gamma curve warning!! Out_B[%d] = %d BIGGER than Vmax_Gamma = %d\n", i, Out_B[i], Vmax_Gamma);
			Out_B[i] = Vmax_Gamma;
			err_cnt++;
		}
	}

	/*aviod all 0 to gamma curve*/
	if (Out_R[Bin_Num_Gamma] == 0 || Out_G[Bin_Num_Gamma] == 0 || Out_B[Bin_Num_Gamma] == 0 ||
		Out_R[Bin_Num_Gamma - 1] == 0 || Out_G[Bin_Num_Gamma - 1] == 0 || Out_B[Bin_Num_Gamma - 1] == 0) {
		VIPprintf("Gamma curve ERROR!! we have all 0 gamma curve!\n");
	}
}

void fwif_color_out_gamma_curve_data_protect(UINT16 *Out_R, UINT16 *Out_G, UINT16 *Out_B)
{
	UINT16 i;
	UINT16 err_cnt = 0;

	/*gamma data protect*/
	Out_R[Bin_Num_Output_Gamma] = Out_R[Bin_Num_Output_Gamma - 1];
	Out_G[Bin_Num_Output_Gamma] = Out_G[Bin_Num_Output_Gamma - 1];
	Out_B[Bin_Num_Output_Gamma] = Out_B[Bin_Num_Output_Gamma - 1];

	/*R, make sure gamma curve is always increasing, and smaller than upper bound*/
	for (i = 0; i < Bin_Num_Output_Gamma; i++) {
		if (Out_R[i] > Out_R[i + 1]) {
			if (err_cnt < 30)
				rtd_pr_vpq_notice("Gamma curve ERROR!! Out_R[%d] = %d BIGGER than Out_R[%d] = %d\n", i, Out_R[i], i + 1, Out_R[i + 1]);
			/*Out_R[i + 1] = Out_R[i];*/
			err_cnt++;
		}
		if (Out_R[i] > Vmax_OutGamma) {
			if (err_cnt < 30)
				rtd_pr_vpq_notice("Gamma curve warning!! Out_R[%d] = %d BIGGER than Vmax_OutGamma = %d\n", i, Out_R[i], Vmax_OutGamma);
			Out_R[i] = Vmax_OutGamma;
			err_cnt++;
		}
	}

	/*G, make sure gamma curve is always increasing, and smaller than upper bound*/
	for (i = 0; i < Bin_Num_Output_Gamma; i++) {
		if (Out_G[i] > Out_G[i + 1]) {
			if (err_cnt < 30)
				rtd_pr_vpq_notice("Gamma curve ERROR!! Out_G[%d] = %d BIGGER than Out_G[%d] = %d\n", i, Out_G[i], i + 1, Out_G[i + 1]);
			/*Out_G[i + 1] = Out_G[i];*/
			err_cnt++;
		}
		if (Out_G[i] > Vmax_OutGamma) {
			if (err_cnt < 30)
				rtd_pr_vpq_notice("Gamma curve warning!! Out_G[%d] = %d BIGGER than Vmax_OutGamma = %d\n", i, Out_G[i], Vmax_OutGamma);
			Out_G[i] = Vmax_OutGamma;
			err_cnt++;
		}
	}

	/*B, make sure gamma curve is always increasing, and smaller than upper bound*/
	for (i = 0; i < Bin_Num_Output_Gamma; i++) {
		if (Out_B[i] > Out_B[i + 1]) {
			if (err_cnt < 30)
				rtd_pr_vpq_notice("Gamma curve ERROR!! Out_B[%d] = %d BIGGER than Out_B[%d] = %d\n", i, Out_B[i], i + 1, Out_B[i + 1]);
			/*Out_B[i + 1] = Out_B[i];*/
			err_cnt++;
		}

		if (Out_B[i] > Vmax_OutGamma) {
			if (err_cnt < 30)
				rtd_pr_vpq_notice("Gamma curve warning!! Out_B[%d] = %d BIGGER than Vmax_OutGamma = %d\n", i, Out_B[i], Vmax_OutGamma);
			Out_B[i] = Vmax_OutGamma;
			err_cnt++;
		}
	}

	/*aviod all 0 to gamma curve*/
	if (Out_R[Bin_Num_Output_Gamma] == 0 || Out_G[Bin_Num_Output_Gamma] == 0 || Out_B[Bin_Num_Output_Gamma] == 0 ||
		Out_R[Bin_Num_Output_Gamma - 1] == 0 || Out_G[Bin_Num_Output_Gamma - 1] == 0 || Out_B[Bin_Num_Output_Gamma - 1] == 0) {
		rtd_pr_vpq_notice("Gamma curve ERROR!! we have all 0 gamma curve!\n");
	}
}


void fwif_color_osd_gamma_encode(unsigned int *final_R, unsigned int *final_G, unsigned int *final_B, UINT16 *Out_R, UINT16 *Out_G, UINT16 *Out_B)
{
	UINT16 i;
	UINT16 d0, d1;
	UINT8 d_max = 128;

	for (i = 0; i < 256-1; i++) {
		if (i % 2 == 0) {
			d0 = (Out_R[i + 1] >=  Out_R[i]) ? (Out_R[i + 1] - Out_R[i]) : 0;
			d1 = (Out_R[i + 2] >=  Out_R[i + 1]) ? (Out_R[i + 2] - Out_R[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_R[i / 2] = (Out_R[i] << 16) + (d0 << 8) + d1;

			d0 = (Out_G[i + 1] >=  Out_G[i]) ? (Out_G[i + 1] - Out_G[i]) : 0;
			d1 = (Out_G[i + 2] >=  Out_G[i + 1]) ? (Out_G[i + 2] - Out_G[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_G[i / 2] = (Out_G[i] << 16) + (d0 << 8) + d1;


			d0 = (Out_B[i + 1] >= Out_B[i]) ? (Out_B[i + 1] - Out_B[i]) : 0;
			d1 = (Out_B[i + 2] >= Out_B[i + 1]) ? (Out_B[i + 2] - Out_B[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_B[i / 2] = (Out_B[i] << 16) + (d0 << 8) + d1;

		}
	}

}

void fwif_color_gamma_encode(unsigned int *final_R, unsigned int *final_G, unsigned int *final_B, UINT16 *Out_R, UINT16 *Out_G, UINT16 *Out_B)
{
	UINT16 i;
	UINT16 d0, d1;
	UINT8 d_max = 255;

	for (i = 0; i < Bin_Num_Gamma-1; i++) {
		if (i % 2 == 0) {
			d0 = (Out_R[i + 1] >=  Out_R[i]) ? (Out_R[i + 1] - Out_R[i]) : 0;
			d1 = (Out_R[i + 2] >=  Out_R[i + 1]) ? (Out_R[i + 2] - Out_R[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_R[i / 2] = (Out_R[i] << 16) + (d0 << 8) + d1;

			d0 = (Out_G[i + 1] >=  Out_G[i]) ? (Out_G[i + 1] - Out_G[i]) : 0;
			d1 = (Out_G[i + 2] >=  Out_G[i + 1]) ? (Out_G[i + 2] - Out_G[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_G[i / 2] = (Out_G[i] << 16) + (d0 << 8) + d1;


			d0 = (Out_B[i + 1] >= Out_B[i]) ? (Out_B[i + 1] - Out_B[i]) : 0;
			d1 = (Out_B[i + 2] >= Out_B[i + 1]) ? (Out_B[i + 2] - Out_B[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_B[i / 2] = (Out_B[i] << 16) + (d0 << 8) + d1;

		}
	}

	#if 0
	rtd_pr_vpq_debug("fwif_color_gamma_encode:\n");

	for (i = 0; i < 10; i++)
		rtd_pr_vpq_debug("final_R[%d] = 0x%x\n", i, final_R[i]);

	for (i = 250; i < 260; i++)
		rtd_pr_vpq_debug("final_R[%d] = 0x%x\n", i, final_R[i]);

	for (i = 500; i < 512; i++)
		rtd_pr_vpq_debug("final_R[%d] = 0x%x\n", i, final_R[i]);


	for (i = 0; i < 10; i++)
		rtd_pr_vpq_debug("Out_R[%d] = %d\n", i, Out_R[i]);
	for (i = 500; i < 520; i++)
		rtd_pr_vpq_debug("Out_R[%d] = %d\n", i, Out_R[i]);
	for (i = 1000; i < 1024; i++)
		rtd_pr_vpq_debug("Out_R[%d] = %d\n", i, Out_R[i]);
	#endif

}

void fwif_color_out_gamma_encode(unsigned int *final_R, unsigned int *final_G, unsigned int *final_B, UINT16 *Out_R, UINT16 *Out_G, UINT16 *Out_B)
{
	UINT16 i;
	UINT16 d0, d1;
	UINT8 d_max = 255;

	for (i = 0; i < Bin_Num_Output_Gamma-1; i++) {
		if (i % 2 == 0) {
			d0 = (Out_R[i + 1] >=  Out_R[i]) ? (Out_R[i + 1] - Out_R[i]) : 0;
			d1 = (Out_R[i + 2] >=  Out_R[i + 1]) ? (Out_R[i + 2] - Out_R[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_R[i / 2] = (Out_R[i] << 16) + (d0 << 8) + d1;

			d0 = (Out_G[i + 1] >=  Out_G[i]) ? (Out_G[i + 1] - Out_G[i]) : 0;
			d1 = (Out_G[i + 2] >=  Out_G[i + 1]) ? (Out_G[i + 2] - Out_G[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_G[i / 2] = (Out_G[i] << 16) + (d0 << 8) + d1;


			d0 = (Out_B[i + 1] >= Out_B[i]) ? (Out_B[i + 1] - Out_B[i]) : 0;
			d1 = (Out_B[i + 2] >= Out_B[i + 1]) ? (Out_B[i + 2] - Out_B[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_B[i / 2] = (Out_B[i] << 16) + (d0 << 8) + d1;

		}
	}

}

void fwif_color_output_gamma_encode(unsigned int *final_R, unsigned int *final_G, unsigned int *final_B, UINT16 *Out_R, UINT16 *Out_G, UINT16 *Out_B) // add for Merlin2 (jyyang 20160616)
{
	// gamma, inv_gamma: 1025bin, 512 grid(g0,d0,d1)
	// output_gamma, in_output_vgamma: 257bin, 128 grid(g0,d0,d1)
	// array size: final_R[128], Out_R[1025](for shared with gamma)
	UINT16 i,j0,j1,j2;
	UINT16 d0, d1;
	UINT8 d_max = 255;

	for (i = 0; i < Bin_Num_Output_Gamma-1; i++) {
		if (i % 2 == 0) {
			j0 = 4*i;
			j1 = j0+4; // 4*(i+1)
			j2 = j1+4; // 4*(i+2)
			d0 = (Out_R[j1] >=  Out_R[j0]) ? (Out_R[j1] - Out_R[j0]) : 0;
			d1 = (Out_R[j2] >=  Out_R[j1]) ? (Out_R[j2] - Out_R[j1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_R[i / 2] = (Out_R[j0] << 16) + (d0 << 8) + d1;

			d0 = (Out_G[j1] >=  Out_G[j0]) ? (Out_G[j1] - Out_G[j0]) : 0;
			d1 = (Out_G[j2] >=  Out_G[j1]) ? (Out_G[j2] - Out_G[j1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_G[i / 2] = (Out_G[j0] << 16) + (d0 << 8) + d1;


			d0 = (Out_B[j1] >= Out_B[j0]) ? (Out_B[j1] - Out_B[j0]) : 0;
			d1 = (Out_B[j2] >= Out_B[j1]) ? (Out_B[j2] - Out_B[j1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_B[i / 2] = (Out_B[j0] << 16) + (d0 << 8) + d1;

		}
	}

}

void fwif_color_out_gamma_encode_1ch(unsigned int * final, UINT16 * Out)
{

#if 0
	UINT16 i;
	UINT16 d0, d1;
	UINT8 d_max = 255;

	for (i = 0; i < 512; i++) {
		//if (i % 2 == 0) {
			d0 = (Out[i + 1] >=  Out[i]) ? (Out[i + 1] - Out[i]) : 0;
			d1 = (Out[i + 2] >=  Out[i + 1]) ? (Out[i + 2] - Out[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			//final[i / 2] = (Out[i] << 16) + (d0 << 8) + d1;
      final[i] = (Out[i] << 16) + (d0 << 8) + d1;
		//}
	}

#else
	UINT16 i;
	UINT16 d0, d1;
	UINT16 d_max = 255;

	for (i = 0; i < Bin_Num_Output_Gamma-1; i++) {
		if (i % 2 == 0) {
			d0 = (Out[i + 1] >=  Out[i]) ? (Out[i + 1] - Out[i]) : 0;
			d1 = (Out[i + 2] >=  Out[i + 1]) ? (Out[i + 2] - Out[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final[i / 2] = (Out[i] << 16) + (d0 << 8) + d1;
		}
	}

#endif

}



void fwif_color_gamma_pre_encode_TV006_HDR_demo(UINT16 *final, UINT16 *main, UINT16 *sub)
{
	UINT16 i;

	//main gamma curve
	for (i = 0; i <= Bin_Num_Gamma / 2; i++)
	{
		final[i] = main[i * 2];
	}

	//sub gamma curve
	for (i = (Bin_Num_Gamma / 2) + 1; i <= Bin_Num_Gamma; i++)
	{
		final[i] = sub[(i - (Bin_Num_Gamma / 2)) * 2];
	}

	#if 0
	rtd_pr_vpq_debug("fwif_color_gamma_pre_encode_TV006_HDR_demo:\n");
	for (i = 0; i < 10; i++)
		rtd_pr_vpq_debug("final[%d] = %d\n", i, final[i]);

	for (i = 500; i < 520; i++)
		rtd_pr_vpq_debug("final[%d] = %d\n", i, final[i]);

	for (i = 1000; i < 1025; i++)
		rtd_pr_vpq_debug("final[%d] = %d\n", i, final[i]);
	#endif
}




void fwif_color_set_gamma_encode(unsigned int *final_GAMMA_R, unsigned int *final_GAMMA_G, unsigned int *final_GAMMA_B)
{
	fwif_color_Gamma_Curve_Write(final_GAMMA_R, GAMMA_CHANNEL_R);	/*R*/
	fwif_color_Gamma_Curve_Write(final_GAMMA_G, GAMMA_CHANNEL_G);	/*G*/
	fwif_color_Gamma_Curve_Write(final_GAMMA_B, GAMMA_CHANNEL_B);	/*B*/
}
void fwif_color_set_ddomainISR_gamma_encode(unsigned int *final_GAMMA_R, unsigned int *final_GAMMA_G, unsigned int *final_GAMMA_B)
{
	static UINT32 temp[1536];

	memcpy(temp, final_GAMMA_R, sizeof(UINT32)*512);  /*R*/
	memcpy(temp+512, final_GAMMA_G, sizeof(UINT32)*512); /*G*/
	memcpy(temp+1024, final_GAMMA_B, sizeof(UINT32)*512);/*B*/

	fwif_color_ChangeUINT32Endian(temp, 1536, 1);		//gamma run to d domain isr need enfian

	if (drvif_color_Gamma_Read_Write_Check())
		WaitFor_DEN_START();

#ifdef CONFIG_ARM64
	memcpy_toio((UINT32 *)Scaler_GetShareMemVirAddr(SCALERIOC_SET_GAMMA), temp, sizeof(UINT32)*3*(512));
#else
	memcpy((UINT32 *)Scaler_GetShareMemVirAddr(SCALERIOC_SET_GAMMA), temp, sizeof(UINT32)*3*(512));
#endif
	if ((Scaler_SendRPC(SCALERIOC_SET_GAMMA, 0, 0)) < 0) {
		rtd_pr_vpq_err(" update GAMMA to driver fail !!!\n");
	}
}
/*======== Set color temp end=============*/

void fwif_color_Set_Inv_Gamma_Encode(unsigned int *final_Inv_GAMMA_R, unsigned int *final_Inv_GAMMA_G, unsigned int *final_Inv_GAMMA_B)
{
	drvif_color_Inv_Gamma_Curve_Write(final_Inv_GAMMA_R, GAMMA_CHANNEL_R);	/*R*/
	drvif_color_Inv_Gamma_Curve_Write(final_Inv_GAMMA_G, GAMMA_CHANNEL_G);	/*G*/
	drvif_color_Inv_Gamma_Curve_Write(final_Inv_GAMMA_B, GAMMA_CHANNEL_B);	/*B*/
}

/*======================================================*/
/*please follow below step*/
/*0. gamma curve reg control*/
/*1. choose encode gamma data*/
/*2. decode gamma data to gamma curve*/
/*3. process the gamma curve*/
/*4. s-curve for gamma*/
/*5. gamma curve data protect and debug*/
/*6. encode gamma cuve to gamma data*/
/*7. write gamma table*/
/**/
/*BUT, each step can be SKIPPED or REPLACED*/
/*======================================================*/
void fwif_set_gamma(unsigned char Gamma_Mode, unsigned char Gamma_Sindex, unsigned char Gamma_Shigh, unsigned char Gamma_Slow)
{
	unsigned char display = 0;
	unsigned char src_idx = 0;
	Scaler_Get_Display_info(&display, &src_idx);

	down(&Gamma_Semaphore);
    rtd_pr_vpq_emerg("fwif_set_gamma\n");
	/*0. gamma curve reg control*/
	fwif_color_gamma_control_front(display);
    
#if 1//add for Gamma&InvGamma with CTP@InvOutputGamma
	fwif_color_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B, Power1div22Gamma, Power1div22Gamma, Power1div22Gamma);
	drvif_color_inv_gamma_enable(SLR_MAIN_DISPLAY, 1, 0);
	g_GammaMode = Gamma_Mode;
    
#else
	if (Scaler_access_Project_TV002_Style(0, 0) == Project_TV002_Style_1) {
		Scaler_get_gamma_decoded_TV002(GOut_R, GOut_G, GOut_B);
	} else {
		/*1. choose encode gamma data*/
		fwif_color_get_gamma_default(Gamma_Mode, &tGAMMA_temp_R, &tGAMMA_temp_G, &tGAMMA_temp_B);
		/*fwif_color_encode_gamma_debug(1);	debug*/

		/*2. decode gamma data to gamma curve*/
		fwif_color_gamma_decode(GOut_R, GOut_G, GOut_B, tGAMMA_temp_R, tGAMMA_temp_G, tGAMMA_temp_B);
		/*fwif_color_decode_gamma_debug(1);*/	/*debug*/

		/*3. process the gamma curve*/
		/*do nothing for main branch*/


		/*4. s - curve for gamma*/
		/*fwif_color_gamma_blending_S_curve(Gamma_Sindex, Gamma_Shigh, Gamma_Slow);*/
		/*fwif_color_decode_gamma_debug(2);*/	/*debug*/


		/*5. gamma curve data protect and debug*/
		fwif_color_gamma_curve_data_protect(GOut_R, GOut_G, GOut_B);		/*DO NOT mark this, must check*/


		/*6. encode gamma cuve to gamma data*/
#ifdef ENABLE_xvYcc
		fwif_color_gamma_remmping_for_xvYcc(src_idx, GOut_R, GOut_G, GOut_B);
#endif
	}

	/*fwif_color_gamma_encode();	*/ /*=== marked by Elsie ===*/
#ifdef CONFIG_RTK_GAMUT_SUPPORT
	fwif_color_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B, Power1div22Gamma, Power1div22Gamma, Power1div22Gamma);
	drvif_color_inv_gamma_enable(SLR_MAIN_DISPLAY, 1, 0);
#else
	fwif_color_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B, GOut_R, GOut_G, GOut_B);
#endif
	/*fwif_color_encode_gamma_debug(2);	*/ /*debug*/
#endif
	/*7. write gamma table*/
	fwif_color_set_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B);
	fwif_color_gamma_control_back(display, 1);

	up(&Gamma_Semaphore);

}
void fwif_set_ddomainISR_gamma(unsigned char Gamma_Mode, unsigned char Gamma_Sindex, unsigned char Gamma_Shigh, unsigned char Gamma_Slow)
{
	unsigned char display = 0;
	unsigned char src_idx = 0;
	Scaler_Get_Display_info(&display, &src_idx);

	/*0. gamma curve reg control*/
	//fwif_color_gamma_control_front(display);

	/*1. choose encode gamma data*/
	fwif_color_get_gamma_default(Gamma_Mode, &tGAMMA_temp_R, &tGAMMA_temp_G, &tGAMMA_temp_B);
	/*fwif_color_encode_gamma_debug(1);	debug*/

	/*2. decode gamma data to gamma curve*/
	fwif_color_gamma_decode(GOut_R, GOut_G, GOut_B, tGAMMA_temp_R, tGAMMA_temp_G, tGAMMA_temp_B);
	/*fwif_color_decode_gamma_debug(1);*/	/*debug*/

	/*3. process the gamma curve*/
	/*do nothing for main branch*/


	/*4. s - curve for gamma*/
	fwif_color_gamma_blending_S_curve(Gamma_Sindex, Gamma_Shigh, Gamma_Slow);
	/*fwif_color_decode_gamma_debug(2);*/	/*debug*/


	/*5. gamma curve data protect and debug*/
	fwif_color_gamma_curve_data_protect(GOut_R, GOut_G, GOut_B);		/*DO NOT mark this, must check*/


	/*6. encode gamma cuve to gamma data*/
#ifdef ENABLE_xvYcc
	fwif_color_gamma_remmping_for_xvYcc(src_idx, GOut_R, GOut_G, GOut_B);
#endif
	/*fwif_color_gamma_encode();	*/ /*=== marked by Elsie ===*/
	fwif_color_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B, GOut_R, GOut_G, GOut_B);
	/*fwif_color_encode_gamma_debug(2);	*/ /*debug*/

	/*7. write gamma table*/
	fwif_color_set_ddomainISR_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B);

}

void fwif_set_software_gamma(unsigned char Gamma_Mode, unsigned char Gamma_Sindex, unsigned char Gamma_Shigh, unsigned char Gamma_Slow)
{
	unsigned char display = 0;
	unsigned char src_idx = 0;
	Scaler_Get_Display_info(&display, &src_idx);

	/*0. gamma curve reg control*/
	fwif_color_gamma_control_front(display);

	/*1. choose encode gamma data*/
	fwif_color_get_gamma_default(Gamma_Mode, &tGAMMA_temp_R, &tGAMMA_temp_G, &tGAMMA_temp_B);
	/*fwif_color_encode_gamma_debug(1);	debug*/

	/*2. decode gamma data to gamma curve*/
	fwif_color_gamma_decode(GOut_R, GOut_G, GOut_B, tGAMMA_temp_R, tGAMMA_temp_G, tGAMMA_temp_B);
	/*fwif_color_decode_gamma_debug(1);*/	/*debug*/

	/*3. process the gamma curve*/
	/*do nothing for main branch*/


	/*4. s - curve for gamma*/
	fwif_color_gamma_blending_S_curve(Gamma_Sindex, Gamma_Shigh, Gamma_Slow);
	/*fwif_color_decode_gamma_debug(2);*/	/*debug*/


	/*5. gamma curve data protect and debug*/
	fwif_color_gamma_curve_data_protect(GOut_R, GOut_G, GOut_B);		/*DO NOT mark this, must check*/


	/*6. encode gamma cuve to gamma data*/
#ifdef ENABLE_xvYcc
	fwif_color_gamma_remmping_for_xvYcc(src_idx, GOut_R, GOut_G, GOut_B);
#endif
	/*fwif_color_gamma_encode();	*/ /*=== marked by Elsie ===*/
	fwif_color_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B, GOut_R, GOut_G, GOut_B);
	/*fwif_color_encode_gamma_debug(2);	*/ /*debug*/

	/*7. write gamma table*/
	fwif_color_set_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B);
	fwif_color_gamma_control_back(display, 1);

}
UINT8 SCPU_Automa_ISR = 0;
void fwif_color_SetAutoMAFlag(unsigned char flag)
{
	SCPU_Automa_ISR = flag;
}

void fwif_color_disable_VIP(unsigned char flag)
{
	if(flag == _ENABLE)
	{
		drvif_color_disable_VIP();
	}
}


unsigned char fwif_color_GetAutoMAFlag(void)
{
	return SCPU_Automa_ISR;
}


/*===============================================================================================	//NR rock 20140127*/

/*move to share memory access struct, elieli*/
/*
unsigned int fwif_color_regPQATableOffsetTemp(unsigned int *ptr)
{
	int ret, i;
	unsigned int *TempTable = NULL;

	if (!ptr)
		return FALSE;


	TempTable = (unsigned int *)Scaler_GetShareMemVirAddr(SCALERIOC_SET_PQA_TABLE_OFFSET_TEMP);


	memcpy(TempTable,  ptr, sizeof(unsigned int)*PQA_ITEM_MAX);

	for (i = 0; i < PQA_ITEM_MAX; i++)
	TempTable[i] = fwif_color_ChangeOneUINT32Endian(TempTable[i], 0);

	if (0 !=  (ret = Scaler_SendRPC(SCALERIOC_SET_PQA_TABLE_OFFSET_TEMP)))
	{
		VIPprintf("ret = %d, Get SCALERIOC_SET_PQA_TABLE_OFFSET_TEMP fail !!!\n", ret);
	}
	return TRUE;
}
*/

unsigned int  fwif_color_regNRTable(DRV_NR_Item *ptr)
{
	if (!ptr){
		return FALSE;
	}
	Manual_NR_TABLE = ptr;
	return TRUE;
}

unsigned int  fwif_color_regIEdgeSmooth_Coef(DRV_IEdgeSmooth_Coef *ptr)
{
	if (!ptr){
		return FALSE;
	}
	IEdgeSmooth_Coef = ptr;
	return TRUE;
}

unsigned int  fwif_color_regDEdgeSmooth_Coef(DRV_DEdgeSmooth_Coef *ptr)
{
	if (!ptr){
		return FALSE;
	}
	DEdgeSmooth_Coef = ptr;
	return TRUE;
}

void fwif_color_RTNR_flow(DRV_NR_Item *ptr)
{
	DRV_RTNR_General_ctrl RTNR_General_ctrl_off = {0};
	if (!ptr) {
		//VIPprintf("drvif_color_NR_flow table to NULL\n");
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "drvif_color_NR_flow table to NULL\n");
		return;
	}
	if (Scaler_color_access_RTNR_H_Rotate_Flag(0, 0) == 1)
		drvif_color_DRV_RTNR_General_ctrl(&RTNR_General_ctrl_off);
	else
		drvif_color_DRV_RTNR_General_ctrl(&(ptr->S_RTNR_TABLE.S_RTNR_General_ctrl));

	drvif_color_DRV_RTNR_Old_Y(&(ptr->S_RTNR_TABLE.S_RTNR_Old_Y));
	drvif_color_DRV_RTNR_Dark_K(&(ptr->S_RTNR_TABLE.S_RTNR_Dark_K));

// chen 170522
//	drvif_color_DRV_RTNR_New_Method(&(ptr->S_RTNR_TABLE.S_RTNR_New_Method));
//	drvif_color_DRV_RTNR_Mark(&(ptr->S_RTNR_TABLE.S_RTNR_Mask));
//	drvif_color_DRV_RTNR_By_Y(&(ptr->S_RTNR_TABLE.S_RTNR_By_Y));
// end chen 170522
// chen 180308

	//drvif_color_DRV_RTNR_LSB(&(ptr->S_RTNR_TABLE.S_RTNR_LSB));
//end 180308
	drvif_color_DRV_MCNR_table(&(ptr->S_RTNR_TABLE.S_MCNR_Table));
	/*drvif_color_DRV_RTNR_SNR(&(ptr->S_RTNR_TABLE.S_RTNR_SNR));*/
	drvif_color_DRV_RTNR_MASNR(&(ptr->S_RTNR_TABLE.S_RTNR_MASNR));
	drvif_color_DRV_RTNR_C(&(ptr->S_RTNR_TABLE.S_RTNR_C));
}

void fwif_color_SNR_flow(DRV_NR_Item *ptr)
{
	bool bIsVDSrc;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	if (!ptr) {
		//VIPprintf("drvif_color_SNR_flow table to NULL\n");
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "drvif_color_SNR_flow table to NULL\n");
		return;
	}
	//drvif_IESM_format_convert();//move to fw_scalerip_set_IEGSM()

	bIsVDSrc = ((VIP_system_info_structure_table->Input_src_Form) == _SRC_FROM_VDC && vdc_power_status);

	drvif_color_DRV_SNR_General_ctrl(&(ptr->S_SNR_TABLE.S_SNR_General_ctrl), bIsVDSrc);
	drvif_color_DRV_SNR_Spatial_NR_Y(&(ptr->S_SNR_TABLE.S_SNR_Spatial_NR_Y));
	drvif_color_DRV_SNR_Spatial_NR_C(&(ptr->S_SNR_TABLE.S_SNR_Spatial_NR_C));
	drvif_color_DRV_SNR_Modified_LPF(&(ptr->S_SNR_TABLE.S_SNR_Modified_LPF));
	//drvif_color_DRV_SNR_Impulse_NR(&(ptr->S_SNR_TABLE.S_SNR_Impulse_NR));
	drvif_color_DRV_SNR_Curve_Mapping_Mode(&(ptr->S_SNR_TABLE.S_SNR_Curve_Mapping_Mode));
	drvif_color_DRV_SNR_NR_Mask(&(ptr->S_SNR_TABLE.S_SNR_NR_Mask));
	drvif_color_DRV_SNR_NR_Mask_W1W2(&(ptr->S_SNR_TABLE.S_SNR_NR_Mask_W1W2)); /*Mac3, leonard wu@20140722*/
	drvif_color_DRV_SNR_Veritcal_NR(&(ptr->S_SNR_TABLE.S_SNR_Veritcal_NR));
	drvif_color_DRV_SNR_Weight_Adjust(&(ptr->S_SNR_TABLE.S_SNR_WeightAdjust)) ; /*add by jyyang Merlin*/
	drvif_color_DRV_SNR_UVEdge(&(ptr->S_SNR_TABLE.S_SNR_UVEdge));/*Merlin*/

	drvif_color_DRV_SNR_Mosquito_NR_Oneside_Edge(&(ptr->S_SNR_TABLE.S_SNR_MNR_Oneside_Edge)); //merlin5 add
	drvif_color_DRV_SNR_PQ_Mask(&(ptr->S_SNR_TABLE.S_SNR_PQ_Mask));//mk2 add
	/*drvif_color_DRV_SNR_Mosquito_NR(&(ptr->S_SNR_TABLE.S_SNR_Mosquito_NR));*/ /*Move to MPEG NR due to LG requirement*/
	//if (bIsVDSrc)
	//	drvif_color_DRV_SNR_VD_Spatial_NR_Y(&(ptr->S_SNR_TABLE.S_SNR_VD_Spatial_NR_Y)); /*Mac3*/
}

void fwif_color_PQA_Input_Item_Check(_system_setting_info *VIP_system_info_structure_table, unsigned int *PQA_TABLE, unsigned char table_select)
{
	UINT16 PQA_ITEM_count;
	UINT32 PQA_row, PQA_Reg, NR_Table;
	UINT8 PQA_Input_item, i;

	if (!PQA_TABLE || VIP_system_info_structure_table == NULL) {
		//VIPprintf("TABLE is NULL!!= [%s->%d], %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "TABLE is NULL!!= [%s->%d], %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	NR_Table = ((table_select * PQA_MODE_MAX * PQA_ITEM_MAX * PQA_LEVEL_MAX) + (PQA_MODE_OFFSET * PQA_ITEM_MAX * PQA_LEVEL_MAX));

	/*reset*/
	for (i = 0; i < PQA_INPUT_ITEM_MAX; i++)
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.PQA_Input_Item_Check_Flag[i] = 0;

	for (PQA_ITEM_count = 0; PQA_ITEM_count < PQA_ITEM_MAX; PQA_ITEM_count++) {
		PQA_row = NR_Table + (PQA_ITEM_count * PQA_LEVEL_MAX);
		PQA_Reg = *(PQA_TABLE + PQA_row + PQA_reg);
		PQA_Input_item = *(PQA_TABLE + PQA_row + PQA_input_item);

		if (PQA_Reg == 0xffffffff || PQA_ITEM_count >=  PQA_ITEM_MAX)
			break;
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.PQA_Input_Item_Check_Flag[PQA_Input_item] = 1;
	}

	NR_Table = ((table_select * PQA_MODE_MAX * PQA_ITEM_MAX * PQA_LEVEL_MAX) + (PQA_MODE_WRITE * PQA_ITEM_MAX * PQA_LEVEL_MAX));

	for (PQA_ITEM_count = 0; PQA_ITEM_count < PQA_ITEM_MAX; PQA_ITEM_count++) {
		PQA_row = NR_Table + (PQA_ITEM_count * PQA_LEVEL_MAX);

		PQA_Reg = *(PQA_TABLE + PQA_row + PQA_reg);
		PQA_Input_item = *(PQA_TABLE + PQA_row + PQA_input_item);

		if (PQA_Reg == 0xffffffff || PQA_ITEM_count >=  PQA_ITEM_MAX)
			break;
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.PQA_Input_Item_Check_Flag[PQA_Input_item] = 1;
	}
}

void fwif_color_SetDNR(unsigned char display, unsigned char level)
{
	SLR_VIP_TABLE *gVip_Table = NULL;
	unsigned int *PQA_TABLE = NULL;
	unsigned int *PQA_TABLE_OFFSET_TEMP = NULL;

	/*=== 20140421 CSFC for vip video fw infomation ====*/
	_system_setting_info *VIP_system_info_structure_table = NULL;

	//VIPprintf("fwif_color_SetDNR	%d	%d\n", display, level);
	//VIPprintfPrivate(VIP_LOGLEVEL_INFO, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "fwif_color_SetDNR	%d	%d\n", display, level);

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		//VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	VIP_system_info_structure_table->OSD_Info.OSD_NR_Mode = level;
	/*====================================*/

	gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		//VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	PQA_TABLE = &(gVip_Table->PQA_Table[0][0][0][0]);
	PQA_TABLE_OFFSET_TEMP = &(VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.OFFSET_TEMP[0]);

	fwif_color_PQA_Input_Item_Check(VIP_system_info_structure_table, PQA_TABLE, Scaler_GetDNR_table());
	if (level < 4) {	/*Manual Mode*/
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_DNR] = 0;
		/*WaitFor_DEN_STOP();*/
		fwif_color_RTNR_flow(&(gVip_Table->Manual_NR_Table[Scaler_GetDNR_table()][level]));
		fwif_color_SNR_flow(&(gVip_Table->Manual_NR_Table[Scaler_GetDNR_table()][level]));
	} else {	/*Auto Mode*/
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_DNR] = 0;
		/*WaitFor_DEN_STOP();*/
		fwif_color_RTNR_flow(&(gVip_Table->Manual_NR_Table[Scaler_GetDNR_table()][DRV_NR_AUTO]));
		fwif_color_SNR_flow(&(gVip_Table->Manual_NR_Table[Scaler_GetDNR_table()][DRV_NR_AUTO]));

		drvif_color_PQ_Adaptive_offset_temp(PQA_TABLE, Scaler_GetDNR_table(), I_DNR, PQA_TABLE_OFFSET_TEMP);
		/*fwif_color_regPQATableOffsetTemp(PQA_TABLE_OFFSET_TEMP);*/
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_DNR] = 1;
	}

#ifdef CONFIG_CUSTOMER_TV002
	// hack for picmode NR off also disable De-Contour
	if (level == 0) {
		IoReg_ClearBits(IPQ_DECONTOUR_De_Contour_CTRL_reg, IPQ_DECONTOUR_De_Contour_CTRL_decont_en_mask);
	} else {
		unsigned char value = Scaler_Get_I_De_Contour();
	
		if (value < I_De_Contour_TBL_Max) {
			if (I_De_Contour_TBL[value].decont_en)
				IoReg_SetBits(IPQ_DECONTOUR_De_Contour_CTRL_reg, IPQ_DECONTOUR_De_Contour_CTRL_decont_en_mask);
			else
				IoReg_ClearBits(IPQ_DECONTOUR_De_Contour_CTRL_reg, IPQ_DECONTOUR_De_Contour_CTRL_decont_en_mask);
		} else
			IoReg_ClearBits(IPQ_DECONTOUR_De_Contour_CTRL_reg, IPQ_DECONTOUR_De_Contour_CTRL_decont_en_mask);
	}
	IoReg_SetBits(IPQ_DECONTOUR_De_Contour_db_reg_ctl_reg, IPQ_DECONTOUR_De_Contour_db_reg_ctl_db_apply_mask);
#endif
}
void fwif_color_RHAL_SetDNR(unsigned char level)
{
	SLR_VIP_TABLE *gVip_Table = NULL;
	unsigned int *PQA_TABLE = NULL;
	unsigned int *PQA_TABLE_OFFSET_TEMP = NULL;

	/*=== 20140421 CSFC for vip video fw infomation ====*/
	_system_setting_info *VIP_system_info_structure_table = NULL;

	//VIPprintf("fwif_color_SetDNR=%d\n", level);
	VIPprintfPrivate(VIP_LOGLEVEL_INFO, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "fwif_color_SetDNR=%d\n", level);

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		//VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	VIP_system_info_structure_table->OSD_Info.OSD_NR_Mode = level;
	/*====================================*/

	gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		//VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	PQA_TABLE = &(gVip_Table->PQA_Table[0][0][0][0]);
	PQA_TABLE_OFFSET_TEMP = &(VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.OFFSET_TEMP[0]);

	fwif_color_PQA_Input_Item_Check(VIP_system_info_structure_table, PQA_TABLE, fwif_color_get_PQA_table());

	if (level < 4) {	/*Manual Mode*/
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_DNR] = 0;
		/*WaitFor_DEN_STOP();*/
		fwif_color_RTNR_flow(&(gVip_Table->Manual_NR_Table[fwif_color_get_PQA_table()][level]));
		fwif_color_SNR_flow(&(gVip_Table->Manual_NR_Table[fwif_color_get_PQA_table()][level]));
	} else {	/*Auto Mode*/
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_DNR] = 0;
		/*WaitFor_DEN_STOP();*/
		fwif_color_RTNR_flow(&(gVip_Table->Manual_NR_Table[fwif_color_get_PQA_table()][DRV_NR_AUTO]));
		fwif_color_SNR_flow(&(gVip_Table->Manual_NR_Table[fwif_color_get_PQA_table()][DRV_NR_AUTO]));

		drvif_color_PQ_Adaptive_offset_temp(PQA_TABLE, fwif_color_get_PQA_table(), I_DNR, PQA_TABLE_OFFSET_TEMP);
		/*fwif_color_regPQATableOffsetTemp(PQA_TABLE_OFFSET_TEMP);*/
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_DNR] = 1;
	}
}

void fwif_color_RHAL_SetMPEGNR(unsigned char level)
{
	/*int ret;*/
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	_system_setting_info *VIP_system_info_structure_table = NULL;
	unsigned int *PQA_TABLE = NULL;
	unsigned int *PQA_TABLE_OFFSET_TEMP = NULL;
	DRV_SNR_Mosquito_NR_blk SNR_Mosquito_NR_blk_OFF = {0}; // mk2

	//VIPprintf("fwif_color_SetMPEGNR	%d\n", level);
	VIPprintfPrivate(VIP_LOGLEVEL_INFO, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG,"fwif_color_SetMPEGNR=%d\n", level);

	if (gVip_Table == NULL) {
		//VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG,"~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	/*=== 20140421 CSFC for vip video fw infomation ====*/
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		//VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG,"~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	PQA_TABLE = &(gVip_Table->PQA_Table[0][0][0][0]);
	PQA_TABLE_OFFSET_TEMP = &(VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.OFFSET_TEMP[0]);

	if (level < 4) {
		DRV_NR_Item *ptr = NULL;
		/*Manual Mode*/
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_MPEGNR] = 0;
		/*WaitFor_DEN_STOP();*/
		ptr = &(gVip_Table->Manual_NR_Table[fwif_color_get_PQA_table()][level]);
		/*drvif_color_MPEGNR_flow(&(gVip_Table.Manual_NR_Table[fwif_color_get_PQA_table()][level]));*/
		// duplicate drvif_color_DRV_MPG_General_ctrl(&(ptr->S_MPG_TABLE.S_MPEGNR_General_ctrl));
		drvif_color_DRV_MPG_H(&(ptr->S_MPG_TABLE.S_MPEGNR_H));
		drvif_color_DRV_MPG_V(&(ptr->S_MPG_TABLE.S_MPEGNR_V));
		drvif_color_DRV_SNR_Mosquito_NR(&(ptr->S_SNR_TABLE.S_SNR_Mosquito_NR)); /*Add from set SNR due to LG requirement*/

		if (drv_memory_Get_MASNR_Mem_Ready_Flag(0) == 1)// mem s0 ready
			drvif_color_DRV_SNR_Mosquito_NR_blk(&(ptr->S_SNR_TABLE.S_SNR_Mosquito_NR_blk));//mk2 add
		else
			drvif_color_DRV_SNR_Mosquito_NR_blk(&SNR_Mosquito_NR_blk_OFF);//mk2 add
	} else {
		DRV_NR_Item *ptr = NULL;
		/*Auto Mode*/
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_MPEGNR] = 0;
		/*WaitFor_DEN_STOP();*/
		ptr = &(gVip_Table->Manual_NR_Table[fwif_color_get_PQA_table()][DRV_NR_AUTO]);
		/*drvif_color_MPEGNR_flow(&(gVip_Table.Manual_NR_Table[fwif_color_get_PQA_table()][DRV_NR_AUTO]));*/
		// duplicate drvif_color_DRV_MPG_General_ctrl(&(ptr->S_MPG_TABLE.S_MPEGNR_General_ctrl));
		drvif_color_DRV_MPG_H(&(ptr->S_MPG_TABLE.S_MPEGNR_H));
		drvif_color_DRV_MPG_V(&(ptr->S_MPG_TABLE.S_MPEGNR_V));
		drvif_color_DRV_SNR_Mosquito_NR(&(ptr->S_SNR_TABLE.S_SNR_Mosquito_NR)); /*Add from set SNR due to LG requirement*/

		if (drv_memory_Get_MASNR_Mem_Ready_Flag(0) == 1)// mem s0 ready
			drvif_color_DRV_SNR_Mosquito_NR_blk(&(ptr->S_SNR_TABLE.S_SNR_Mosquito_NR_blk));//mk2 add
		else
			drvif_color_DRV_SNR_Mosquito_NR_blk(&SNR_Mosquito_NR_blk_OFF);//mk2 add
		
		drvif_color_PQ_Adaptive_offset_temp(PQA_TABLE, fwif_color_get_PQA_table(), I_MPEGNR, PQA_TABLE_OFFSET_TEMP);
		/*fwif_color_regPQATableOffsetTemp(PQA_TABLE_OFFSET_TEMP);*/
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_MPEGNR] = 1;
	}

	VIP_system_info_structure_table->OSD_Info.OSD_MpegNR_Mode = level;
	/*====================================*/


	Scaler_set_picmode_init_value(PICMODE_INIT_MPEGNR, level);

}


void fwif_color_SetMPEGNR(unsigned char display, unsigned char level, unsigned char calledByOSD)
{
	int ret;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	_system_setting_info *VIP_system_info_structure_table = NULL;
	unsigned int *PQA_TABLE = NULL;
	unsigned int *PQA_TABLE_OFFSET_TEMP = NULL;
	DRV_SNR_Mosquito_NR_blk SNR_Mosquito_NR_blk_OFF = {0};

	//VIPprintf("fwif_color_SetMPEGNR	%d	%d\n", display, level);
	VIPprintfPrivate(VIP_LOGLEVEL_INFO, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG,"fwif_color_SetMPEGNR=%d,=%d\n", display, level);

	if (gVip_Table == NULL) {
		//VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG,"~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	/*=== 20140421 CSFC for vip video fw infomation ====*/
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		//VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG,"~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	PQA_TABLE = &(gVip_Table->PQA_Table[0][0][0][0]);
	PQA_TABLE_OFFSET_TEMP = &(VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.OFFSET_TEMP[0]);

	if (level < 4) {
		DRV_NR_Item *ptr = NULL;
		/*Manual Mode*/
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_MPEGNR] = 0;
		/*WaitFor_DEN_STOP();*/
		ptr = &(gVip_Table->Manual_NR_Table[Scaler_GetDNR_table()][level]);
		/*drvif_color_MPEGNR_flow(&(gVip_Table.Manual_NR_Table[Scaler_GetDNR_table()][level]));*/
		// duplicate drvif_color_DRV_MPG_General_ctrl(&(ptr->S_MPG_TABLE.S_MPEGNR_General_ctrl));
		drvif_color_DRV_MPG_H(&(ptr->S_MPG_TABLE.S_MPEGNR_H));
		drvif_color_DRV_MPG_V(&(ptr->S_MPG_TABLE.S_MPEGNR_V));
		drvif_color_DRV_SNR_Mosquito_NR(&(ptr->S_SNR_TABLE.S_SNR_Mosquito_NR));
		drvif_color_DRV_SNR_Mosquito_NR_En(1);	// fixed me
		
		if (drv_memory_Get_MASNR_Mem_Ready_Flag(0) == 1)// mem s0 ready
			drvif_color_DRV_SNR_Mosquito_NR_blk(&(ptr->S_SNR_TABLE.S_SNR_Mosquito_NR_blk));//mk2 add
		else
			drvif_color_DRV_SNR_Mosquito_NR_blk(&SNR_Mosquito_NR_blk_OFF);//mk2 add
			
		drvif_color_set_DRV_MPG_H_SW_Ctrl(&(ptr->S_MPG_TABLE.S_MPEGNR_H.S_MPEGNR_SW_ctrl));
		drvif_color_set_DRV_MPG_V_SW_Ctrl(&(ptr->S_MPG_TABLE.S_MPEGNR_V.S_MPEGNR_SW_ctrl));
	} else {
		DRV_NR_Item *ptr = NULL;
		/*Auto Mode*/
		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_MPEGNR] = 0;
		/*WaitFor_DEN_STOP();*/
		ptr = &(gVip_Table->Manual_NR_Table[Scaler_GetDNR_table()][DRV_NR_AUTO]);
		/*drvif_color_MPEGNR_flow(&(gVip_Table.Manual_NR_Table[Scaler_GetDNR_table()][DRV_NR_AUTO]));*/
		// duplicate drvif_color_DRV_MPG_General_ctrl(&(ptr->S_MPG_TABLE.S_MPEGNR_General_ctrl));
		drvif_color_DRV_MPG_H(&(ptr->S_MPG_TABLE.S_MPEGNR_H));
		drvif_color_DRV_MPG_V(&(ptr->S_MPG_TABLE.S_MPEGNR_V));
		drvif_color_PQ_Adaptive_offset_temp(PQA_TABLE, Scaler_GetDNR_table(), I_MPEGNR, PQA_TABLE_OFFSET_TEMP);
		/*fwif_color_regPQATableOffsetTemp(PQA_TABLE_OFFSET_TEMP);*/
		drvif_color_DRV_SNR_Mosquito_NR(&(ptr->S_SNR_TABLE.S_SNR_Mosquito_NR));
		drvif_color_DRV_SNR_Mosquito_NR_En(1); // fixed me
		
		if (drv_memory_Get_MASNR_Mem_Ready_Flag(0) == 1)// mem s0 ready
			drvif_color_DRV_SNR_Mosquito_NR_blk(&(ptr->S_SNR_TABLE.S_SNR_Mosquito_NR_blk));//mk2 add
		else
			drvif_color_DRV_SNR_Mosquito_NR_blk(&SNR_Mosquito_NR_blk_OFF);//mk2 add
			
		drvif_color_set_DRV_MPG_H_SW_Ctrl(&(ptr->S_MPG_TABLE.S_MPEGNR_H.S_MPEGNR_SW_ctrl));
		drvif_color_set_DRV_MPG_V_SW_Ctrl(&(ptr->S_MPG_TABLE.S_MPEGNR_V.S_MPEGNR_SW_ctrl));

		VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.Run_Flag[I_MPEGNR] = 1;
	}

	VIP_system_info_structure_table->OSD_Info.OSD_MpegNR_Mode = level;
	/*====================================*/

	if (calledByOSD) {
		ret = Scaler_SendRPC(SCALERIOC_SET_MPEGNR, level, RPC_SEND_VALUE_ONLY);
		if (0 !=  ret) {
			//VIPprintf("%s:%d, ret = %d, fail \n", __FUNCTION__, __LINE__, ret);
			VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "%s:%d, ret = %d, fail \n", __FUNCTION__, __LINE__, ret);
			return;
		}
	} else {
		Scaler_set_picmode_init_value(PICMODE_INIT_MPEGNR, level);
	}
}

DRV_RTNR_General_ctrl *fwif_color_GetRTNR_General(unsigned char source, unsigned char level)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		//VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return 0;
	}

	return &(gVip_Table->Manual_NR_Table[source][level].S_RTNR_TABLE.S_RTNR_General_ctrl);
}

unsigned char fwif_color_access_DeJaggy_Level(unsigned char Level, unsigned char isSetFlag)
{
	static unsigned char De_Jaggy_Lv = De_Jaggy_LEVEL_MAX;

	if (isSetFlag == 1) {
		if (Level >= De_Jaggy_LEVEL_MAX)
			Level = De_Jaggy_LEVEL_MAX;

		De_Jaggy_Lv = Level;
	}
	return De_Jaggy_Lv;
}

void fwif_color_set_iESM(unsigned char display, unsigned char value)
{
	extern De_Jaggy_TBL De_Jaggy_TBL_byLevel[t_I_EDGE_Smooth_Coef_MAX][De_Jaggy_LEVEL_MAX];
	DRV_IEdgeSmooth_Coef *ptr = NULL;
	DRV_IEdgeSmooth_Coef I_EdgeSmooth_Coef;
	DRV_IEdgeSmooth_Coef I_EDGE_Smooth_Coef_disable = {{0}};
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();

	unsigned char De_Jaggy_Lv;

	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	ptr = &(gVip_Table->I_EDGE_Smooth_Coef[value]);
	/*drvif_color_IEDGESMOOTH_flow(&(gVip_Table.I_EDGE_Smooth_Coef[value]));*/
	if (value >= t_I_EDGE_Smooth_Coef_MAX) {
		ptr = &I_EDGE_Smooth_Coef_disable;
                value =0;
	}
	memcpy(&I_EdgeSmooth_Coef, ptr, sizeof(DRV_IEdgeSmooth_Coef));

	De_Jaggy_Lv = fwif_color_access_DeJaggy_Level(0xFF, 0);
	if (De_Jaggy_Lv < De_Jaggy_LEVEL_MAX) {
		I_EdgeSmooth_Coef.S_IESM_Basic.IESM_En = De_Jaggy_TBL_byLevel[value][De_Jaggy_Lv].IESM_En;
		I_EdgeSmooth_Coef.S_IESM_Additional_setting.IESM_3tap_gain = De_Jaggy_TBL_byLevel[value][De_Jaggy_Lv].IESM_3tap_gain;
		I_EdgeSmooth_Coef.S_IESM_Additional_setting.IESM_5tap_gain = De_Jaggy_TBL_byLevel[value][De_Jaggy_Lv].IESM_5tap_gain;
	}

	drvif_color_DRV_IESM_Basic(&(I_EdgeSmooth_Coef.S_IESM_Basic));
	// removed drvif_color_DRV_DLTI_2D(&(ptr->S_DLTI_2D));
	drvif_color_DRV_IESM_Additional_setting(&(I_EdgeSmooth_Coef.S_IESM_Additional_setting));
}

void fwif_color_set_dESM(unsigned char display, unsigned char value)
{
	DRV_DEdgeSmooth_Coef *ptr = NULL;
	DRV_DEdgeSmooth_Coef D_EDGE_Smooth_Coef_disable = {{0}};
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	ptr = &(gVip_Table->D_EDGE_Smooth_Coef[value]);

	/*drvif_color_DEDGESMOOTH_flow(&(gVip_Table.D_EDGE_Smooth_Coef[value]));*/
	if (value >= 255) {
		/*drvif_color_DEDGESMOOTH_flow(&(gVip_Table.D_EDGE_Smooth_Coef[value]));*/
		drvif_color_DRV_DESM_Basic(&(D_EDGE_Smooth_Coef_disable.S_DESM_Basic));
		drvif_color_DRV_DESM_Dirlpf(&(D_EDGE_Smooth_Coef_disable.S_DESM_Dirlpf));
		drvif_color_DRV_DESM_Postshp(&(D_EDGE_Smooth_Coef_disable.S_DESM_Postshp));
	} else{
		/*drvif_color_DEDGESMOOTH_flow(&(gVip_Table.D_EDGE_Smooth_Coef[value]));*/
		drvif_color_DRV_DESM_Basic(&(ptr->S_DESM_Basic));
		drvif_color_DRV_DESM_Dirlpf(&(ptr->S_DESM_Dirlpf));
		drvif_color_DRV_DESM_Postshp(&(ptr->S_DESM_Postshp));
	}
}

void fwif_color_set_PQA_Input_table(unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		//VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.PQA_Input_table_select = value;

}

void fwif_color_set_PQA_table(unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		//VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		VIPprintfPrivate(VIP_LOGLEVEL_ERR, VIP_LOGMODULE_VIP_PQA_interface1_DEBUG, "~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.PQA_table_select = value;

	/* MA I SNR and EGSM */
	fwif_color_set_MA_SNR_IESM_TBL(value);

}

unsigned char fwif_color_get_PQA_Input_table(void)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return 0;
	}
	return VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.PQA_Input_table_select;
}

unsigned char fwif_color_get_PQA_table(void)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return 0;
	}
	return  VIP_system_info_structure_table->PQ_Setting_Info.PQA_Setting_INFO.PQA_table_select;
}
void fwif_color_set_MA_SNR_IESM_TBL(unsigned char which_TBL)
{
	DRV_MA_SNR_IESM_Coef data;
	_system_setting_info *system_setting_info =(_system_setting_info *) Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	memcpy(&data, &(pq_misc_MA_SNR_IESM_TBL[which_TBL]), sizeof(DRV_MA_SNR_IESM_Coef));
	system_setting_info->PQ_Setting_Info.sMA_SNR_IESM_Coef_CTRL.TBL_sel = which_TBL;

	VIP_RPC_system_info_structure_table->MASNR_Ctrl.RTNR_isnr_Get_Motion_En = data.S_MA_ISNR_GetMotion.RTNR_isnr_Get_Motion_En;
	VIP_RPC_system_info_structure_table->MASNR_Ctrl.nr_motion_en = data.S_MA_SNR_Motion_Weight1.nr_motion_en;
	VIP_RPC_system_info_structure_table->MASNR_Ctrl.IESM_Motion_En = data.S_MA_IESM_Motion_Teeth.IESM_Motion_En;
	VIP_RPC_system_info_structure_table->MASNR_Ctrl.AVLPF_Motion_En = data.S_MA_IESM_Motion_Teeth.AVLPF_Motion_En;

	if (drv_memory_Get_MASNR_Mem_Ready_Flag(0) == 0) {
		data.S_MA_ISNR_GetMotion.RTNR_isnr_Get_Motion_En = 0;
		data.S_MA_SNR_Motion_Weight1.nr_motion_en = 0;
		data.S_MA_IESM_Motion_Teeth.IESM_Motion_En = 0;
		data.S_MA_IESM_Motion_Teeth.AVLPF_Motion_En = 0;
	}

	// add for Merlin2 (jyyang 20160620)
	drvif_color_MASNR_DB_Enable();
	drvif_color_DRV_MA_ISNR_GetMotion(&data.S_MA_ISNR_GetMotion);
	drvif_color_DRV_MA_SNR_Motion_Weight1(&data.S_MA_SNR_Motion_Weight1);
	drvif_color_DRV_MA_SNR_Motion_Weight2(&data.S_MA_SNR_Motion_Weight2);
	drvif_color_DRV_MA_IESM_Motion_Ctrl(&data.S_MA_IESM_Motion_Teeth);
	drvif_color_DRV_MA_IESM_Motion_Weight(&data.S_MA_IESM_Motion_Weight);
	drvif_color_DRV_MA_VLPF_Motion_Weight(&data.S_MA_VLPF_Motion_Weight);
	drvif_color_MASNR_DB_Apply();
}
/*move "DNR table select info" to system_info_struct and replace by PQA table, elieli*/
#if 0
void fwif_color_set_DNR_table(unsigned char  value, unsigned char calledByOSD)
{
	if (calledByOSD) {
		int ret;
		unsigned char *pwTemp = (unsigned char *)Scaler_GetShareMemVirAddr(SCALERIOC_SETDNRTABLE);
		if (pwTemp) {
			memcpy((unsigned char *)Scaler_GetShareMemVirAddr(SCALERIOC_SETDNRTABLE), &value, sizeof(unsigned char));
			ret = Scaler_SendRPC(SCALERIOC_SETDNRTABLE);
			if (0 !=  ret) {
				VIPprintf("ret = %d, set Enter_SetDNRTable to driver fail !!!\n", ret);
				return;
			}
		}
	} else {
		fwif_color_set_quality_init_value(QUALITY_INIT_DNRTABLE, value);
	}
}
#endif



void fwif_color_set_TNRXC_Ctrl(unsigned char src_idx, unsigned char TableIdx)
{
	DRV_di_TNR_XC_CTRL data;
	extern DRV_di_TNR_XC_table di_TNR_XC_table[di_TNR_XC_table_MAX];

	if (TableIdx >=  di_TNR_XC_table_MAX)
	TableIdx = 0;

	data.cp_temporal_xc_en = di_TNR_XC_table[TableIdx].di_TNR_XC_CTRL.cp_temporal_xc_en;
	data.cp_temporalenable = di_TNR_XC_table[TableIdx].di_TNR_XC_CTRL.cp_temporalenable;
	data.cp_temporalthly = di_TNR_XC_table[TableIdx].di_TNR_XC_CTRL.cp_temporalthly;

	drvif_color_di_set_TNRXC_Ctrl((DRV_di_TNR_XC_CTRL *) (&data));
}
void fwif_color_set_TNRXC_MK2(unsigned char src_idx, unsigned char TableIdx)
{
	DRV_di_TNR_XC_MKII data;
	extern DRV_di_TNR_XC_table di_TNR_XC_table[di_TNR_XC_table_MAX];

	if (TableIdx >=  di_TNR_XC_table_MAX)
		TableIdx = 0;

	data.tnrxc_mkii_en = di_TNR_XC_table[TableIdx].di_TNR_XC_MKII.tnrxc_mkii_en;
	data.tnrxc_mkii_thc1 = di_TNR_XC_table[TableIdx].di_TNR_XC_MKII.tnrxc_mkii_thc1;
	data.tnrxc_mkii_thc2 = di_TNR_XC_table[TableIdx].di_TNR_XC_MKII.tnrxc_mkii_thc2;
	data.tnrxc_mkii_thy = di_TNR_XC_table[TableIdx].di_TNR_XC_MKII.tnrxc_mkii_thy;

	drvif_color_di_set_TNRXC_Mk2((DRV_di_TNR_XC_MKII *)(&data));
}



void fwif_color_Set_NRtemporal(unsigned char display, unsigned char value)
{
	drvif_color_noisereduction_temporal(display, value);
}

/*===============================================================================================	//NR rock 20140127*/


/*==============================rord.tsao start===================================================*/

void fwif_color_set_shp_driver(unsigned char src_idx, unsigned char value)
{
	drvif_color_TwoD_peaking_AdaptiveCtrl(_MAIN_DISPLAY, value);
	drvif_color_sharpness_adjust(_MAIN_DISPLAY, value);		/*Texture*/
	drvif_color_2dpk_edge_Coef_apply(_MAIN_DISPLAY, value);	/*Edge*/
	drvif_color_2dpk_Vertical_Coef_apply(_MAIN_DISPLAY, value);	/*Vertical*/
	drvif_color_2dpk_MKIII_init(_MAIN_DISPLAY, value);

}
void fwif_color_sharpness_osd_adjust(unsigned char src_idx, unsigned char value)
{
	/*VIPprintf("[Scalercolor]fwif_color_sharpness_osd_adjust = %d\n", value);*/
	drvif_color_TwoD_peaking_AdaptiveCtrl(_MAIN_DISPLAY, value);/*sharpness MKII from Magellan, 20130515*/
	drvif_color_sharpness_adjust(_MAIN_DISPLAY, value);		/*Texture*/
	drvif_color_2dpk_edge_Coef_apply(_MAIN_DISPLAY,  Scaler_GetSharpness());	/*Edge*/
	drvif_color_2dpk_Vertical_Coef_apply(_MAIN_DISPLAY, value);	/*Vertical*/

}

short fwif_color_set_sharpness_level_calc(short max_value, short mid_value, short min_value, unsigned char sharp_max, unsigned char sharp_mid, unsigned char sharp, unsigned char level, short limit)
{
	short data;

	if (mid_value == 0 || sharp_mid == 0) { //old method
		data = min_value+(max_value - min_value)*level/100;
	} else { //new method
		if (sharp <= sharp_mid)
			data = min_value+(mid_value - min_value)*sharp/sharp_mid;
		else if (sharp_max > sharp_mid)
			data = mid_value+(max_value - mid_value)*(sharp-sharp_mid)/(sharp_max-sharp_mid);
		else
			data = mid_value;
	}
	if (data > limit)
		data = limit;

	return data;
}

short fwif_color_set_CDS_level_calc(short cur_value, unsigned char sharp_mid, unsigned char sharp, short limit)
{
	short data;

	data = cur_value*sharp/sharp_mid;

	if (data > limit)
		data = limit;

	return data;
}

void fwif_color_set_sharpness_level(unsigned char table, unsigned char value)
{
	unsigned char sharp = 0, level = 0, sharp_max = 255, sharp_mid = 0;
	//signed short data = 0;
	signed short max_value = 0, min_value = 0, mid_value = 0;
	DRV_Sharpness_Level sharp_gain;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_Sharpness_Table *pSharpTbl;

	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	pSharpTbl = &gVip_Table->Ddomain_SHPTable[table];

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	VIP_system_info_structure_table->OSD_Info.OSD_Sharpness = value;

	if (table >= Sharp_table_num)
		table = 0;

	sharp = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_SHARPNESS, value);
	level = (sharp*100) >> 8;

	sharp_mid = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_SHARPNESS, pSharpTbl->TwoD_Peak_AdaptCtrl.OSD_Sharpness);
	if (pSharpTbl->TwoD_Peak_AdaptCtrl.OSD_Sharpness == 0 || sharp_mid == 255)
		sharp_mid = 0; // sharp_mid = 0 will skip mid value calc ,prevent error

/*cal edge_shp*/
	max_value = pSharpTbl->Edge_Shp_set.G_Pos_Max;
	min_value = 0; //pSharpTbl->Edge_Shp_set.G_Pos_Min;
	mid_value = pSharpTbl->Edge_Shp_set.G_Pos_Mid;
	sharp_gain.Edge_Level.G_Pos_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 255);

	max_value = pSharpTbl->Edge_Shp_set.G_Neg_Max;
	min_value = 0; //pSharpTbl->Edge_Shp_set.G_Neg_Min;
	mid_value = pSharpTbl->Edge_Shp_set.G_Neg_Mid;
	sharp_gain.Edge_Level.G_Neg_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 255);

	max_value = pSharpTbl->Edge_Shp_set.HV_POS_Max;
	min_value = 0; //pSharpTbl->Edge_Shp_set.HV_POS_Min;
	mid_value = pSharpTbl->Edge_Shp_set.HV_POS_Mid;
	sharp_gain.Edge_Level.HV_POS_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 1023);

	max_value = pSharpTbl->Edge_Shp_set.HV_NEG_Max;
	min_value = 0; //pSharpTbl->Edge_Shp_set.HV_NEG_Min;
	mid_value = pSharpTbl->Edge_Shp_set.HV_NEG_Mid;
	sharp_gain.Edge_Level.HV_NEG_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 1023);

	/*LV gain fixed value*/
	sharp_gain.Edge_Level.LV_Gain = pSharpTbl->Edge_Shp_set.LV_Max;

/*cal Texture_shp*/
	max_value = pSharpTbl->Texture_Shp_set.G_Pos_Max;
	min_value = 0; //pSharpTbl->Texture_Shp_set.G_Pos_Min;
	mid_value = pSharpTbl->Texture_Shp_set.G_Pos_Mid;
	sharp_gain.Texture_Level.G_Pos_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 255);

	max_value = pSharpTbl->Texture_Shp_set.G_Neg_Max;
	min_value = 0; //pSharpTbl->Texture_Shp_set.G_Neg_Min;
	mid_value = pSharpTbl->Texture_Shp_set.G_Neg_Mid;
	sharp_gain.Texture_Level.G_Neg_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 255);

	max_value = pSharpTbl->Texture_Shp_set.HV_POS_Max;
	min_value = 0; //pSharpTbl->Texture_Shp_set.HV_POS_Min;
	mid_value = pSharpTbl->Texture_Shp_set.HV_POS_Mid;
	sharp_gain.Texture_Level.HV_POS_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 1023);

	max_value = pSharpTbl->Texture_Shp_set.HV_NEG_Max;
	min_value = 0; //pSharpTbl->Texture_Shp_set.HV_NEG_Min;
	mid_value = pSharpTbl->Texture_Shp_set.HV_NEG_Mid;
	sharp_gain.Texture_Level.HV_NEG_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 1023);

	/*LV gain fixed value*/
	sharp_gain.Texture_Level.LV_Gain = pSharpTbl->Texture_Shp_set.LV_Max;

/*cal vertical*/
	max_value = pSharpTbl->Vertical.G_Pos_Max;
	min_value = 0; //pSharpTbl->Vertical.G_Pos_Min;
	mid_value = pSharpTbl->Vertical.G_Pos_Mid;
	sharp_gain.Vertical_Level.G_Pos_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 255);

	max_value = pSharpTbl->Vertical.G_Neg_Max;
	min_value = 0; //pSharpTbl->Vertical.G_Neg_Min;
	mid_value = pSharpTbl->Vertical.G_Neg_Mid;
	sharp_gain.Vertical_Level.G_Neg_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 255);

	max_value = pSharpTbl->Vertical.HV_POS_Max;
	min_value = 0; //pSharpTbl->Vertical.HV_POS_Min;
	mid_value = pSharpTbl->Vertical.HV_POS_Mid;
	sharp_gain.Vertical_Level.HV_POS_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 255);

	max_value = pSharpTbl->Vertical.HV_NEG_Max;
	min_value = 0; //pSharpTbl->Vertical.HV_NEG_Min;
	mid_value = pSharpTbl->Vertical.HV_NEG_Mid;
	sharp_gain.Vertical_Level.HV_NEG_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 255);


	/*LV gain fixed value*/
	sharp_gain.Vertical_Level.LV_Gain = pSharpTbl->Vertical.LV_Max;

	/*cal vertical Edge  */
	max_value = pSharpTbl->Vertical_edg.G_Pos_Max;
	min_value = 0; //pSharpTbl->Vertical_edg.G_Pos_Min;
	mid_value = pSharpTbl->Vertical_edg.G_Pos_Mid;
	sharp_gain.Vertical_Edge_Level.G_Pos_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 255);

	max_value = pSharpTbl->Vertical_edg.G_Neg_Max;
	min_value = 0; //pSharpTbl->Vertical_edg.G_Neg_Min;
	mid_value = pSharpTbl->Vertical_edg.G_Neg_Mid;
	sharp_gain.Vertical_Edge_Level.G_Neg_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 255);

	max_value = pSharpTbl->Vertical_edg.HV_POS_Max;
	min_value = 0; //pSharpTbl->Vertical_edg.HV_POS_Min;
	mid_value = pSharpTbl->Vertical_edg.HV_POS_Mid;
	sharp_gain.Vertical_Edge_Level.HV_POS_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 1023);

	max_value = pSharpTbl->Vertical_edg.HV_NEG_Max;
	min_value = 0; //pSharpTbl->Vertical_edg.HV_NEG_Min;
	mid_value = pSharpTbl->Vertical_edg.HV_NEG_Mid;
	sharp_gain.Vertical_Edge_Level.HV_NEG_Gain = fwif_color_set_sharpness_level_calc(max_value, mid_value, min_value, sharp_max, sharp_mid, sharp, level, 1023);

	/*LV gain fixed value*/
	sharp_gain.Vertical_Edge_Level.LV_Gain = pSharpTbl->Vertical_edg.LV_Max;

	/* for TV002*/
	if (Scaler_access_Project_TV002_Style(0, 0) == Project_TV002_Style_1)
		Scaler_scalerVIP_Access_sharpness_level_TBL_TV002(&sharp_gain, 1);

	drvif_color_set_Sharpness_level((DRV_Sharpness_Level *)&sharp_gain);

	#ifdef CONFIG_CUSTOMER_TV002
	fwif_color_set_cds_level(table, sharp, sharp_mid);
	#ifdef CONFIG_TV002_DE_SHARPNESS
	fwif_color_set_DeSharpness(table, value, sharp);
	#endif
	#endif

}

void fwif_color_set_cds_level(unsigned char table, unsigned char sharp, unsigned char sharp_mid)
{
	DRV_Sharpness_Level sharp_gain;
	VIP_CDS_CM_Ctrl *pCDSTbl;

	if (sharp_mid == 0)
		return;

	if (sharp > sharp_mid)
		sharp = sharp_mid;

	pCDSTbl = &gVip_Table->CDS_ini[table].CDS_CM0_Ctrl;
	sharp_gain.Edge_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Edge_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Edge_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_hv_pos, sharp_mid, sharp, 1023);
	sharp_gain.Edge_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_hv_neg, sharp_mid, sharp, 1023);
	sharp_gain.Texture_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Texture_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Texture_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_hv_pos, sharp_mid, sharp, 1023);
	sharp_gain.Texture_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_hv_neg, sharp_mid, sharp, 1023);
	sharp_gain.Vertical_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_hv_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_hv_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_hv_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_hv_neg, sharp_mid, sharp, 255);
	drvif_color_set_CDS_CM0_level(&sharp_gain);

	pCDSTbl = &gVip_Table->CDS_ini[table].CDS_CM1_Ctrl;
	sharp_gain.Edge_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Edge_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Edge_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_hv_pos, sharp_mid, sharp, 1023);
	sharp_gain.Edge_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_hv_neg, sharp_mid, sharp, 1023);
	sharp_gain.Texture_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Texture_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Texture_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_hv_pos, sharp_mid, sharp, 1023);
	sharp_gain.Texture_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_hv_neg, sharp_mid, sharp, 1023);
	sharp_gain.Vertical_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_hv_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_hv_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_hv_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_hv_neg, sharp_mid, sharp, 255);
	drvif_color_set_CDS_CM1_level(&sharp_gain);

	pCDSTbl = &gVip_Table->CDS_ini[table].CDS_CM2_Ctrl;
	sharp_gain.Edge_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Edge_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Edge_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_hv_pos, sharp_mid, sharp, 1023);
	sharp_gain.Edge_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_hv_neg, sharp_mid, sharp, 1023);
	sharp_gain.Texture_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Texture_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Texture_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_hv_pos, sharp_mid, sharp, 1023);
	sharp_gain.Texture_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_hv_neg, sharp_mid, sharp, 1023);
	sharp_gain.Vertical_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_hv_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_hv_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_hv_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_hv_neg, sharp_mid, sharp, 255);
	drvif_color_set_CDS_CM2_level(&sharp_gain);

	pCDSTbl = &gVip_Table->CDS_ini[table].CDS_CM3_Ctrl;
	sharp_gain.Edge_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Edge_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Edge_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_hv_pos, sharp_mid, sharp, 1023);
	sharp_gain.Edge_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->edge_hv_neg, sharp_mid, sharp, 1023);
	sharp_gain.Texture_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Texture_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Texture_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_hv_pos, sharp_mid, sharp, 1023);
	sharp_gain.Texture_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->tex_hv_neg, sharp_mid, sharp, 1023);
	sharp_gain.Vertical_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_hv_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_tex_hv_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.G_Pos_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_gain_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.G_Neg_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_gain_neg, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.HV_POS_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_hv_pos, sharp_mid, sharp, 255);
	sharp_gain.Vertical_Edge_Level.HV_NEG_Gain = fwif_color_set_CDS_level_calc(pCDSTbl->v_edge_hv_neg, sharp_mid, sharp, 255);
	drvif_color_set_CDS_CM3_level(&sharp_gain);
}

void fwif_color_set_DeSharpness(unsigned char table, unsigned char osd_value, unsigned char sharp)
{
	unsigned char tnoff = 0;
	unsigned short weight[7];
	VIP_Sharpness_Table *pSharpTbl;
	unsigned char dlti_idx = Scaler_GetDLti();

	SLR_VIP_TABLE *gVIP_Table = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (gVIP_Table == NULL)
		return;

	pSharpTbl = &gVIP_Table->Ddomain_SHPTable[table];

	if (osd_value < 50 && sharp == 0) {
		weight[0] = weight[1] = weight[2] = weight[3] = weight[4] = weight[5] = weight[6] = 1024*osd_value/50;

		drvif_color_Set_Sharpness_source_blending_only_weight(weight);
		drvif_color_Set_Sharpness_source_blending_en(1, 1, 1);
		drvif_color_Set_Sharpness_tex_range(0, 0);

		if (osd_value > 42) {
			unsigned int tmp = osd_value - 42;

			tnoff = (tmp*gVIP_Table->vip_D_DLTI_Table[dlti_idx].DLTI_H_Tnoff.Tnoff0)>>3;
			drvif_color_Set_D_DLTI_H_Tnoff_gain(tnoff);

			tnoff = (tmp*gVIP_Table->vip_D_DLTI_Table[dlti_idx].DLTI_V_Tnoff.Tnoff0)>>3;
			drvif_color_Set_D_DLTI_V_Tnoff_gain(tnoff);
		} else {
			drvif_color_Set_D_DLTI_H_Tnoff_gain(tnoff);
			drvif_color_Set_D_DLTI_V_Tnoff_gain(tnoff);
		}
	} else {
		weight[0] = pSharpTbl->Max_Min_Lpf.Weit_0;
		weight[1] = pSharpTbl->Max_Min_Lpf.Weit_1;
		weight[2] = pSharpTbl->Max_Min_Lpf.Weit_2;
		weight[3] = pSharpTbl->Max_Min_Lpf.Weit_3;
		weight[4] = pSharpTbl->Max_Min_Lpf.Weit_4;
		weight[5] = pSharpTbl->Max_Min_Lpf.Weit_5;
		weight[6] = pSharpTbl->Max_Min_Lpf.Weit_6;

		drvif_color_Set_Sharpness_source_blending_en(pSharpTbl->Max_Min_Lpf.Weigh_En, pSharpTbl->Max_Min_Lpf.lpf_weigh_edg_en, pSharpTbl->Max_Min_Lpf.lpf_weigh_tex_en);
		drvif_color_Set_Sharpness_source_blending_only_weight(weight);
		drvif_color_Set_Sharpness_tex_range(pSharpTbl->TwoD_Peak_AdaptCtrl._5x5_h, pSharpTbl->TwoD_Peak_AdaptCtrl._5x5_v);

		tnoff = gVIP_Table->vip_D_DLTI_Table[dlti_idx].DLTI_H_Tnoff.Tnoff0;
		drvif_color_Set_D_DLTI_H_Tnoff_gain(tnoff);

		tnoff = gVIP_Table->vip_D_DLTI_Table[dlti_idx].DLTI_V_Tnoff.Tnoff0;
		drvif_color_Set_D_DLTI_V_Tnoff_gain(tnoff);
	}
}

void fwif_color_set_DLTI_level(unsigned char value)
{
        static VIP_D_DLTI_Table drv_shp_Dlti;


        drvif_color_Get_D_DLTI_Table(&drv_shp_Dlti);

       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff0 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff0 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff0 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff1 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff1 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff1 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff2 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff2 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff2 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff3 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff3 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff3 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff4 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff4 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff4 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff5 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff5 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff5 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff6 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff6 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff6 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff7 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff7 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff7 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff8 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff8 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff8 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff9 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff9 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff9 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff10 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff10 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff10 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff11 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff11 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff11 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff12 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff12 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff12 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff13 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff13 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff13 *value/30);
       drv_shp_Dlti.DLTI_H_Tnoff.Tnoff14 = (drv_shp_Dlti.DLTI_H_Tnoff.Tnoff14 *value/30>15)?15:(drv_shp_Dlti.DLTI_H_Tnoff.Tnoff14 *value/30);

       drv_shp_Dlti.DLTI_V_Tnoff.Tnoff0 = (drv_shp_Dlti.DLTI_V_Tnoff.Tnoff0 *value/30>15)?15:(drv_shp_Dlti.DLTI_V_Tnoff.Tnoff0 *value/30);
       drv_shp_Dlti.DLTI_V_Tnoff.Tnoff1 = (drv_shp_Dlti.DLTI_V_Tnoff.Tnoff1 *value/30>15)?15:(drv_shp_Dlti.DLTI_V_Tnoff.Tnoff1 *value/30);
       drv_shp_Dlti.DLTI_V_Tnoff.Tnoff2 = (drv_shp_Dlti.DLTI_V_Tnoff.Tnoff2 *value/30>15)?15:(drv_shp_Dlti.DLTI_V_Tnoff.Tnoff2 *value/30);
       drv_shp_Dlti.DLTI_V_Tnoff.Tnoff3 = (drv_shp_Dlti.DLTI_V_Tnoff.Tnoff3 *value/30>15)?15:(drv_shp_Dlti.DLTI_V_Tnoff.Tnoff3 *value/30);
       drv_shp_Dlti.DLTI_V_Tnoff.Tnoff4 = (drv_shp_Dlti.DLTI_V_Tnoff.Tnoff4 *value/30>15)?15:(drv_shp_Dlti.DLTI_V_Tnoff.Tnoff4 *value/30);
       drv_shp_Dlti.DLTI_V_Tnoff.Tnoff5 = (drv_shp_Dlti.DLTI_V_Tnoff.Tnoff5 *value/30>15)?15:(drv_shp_Dlti.DLTI_V_Tnoff.Tnoff5 *value/30);
       drv_shp_Dlti.DLTI_V_Tnoff.Tnoff6 = (drv_shp_Dlti.DLTI_V_Tnoff.Tnoff6 *value/30>15)?15:(drv_shp_Dlti.DLTI_V_Tnoff.Tnoff6 *value/30);

       drvif_color_Set_D_DLTI_Table(&drv_shp_Dlti);


}

void fwif_color_set_sharpness_table(unsigned char src_idx, unsigned char value)
{
	static DRV_Sharpness_Table sharp;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	if (value >= Sharp_table_num)
		value = 0;
	//if((Scaler_DispGetStatus(SLR_MAIN_DISPLAY, SLR_DISP_422CAP) == FALSE) && (get_scaler_connect_source(SLR_MAIN_DISPLAY) == _SRC_HDMI))//fixed me	RGB444
	//	sharp.TwoD_Peak_AdaptCtrl.Peaking_Enable = 0;	// fixed me
	//else
	sharp.TwoD_Peak_AdaptCtrl.Peaking_Enable = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Peaking_Enable;

        sharp.TwoD_Peak_AdaptCtrl.Edge_Mode = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Edge_Mode;
	sharp.TwoD_Peak_AdaptCtrl.Sobel_Mode = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Sobel_Mode;
	sharp.TwoD_Peak_AdaptCtrl.Edgextrange = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Edgextrange;
	sharp.TwoD_Peak_AdaptCtrl.Sobel_Upbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Sobel_Upbnd;
	sharp.TwoD_Peak_AdaptCtrl.Sobel_Stepbit = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Sobel_Stepbit;
	sharp.TwoD_Peak_AdaptCtrl.Zdiff_Upbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Zdiff_Upbnd;
	sharp.TwoD_Peak_AdaptCtrl.Zdiff_Stepbit = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Zdiff_Stepbit;
	sharp.TwoD_Peak_AdaptCtrl.Zigsftbit_Reg = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Zigsftbit_Reg;
	sharp.TwoD_Peak_AdaptCtrl.Tex_En = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Tex_En;
	sharp.TwoD_Peak_AdaptCtrl.Tex_Upbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Tex_Upbnd;
	sharp.TwoD_Peak_AdaptCtrl.Tex_Stepbit = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Tex_Stepbit;
	sharp.TwoD_Peak_AdaptCtrl.Actsftbit_Reg = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Actsftbit_Reg;

	sharp.TwoD_Peak_AdaptCtrl.Hpf_Vpf_Maxmin_En = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Hpf_Vpf_Maxmin_En;/*magellan2*/
	sharp.TwoD_Peak_AdaptCtrl.Src_Sel = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Src_Sel;/*magellan2*/

	sharp.TwoD_Peak_AdaptCtrl.Sobel_h= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.sobelrange_h;//merlin
	sharp.TwoD_Peak_AdaptCtrl.Sobel_v= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.sobelrange_v;//merlin
	sharp.TwoD_Peak_AdaptCtrl.Acts_offset= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.acts_offset;//merlin
	sharp.TwoD_Peak_AdaptCtrl.Small_thl= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.small_th1;//merlin
	sharp.TwoD_Peak_AdaptCtrl.Edgextrange_v= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.edgextrange_v;//merlin

	sharp.TwoD_Peak_AdaptCtrl._5x5_h= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl._5x5_h;//merlin3
	sharp.TwoD_Peak_AdaptCtrl._5x5_v= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl._5x5_v;//merlin3
	sharp.TwoD_Peak_AdaptCtrl.Tex_Exclude_Smooth= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Tex_Exclude_Smooth;//merlin3
	sharp.TwoD_Peak_AdaptCtrl.Sobel_hspace= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Sobel_hspace;//merlin3
	sharp.TwoD_Peak_AdaptCtrl.Sobel_vspace= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Sobel_vspace;//merlin3

    #ifdef SQM_OFFSET_TBL
        TWODPK_TBL_forSQM[0]= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Edgextrange;
        TWODPK_TBL_forSQM[1]= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.small_th1;
    #endif

	sharp.Edge_Shp.Edg_D2_Shift_Bit = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_set.Edg_D2_Shift_Bit;
	sharp.Edge_Shp.G_Neg2 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_set.G_Neg2;
	sharp.Edge_Shp.G_Pos2 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_set.G_Pos2;
	sharp.Edge_Shp.LV2 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_set.LV2;
	sharp.Texture_Shp.Edg_D2_Shift_Bit = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_set.Edg_D2_Shift_Bit;
	sharp.Texture_Shp.G_Neg2 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_set.G_Neg2;
	sharp.Texture_Shp.G_Pos2 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_set.G_Pos2;
	sharp.Texture_Shp.LV2 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_set.LV2;
	sharp.Vertical.C0 = gVip_Table->Ddomain_SHPTable[value].Vertical.C0;
	sharp.Vertical.C1 = gVip_Table->Ddomain_SHPTable[value].Vertical.C1;
	sharp.Vertical.C2 = gVip_Table->Ddomain_SHPTable[value].Vertical.C2;
	sharp.Vertical.C3 = gVip_Table->Ddomain_SHPTable[value].Vertical.C3;
	sharp.Vertical.C4 = gVip_Table->Ddomain_SHPTable[value].Vertical.C4;
	sharp.Vertical.Vext_Reg = gVip_Table->Ddomain_SHPTable[value].Vertical.Vext_Reg;
	sharp.Vertical.Vemf_En = gVip_Table->Ddomain_SHPTable[value].Vertical.Vemf_En;
	sharp.Vertical.en_tex = gVip_Table->Ddomain_SHPTable[value].Vertical.en_tex;
	sharp.Vertical.en_edg = gVip_Table->Ddomain_SHPTable[value].Vertical.en_edg;
	sharp.Vertical.V_Tex_en = gVip_Table->Ddomain_SHPTable[value].Vertical.V_Tex_en;
	sharp.Vertical.V_Dering_En = gVip_Table->Ddomain_SHPTable[value].Vertical.V_Dering_En;
	sharp.Vertical.G_Neg2 = gVip_Table->Ddomain_SHPTable[value].Vertical.G_Neg2;
	sharp.Vertical.G_Pos2 = gVip_Table->Ddomain_SHPTable[value].Vertical.G_Pos2;
	sharp.Vertical.LV2 = gVip_Table->Ddomain_SHPTable[value].Vertical.LV2;

	sharp.Vertical.enable_edge= gVip_Table->Ddomain_SHPTable[value].Vertical_edg.enable;//merlin
	sharp.Vertical.LV2_edge= gVip_Table->Ddomain_SHPTable[value].Vertical_edg.LV2;//merlin
	sharp.Vertical.G_Pos2_edge= gVip_Table->Ddomain_SHPTable[value].Vertical_edg.G_Pos2;//merlin
	sharp.Vertical.G_Neg2_edge= gVip_Table->Ddomain_SHPTable[value].Vertical_edg.G_Neg2;//merlin
	sharp.Edge_EMF_Table.EMF_En = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.EMF_En;
	sharp.Edge_EMF_Table.EMF_Shift = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.EMF_Shift;
	// sharp.Edge_EMF_Table.EMF_Range = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.EMF_Range;
	sharp.Edge_EMF_Table.Seg_0_Gain = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_0_Gain;
	sharp.Edge_EMF_Table.Seg_1_Gain = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_1_Gain;
	sharp.Edge_EMF_Table.Seg_2_Gain = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_2_Gain;
	sharp.Edge_EMF_Table.Seg_0_Offset = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_0_Offset;
	sharp.Edge_EMF_Table.Seg_1_Offset = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_1_Offset;
	sharp.Edge_EMF_Table.Seg_2_Offset = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_2_Offset;
	sharp.Edge_EMF_Table.emf_fixextent_neg = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.emf_fixextent_neg;
	sharp.Edge_EMF_Table.emf_fixextent_pos = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.emf_fixextent_pos;
	sharp.Edge_EMF_Table.Seg_0_x = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_0_x;
	sharp.Edge_EMF_Table.Seg_1_x = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_1_x;
	sharp.Edge_EMF_Table.Blend_wt = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Blend_wt;
	sharp.Edge_EMF_Table.v5= gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.v5;
	sharp.Edge_EMF_Table.h11= gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.h11;
	sharp.Text_EMF_Table.EMF_En = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.EMF_En;
	sharp.Text_EMF_Table.EMF_Shift = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.EMF_Shift;
	// sharp.Text_EMF_Table.EMF_Range = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.EMF_Range;
	sharp.Text_EMF_Table.Seg_0_Gain = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_0_Gain;
	sharp.Text_EMF_Table.Seg_1_Gain = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_1_Gain;
	sharp.Text_EMF_Table.Seg_2_Gain = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_2_Gain;
	sharp.Text_EMF_Table.Seg_0_Offset = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_0_Offset;
	sharp.Text_EMF_Table.Seg_1_Offset = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_1_Offset;
	sharp.Text_EMF_Table.Seg_2_Offset = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_2_Offset;
	sharp.Text_EMF_Table.emf_fixextent_neg = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.emf_fixextent_neg;
	sharp.Text_EMF_Table.emf_fixextent_pos = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.emf_fixextent_pos;
	sharp.Text_EMF_Table.tex_share_v_enable = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.tex_share_v_enable;
	sharp.Text_EMF_Table.tex_share_v_blend_wt = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.tex_share_v_blend_wt;
	sharp.Text_EMF_Table.Seg_0_x = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_0_x;
	sharp.Text_EMF_Table.Seg_1_x = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_1_x;
	sharp.Text_EMF_Table.Blend_wt = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Blend_wt;
	sharp.Text_EMF_Table.v5 = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.v5;
	sharp.Text_EMF_Table.h11 = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.h11;
	sharp.Text_EMF_Table.EMF_texgain = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.EMF_texgain;
	/*sharp.MK3_Table.Mkiii_En = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Mkiii_En; magellan2 removed*/
	sharp.MK3_Table.Tex_Filter_Sel = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Tex_Filter_Sel;
	sharp.MK3_Table.Edge_Filter_Sel = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.Edge_Filter_Sel;
	sharp.TwoD_Peak_AdaptCtrl.PkDlti_comsign = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.PkDlti_comsign;
	sharp.TwoD_Peak_AdaptCtrl.edg_dlti = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edg_dlti;
	sharp.TwoD_Peak_AdaptCtrl.edg_dlti_tex = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edg_dlti_tex;
	sharp.TwoD_Peak_AdaptCtrl.zdiffl_en = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.zdiffl_en;
	sharp.TwoD_Peak_AdaptCtrl.zdiffl_lowbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.zdiffl_lowbnd;
	sharp.TwoD_Peak_AdaptCtrl.zdiffl_stepbit = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.zdiffl_stepbit;
	sharp.TwoD_Peak_AdaptCtrl.edge_mono_en = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edge_mono_en;
	sharp.TwoD_Peak_AdaptCtrl.edge_mono_stepbit = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edge_mono_stepbit;
	sharp.TwoD_Peak_AdaptCtrl.edge_mono_stepbiu = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edge_mono_stepbiu;
	sharp.TwoD_Peak_AdaptCtrl.edge_mono_upbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edge_mono_upbnd;
	sharp.TwoD_Peak_AdaptCtrl.edge_mono_lowbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edge_mono_lowbnd;
    #ifdef SQM_OFFSET_TBL
        TWODPK_TBL_forSQM[2]= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edg_dlti;
        TWODPK_TBL_forSQM[3]= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edg_dlti_tex;
    #endif

	sharp.MK3_Table.Lpf2d_C0 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C0;
	sharp.MK3_Table.Lpf2d_C1 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C1;
	sharp.MK3_Table.Lpf2d_C2 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C2;
	sharp.MK3_Table.Lpf2d_C3 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C3;
	sharp.MK3_Table.Lpf2d_C4 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C4;
	sharp.MK3_Table.Lpf2d_C5 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C5;
	sharp.MK3_Table.MaxMin_Gain_0 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_0;
	sharp.MK3_Table.MaxMin_Gain_1 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_1;
	sharp.MK3_Table.MaxMin_Gain_2 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_2;
	sharp.MK3_Table.MaxMin_Gain_3 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_3;
	sharp.MK3_Table.MaxMin_Gain_4 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_4;
	sharp.MK3_Table.MaxMin_Gain_5 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_5;
	sharp.MK3_Table.MaxMin_Gain_6 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_6;
	sharp.MK3_Table.MaxMin_Step_1 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_1;
	sharp.MK3_Table.MaxMin_Step_2 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_2;
	sharp.MK3_Table.MaxMin_Step_3 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_3;
	sharp.MK3_Table.MaxMin_Step_4 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_4;
	sharp.MK3_Table.MaxMin_Step_5 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_5;
	sharp.MK3_Table.MaxMin_Step_6 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_6;
	sharp.MK3_Table.MaxMin_Gain_En =        gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Max_Min_Gain_En;
	sharp.MK3_Table.max_min_gain_tex_en =   gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.max_min_gain_tex_en;
	sharp.MK3_Table.max_min_gain_edg_en =   gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.max_min_gain_edg_en;
	sharp.MK3_Table.max_min_gain_v_en =     gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.max_min_gain_v_en;

    #ifdef SQM_OFFSET_TBL
        TWODPK_TBL_forSQM[4]    = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_0;
        TWODPK_TBL_forSQM[5]    = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_1;
        TWODPK_TBL_forSQM[6]    = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_2;
        TWODPK_TBL_forSQM[7]    = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_3;
        TWODPK_TBL_forSQM[8]    = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_4;
        TWODPK_TBL_forSQM[9]    = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_5;
        TWODPK_TBL_forSQM[10]   = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Gain_6;
        TWODPK_TBL_forSQM[11]   = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_1;
        TWODPK_TBL_forSQM[12]   = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_2;
        TWODPK_TBL_forSQM[13]   = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_3;
        TWODPK_TBL_forSQM[14]   = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_4;
        TWODPK_TBL_forSQM[15]   = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_5;
        TWODPK_TBL_forSQM[16]   = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Step_6;

        TWODPK_TBL_forSQM[17]   = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.Max_Min_Gain_En;
        TWODPK_TBL_forSQM[18]   = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.max_min_gain_tex_en;
        TWODPK_TBL_forSQM[19]   = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.max_min_gain_edg_en;
        TWODPK_TBL_forSQM[20]   = gVip_Table->Ddomain_SHPTable[value].Max_Min_Gain.max_min_gain_v_en;
    #endif

	sharp.MK3_Table.Lpf_Weit_0 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_0;
	sharp.MK3_Table.Lpf_Weit_1 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_1;
	sharp.MK3_Table.Lpf_Weit_2 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_2;
	sharp.MK3_Table.Lpf_Weit_3 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_3;
	sharp.MK3_Table.Lpf_Weit_4 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_4;
	sharp.MK3_Table.Lpf_Weit_5 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_5;
	sharp.MK3_Table.Lpf_Weit_6 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_6;
	sharp.MK3_Table.Lpf_Step_1 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_1;
	sharp.MK3_Table.Lpf_Step_2 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_2;
	sharp.MK3_Table.Lpf_Step_3 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_3;
	sharp.MK3_Table.Lpf_Step_4 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_4;
	sharp.MK3_Table.Lpf_Step_5 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_5;
	sharp.MK3_Table.Lpf_Step_6 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_6;
	sharp.MK3_Table.Lpf_Weigh_En = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weigh_En;
	sharp.MK3_Table.lpf_weigh_tex_en = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.lpf_weigh_tex_en;
	sharp.MK3_Table.lpf_weigh_edg_en = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.lpf_weigh_edg_en;
	sharp.MK3_Table.Gain_By_Y_Gain_0 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_0;
	sharp.MK3_Table.Gain_By_Y_Gain_1 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_1;
	sharp.MK3_Table.Gain_By_Y_Gain_2 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_2;
	sharp.MK3_Table.Gain_By_Y_Gain_3 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_3;
	sharp.MK3_Table.Gain_By_Y_Gain_4 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_4;
	sharp.MK3_Table.Gain_By_Y_Gain_5 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_5;
	sharp.MK3_Table.Gain_By_Y_Gain_6 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_6;
	sharp.MK3_Table.Gain_By_Y_Step_1 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_1;
	sharp.MK3_Table.Gain_By_Y_Step_2 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_2;
	sharp.MK3_Table.Gain_By_Y_Step_3 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_3;
	sharp.MK3_Table.Gain_By_Y_Step_4 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_4;
	sharp.MK3_Table.Gain_By_Y_Step_5 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_5;
	sharp.MK3_Table.Gain_By_Y_Step_6 = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_6;
	sharp.MK3_Table.Gain_By_Y_En        = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_By_Y_En;
	sharp.MK3_Table.gain_by_y_tex_en    = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.gain_by_y_tex_en;
	sharp.MK3_Table.gain_by_y_edg_en    = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.gain_by_y_edg_en;
	sharp.MK3_Table.gain_by_y_v_en      = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.gain_by_y_v_en;
	sharp.MK3_Table.lv_by_y_enable      = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.lv_by_y_enable;
	sharp.MK3_Table.lv_by_y_tex_enable  = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.lv_by_y_tex_enable;
	sharp.MK3_Table.lv_by_y_edg_enable  = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.lv_by_y_edg_enable;
	sharp.MK3_Table.lv_by_y_v_enable    = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.lv_by_y_v_enable;
	sharp.MK3_Table.lv_by_y_v_edg_enable= gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.lv_by_y_v_edg_enable;

    #ifdef SQM_OFFSET_TBL
        TWODPK_TBL_forSQM[21]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_0;
        TWODPK_TBL_forSQM[22]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_1;
        TWODPK_TBL_forSQM[23]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_2;
        TWODPK_TBL_forSQM[24]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_3;
        TWODPK_TBL_forSQM[25]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_4;
        TWODPK_TBL_forSQM[26]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_5;
        TWODPK_TBL_forSQM[27]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_6;
        TWODPK_TBL_forSQM[28]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_1;
        TWODPK_TBL_forSQM[29]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_2;
        TWODPK_TBL_forSQM[30]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_3;
        TWODPK_TBL_forSQM[31]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_4;
        TWODPK_TBL_forSQM[32]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_5;
        TWODPK_TBL_forSQM[33]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Step_6;

        TWODPK_TBL_forSQM[34]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.Gain_By_Y_En;
        TWODPK_TBL_forSQM[35]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.gain_by_y_tex_en;
        TWODPK_TBL_forSQM[36]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.gain_by_y_edg_en;
        TWODPK_TBL_forSQM[37]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.gain_by_y_v_en;
        TWODPK_TBL_forSQM[38]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.lv_by_y_enable;
        TWODPK_TBL_forSQM[39]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.lv_by_y_tex_enable;
        TWODPK_TBL_forSQM[40]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.lv_by_y_edg_enable;
        TWODPK_TBL_forSQM[41]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.lv_by_y_v_enable;
        TWODPK_TBL_forSQM[42]   = gVip_Table->Ddomain_SHPTable[value].Gain_By_Y.lv_by_y_v_edg_enable;
     #endif
   
	sharp.TwoD_edg.en_edg = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.en_edg;
	sharp.TwoD_edg.C0 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C0;
	sharp.TwoD_edg.C1 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C1;
	sharp.TwoD_edg.C2 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C2;
	sharp.TwoD_edg.C3 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C3;
	sharp.TwoD_edg.C4 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C4;
	sharp.TwoD_edg.C5 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C5;
	sharp.TwoD_edg.C6 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C6;
	sharp.TwoD_edg.C7 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C7;
	sharp.TwoD_edg.C8 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C8;
	sharp.TwoD_edg.C9 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C9;
	sharp.TwoD_edg.C10 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C10;
	sharp.TwoD_edg.C0H1 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef2.C0;
	sharp.TwoD_edg.C0H2 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef3.C0;
	sharp.TwoD_edg.C0H3 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef4.C0;
	sharp.TwoD_edg.C0H4 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef5.C0;
	sharp.TwoD_tex.en_tex = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.en_tex;
	sharp.TwoD_tex.C0 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C0;
	sharp.TwoD_tex.C1 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C1;
	sharp.TwoD_tex.C2 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C2;
	sharp.TwoD_tex.C3 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C3;
	sharp.TwoD_tex.C4 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C4;
	sharp.TwoD_tex.C5 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C5;
	sharp.TwoD_tex.C6 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C6;
	sharp.TwoD_tex.C7 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C7;
	sharp.TwoD_tex.C8 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C8;
	sharp.TwoD_tex.C9 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C9;
	sharp.TwoD_tex.C10 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C10;
	sharp.TwoD_tex.C0H1 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef2.C0;
	sharp.TwoD_tex.C0H2 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef3.C0;
	sharp.TwoD_tex.C0H3 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef4.C0;
	sharp.TwoD_tex.C0H4 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef5.C0;
	sharp.MK3_Table.EdgeCoring_En = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Coring_En;
	sharp.MK3_Table.EdgeCoring_Gain_En = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Gain_En;
	sharp.MK3_Table.EdgeCoring_DeltaEdge_Ulevel = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.DeltaEdge_Ulevel;
	sharp.MK3_Table.EdgeCoring_Clip = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Coring_Clip;
	sharp.MK3_Table.EdgeCoring_Gain_Bound = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Gain_Bound;
	sharp.MK3_Table.EdgeCoring_Ser_Range = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Ser_Range;
	sharp.MK3_Table.EdgeCoring_Bigedge_Ratio = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Bigedge_Ratio;
	sharp.MK3_Table.EdgeCoring_Smalledge_Ratio = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Smalledge_Ratio;
	sharp.MK3_Table.EdgeCoring_Deltaedge_Ratio = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Deltaedge_Ratio;
	sharp.MK3_Table.EdgeCoring_Smalledge_Ulevel = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Smalledge_Ulevel;
	sharp.MK3_Table.Edge_Text_blend_en = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.Edg_Tex_Blending_Lpf_En;
	sharp.MK3_Table.Edge_Text_blend_filter = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.Edg_Tex_Blending_Lpf_Filter;
	sharp.MK3_Table.Edge_Delta_Ext_Range = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Delta_Ext_Range;/*magellan2*/
	sharp.MK3_Table.h_lvd_range = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.h_lvd_range;
	sharp.MK3_Table.h_lvd_gaim = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.h_lvd_gaim;
	sharp.MK3_Table.h_lvd_gain = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.h_lvd_gain;
	sharp.MK3_Table.v_lvd_range = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.v_lvd_range;
	sharp.MK3_Table.v_lvd_gaim = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.v_lvd_gaim;
	sharp.MK3_Table.v_lvd_gain = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.v_lvd_gain;

	sharp.MK3_Table.LinearY_LB = gVip_Table->Ddomain_SHPTable[value].Y_Remap.LinearY_LB;
	sharp.MK3_Table.LinearY_UB = gVip_Table->Ddomain_SHPTable[value].Y_Remap.LinearY_UB;
	sharp.MK3_Table.LinearY_LM = gVip_Table->Ddomain_SHPTable[value].Y_Remap.LinearY_LM;
	sharp.MK3_Table.LinearY_UM = gVip_Table->Ddomain_SHPTable[value].Y_Remap.LinearY_UM;

	sharp.MK3_Table.Slope_gain_en = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.Slope_gain_en;
	sharp.MK3_Table.dir = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.dir;
	sharp.MK3_Table.flat_method = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_method;
	sharp.MK3_Table.Gain_boundPos = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.Gain_boundPos;
	sharp.MK3_Table.Gain_boundNeg = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.Gain_boundNeg;
	sharp.MK3_Table.Gain_extendPos = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.Gain_externdPos;
	sharp.MK3_Table.Gain_extendNeg = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.Gain_externdNeg;
	sharp.MK3_Table.flat_enable = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_enable;
	sharp.MK3_Table.flat_offset = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_offset;
	sharp.MK3_Table.flat_gain = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_gain;

	sharp.MK3_Table.Slope_gain_v_en = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.v_slope_gain_en;//merlin
	sharp.MK3_Table.dir_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.dir_v;//merlin
	sharp.MK3_Table.Gain_boundPos_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.gain_boundpos_v;//merlin
	sharp.MK3_Table.Gain_boundNeg_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.gain_boundneg_v;//merlin
	sharp.MK3_Table.Gain_extendPos_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.gain_extendpos_v;//merlin
	sharp.MK3_Table.Gain_extendNeg_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.gain_extendneg_v;//merlin
	sharp.MK3_Table.flat_v_enable= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_v_enable;//merlin2
	sharp.MK3_Table.flat_offset_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_offset_v;//merlin2
	sharp.MK3_Table.flat_gain_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_gain_v;//merlin2
	sharp.MK3_Table.lowbound= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.lowbound;//merlin3
	sharp.MK3_Table.lowbound_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.lowbound_v;//merlin3
	sharp.MK3_Table.use_ramp= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.use_ramp;// 2020
	sharp.MK3_Table.extend2= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.extend2;//merlin3//juwen, delete
	sharp.MK3_Table.flat_range_h= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_range_h;//merlin3
	sharp.MK3_Table.flat_range_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_range_v;//merlin3

	/*magellan2 start*/

	sharp.Edge_Pos_Curve.G0 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G0;
	sharp.Edge_Pos_Curve.G1 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G1;
	sharp.Edge_Pos_Curve.G2 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G2;
	sharp.Edge_Pos_Curve.G3 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G3;
	sharp.Edge_Pos_Curve.G4 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G4;
	sharp.Edge_Pos_Curve.G5 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G5;
	sharp.Edge_Pos_Curve.G6 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G6;
	sharp.Edge_Pos_Curve.G7 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G7;
	sharp.Edge_Pos_Curve.G8 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G8;
	sharp.Edge_Pos_Curve.G9 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G9;
	sharp.Edge_Pos_Curve.G10 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G10;
	sharp.Edge_Pos_Curve.G11 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G11;
	sharp.Edge_Pos_Curve.G12 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G12;
	sharp.Edge_Pos_Curve.G13 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G13;
	sharp.Edge_Pos_Curve.G14 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G14;

	sharp.Edge_Pos_Curve.S1 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S1;
	sharp.Edge_Pos_Curve.S2 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S2;
	sharp.Edge_Pos_Curve.S3 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S3;
	sharp.Edge_Pos_Curve.S4 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S4;
	sharp.Edge_Pos_Curve.S5 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S5;
	sharp.Edge_Pos_Curve.S6 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S6;
	sharp.Edge_Pos_Curve.S7 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S7;
	sharp.Edge_Pos_Curve.S8 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S8;
	sharp.Edge_Pos_Curve.S9 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S9;
	sharp.Edge_Pos_Curve.S10 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S10;
	sharp.Edge_Pos_Curve.S11 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S11;
	sharp.Edge_Pos_Curve.S12 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S12;
	sharp.Edge_Pos_Curve.S13 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S13;
	sharp.Edge_Pos_Curve.S14 = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S14;

    #ifdef SQM_OFFSET_TBL
        TWODPK_TBL_forSQM[43]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G0;
        TWODPK_TBL_forSQM[44]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G1;
        TWODPK_TBL_forSQM[45]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G2;
        TWODPK_TBL_forSQM[46]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G3;
        TWODPK_TBL_forSQM[47]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G4;
        TWODPK_TBL_forSQM[48]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G5;
        TWODPK_TBL_forSQM[49]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G6;
        TWODPK_TBL_forSQM[50]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G7;
        TWODPK_TBL_forSQM[51]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G8;
        TWODPK_TBL_forSQM[52]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G9;
        TWODPK_TBL_forSQM[53]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G10;
        TWODPK_TBL_forSQM[54]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G11;
        TWODPK_TBL_forSQM[55]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G12;
        TWODPK_TBL_forSQM[56]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G13;
        TWODPK_TBL_forSQM[57]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.G14;

        TWODPK_TBL_forSQM[58]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S1;
        TWODPK_TBL_forSQM[59]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S2;
        TWODPK_TBL_forSQM[60]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S3;
        TWODPK_TBL_forSQM[61]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S4;
        TWODPK_TBL_forSQM[62]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S5;
        TWODPK_TBL_forSQM[63]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S6;
        TWODPK_TBL_forSQM[64]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S7;
        TWODPK_TBL_forSQM[65]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S8;
        TWODPK_TBL_forSQM[66]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S9;
        TWODPK_TBL_forSQM[67]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S10;
        TWODPK_TBL_forSQM[68]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S11;
        TWODPK_TBL_forSQM[69]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S12;
        TWODPK_TBL_forSQM[70]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S13;
        TWODPK_TBL_forSQM[71]   = gVip_Table->Ddomain_SHPTable[value].Edge_Pos_Curve.S14;

    #endif
    
	sharp.Edge_Neg_Curve.G0 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G0;
	sharp.Edge_Neg_Curve.G1 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G1;
	sharp.Edge_Neg_Curve.G2 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G2;
	sharp.Edge_Neg_Curve.G3 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G3;
	sharp.Edge_Neg_Curve.G4 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G4;
	sharp.Edge_Neg_Curve.G5 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G5;
	sharp.Edge_Neg_Curve.G6 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G6;
	sharp.Edge_Neg_Curve.G7 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G7;
	sharp.Edge_Neg_Curve.G8 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G8;
	sharp.Edge_Neg_Curve.G9 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G9;
	sharp.Edge_Neg_Curve.G10 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G10;
	sharp.Edge_Neg_Curve.G11 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G11;
	sharp.Edge_Neg_Curve.G12 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G12;
	sharp.Edge_Neg_Curve.G13 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G13;
	sharp.Edge_Neg_Curve.G14 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G14;

	sharp.Edge_Neg_Curve.S1 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S1;
	sharp.Edge_Neg_Curve.S2 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S2;
	sharp.Edge_Neg_Curve.S3 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S3;
	sharp.Edge_Neg_Curve.S4 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S4;
	sharp.Edge_Neg_Curve.S5 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S5;
	sharp.Edge_Neg_Curve.S6 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S6;
	sharp.Edge_Neg_Curve.S7 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S7;
	sharp.Edge_Neg_Curve.S8 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S8;
	sharp.Edge_Neg_Curve.S9 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S9;
	sharp.Edge_Neg_Curve.S10 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S10;
	sharp.Edge_Neg_Curve.S11 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S11;
	sharp.Edge_Neg_Curve.S12 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S12;
	sharp.Edge_Neg_Curve.S13 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S13;
	sharp.Edge_Neg_Curve.S14 = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S14;
	sharp.Edge_Neg_Curve.enable = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.enable;

    #ifdef SQM_OFFSET_TBL
        TWODPK_TBL_forSQM[72]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G0;
        TWODPK_TBL_forSQM[73]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G1;
        TWODPK_TBL_forSQM[74]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G2;
        TWODPK_TBL_forSQM[75]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G3;
        TWODPK_TBL_forSQM[76]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G4;
        TWODPK_TBL_forSQM[77]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G5;
        TWODPK_TBL_forSQM[78]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G6;
        TWODPK_TBL_forSQM[79]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G7;
        TWODPK_TBL_forSQM[80]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G8;
        TWODPK_TBL_forSQM[81]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G9;
        TWODPK_TBL_forSQM[82]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G10;
        TWODPK_TBL_forSQM[83]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G11;
        TWODPK_TBL_forSQM[84]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G12;
        TWODPK_TBL_forSQM[85]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G13;
        TWODPK_TBL_forSQM[86]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.G14;
        
        TWODPK_TBL_forSQM[87]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S1;
        TWODPK_TBL_forSQM[88]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S2;
        TWODPK_TBL_forSQM[89]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S3;
        TWODPK_TBL_forSQM[90]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S4;
        TWODPK_TBL_forSQM[91]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S5;
        TWODPK_TBL_forSQM[92]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S6;
        TWODPK_TBL_forSQM[93]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S7;
        TWODPK_TBL_forSQM[94]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S8;
        TWODPK_TBL_forSQM[95]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S9;
        TWODPK_TBL_forSQM[96]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S10;
        TWODPK_TBL_forSQM[97]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S11;
        TWODPK_TBL_forSQM[98]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S12;
        TWODPK_TBL_forSQM[99]   = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S13;
        TWODPK_TBL_forSQM[100]  = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.S14;
        
        TWODPK_TBL_forSQM[101]  = gVip_Table->Ddomain_SHPTable[value].Edge_Neg_Curve.enable;
    #endif


	sharp.Tex_Pos_Curve.G0 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G0;
	sharp.Tex_Pos_Curve.G1 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G1;
	sharp.Tex_Pos_Curve.G2 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G2;
	sharp.Tex_Pos_Curve.G3 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G3;
	sharp.Tex_Pos_Curve.G4 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G4;
	sharp.Tex_Pos_Curve.G5 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G5;
	sharp.Tex_Pos_Curve.G6 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G6;
	sharp.Tex_Pos_Curve.G7 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G7;
	sharp.Tex_Pos_Curve.G8 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G8;
	sharp.Tex_Pos_Curve.G9 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G9;
	sharp.Tex_Pos_Curve.G10 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G10;
	sharp.Tex_Pos_Curve.G11 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G11;
	sharp.Tex_Pos_Curve.G12 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G12;
	sharp.Tex_Pos_Curve.G13 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G13;
	sharp.Tex_Pos_Curve.G14 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G14;

	sharp.Tex_Pos_Curve.S1 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S1;
	sharp.Tex_Pos_Curve.S2 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S2;
	sharp.Tex_Pos_Curve.S3 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S3;
	sharp.Tex_Pos_Curve.S4 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S4;
	sharp.Tex_Pos_Curve.S5 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S5;
	sharp.Tex_Pos_Curve.S6 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S6;
	sharp.Tex_Pos_Curve.S7 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S7;
	sharp.Tex_Pos_Curve.S8 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S8;
	sharp.Tex_Pos_Curve.S9 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S9;
	sharp.Tex_Pos_Curve.S10 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S10;
	sharp.Tex_Pos_Curve.S11 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S11;
	sharp.Tex_Pos_Curve.S12 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S12;
	sharp.Tex_Pos_Curve.S13 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S13;
	sharp.Tex_Pos_Curve.S14 = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S14;

    #ifdef SQM_OFFSET_TBL
        TWODPK_TBL_forSQM[102]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G0;
        TWODPK_TBL_forSQM[103]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G1;
        TWODPK_TBL_forSQM[104]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G2;
        TWODPK_TBL_forSQM[105]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G3;
        TWODPK_TBL_forSQM[106]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G4;
        TWODPK_TBL_forSQM[107]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G5;
        TWODPK_TBL_forSQM[108]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G6;
        TWODPK_TBL_forSQM[109]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G7;
        TWODPK_TBL_forSQM[110]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G8;
        TWODPK_TBL_forSQM[111]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G9;
        TWODPK_TBL_forSQM[112]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G10;
        TWODPK_TBL_forSQM[113]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G11;
        TWODPK_TBL_forSQM[114]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G12;
        TWODPK_TBL_forSQM[115]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G13;
        TWODPK_TBL_forSQM[116]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G14;
        
        TWODPK_TBL_forSQM[117]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S1;
        TWODPK_TBL_forSQM[118]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S2;
        TWODPK_TBL_forSQM[119]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S3;
        TWODPK_TBL_forSQM[120]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S4;
        TWODPK_TBL_forSQM[121]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S5;
        TWODPK_TBL_forSQM[122]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S6;
        TWODPK_TBL_forSQM[123]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S7;
        TWODPK_TBL_forSQM[124]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S8;
        TWODPK_TBL_forSQM[125]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.S9;
        TWODPK_TBL_forSQM[126]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G10;
        TWODPK_TBL_forSQM[127]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G11;
        TWODPK_TBL_forSQM[128]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G12;
        TWODPK_TBL_forSQM[129]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G13;
        TWODPK_TBL_forSQM[130]   = gVip_Table->Ddomain_SHPTable[value].Tex_Pos_Curve.G14;        
    #endif

	sharp.Tex_Neg_Curve.G0 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G0;
	sharp.Tex_Neg_Curve.G1 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G1;
	sharp.Tex_Neg_Curve.G2 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G2;
	sharp.Tex_Neg_Curve.G3 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G3;
	sharp.Tex_Neg_Curve.G4 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G4;
	sharp.Tex_Neg_Curve.G5 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G5;
	sharp.Tex_Neg_Curve.G6 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G6;
	sharp.Tex_Neg_Curve.G7 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G7;
	sharp.Tex_Neg_Curve.G8 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G8;
	sharp.Tex_Neg_Curve.G9 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G9;
	sharp.Tex_Neg_Curve.G10 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G10;
	sharp.Tex_Neg_Curve.G11 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G11;
	sharp.Tex_Neg_Curve.G12 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G12;
	sharp.Tex_Neg_Curve.G13 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G13;
	sharp.Tex_Neg_Curve.G14 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G14;

	sharp.Tex_Neg_Curve.S1 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S1;
	sharp.Tex_Neg_Curve.S2 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S2;
	sharp.Tex_Neg_Curve.S3 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S3;
	sharp.Tex_Neg_Curve.S4 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S4;
	sharp.Tex_Neg_Curve.S5 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S5;
	sharp.Tex_Neg_Curve.S6 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S6;
	sharp.Tex_Neg_Curve.S7 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S7;
	sharp.Tex_Neg_Curve.S8 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S8;
	sharp.Tex_Neg_Curve.S9 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S9;
	sharp.Tex_Neg_Curve.S10 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S10;
	sharp.Tex_Neg_Curve.S11 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S11;
	sharp.Tex_Neg_Curve.S12 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S12;
	sharp.Tex_Neg_Curve.S13 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S13;
	sharp.Tex_Neg_Curve.S14 = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S14;
	sharp.Tex_Neg_Curve.enable = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.enable;

    #ifdef SQM_OFFSET_TBL
        TWODPK_TBL_forSQM[131]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G0;
        TWODPK_TBL_forSQM[132]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G1;
        TWODPK_TBL_forSQM[133]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G2;
        TWODPK_TBL_forSQM[134]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G3;
        TWODPK_TBL_forSQM[135]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G4;
        TWODPK_TBL_forSQM[136]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G5;
        TWODPK_TBL_forSQM[137]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G6;
        TWODPK_TBL_forSQM[138]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G7;
        TWODPK_TBL_forSQM[139]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G8;
        TWODPK_TBL_forSQM[140]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G9;
        TWODPK_TBL_forSQM[141]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G10;
        TWODPK_TBL_forSQM[142]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G11;
        TWODPK_TBL_forSQM[143]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G12;
        TWODPK_TBL_forSQM[144]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G13;
        TWODPK_TBL_forSQM[145]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.G14;
        
        TWODPK_TBL_forSQM[146]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S1;
        TWODPK_TBL_forSQM[147]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S2;
        TWODPK_TBL_forSQM[148]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S3;
        TWODPK_TBL_forSQM[149]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S4;
        TWODPK_TBL_forSQM[150]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S5;
        TWODPK_TBL_forSQM[151]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S6;
        TWODPK_TBL_forSQM[152]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S7;
        TWODPK_TBL_forSQM[153]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S8;
        TWODPK_TBL_forSQM[154]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S9;
        TWODPK_TBL_forSQM[155]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S10;
        TWODPK_TBL_forSQM[156]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S11;
        TWODPK_TBL_forSQM[157]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S12;
        TWODPK_TBL_forSQM[158]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S13;
        TWODPK_TBL_forSQM[169]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S14;    

        TWODPK_TBL_forSQM[239]   = gVip_Table->Ddomain_SHPTable[value].Tex_Neg_Curve.S14;   
    #endif

	sharp.Vertical.C3 = gVip_Table->Ddomain_SHPTable[value].Vertical.C3;
	sharp.Vertical.C4 = gVip_Table->Ddomain_SHPTable[value].Vertical.C4;

	sharp.V_Pos_Curve.G0 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G0;
	sharp.V_Pos_Curve.G1 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G1;
	sharp.V_Pos_Curve.G2 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G2;
	sharp.V_Pos_Curve.G3 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G3;
	sharp.V_Pos_Curve.G4 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G4;
	sharp.V_Pos_Curve.G5 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G5;
	sharp.V_Pos_Curve.G6 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G6;
	sharp.V_Pos_Curve.G7 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G7;
	sharp.V_Pos_Curve.G8 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G8;
	sharp.V_Pos_Curve.G9 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G9;
	sharp.V_Pos_Curve.G10 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G10;
	sharp.V_Pos_Curve.G11 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G11;
	sharp.V_Pos_Curve.G12 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G12;
	sharp.V_Pos_Curve.G13 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G13;
	sharp.V_Pos_Curve.G14 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G14;

	sharp.V_Pos_Curve.S1 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S1;
	sharp.V_Pos_Curve.S2 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S2;
	sharp.V_Pos_Curve.S3 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S3;
	sharp.V_Pos_Curve.S4 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S4;
	sharp.V_Pos_Curve.S5 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S5;
	sharp.V_Pos_Curve.S6 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S6;
	sharp.V_Pos_Curve.S7 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S7;
	sharp.V_Pos_Curve.S8 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S8;
	sharp.V_Pos_Curve.S9 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S9;
	sharp.V_Pos_Curve.S10 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S10;
	sharp.V_Pos_Curve.S11 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S11;
	sharp.V_Pos_Curve.S12 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S12;
	sharp.V_Pos_Curve.S13 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S13;
	sharp.V_Pos_Curve.S14 = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S14;
	sharp.V_Pos_Curve.edg_curve_bypass = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.edg_curve_bypass;

    #ifdef SQM_OFFSET_TBL
        TWODPK_TBL_forSQM[170]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G0;     
        TWODPK_TBL_forSQM[171]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G1;
        TWODPK_TBL_forSQM[172]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G2;
        TWODPK_TBL_forSQM[173]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G3;
        TWODPK_TBL_forSQM[174]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G4;
        TWODPK_TBL_forSQM[175]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G5;
        TWODPK_TBL_forSQM[176]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G6;
        TWODPK_TBL_forSQM[177]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G7;
        TWODPK_TBL_forSQM[178]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G8;
        TWODPK_TBL_forSQM[179]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G9;
        TWODPK_TBL_forSQM[180]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G10;
        TWODPK_TBL_forSQM[181]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G11;
        TWODPK_TBL_forSQM[182]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G12;
        TWODPK_TBL_forSQM[183]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G13;
        TWODPK_TBL_forSQM[184]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.G14;
        
        TWODPK_TBL_forSQM[185]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S1;
        TWODPK_TBL_forSQM[186]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S2;
        TWODPK_TBL_forSQM[187]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S3;
        TWODPK_TBL_forSQM[188]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S4;
        TWODPK_TBL_forSQM[189]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S5;
        TWODPK_TBL_forSQM[190]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S6;
        TWODPK_TBL_forSQM[191]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S7;
        TWODPK_TBL_forSQM[192]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S8;
        TWODPK_TBL_forSQM[193]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S9;
        TWODPK_TBL_forSQM[194]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S10;
        TWODPK_TBL_forSQM[195]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S11;
        TWODPK_TBL_forSQM[196]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S12;
        TWODPK_TBL_forSQM[197]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S13;
        TWODPK_TBL_forSQM[198]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.S14;
        
        TWODPK_TBL_forSQM[199]   = gVip_Table->Ddomain_SHPTable[value].V_Pos_Curve.edg_curve_bypass;     
    #endif

	sharp.V_Neg_Curve.G0 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G0;
	sharp.V_Neg_Curve.G1 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G1;
	sharp.V_Neg_Curve.G2 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G2;
	sharp.V_Neg_Curve.G3 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G3;
	sharp.V_Neg_Curve.G4 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G4;
	sharp.V_Neg_Curve.G5 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G5;
	sharp.V_Neg_Curve.G6 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G6;
	sharp.V_Neg_Curve.G7 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G7;
	sharp.V_Neg_Curve.G8 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G8;
	sharp.V_Neg_Curve.G9 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G9;
	sharp.V_Neg_Curve.G10 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G10;
	sharp.V_Neg_Curve.G11 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G11;
	sharp.V_Neg_Curve.G12 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G12;
	sharp.V_Neg_Curve.G13 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G13;
	sharp.V_Neg_Curve.G14 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G14;

	sharp.V_Neg_Curve.S1 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S1;
	sharp.V_Neg_Curve.S2 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S2;
	sharp.V_Neg_Curve.S3 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S3;
	sharp.V_Neg_Curve.S4 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S4;
	sharp.V_Neg_Curve.S5 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S5;
	sharp.V_Neg_Curve.S6 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S6;
	sharp.V_Neg_Curve.S7 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S7;
	sharp.V_Neg_Curve.S8 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S8;
	sharp.V_Neg_Curve.S9 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S9;
	sharp.V_Neg_Curve.S10 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S10;
	sharp.V_Neg_Curve.S11 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S11;
	sharp.V_Neg_Curve.S12 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S12;
	sharp.V_Neg_Curve.S13 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S13;
	sharp.V_Neg_Curve.S14 = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S14;
	sharp.V_Neg_Curve.enable = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.enable;

    #ifdef SQM_OFFSET_TBL
        TWODPK_TBL_forSQM[200]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G0;     
        TWODPK_TBL_forSQM[201]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G1;
        TWODPK_TBL_forSQM[202]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G2;
        TWODPK_TBL_forSQM[203]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G3;
        TWODPK_TBL_forSQM[204]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G4;
        TWODPK_TBL_forSQM[205]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G5;
        TWODPK_TBL_forSQM[206]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G6;
        TWODPK_TBL_forSQM[207]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G7;
        TWODPK_TBL_forSQM[208]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G8;
        TWODPK_TBL_forSQM[209]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G9;
        TWODPK_TBL_forSQM[210]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G10;
        TWODPK_TBL_forSQM[211]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G11;
        TWODPK_TBL_forSQM[212]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G12;
        TWODPK_TBL_forSQM[213]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G13;
        TWODPK_TBL_forSQM[214]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.G14;
        
        TWODPK_TBL_forSQM[215]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S1;
        TWODPK_TBL_forSQM[216]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S2;
        TWODPK_TBL_forSQM[217]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S3;
        TWODPK_TBL_forSQM[218]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S4;
        TWODPK_TBL_forSQM[219]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S5;
        TWODPK_TBL_forSQM[220]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S6;
        TWODPK_TBL_forSQM[221]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S7;
        TWODPK_TBL_forSQM[222]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S8;
        TWODPK_TBL_forSQM[223]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S9;
        TWODPK_TBL_forSQM[224]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S10;
        TWODPK_TBL_forSQM[225]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S11;
        TWODPK_TBL_forSQM[226]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S12;
        TWODPK_TBL_forSQM[227]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S13;
        TWODPK_TBL_forSQM[228]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.S14;
        
        TWODPK_TBL_forSQM[229]   = gVip_Table->Ddomain_SHPTable[value].V_Neg_Curve.enable;   
    #endif

	sharp.After_Filter.C0 = gVip_Table->Ddomain_SHPTable[value].After_Filter.C0;
	sharp.After_Filter.C1 = gVip_Table->Ddomain_SHPTable[value].After_Filter.C1;
	sharp.After_Filter.C2 = gVip_Table->Ddomain_SHPTable[value].After_Filter.C2;
	sharp.After_Filter.C3 = gVip_Table->Ddomain_SHPTable[value].After_Filter.C3;
	sharp.After_Filter.C4 = gVip_Table->Ddomain_SHPTable[value].After_Filter.C4;
	sharp.After_Filter.HPF_Gain = gVip_Table->Ddomain_SHPTable[value].After_Filter.HPF_Gain;
	sharp.After_Filter.Mode = gVip_Table->Ddomain_SHPTable[value].After_Filter.Mode;
	sharp.After_Filter.Enable = gVip_Table->Ddomain_SHPTable[value].After_Filter.Enable;
	sharp.After_Filter.Rgblimit_pos= gVip_Table->Ddomain_SHPTable[value].After_Filter.Rgblimit_pos;
	sharp.After_Filter.Rgblimit_neg= gVip_Table->Ddomain_SHPTable[value].After_Filter.Rgblimit_neg;

	sharp.SR_Control.Period             = gVip_Table->Ddomain_SHPTable[value].SR_Control.Period;
	sharp.SR_Control.Gain               = gVip_Table->Ddomain_SHPTable[value].SR_Control.Gain;
	sharp.SR_Control.Offset             = gVip_Table->Ddomain_SHPTable[value].SR_Control.Offset;
	sharp.SR_Control.Ring_Gen_Gain      = gVip_Table->Ddomain_SHPTable[value].SR_Control.Ring_Gen_Gain;
	sharp.SR_Control.Ring_Gen           = gVip_Table->Ddomain_SHPTable[value].SR_Control.Ring_Gen;
	sharp.SR_Control.sr_detail_tex_en   = gVip_Table->Ddomain_SHPTable[value].SR_Control.sr_detail_tex_en;
	sharp.SR_Control.sr_detail_edg_en   = gVip_Table->Ddomain_SHPTable[value].SR_Control.sr_detail_edg_en;
	sharp.SR_Control.sr_detail_v_tex_en = gVip_Table->Ddomain_SHPTable[value].SR_Control.sr_detail_v_tex_en;
	sharp.SR_Control.sr_detail_v_edg_en = gVip_Table->Ddomain_SHPTable[value].SR_Control.sr_detail_v_edg_en;
	sharp.SR_Control.sr_1_touch_edge = gVip_Table->Ddomain_SHPTable[value].SR_Control.sr_1_touch_edge;
	sharp.SR_Control.sr_1_pxdiff_lim = gVip_Table->Ddomain_SHPTable[value].SR_Control.sr_1_pxdiff_lim;

    #ifdef SQM_OFFSET_TBL
        TWODPK_TBL_forSQM[230]   = gVip_Table->Ddomain_SHPTable[value].SR_Control.Period;   
        TWODPK_TBL_forSQM[231]   = gVip_Table->Ddomain_SHPTable[value].SR_Control.Gain;
        TWODPK_TBL_forSQM[232]   = gVip_Table->Ddomain_SHPTable[value].SR_Control.Offset;
        TWODPK_TBL_forSQM[233]   = gVip_Table->Ddomain_SHPTable[value].SR_Control.Ring_Gen_Gain;
        TWODPK_TBL_forSQM[234]   = gVip_Table->Ddomain_SHPTable[value].SR_Control.Ring_Gen;
        TWODPK_TBL_forSQM[235]   = gVip_Table->Ddomain_SHPTable[value].SR_Control.sr_detail_tex_en;
        TWODPK_TBL_forSQM[236]   = gVip_Table->Ddomain_SHPTable[value].SR_Control.sr_detail_edg_en;
        TWODPK_TBL_forSQM[237]   = gVip_Table->Ddomain_SHPTable[value].SR_Control.sr_detail_v_tex_en;
        TWODPK_TBL_forSQM[238]   = gVip_Table->Ddomain_SHPTable[value].SR_Control.sr_detail_v_edg_en;
    #endif

	sharp.SR_H9.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_H9.en_tex;
	sharp.SR_H9.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_H9.en_edg;
	sharp.SR_H9.C0 = gVip_Table->Ddomain_SHPTable[value].SR_H9.C0;
	sharp.SR_H9.C1 = gVip_Table->Ddomain_SHPTable[value].SR_H9.C1;
	sharp.SR_H9.C2 = gVip_Table->Ddomain_SHPTable[value].SR_H9.C2;
	sharp.SR_H9.C3 = gVip_Table->Ddomain_SHPTable[value].SR_H9.C3;
	sharp.SR_H9.C4 = gVip_Table->Ddomain_SHPTable[value].SR_H9.C4;

	sharp.SR_H13.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_H13.en_tex;
	sharp.SR_H13.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_H13.en_edg;
	sharp.SR_H13.C0 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C0;
	sharp.SR_H13.C1 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C1;
	sharp.SR_H13.C2 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C2;
	sharp.SR_H13.C3 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C3;
	sharp.SR_H13.C4 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C4;
	sharp.SR_H13.C5 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C5;
	sharp.SR_H13.C6 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C6;

	sharp.SR_H21.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_H21.en_tex;
	sharp.SR_H21.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_H21.en_edg;
	sharp.SR_H21.C0 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C0;
	sharp.SR_H21.C1 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C1;
	sharp.SR_H21.C2 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C2;
	sharp.SR_H21.C3 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C3;
	sharp.SR_H21.C4 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C4;
	sharp.SR_H21.C5 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C5;
	sharp.SR_H21.C6 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C6;
	sharp.SR_H21.C7 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C7;
	sharp.SR_H21.C8 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C8;
	sharp.SR_H21.C9 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C9;
	sharp.SR_H21.C10 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C10;

	sharp.SR_V9_1.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.en_tex;
	sharp.SR_V9_1.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.en_edg;
	sharp.SR_V9_1.C0 = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.C0;
	sharp.SR_V9_1.C1 = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.C1;
	sharp.SR_V9_1.C2 = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.C2;
	sharp.SR_V9_1.C3 = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.C3;
	sharp.SR_V9_1.C4 = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.C4;

	sharp.SR_V9_2.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.en_tex;
	sharp.SR_V9_2.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.en_edg;
	sharp.SR_V9_2.C0 = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.C0;
	sharp.SR_V9_2.C1 = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.C1;
	sharp.SR_V9_2.C2 = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.C2;
	sharp.SR_V9_2.C3 = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.C3;
	sharp.SR_V9_2.C4 = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.C4;

	sharp.SR_V9_3.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.en_tex;
	sharp.SR_V9_3.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.en_edg;
	sharp.SR_V9_3.C0 = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.C0;
	sharp.SR_V9_3.C1 = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.C1;
	sharp.SR_V9_3.C2 = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.C2;
	sharp.SR_V9_3.C3 = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.C3;
	sharp.SR_V9_3.C4 = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.C4;

	sharp.SR_Ring_H11.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.en_tex;
	sharp.SR_Ring_H11.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.en_edg;
	sharp.SR_Ring_H11.C0 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C0;
	sharp.SR_Ring_H11.C1 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C1;
	sharp.SR_Ring_H11.C2 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C2;
	sharp.SR_Ring_H11.C3 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C3;
	sharp.SR_Ring_H11.C4 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C4;
	sharp.SR_Ring_H11.C5 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C5;
	sharp.SR_Ring_H11.C0H0 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C0H0;
	sharp.SR_Ring_H11.C0H1 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C0H1;
	sharp.SR_Ring_H11.C0H2 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C0H2;
	sharp.SR_Ring_H11.C0H3 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C0H3;

	sharp.SR_Ring_V9.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.en_tex;
	sharp.SR_Ring_V9.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.en_edg;
	sharp.SR_Ring_V9.C0 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C0;
	sharp.SR_Ring_V9.C1 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C1;
	sharp.SR_Ring_V9.C2 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C2;
	sharp.SR_Ring_V9.C3 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C3;
	sharp.SR_Ring_V9.C4 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C4;
	sharp.SR_Ring_V9.C0H0 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C0H0;
	sharp.SR_Ring_V9.C0H1 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C0H1;
	sharp.SR_Ring_V9.C0H2 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C0H2;
	sharp.SR_Ring_V9.C0H3 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C0H3;

	/*magellan2 end*/

	sharp.Sub_Gain_Modify.sub_index_en = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.sub_index_en;
	sharp.Sub_Gain_Modify.EDG.Gain_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.EDG_Gain_Pos;
	sharp.Sub_Gain_Modify.EDG.Gain_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.EDG_Gain_Neg;
	sharp.Sub_Gain_Modify.EDG.HV_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.EDG_HV_Pos;
	sharp.Sub_Gain_Modify.EDG.HV_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.EDG_HV_Neg;
	sharp.Sub_Gain_Modify.EDG.LV = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.EDG_LV;
	sharp.Sub_Gain_Modify.TEX.Gain_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.TEX_Gain_Pos;
	sharp.Sub_Gain_Modify.TEX.Gain_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.TEX_Gain_Neg;
	sharp.Sub_Gain_Modify.TEX.HV_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.TEX_HV_Pos;
	sharp.Sub_Gain_Modify.TEX.HV_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.TEX_HV_Neg;
	sharp.Sub_Gain_Modify.TEX.LV = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.TEX_LV;
	sharp.Sub_Gain_Modify.V.Gain_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_Gain_Pos;
	sharp.Sub_Gain_Modify.V.Gain_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_Gain_Neg;
	sharp.Sub_Gain_Modify.V.HV_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_HV_Pos;
	sharp.Sub_Gain_Modify.V.HV_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_HV_Neg;
	sharp.Sub_Gain_Modify.V.LV = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_LV;
	sharp.Sub_Gain_Modify.V_EDG.Gain_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_EDG_Gain_Pos;
	sharp.Sub_Gain_Modify.V_EDG.Gain_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_EDG_Gain_Neg;
	sharp.Sub_Gain_Modify.V_EDG.HV_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_EDG_HV_Pos;
	sharp.Sub_Gain_Modify.V_EDG.HV_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_EDG_HV_Neg;
	sharp.Sub_Gain_Modify.V_EDG.LV = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_EDG_LV;

	sharp.Edge_SM.dirsm_rangh = gVip_Table->Ddomain_SHPTable[value].Edge_SM.dirsm_rangh;//merlin
	sharp.Edge_SM.dirsm_rangv= gVip_Table->Ddomain_SHPTable[value].Edge_SM.dirsm_rangv;//merlin
	sharp.Edge_SM.meandiff_rangeh= gVip_Table->Ddomain_SHPTable[value].Edge_SM.meandiff_rangeh;//merlin
	sharp.Edge_SM.meandiff_rangev= gVip_Table->Ddomain_SHPTable[value].Edge_SM.meandiff_rangev;//merlin
	sharp.Edge_SM.meandiff_shiftbit= gVip_Table->Ddomain_SHPTable[value].Edge_SM.meandiff_shiftbit;//merlin
	sharp.Edge_SM.meandiff_step= gVip_Table->Ddomain_SHPTable[value].Edge_SM.meandiff_step;//merlin
	sharp.Edge_SM.meandiff_lowbd= gVip_Table->Ddomain_SHPTable[value].Edge_SM.meandiff_lowbd;//merlin
	sharp.Edge_SM.edge_method_sel= gVip_Table->Ddomain_SHPTable[value].Edge_SM.edge_method_sel;//merlin
	sharp.Edge_SM.edgeindex_step= gVip_Table->Ddomain_SHPTable[value].Edge_SM.edgeindex_step;//merlin
	sharp.Edge_SM.edgeindex_lowbd= gVip_Table->Ddomain_SHPTable[value].Edge_SM.edgeindex_lowbd;//merlin

	sharp.SEGPK_ISE.ise_en = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_en;
	sharp.SEGPK_ISE.ise_step = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_step;
	sharp.SEGPK_ISE.ise_scale = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_scale;
	sharp.SEGPK_ISE.ise_ub = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_ub;
	sharp.SEGPK_ISE.ise_h_st = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_h_st;
	sharp.SEGPK_ISE.ise_h_end = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_h_end;
	sharp.SEGPK_ISE.ise_v_st = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_v_st;
	sharp.SEGPK_ISE.ise_v_end = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_v_end;
	sharp.SEGPK_ISE.ise_mul_max = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_mul_max;
	sharp.SEGPK_ISE.ise_mul_min = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_mul_min;

	sharp.Texture_Flat_Shp.en_tex= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef1.en_tex;
	sharp.Texture_Flat_Shp.C0= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef1.C0;
	sharp.Texture_Flat_Shp.C1= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef1.C1;
	sharp.Texture_Flat_Shp.C2= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef1.C2;
	sharp.Texture_Flat_Shp.C3= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef1.C3;
	sharp.Texture_Flat_Shp.C0H1= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef2.C0;
	sharp.Texture_Flat_Shp.C0H2 = gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef3.C0;

	memcpy(&(sharp.Ramp_H),&(gVip_Table->Ddomain_SHPTable[value].Ramp_H),sizeof(VIP_SEGPK_RAMP));
	memcpy(&(sharp.Ramp_V),&(gVip_Table->Ddomain_SHPTable[value].Ramp_V),sizeof(VIP_SEGPK_RAMP));
	memcpy(&(sharp.SR_X),&(gVip_Table->Ddomain_SHPTable[value].SR_X),sizeof(VIP_SR_H21));

	if (Scaler_access_Project_TV002_Style(0, 0) == Project_TV002_Style_1)
		Scaler_Cal_2D_Peaking_Clarity_Resolution_TV002(&sharp, value);

	drvif_color_Set_Sharpness_Table((DRV_Sharpness_Table *)&sharp);
}

void fwif_color_set_MBPK_table(unsigned char src_idx, unsigned char value)
{
	VIP_MBPK_Table MBPK = {{0}};
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	if (value >= MBPK_table_num) {	/* bypass = 255*/
		MBPK.MBPK_Ctrl.mb_peaking_en = 0;
		value = 0;
	} else {
		memcpy(&MBPK,gVip_Table->Idomain_MBPKTable+value,sizeof(VIP_MBPK_Table));
	}

	if (Scaler_access_Project_TV002_Style(0, 0) == Project_TV002_Style_1)
		Scaler_Cal_MB_Peaking_Clarity_Resolution_TV002(&MBPK, value);

	drvif_color_Set_MBPK_Table((VIP_MBPK_Table *)&MBPK);
}

void fwif_color_set_MBSU_table(unsigned char src_idx, unsigned char value)
{
	VIP_MBPK_Table MBPK = {{0}};
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	if (value >= MBSU_table_num) {	/* bypass = 255*/
		MBPK.MBPK_Ctrl.mb_peaking_en = 0;
		value = 0;
	} else {
		memcpy(&MBPK,gVip_Table->Ddomain_MBSUTable+value,sizeof(VIP_MBPK_Table));
	}

	if (Scaler_access_Project_TV002_Style(0, 0) == Project_TV002_Style_1)
		Scaler_Cal_SU_Peaking_Clarity_Resolution_TV002(&MBPK, value);

	drvif_color_Set_MBSU_Table((VIP_MBPK_Table *)&MBPK);
}


void fwif_color_VIPShpTable_to_DRVShpTable(VIP_Sharpness_Table *VIPShpTable, DRV_Sharpness_Table *DRVShpTable)
{

	DRVShpTable->TwoD_Peak_AdaptCtrl.Peaking_Enable = VIPShpTable->TwoD_Peak_AdaptCtrl.Peaking_Enable;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Edge_Mode = VIPShpTable->TwoD_Peak_AdaptCtrl.Edge_Mode;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Sobel_Mode = VIPShpTable->TwoD_Peak_AdaptCtrl.Sobel_Mode;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Edgextrange = VIPShpTable->TwoD_Peak_AdaptCtrl.Edgextrange;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Sobel_Upbnd = VIPShpTable->TwoD_Peak_AdaptCtrl.Sobel_Upbnd;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Sobel_Stepbit = VIPShpTable->TwoD_Peak_AdaptCtrl.Sobel_Stepbit;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Zdiff_Upbnd = VIPShpTable->TwoD_Peak_AdaptCtrl.Zdiff_Upbnd;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Zdiff_Stepbit = VIPShpTable->TwoD_Peak_AdaptCtrl.Zdiff_Stepbit;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Zigsftbit_Reg = VIPShpTable->TwoD_Peak_AdaptCtrl.Zigsftbit_Reg;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Tex_En = VIPShpTable->TwoD_Peak_AdaptCtrl.Tex_En;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Tex_Upbnd = VIPShpTable->TwoD_Peak_AdaptCtrl.Tex_Upbnd;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Tex_Stepbit = VIPShpTable->TwoD_Peak_AdaptCtrl.Tex_Stepbit;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Actsftbit_Reg = VIPShpTable->TwoD_Peak_AdaptCtrl.Actsftbit_Reg;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Lpf_Mode = VIPShpTable->TwoD_Peak_AdaptCtrl.Lpf_Mode;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Lpf_Filter = VIPShpTable->TwoD_Peak_AdaptCtrl.Lpf_Filter;
	DRVShpTable->TwoD_Peak_AdaptCtrl._5x5_h = VIPShpTable->TwoD_Peak_AdaptCtrl._5x5_h;
	DRVShpTable->TwoD_Peak_AdaptCtrl._5x5_v = VIPShpTable->TwoD_Peak_AdaptCtrl._5x5_v;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Tex_Exclude_Smooth = VIPShpTable->TwoD_Peak_AdaptCtrl.Tex_Exclude_Smooth;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Sobel_hspace = VIPShpTable->TwoD_Peak_AdaptCtrl.Sobel_hspace;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Sobel_vspace = VIPShpTable->TwoD_Peak_AdaptCtrl.Sobel_vspace;
	DRVShpTable->Edge_Shp.Edg_D2_Shift_Bit = VIPShpTable->Edge_Shp_set.Edg_D2_Shift_Bit;
	DRVShpTable->Edge_Shp.G_Neg2 = VIPShpTable->Edge_Shp_set.G_Neg2;
	DRVShpTable->Edge_Shp.G_Pos2 = VIPShpTable->Edge_Shp_set.G_Pos2;
	DRVShpTable->Edge_Shp.LV2 = VIPShpTable->Edge_Shp_set.LV2;
	DRVShpTable->Texture_Shp.Edg_D2_Shift_Bit = VIPShpTable->Texture_Shp_set.Edg_D2_Shift_Bit;
	DRVShpTable->Texture_Shp.G_Neg2 = VIPShpTable->Texture_Shp_set.G_Neg2;
	DRVShpTable->Texture_Shp.G_Pos2 = VIPShpTable->Texture_Shp_set.G_Pos2;
	DRVShpTable->Texture_Shp.LV2 = VIPShpTable->Texture_Shp_set.LV2;
	DRVShpTable->Vertical.C0 = VIPShpTable->Vertical.C0;
	DRVShpTable->Vertical.C1 = VIPShpTable->Vertical.C1;
	DRVShpTable->Vertical.C2 = VIPShpTable->Vertical.C2;
	DRVShpTable->Vertical.Vext_Reg = VIPShpTable->Vertical.Vext_Reg;
	DRVShpTable->Vertical.Vemf_En = VIPShpTable->Vertical.Vemf_En;
	DRVShpTable->Vertical.en_edg = VIPShpTable->Vertical.en_edg;
	DRVShpTable->Vertical.en_tex = VIPShpTable->Vertical.en_tex;
	DRVShpTable->Vertical.V_Tex_en = VIPShpTable->Vertical.V_Tex_en;
	DRVShpTable->Vertical.V_Dering_En = VIPShpTable->Vertical.V_Dering_En;
	DRVShpTable->Vertical.G_Neg2 = VIPShpTable->Vertical.G_Neg2;
	DRVShpTable->Vertical.G_Pos2 = VIPShpTable->Vertical.G_Pos2;
	DRVShpTable->Vertical.LV2 = VIPShpTable->Vertical.LV2;
	DRVShpTable->Edge_EMF_Table.EMF_En = VIPShpTable->Edge_EMF_Table.EMF_En;
	DRVShpTable->Edge_EMF_Table.EMF_Shift = VIPShpTable->Edge_EMF_Table.EMF_Shift;
	// DRVShpTable->Edge_EMF_Table.EMF_Range = VIPShpTable->Edge_EMF_Table.EMF_Range;
	DRVShpTable->Edge_EMF_Table.Seg_0_Gain = VIPShpTable->Edge_EMF_Table.Seg_0_Gain;
	DRVShpTable->Edge_EMF_Table.Seg_1_Gain = VIPShpTable->Edge_EMF_Table.Seg_1_Gain;
	DRVShpTable->Edge_EMF_Table.Seg_2_Gain = VIPShpTable->Edge_EMF_Table.Seg_2_Gain;
	DRVShpTable->Edge_EMF_Table.Seg_0_Offset = VIPShpTable->Edge_EMF_Table.Seg_0_Offset;
	DRVShpTable->Edge_EMF_Table.Seg_1_Offset = VIPShpTable->Edge_EMF_Table.Seg_1_Offset;
	DRVShpTable->Edge_EMF_Table.Seg_2_Offset = VIPShpTable->Edge_EMF_Table.Seg_2_Offset;
	DRVShpTable->Edge_EMF_Table.emf_fixextent_neg = VIPShpTable->Edge_EMF_Table.emf_fixextent_neg;
	DRVShpTable->Edge_EMF_Table.emf_fixextent_pos = VIPShpTable->Edge_EMF_Table.emf_fixextent_pos;
	DRVShpTable->Edge_EMF_Table.Seg_0_x = VIPShpTable->Edge_EMF_Table.Seg_0_x;
	DRVShpTable->Edge_EMF_Table.Seg_1_x = VIPShpTable->Edge_EMF_Table.Seg_1_x;
	DRVShpTable->Edge_EMF_Table.Blend_wt = VIPShpTable->Edge_EMF_Table.Blend_wt;
	DRVShpTable->Edge_EMF_Table.v5= VIPShpTable->Edge_EMF_Table.v5;
	DRVShpTable->Edge_EMF_Table.h11= VIPShpTable->Edge_EMF_Table.h11;
	DRVShpTable->Text_EMF_Table.EMF_En = VIPShpTable->Texture_EMF_Table.EMF_En;
	DRVShpTable->Text_EMF_Table.EMF_Shift = VIPShpTable->Texture_EMF_Table.EMF_Shift;
	// DRVShpTable->Text_EMF_Table.EMF_Range = VIPShpTable->Texture_EMF_Table.EMF_Range;
	DRVShpTable->Text_EMF_Table.Seg_0_Gain = VIPShpTable->Texture_EMF_Table.Seg_0_Gain;
	DRVShpTable->Text_EMF_Table.Seg_1_Gain = VIPShpTable->Texture_EMF_Table.Seg_1_Gain;
	DRVShpTable->Text_EMF_Table.Seg_2_Gain = VIPShpTable->Texture_EMF_Table.Seg_2_Gain;
	DRVShpTable->Text_EMF_Table.Seg_0_Offset = VIPShpTable->Texture_EMF_Table.Seg_0_Offset;
	DRVShpTable->Text_EMF_Table.Seg_1_Offset = VIPShpTable->Texture_EMF_Table.Seg_1_Offset;
	DRVShpTable->Text_EMF_Table.Seg_2_Offset = VIPShpTable->Texture_EMF_Table.Seg_2_Offset;
	DRVShpTable->Text_EMF_Table.emf_fixextent_neg = VIPShpTable->Texture_EMF_Table.emf_fixextent_neg;
	DRVShpTable->Text_EMF_Table.emf_fixextent_pos = VIPShpTable->Texture_EMF_Table.emf_fixextent_pos;
	DRVShpTable->Text_EMF_Table.tex_share_v_enable = VIPShpTable->Texture_EMF_Table.tex_share_v_enable;
	DRVShpTable->Text_EMF_Table.tex_share_v_blend_wt = VIPShpTable->Texture_EMF_Table.tex_share_v_blend_wt;
	DRVShpTable->Text_EMF_Table.Seg_0_x = VIPShpTable->Texture_EMF_Table.Seg_0_x;
	DRVShpTable->Text_EMF_Table.Seg_1_x = VIPShpTable->Texture_EMF_Table.Seg_1_x;
	DRVShpTable->Text_EMF_Table.Blend_wt = VIPShpTable->Texture_EMF_Table.Blend_wt;
	DRVShpTable->Text_EMF_Table.v5= VIPShpTable->Texture_EMF_Table.v5;
	DRVShpTable->Text_EMF_Table.h11= VIPShpTable->Texture_EMF_Table.h11;
	DRVShpTable->Text_EMF_Table.EMF_texgain = VIPShpTable->Texture_EMF_Table.EMF_texgain;
	/*DRVShpTable->MK3_Table.Mkiii_En = VIPShpTable->TwoD_Peak_AdaptCtrl.Mkiii_En; magellan2 removed*/
	DRVShpTable->MK3_Table.Tex_Filter_Sel = VIPShpTable->TwoD_Peak_AdaptCtrl.Tex_Filter_Sel;
	DRVShpTable->MK3_Table.Edge_Filter_Sel = VIPShpTable->TwoD_Peak_AdaptCtrl2.Edge_Filter_Sel;
	DRVShpTable->MK3_Table.Lpf2d_C0 = VIPShpTable->Mk3_Lpf.C0;
	DRVShpTable->MK3_Table.Lpf2d_C1 = VIPShpTable->Mk3_Lpf.C1;
	DRVShpTable->MK3_Table.Lpf2d_C2 = VIPShpTable->Mk3_Lpf.C2;
	DRVShpTable->MK3_Table.Lpf2d_C3 = VIPShpTable->Mk3_Lpf.C3;
	DRVShpTable->MK3_Table.Lpf2d_C4 = VIPShpTable->Mk3_Lpf.C4;
	DRVShpTable->MK3_Table.Lpf2d_C5 = VIPShpTable->Mk3_Lpf.C5;
	DRVShpTable->MK3_Table.MaxMin_Gain_0 = VIPShpTable->Max_Min_Gain.Gain_0;
	DRVShpTable->MK3_Table.MaxMin_Gain_1 = VIPShpTable->Max_Min_Gain.Gain_1;
	DRVShpTable->MK3_Table.MaxMin_Gain_2 = VIPShpTable->Max_Min_Gain.Gain_2;
	DRVShpTable->MK3_Table.MaxMin_Gain_3 = VIPShpTable->Max_Min_Gain.Gain_3;
	DRVShpTable->MK3_Table.MaxMin_Gain_4 = VIPShpTable->Max_Min_Gain.Gain_4;
	DRVShpTable->MK3_Table.MaxMin_Gain_5 = VIPShpTable->Max_Min_Gain.Gain_5;
	DRVShpTable->MK3_Table.MaxMin_Gain_6 = VIPShpTable->Max_Min_Gain.Gain_6;
	DRVShpTable->MK3_Table.MaxMin_Step_1 = VIPShpTable->Max_Min_Gain.Step_1;
	DRVShpTable->MK3_Table.MaxMin_Step_2 = VIPShpTable->Max_Min_Gain.Step_2;
	DRVShpTable->MK3_Table.MaxMin_Step_3 = VIPShpTable->Max_Min_Gain.Step_3;
	DRVShpTable->MK3_Table.MaxMin_Step_4 = VIPShpTable->Max_Min_Gain.Step_4;
	DRVShpTable->MK3_Table.MaxMin_Step_5 = VIPShpTable->Max_Min_Gain.Step_5;
	DRVShpTable->MK3_Table.MaxMin_Step_6 = VIPShpTable->Max_Min_Gain.Step_6;
	DRVShpTable->MK3_Table.MaxMin_Gain_En = VIPShpTable->Max_Min_Gain.Max_Min_Gain_En;
	DRVShpTable->MK3_Table.max_min_gain_tex_en = VIPShpTable->Max_Min_Gain.max_min_gain_tex_en;
	DRVShpTable->MK3_Table.max_min_gain_edg_en = VIPShpTable->Max_Min_Gain.max_min_gain_edg_en;
	DRVShpTable->MK3_Table.max_min_gain_v_en = VIPShpTable->Max_Min_Gain.max_min_gain_v_en;
	DRVShpTable->MK3_Table.Lpf_Weit_0 = VIPShpTable->Max_Min_Lpf.Weit_0;
	DRVShpTable->MK3_Table.Lpf_Weit_1 = VIPShpTable->Max_Min_Lpf.Weit_1;
	DRVShpTable->MK3_Table.Lpf_Weit_2 = VIPShpTable->Max_Min_Lpf.Weit_2;
	DRVShpTable->MK3_Table.Lpf_Weit_3 = VIPShpTable->Max_Min_Lpf.Weit_3;
	DRVShpTable->MK3_Table.Lpf_Weit_4 = VIPShpTable->Max_Min_Lpf.Weit_4;
	DRVShpTable->MK3_Table.Lpf_Weit_5 = VIPShpTable->Max_Min_Lpf.Weit_5;
	DRVShpTable->MK3_Table.Lpf_Weit_6 = VIPShpTable->Max_Min_Lpf.Weit_6;
	DRVShpTable->MK3_Table.Lpf_Step_1 = VIPShpTable->Max_Min_Lpf.Step_1;
	DRVShpTable->MK3_Table.Lpf_Step_2 = VIPShpTable->Max_Min_Lpf.Step_2;
	DRVShpTable->MK3_Table.Lpf_Step_3 = VIPShpTable->Max_Min_Lpf.Step_3;
	DRVShpTable->MK3_Table.Lpf_Step_4 = VIPShpTable->Max_Min_Lpf.Step_4;
	DRVShpTable->MK3_Table.Lpf_Step_5 = VIPShpTable->Max_Min_Lpf.Step_5;
	DRVShpTable->MK3_Table.Lpf_Step_6 = VIPShpTable->Max_Min_Lpf.Step_6;
	DRVShpTable->MK3_Table.Lpf_Weigh_En = VIPShpTable->Max_Min_Lpf.Weigh_En;
	DRVShpTable->MK3_Table.lpf_weigh_tex_en = VIPShpTable->Max_Min_Lpf.lpf_weigh_tex_en;
	DRVShpTable->MK3_Table.lpf_weigh_edg_en = VIPShpTable->Max_Min_Lpf.lpf_weigh_edg_en;
	DRVShpTable->MK3_Table.Gain_By_Y_Gain_0 = VIPShpTable->Gain_By_Y.Gain_0;
	DRVShpTable->MK3_Table.Gain_By_Y_Gain_1 = VIPShpTable->Gain_By_Y.Gain_1;
	DRVShpTable->MK3_Table.Gain_By_Y_Gain_2 = VIPShpTable->Gain_By_Y.Gain_2;
	DRVShpTable->MK3_Table.Gain_By_Y_Gain_3 = VIPShpTable->Gain_By_Y.Gain_3;
	DRVShpTable->MK3_Table.Gain_By_Y_Gain_4 = VIPShpTable->Gain_By_Y.Gain_4;
	DRVShpTable->MK3_Table.Gain_By_Y_Gain_5 = VIPShpTable->Gain_By_Y.Gain_5;
	DRVShpTable->MK3_Table.Gain_By_Y_Gain_6 = VIPShpTable->Gain_By_Y.Gain_6;
	DRVShpTable->MK3_Table.Gain_By_Y_Step_1 = VIPShpTable->Gain_By_Y.Step_1;
	DRVShpTable->MK3_Table.Gain_By_Y_Step_2 = VIPShpTable->Gain_By_Y.Step_2;
	DRVShpTable->MK3_Table.Gain_By_Y_Step_3 = VIPShpTable->Gain_By_Y.Step_3;
	DRVShpTable->MK3_Table.Gain_By_Y_Step_4 = VIPShpTable->Gain_By_Y.Step_4;
	DRVShpTable->MK3_Table.Gain_By_Y_Step_5 = VIPShpTable->Gain_By_Y.Step_5;
	DRVShpTable->MK3_Table.Gain_By_Y_Step_6 = VIPShpTable->Gain_By_Y.Step_6;
	DRVShpTable->MK3_Table.Gain_By_Y_En = VIPShpTable->Gain_By_Y.Gain_By_Y_En;
	DRVShpTable->MK3_Table.gain_by_y_tex_en = VIPShpTable->Gain_By_Y.gain_by_y_tex_en;
	DRVShpTable->MK3_Table.gain_by_y_edg_en = VIPShpTable->Gain_By_Y.gain_by_y_edg_en;
	DRVShpTable->MK3_Table.gain_by_y_v_en = VIPShpTable->Gain_By_Y.gain_by_y_v_en;
	DRVShpTable->MK3_Table.lv_by_y_enable = VIPShpTable->Gain_By_Y.lv_by_y_enable;
	DRVShpTable->MK3_Table.lv_by_y_tex_enable = VIPShpTable->Gain_By_Y.lv_by_y_tex_enable;
	DRVShpTable->MK3_Table.lv_by_y_edg_enable = VIPShpTable->Gain_By_Y.lv_by_y_edg_enable;
	DRVShpTable->MK3_Table.lv_by_y_v_enable = VIPShpTable->Gain_By_Y.lv_by_y_v_enable;
	DRVShpTable->MK3_Table.lv_by_y_v_edg_enable = VIPShpTable->Gain_By_Y.lv_by_y_v_edg_enable;
	DRVShpTable->TwoD_edg.en_edg= VIPShpTable->Edge_Shp_coef1.en_edg;
	DRVShpTable->TwoD_edg.C0 = VIPShpTable->Edge_Shp_coef1.C0;
	DRVShpTable->TwoD_edg.C1 = VIPShpTable->Edge_Shp_coef1.C1;
	DRVShpTable->TwoD_edg.C2 = VIPShpTable->Edge_Shp_coef1.C2;
	DRVShpTable->TwoD_edg.C3 = VIPShpTable->Edge_Shp_coef1.C3;
	DRVShpTable->TwoD_edg.C4 = VIPShpTable->Edge_Shp_coef1.C4;
	DRVShpTable->TwoD_edg.C5 = VIPShpTable->Edge_Shp_coef1.C5;
	DRVShpTable->TwoD_edg.C6 = VIPShpTable->Edge_Shp_coef1.C6;
	DRVShpTable->TwoD_edg.C7 = VIPShpTable->Edge_Shp_coef1.C7;
	DRVShpTable->TwoD_edg.C8 = VIPShpTable->Edge_Shp_coef1.C8;
	DRVShpTable->TwoD_edg.C9 = VIPShpTable->Edge_Shp_coef1.C9;
	DRVShpTable->TwoD_edg.C10 = VIPShpTable->Edge_Shp_coef1.C10;
	DRVShpTable->TwoD_edg.C0H1 = VIPShpTable->Edge_Shp_coef2.C0;
	DRVShpTable->TwoD_edg.C0H2 = VIPShpTable->Edge_Shp_coef3.C0;
	DRVShpTable->TwoD_edg.C0H3 = VIPShpTable->Edge_Shp_coef4.C0;
	DRVShpTable->TwoD_edg.C0H4 = VIPShpTable->Edge_Shp_coef5.C0;
	DRVShpTable->TwoD_tex.en_tex= VIPShpTable->Texture_Shp_coef1.en_tex;
	DRVShpTable->TwoD_tex.C0 = VIPShpTable->Texture_Shp_coef1.C0;
	DRVShpTable->TwoD_tex.C1 = VIPShpTable->Texture_Shp_coef1.C1;
	DRVShpTable->TwoD_tex.C2 = VIPShpTable->Texture_Shp_coef1.C2;
	DRVShpTable->TwoD_tex.C3 = VIPShpTable->Texture_Shp_coef1.C3;
	DRVShpTable->TwoD_tex.C4 = VIPShpTable->Texture_Shp_coef1.C4;
	DRVShpTable->TwoD_tex.C5 = VIPShpTable->Texture_Shp_coef1.C5;
	DRVShpTable->TwoD_tex.C6 = VIPShpTable->Texture_Shp_coef1.C6;
	DRVShpTable->TwoD_tex.C7 = VIPShpTable->Texture_Shp_coef1.C7;
	DRVShpTable->TwoD_tex.C8 = VIPShpTable->Texture_Shp_coef1.C8;
	DRVShpTable->TwoD_tex.C9 = VIPShpTable->Texture_Shp_coef1.C9;
	DRVShpTable->TwoD_tex.C10 = VIPShpTable->Texture_Shp_coef1.C10;
	DRVShpTable->TwoD_tex.C0H1 = VIPShpTable->Texture_Shp_coef2.C0;
	DRVShpTable->TwoD_tex.C0H2 = VIPShpTable->Texture_Shp_coef3.C0;
	DRVShpTable->TwoD_tex.C0H3 = VIPShpTable->Texture_Shp_coef4.C0;
	DRVShpTable->TwoD_tex.C0H4 = VIPShpTable->Texture_Shp_coef5.C0;
	DRVShpTable->MK3_Table.EdgeCoring_En = VIPShpTable->Edge_Coring.Edge_Coring_En;
	DRVShpTable->MK3_Table.EdgeCoring_Gain_En = VIPShpTable->Edge_Coring.Edge_Gain_En;
	DRVShpTable->MK3_Table.EdgeCoring_DeltaEdge_Ulevel = VIPShpTable->Edge_Coring.DeltaEdge_Ulevel;
	DRVShpTable->MK3_Table.EdgeCoring_Clip = VIPShpTable->Edge_Coring.Edge_Coring_Clip;
	DRVShpTable->MK3_Table.EdgeCoring_Gain_Bound = VIPShpTable->Edge_Coring.Edge_Gain_Bound;
	DRVShpTable->MK3_Table.EdgeCoring_Ser_Range = VIPShpTable->Edge_Coring.Edge_Ser_Range;
	DRVShpTable->MK3_Table.EdgeCoring_Bigedge_Ratio = VIPShpTable->Edge_Coring.Bigedge_Ratio;
	DRVShpTable->MK3_Table.EdgeCoring_Smalledge_Ratio = VIPShpTable->Edge_Coring.Smalledge_Ratio;
	DRVShpTable->MK3_Table.EdgeCoring_Deltaedge_Ratio = VIPShpTable->Edge_Coring.Deltaedge_Ratio;
	DRVShpTable->MK3_Table.EdgeCoring_Smalledge_Ulevel = VIPShpTable->Edge_Coring.Smalledge_Ulevel;
	DRVShpTable->MK3_Table.Edge_Text_blend_en = VIPShpTable->TwoD_Peak_AdaptCtrl2.Edg_Tex_Blending_Lpf_En;
	DRVShpTable->MK3_Table.Edge_Text_blend_filter = VIPShpTable->TwoD_Peak_AdaptCtrl2.Edg_Tex_Blending_Lpf_Filter;
	DRVShpTable->MK3_Table.Edge_Delta_Ext_Range = VIPShpTable->Edge_Coring.Edge_Delta_Ext_Range;/*magellan2*/
	DRVShpTable->MK3_Table.h_lvd_range = VIPShpTable->Edge_Coring.h_lvd_range;
	DRVShpTable->MK3_Table.h_lvd_gaim = VIPShpTable->Edge_Coring.h_lvd_gaim;
	DRVShpTable->MK3_Table.h_lvd_gain = VIPShpTable->Edge_Coring.h_lvd_gain;
	DRVShpTable->MK3_Table.v_lvd_range = VIPShpTable->Edge_Coring.v_lvd_range;
	DRVShpTable->MK3_Table.v_lvd_gaim = VIPShpTable->Edge_Coring.v_lvd_gaim;
	DRVShpTable->MK3_Table.v_lvd_gain = VIPShpTable->Edge_Coring.v_lvd_gain;

	DRVShpTable->MK3_Table.LinearY_LB = VIPShpTable->Y_Remap.LinearY_LB;
	DRVShpTable->MK3_Table.LinearY_UB = VIPShpTable->Y_Remap.LinearY_UB;
	DRVShpTable->MK3_Table.LinearY_LM = VIPShpTable->Y_Remap.LinearY_LM;
	DRVShpTable->MK3_Table.LinearY_UM = VIPShpTable->Y_Remap.LinearY_UM;

	DRVShpTable->MK3_Table.Slope_gain_en = VIPShpTable->Slope_gain_mask.Slope_gain_en;
	DRVShpTable->MK3_Table.dir = VIPShpTable->Slope_gain_mask.dir;
	DRVShpTable->MK3_Table.flat_method = VIPShpTable->Slope_gain_mask.flat_method;
	DRVShpTable->MK3_Table.Gain_boundPos = VIPShpTable->Slope_gain_mask.Gain_boundPos;
	DRVShpTable->MK3_Table.Gain_boundNeg = VIPShpTable->Slope_gain_mask.Gain_boundNeg;
	DRVShpTable->MK3_Table.Gain_extendPos = VIPShpTable->Slope_gain_mask.Gain_externdPos;
	DRVShpTable->MK3_Table.Gain_extendNeg = VIPShpTable->Slope_gain_mask.Gain_externdNeg;
	DRVShpTable->MK3_Table.flat_enable = VIPShpTable->Slope_gain_mask.flat_enable;
	DRVShpTable->MK3_Table.flat_offset = VIPShpTable->Slope_gain_mask.flat_offset;
	DRVShpTable->MK3_Table.flat_gain = VIPShpTable->Slope_gain_mask.flat_gain;
	DRVShpTable->MK3_Table.flat_v_enable = VIPShpTable->Slope_gain_mask.flat_v_enable;
	DRVShpTable->MK3_Table.flat_offset_v = VIPShpTable->Slope_gain_mask.flat_offset_v;
	DRVShpTable->MK3_Table.flat_gain_v = VIPShpTable->Slope_gain_mask.flat_gain_v;

	DRVShpTable->TwoD_Peak_AdaptCtrl.Edge_Mode = VIPShpTable->TwoD_Peak_AdaptCtrl.Edge_Mode;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Sobel_Mode = VIPShpTable->TwoD_Peak_AdaptCtrl.Sobel_Mode;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Edgextrange = VIPShpTable->TwoD_Peak_AdaptCtrl.Edgextrange;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Sobel_Upbnd = VIPShpTable->TwoD_Peak_AdaptCtrl.Sobel_Upbnd;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Sobel_Stepbit = VIPShpTable->TwoD_Peak_AdaptCtrl.Sobel_Stepbit;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Zdiff_Upbnd = VIPShpTable->TwoD_Peak_AdaptCtrl.Zdiff_Upbnd;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Zdiff_Stepbit = VIPShpTable->TwoD_Peak_AdaptCtrl.Zdiff_Stepbit;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Zigsftbit_Reg = VIPShpTable->TwoD_Peak_AdaptCtrl.Zigsftbit_Reg;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Tex_En = VIPShpTable->TwoD_Peak_AdaptCtrl.Tex_En;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Tex_Upbnd = VIPShpTable->TwoD_Peak_AdaptCtrl.Tex_Upbnd;

	DRVShpTable->TwoD_Peak_AdaptCtrl.Hpf_Vpf_Maxmin_En = VIPShpTable->TwoD_Peak_AdaptCtrl.Hpf_Vpf_Maxmin_En;/*magellan2*/
	DRVShpTable->TwoD_Peak_AdaptCtrl.Src_Sel = VIPShpTable->TwoD_Peak_AdaptCtrl.Src_Sel;/*magellan2*/
	// Merlin3 edg & tex sampling point
	DRVShpTable->TwoD_Peak_AdaptCtrl._5x5_h = VIPShpTable->TwoD_Peak_AdaptCtrl._5x5_h;
	DRVShpTable->TwoD_Peak_AdaptCtrl._5x5_v = VIPShpTable->TwoD_Peak_AdaptCtrl._5x5_v;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Tex_Exclude_Smooth = VIPShpTable->TwoD_Peak_AdaptCtrl.Tex_Exclude_Smooth;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Sobel_hspace = VIPShpTable->TwoD_Peak_AdaptCtrl.Sobel_hspace;
	DRVShpTable->TwoD_Peak_AdaptCtrl.Sobel_vspace = VIPShpTable->TwoD_Peak_AdaptCtrl.Sobel_vspace;

	/*magellan2 start*/

	DRVShpTable->Edge_Pos_Curve.G0 = VIPShpTable->Edge_Pos_Curve.G0;
	DRVShpTable->Edge_Pos_Curve.G1 = VIPShpTable->Edge_Pos_Curve.G1;
	DRVShpTable->Edge_Pos_Curve.G2 = VIPShpTable->Edge_Pos_Curve.G2;
	DRVShpTable->Edge_Pos_Curve.G3 = VIPShpTable->Edge_Pos_Curve.G3;
	DRVShpTable->Edge_Pos_Curve.G4 = VIPShpTable->Edge_Pos_Curve.G4;
	DRVShpTable->Edge_Pos_Curve.G5 = VIPShpTable->Edge_Pos_Curve.G5;
	DRVShpTable->Edge_Pos_Curve.G6 = VIPShpTable->Edge_Pos_Curve.G6;
	DRVShpTable->Edge_Pos_Curve.G7 = VIPShpTable->Edge_Pos_Curve.G7;
	DRVShpTable->Edge_Pos_Curve.G8 = VIPShpTable->Edge_Pos_Curve.G8;
	DRVShpTable->Edge_Pos_Curve.G9 = VIPShpTable->Edge_Pos_Curve.G9;
	DRVShpTable->Edge_Pos_Curve.G10 = VIPShpTable->Edge_Pos_Curve.G10;
	DRVShpTable->Edge_Pos_Curve.G11 = VIPShpTable->Edge_Pos_Curve.G11;
	DRVShpTable->Edge_Pos_Curve.G12 = VIPShpTable->Edge_Pos_Curve.G12;
	DRVShpTable->Edge_Pos_Curve.G13 = VIPShpTable->Edge_Pos_Curve.G13;
	DRVShpTable->Edge_Pos_Curve.G14 = VIPShpTable->Edge_Pos_Curve.G14;

	DRVShpTable->Edge_Pos_Curve.S1 = VIPShpTable->Edge_Pos_Curve.S1;
	DRVShpTable->Edge_Pos_Curve.S2 = VIPShpTable->Edge_Pos_Curve.S2;
	DRVShpTable->Edge_Pos_Curve.S3 = VIPShpTable->Edge_Pos_Curve.S3;
	DRVShpTable->Edge_Pos_Curve.S4 = VIPShpTable->Edge_Pos_Curve.S4;
	DRVShpTable->Edge_Pos_Curve.S5 = VIPShpTable->Edge_Pos_Curve.S5;
	DRVShpTable->Edge_Pos_Curve.S6 = VIPShpTable->Edge_Pos_Curve.S6;
	DRVShpTable->Edge_Pos_Curve.S7 = VIPShpTable->Edge_Pos_Curve.S7;
	DRVShpTable->Edge_Pos_Curve.S8 = VIPShpTable->Edge_Pos_Curve.S8;
	DRVShpTable->Edge_Pos_Curve.S9 = VIPShpTable->Edge_Pos_Curve.S9;
	DRVShpTable->Edge_Pos_Curve.S10 = VIPShpTable->Edge_Pos_Curve.S10;
	DRVShpTable->Edge_Pos_Curve.S11 = VIPShpTable->Edge_Pos_Curve.S11;
	DRVShpTable->Edge_Pos_Curve.S12 = VIPShpTable->Edge_Pos_Curve.S12;
	DRVShpTable->Edge_Pos_Curve.S13 = VIPShpTable->Edge_Pos_Curve.S13;
	DRVShpTable->Edge_Pos_Curve.S14 = VIPShpTable->Edge_Pos_Curve.S14;

	DRVShpTable->Edge_Neg_Curve.G0 = VIPShpTable->Edge_Neg_Curve.G0;
	DRVShpTable->Edge_Neg_Curve.G1 = VIPShpTable->Edge_Neg_Curve.G1;
	DRVShpTable->Edge_Neg_Curve.G2 = VIPShpTable->Edge_Neg_Curve.G2;
	DRVShpTable->Edge_Neg_Curve.G3 = VIPShpTable->Edge_Neg_Curve.G3;
	DRVShpTable->Edge_Neg_Curve.G4 = VIPShpTable->Edge_Neg_Curve.G4;
	DRVShpTable->Edge_Neg_Curve.G5 = VIPShpTable->Edge_Neg_Curve.G5;
	DRVShpTable->Edge_Neg_Curve.G6 = VIPShpTable->Edge_Neg_Curve.G6;
	DRVShpTable->Edge_Neg_Curve.G7 = VIPShpTable->Edge_Neg_Curve.G7;
	DRVShpTable->Edge_Neg_Curve.G8 = VIPShpTable->Edge_Neg_Curve.G8;
	DRVShpTable->Edge_Neg_Curve.G9 = VIPShpTable->Edge_Neg_Curve.G9;
	DRVShpTable->Edge_Neg_Curve.G10 = VIPShpTable->Edge_Neg_Curve.G10;
	DRVShpTable->Edge_Neg_Curve.G11 = VIPShpTable->Edge_Neg_Curve.G11;
	DRVShpTable->Edge_Neg_Curve.G12 = VIPShpTable->Edge_Neg_Curve.G12;
	DRVShpTable->Edge_Neg_Curve.G13 = VIPShpTable->Edge_Neg_Curve.G13;
	DRVShpTable->Edge_Neg_Curve.G14 = VIPShpTable->Edge_Neg_Curve.G14;

	DRVShpTable->Edge_Neg_Curve.S1 = VIPShpTable->Edge_Neg_Curve.S1;
	DRVShpTable->Edge_Neg_Curve.S2 = VIPShpTable->Edge_Neg_Curve.S2;
	DRVShpTable->Edge_Neg_Curve.S3 = VIPShpTable->Edge_Neg_Curve.S3;
	DRVShpTable->Edge_Neg_Curve.S4 = VIPShpTable->Edge_Neg_Curve.S4;
	DRVShpTable->Edge_Neg_Curve.S5 = VIPShpTable->Edge_Neg_Curve.S5;
	DRVShpTable->Edge_Neg_Curve.S6 = VIPShpTable->Edge_Neg_Curve.S6;
	DRVShpTable->Edge_Neg_Curve.S7 = VIPShpTable->Edge_Neg_Curve.S7;
	DRVShpTable->Edge_Neg_Curve.S8 = VIPShpTable->Edge_Neg_Curve.S8;
	DRVShpTable->Edge_Neg_Curve.S9 = VIPShpTable->Edge_Neg_Curve.S9;
	DRVShpTable->Edge_Neg_Curve.S10 = VIPShpTable->Edge_Neg_Curve.S10;
	DRVShpTable->Edge_Neg_Curve.S11 = VIPShpTable->Edge_Neg_Curve.S11;
	DRVShpTable->Edge_Neg_Curve.S12 = VIPShpTable->Edge_Neg_Curve.S12;
	DRVShpTable->Edge_Neg_Curve.S13 = VIPShpTable->Edge_Neg_Curve.S13;
	DRVShpTable->Edge_Neg_Curve.S14 = VIPShpTable->Edge_Neg_Curve.S14;
	DRVShpTable->Edge_Neg_Curve.enable = VIPShpTable->Edge_Neg_Curve.enable;

	DRVShpTable->Tex_Pos_Curve.G0 = VIPShpTable->Tex_Pos_Curve.G0;
	DRVShpTable->Tex_Pos_Curve.G1 = VIPShpTable->Tex_Pos_Curve.G1;
	DRVShpTable->Tex_Pos_Curve.G2 = VIPShpTable->Tex_Pos_Curve.G2;
	DRVShpTable->Tex_Pos_Curve.G3 = VIPShpTable->Tex_Pos_Curve.G3;
	DRVShpTable->Tex_Pos_Curve.G4 = VIPShpTable->Tex_Pos_Curve.G4;
	DRVShpTable->Tex_Pos_Curve.G5 = VIPShpTable->Tex_Pos_Curve.G5;
	DRVShpTable->Tex_Pos_Curve.G6 = VIPShpTable->Tex_Pos_Curve.G6;
	DRVShpTable->Tex_Pos_Curve.G7 = VIPShpTable->Tex_Pos_Curve.G7;
	DRVShpTable->Tex_Pos_Curve.G8 = VIPShpTable->Tex_Pos_Curve.G8;
	DRVShpTable->Tex_Pos_Curve.G9 = VIPShpTable->Tex_Pos_Curve.G9;
	DRVShpTable->Tex_Pos_Curve.G10 = VIPShpTable->Tex_Pos_Curve.G10;
	DRVShpTable->Tex_Pos_Curve.G11 = VIPShpTable->Tex_Pos_Curve.G11;
	DRVShpTable->Tex_Pos_Curve.G12 = VIPShpTable->Tex_Pos_Curve.G12;
	DRVShpTable->Tex_Pos_Curve.G13 = VIPShpTable->Tex_Pos_Curve.G13;
	DRVShpTable->Tex_Pos_Curve.G14 = VIPShpTable->Tex_Pos_Curve.G14;

	DRVShpTable->Tex_Pos_Curve.S1 = VIPShpTable->Tex_Pos_Curve.S1;
	DRVShpTable->Tex_Pos_Curve.S2 = VIPShpTable->Tex_Pos_Curve.S2;
	DRVShpTable->Tex_Pos_Curve.S3 = VIPShpTable->Tex_Pos_Curve.S3;
	DRVShpTable->Tex_Pos_Curve.S4 = VIPShpTable->Tex_Pos_Curve.S4;
	DRVShpTable->Tex_Pos_Curve.S5 = VIPShpTable->Tex_Pos_Curve.S5;
	DRVShpTable->Tex_Pos_Curve.S6 = VIPShpTable->Tex_Pos_Curve.S6;
	DRVShpTable->Tex_Pos_Curve.S7 = VIPShpTable->Tex_Pos_Curve.S7;
	DRVShpTable->Tex_Pos_Curve.S8 = VIPShpTable->Tex_Pos_Curve.S8;
	DRVShpTable->Tex_Pos_Curve.S9 = VIPShpTable->Tex_Pos_Curve.S9;
	DRVShpTable->Tex_Pos_Curve.S10 = VIPShpTable->Tex_Pos_Curve.S10;
	DRVShpTable->Tex_Pos_Curve.S11 = VIPShpTable->Tex_Pos_Curve.S11;
	DRVShpTable->Tex_Pos_Curve.S12 = VIPShpTable->Tex_Pos_Curve.S12;
	DRVShpTable->Tex_Pos_Curve.S13 = VIPShpTable->Tex_Pos_Curve.S13;
	DRVShpTable->Tex_Pos_Curve.S14 = VIPShpTable->Tex_Pos_Curve.S14;

	DRVShpTable->Tex_Neg_Curve.G0 = VIPShpTable->Tex_Neg_Curve.G0;
	DRVShpTable->Tex_Neg_Curve.G1 = VIPShpTable->Tex_Neg_Curve.G1;
	DRVShpTable->Tex_Neg_Curve.G2 = VIPShpTable->Tex_Neg_Curve.G2;
	DRVShpTable->Tex_Neg_Curve.G3 = VIPShpTable->Tex_Neg_Curve.G3;
	DRVShpTable->Tex_Neg_Curve.G4 = VIPShpTable->Tex_Neg_Curve.G4;
	DRVShpTable->Tex_Neg_Curve.G5 = VIPShpTable->Tex_Neg_Curve.G5;
	DRVShpTable->Tex_Neg_Curve.G6 = VIPShpTable->Tex_Neg_Curve.G6;
	DRVShpTable->Tex_Neg_Curve.G7 = VIPShpTable->Tex_Neg_Curve.G7;
	DRVShpTable->Tex_Neg_Curve.G8 = VIPShpTable->Tex_Neg_Curve.G8;
	DRVShpTable->Tex_Neg_Curve.G9 = VIPShpTable->Tex_Neg_Curve.G9;
	DRVShpTable->Tex_Neg_Curve.G10 = VIPShpTable->Tex_Neg_Curve.G10;
	DRVShpTable->Tex_Neg_Curve.G11 = VIPShpTable->Tex_Neg_Curve.G11;
	DRVShpTable->Tex_Neg_Curve.G12 = VIPShpTable->Tex_Neg_Curve.G12;
	DRVShpTable->Tex_Neg_Curve.G13 = VIPShpTable->Tex_Neg_Curve.G13;
	DRVShpTable->Tex_Neg_Curve.G14 = VIPShpTable->Tex_Neg_Curve.G14;

	DRVShpTable->Tex_Neg_Curve.S1 = VIPShpTable->Tex_Neg_Curve.S1;
	DRVShpTable->Tex_Neg_Curve.S2 = VIPShpTable->Tex_Neg_Curve.S2;
	DRVShpTable->Tex_Neg_Curve.S3 = VIPShpTable->Tex_Neg_Curve.S3;
	DRVShpTable->Tex_Neg_Curve.S4 = VIPShpTable->Tex_Neg_Curve.S4;
	DRVShpTable->Tex_Neg_Curve.S5 = VIPShpTable->Tex_Neg_Curve.S5;
	DRVShpTable->Tex_Neg_Curve.S6 = VIPShpTable->Tex_Neg_Curve.S6;
	DRVShpTable->Tex_Neg_Curve.S7 = VIPShpTable->Tex_Neg_Curve.S7;
	DRVShpTable->Tex_Neg_Curve.S8 = VIPShpTable->Tex_Neg_Curve.S8;
	DRVShpTable->Tex_Neg_Curve.S9 = VIPShpTable->Tex_Neg_Curve.S9;
	DRVShpTable->Tex_Neg_Curve.S10 = VIPShpTable->Tex_Neg_Curve.S10;
	DRVShpTable->Tex_Neg_Curve.S11 = VIPShpTable->Tex_Neg_Curve.S11;
	DRVShpTable->Tex_Neg_Curve.S12 = VIPShpTable->Tex_Neg_Curve.S12;
	DRVShpTable->Tex_Neg_Curve.S13 = VIPShpTable->Tex_Neg_Curve.S13;
	DRVShpTable->Tex_Neg_Curve.S14 = VIPShpTable->Tex_Neg_Curve.S14;
	DRVShpTable->Tex_Neg_Curve.enable = VIPShpTable->Tex_Neg_Curve.enable;

	DRVShpTable->Vertical.C3 = VIPShpTable->Vertical.C3;
	DRVShpTable->Vertical.C4 = VIPShpTable->Vertical.C4;

	DRVShpTable->V_Pos_Curve.G0 = VIPShpTable->V_Pos_Curve.G0;
	DRVShpTable->V_Pos_Curve.G1 = VIPShpTable->V_Pos_Curve.G1;
	DRVShpTable->V_Pos_Curve.G2 = VIPShpTable->V_Pos_Curve.G2;
	DRVShpTable->V_Pos_Curve.G3 = VIPShpTable->V_Pos_Curve.G3;
	DRVShpTable->V_Pos_Curve.G4 = VIPShpTable->V_Pos_Curve.G4;
	DRVShpTable->V_Pos_Curve.G5 = VIPShpTable->V_Pos_Curve.G5;
	DRVShpTable->V_Pos_Curve.G6 = VIPShpTable->V_Pos_Curve.G6;
	DRVShpTable->V_Pos_Curve.G7 = VIPShpTable->V_Pos_Curve.G7;
	DRVShpTable->V_Pos_Curve.G8 = VIPShpTable->V_Pos_Curve.G8;
	DRVShpTable->V_Pos_Curve.G9 = VIPShpTable->V_Pos_Curve.G9;
	DRVShpTable->V_Pos_Curve.G10 = VIPShpTable->V_Pos_Curve.G10;
	DRVShpTable->V_Pos_Curve.G11 = VIPShpTable->V_Pos_Curve.G11;
	DRVShpTable->V_Pos_Curve.G12 = VIPShpTable->V_Pos_Curve.G12;
	DRVShpTable->V_Pos_Curve.G13 = VIPShpTable->V_Pos_Curve.G13;
	DRVShpTable->V_Pos_Curve.G14 = VIPShpTable->V_Pos_Curve.G14;

	DRVShpTable->V_Pos_Curve.S1 = VIPShpTable->V_Pos_Curve.S1;
	DRVShpTable->V_Pos_Curve.S2 = VIPShpTable->V_Pos_Curve.S2;
	DRVShpTable->V_Pos_Curve.S3 = VIPShpTable->V_Pos_Curve.S3;
	DRVShpTable->V_Pos_Curve.S4 = VIPShpTable->V_Pos_Curve.S4;
	DRVShpTable->V_Pos_Curve.S5 = VIPShpTable->V_Pos_Curve.S5;
	DRVShpTable->V_Pos_Curve.S6 = VIPShpTable->V_Pos_Curve.S6;
	DRVShpTable->V_Pos_Curve.S7 = VIPShpTable->V_Pos_Curve.S7;
	DRVShpTable->V_Pos_Curve.S8 = VIPShpTable->V_Pos_Curve.S8;
	DRVShpTable->V_Pos_Curve.S9 = VIPShpTable->V_Pos_Curve.S9;
	DRVShpTable->V_Pos_Curve.S10 = VIPShpTable->V_Pos_Curve.S10;
	DRVShpTable->V_Pos_Curve.S11 = VIPShpTable->V_Pos_Curve.S11;
	DRVShpTable->V_Pos_Curve.S12 = VIPShpTable->V_Pos_Curve.S12;
	DRVShpTable->V_Pos_Curve.S13 = VIPShpTable->V_Pos_Curve.S13;
	DRVShpTable->V_Pos_Curve.S14 = VIPShpTable->V_Pos_Curve.S14;
	DRVShpTable->V_Pos_Curve.edg_curve_bypass = VIPShpTable->V_Pos_Curve.edg_curve_bypass;

	DRVShpTable->V_Neg_Curve.G0 = VIPShpTable->V_Neg_Curve.G0;
	DRVShpTable->V_Neg_Curve.G1 = VIPShpTable->V_Neg_Curve.G1;
	DRVShpTable->V_Neg_Curve.G2 = VIPShpTable->V_Neg_Curve.G2;
	DRVShpTable->V_Neg_Curve.G3 = VIPShpTable->V_Neg_Curve.G3;
	DRVShpTable->V_Neg_Curve.G4 = VIPShpTable->V_Neg_Curve.G4;
	DRVShpTable->V_Neg_Curve.G5 = VIPShpTable->V_Neg_Curve.G5;
	DRVShpTable->V_Neg_Curve.G6 = VIPShpTable->V_Neg_Curve.G6;
	DRVShpTable->V_Neg_Curve.G7 = VIPShpTable->V_Neg_Curve.G7;
	DRVShpTable->V_Neg_Curve.G8 = VIPShpTable->V_Neg_Curve.G8;
	DRVShpTable->V_Neg_Curve.G9 = VIPShpTable->V_Neg_Curve.G9;
	DRVShpTable->V_Neg_Curve.G10 = VIPShpTable->V_Neg_Curve.G10;
	DRVShpTable->V_Neg_Curve.G11 = VIPShpTable->V_Neg_Curve.G11;
	DRVShpTable->V_Neg_Curve.G12 = VIPShpTable->V_Neg_Curve.G12;
	DRVShpTable->V_Neg_Curve.G13 = VIPShpTable->V_Neg_Curve.G13;
	DRVShpTable->V_Neg_Curve.G14 = VIPShpTable->V_Neg_Curve.G14;

	DRVShpTable->V_Neg_Curve.S1 = VIPShpTable->V_Neg_Curve.S1;
	DRVShpTable->V_Neg_Curve.S2 = VIPShpTable->V_Neg_Curve.S2;
	DRVShpTable->V_Neg_Curve.S3 = VIPShpTable->V_Neg_Curve.S3;
	DRVShpTable->V_Neg_Curve.S4 = VIPShpTable->V_Neg_Curve.S4;
	DRVShpTable->V_Neg_Curve.S5 = VIPShpTable->V_Neg_Curve.S5;
	DRVShpTable->V_Neg_Curve.S6 = VIPShpTable->V_Neg_Curve.S6;
	DRVShpTable->V_Neg_Curve.S7 = VIPShpTable->V_Neg_Curve.S7;
	DRVShpTable->V_Neg_Curve.S8 = VIPShpTable->V_Neg_Curve.S8;
	DRVShpTable->V_Neg_Curve.S9 = VIPShpTable->V_Neg_Curve.S9;
	DRVShpTable->V_Neg_Curve.S10 = VIPShpTable->V_Neg_Curve.S10;
	DRVShpTable->V_Neg_Curve.S11 = VIPShpTable->V_Neg_Curve.S11;
	DRVShpTable->V_Neg_Curve.S12 = VIPShpTable->V_Neg_Curve.S12;
	DRVShpTable->V_Neg_Curve.S13 = VIPShpTable->V_Neg_Curve.S13;
	DRVShpTable->V_Neg_Curve.S14 = VIPShpTable->V_Neg_Curve.S14;
	DRVShpTable->V_Neg_Curve.enable = VIPShpTable->V_Neg_Curve.enable;


	DRVShpTable->After_Filter.C0 = VIPShpTable->After_Filter.C0;
	DRVShpTable->After_Filter.C1 = VIPShpTable->After_Filter.C1;
	DRVShpTable->After_Filter.C2 = VIPShpTable->After_Filter.C2;
	DRVShpTable->After_Filter.C3 = VIPShpTable->After_Filter.C3;
	DRVShpTable->After_Filter.C4 = VIPShpTable->After_Filter.C4;
	DRVShpTable->After_Filter.HPF_Gain = VIPShpTable->After_Filter.HPF_Gain;
	DRVShpTable->After_Filter.Mode = VIPShpTable->After_Filter.Mode;
	DRVShpTable->After_Filter.Enable = VIPShpTable->After_Filter.Enable;
	DRVShpTable->After_Filter.Rgblimit_pos= VIPShpTable->After_Filter.Rgblimit_pos;
	DRVShpTable->After_Filter.Rgblimit_neg= VIPShpTable->After_Filter.Rgblimit_neg;

	DRVShpTable->SR_Control.Period = VIPShpTable->SR_Control.Period;
	DRVShpTable->SR_Control.Gain = VIPShpTable->SR_Control.Gain;
	DRVShpTable->SR_Control.Offset = VIPShpTable->SR_Control.Offset;
	DRVShpTable->SR_Control.Ring_Gen_Gain = VIPShpTable->SR_Control.Ring_Gen_Gain;
	DRVShpTable->SR_Control.Ring_Gen = VIPShpTable->SR_Control.Ring_Gen;

	DRVShpTable->SR_H9.en_tex = VIPShpTable->SR_H9.en_tex;
	DRVShpTable->SR_H9.en_edg = VIPShpTable->SR_H9.en_edg;
	DRVShpTable->SR_H9.C0 = VIPShpTable->SR_H9.C0;
	DRVShpTable->SR_H9.C1 = VIPShpTable->SR_H9.C1;
	DRVShpTable->SR_H9.C2 = VIPShpTable->SR_H9.C2;
	DRVShpTable->SR_H9.C3 = VIPShpTable->SR_H9.C3;
	DRVShpTable->SR_H9.C4 = VIPShpTable->SR_H9.C4;

	DRVShpTable->SR_H13.en_tex = VIPShpTable->SR_H13.en_tex;
	DRVShpTable->SR_H13.en_edg = VIPShpTable->SR_H13.en_edg;
	DRVShpTable->SR_H13.C0 = VIPShpTable->SR_H13.C0;
	DRVShpTable->SR_H13.C1 = VIPShpTable->SR_H13.C1;
	DRVShpTable->SR_H13.C2 = VIPShpTable->SR_H13.C2;
	DRVShpTable->SR_H13.C3 = VIPShpTable->SR_H13.C3;
	DRVShpTable->SR_H13.C4 = VIPShpTable->SR_H13.C4;
	DRVShpTable->SR_H13.C5 = VIPShpTable->SR_H13.C5;
	DRVShpTable->SR_H13.C6 = VIPShpTable->SR_H13.C6;

	DRVShpTable->SR_H21.en_tex = VIPShpTable->SR_H21.en_tex;
	DRVShpTable->SR_H21.en_edg = VIPShpTable->SR_H21.en_edg;
	DRVShpTable->SR_H21.C0 = VIPShpTable->SR_H21.C0;
	DRVShpTable->SR_H21.C1 = VIPShpTable->SR_H21.C1;
	DRVShpTable->SR_H21.C2 = VIPShpTable->SR_H21.C2;
	DRVShpTable->SR_H21.C3 = VIPShpTable->SR_H21.C3;
	DRVShpTable->SR_H21.C4 = VIPShpTable->SR_H21.C4;
	DRVShpTable->SR_H21.C5 = VIPShpTable->SR_H21.C5;
	DRVShpTable->SR_H21.C6 = VIPShpTable->SR_H21.C6;
	DRVShpTable->SR_H21.C7 = VIPShpTable->SR_H21.C7;
	DRVShpTable->SR_H21.C8 = VIPShpTable->SR_H21.C8;
	DRVShpTable->SR_H21.C9 = VIPShpTable->SR_H21.C9;
	DRVShpTable->SR_H21.C10 = VIPShpTable->SR_H21.C10;

	DRVShpTable->SR_V9_1.en_tex = VIPShpTable->SR_V9_1.en_tex;
	DRVShpTable->SR_V9_1.en_edg = VIPShpTable->SR_V9_1.en_edg;
	DRVShpTable->SR_V9_1.C0 = VIPShpTable->SR_V9_1.C0;
	DRVShpTable->SR_V9_1.C1 = VIPShpTable->SR_V9_1.C1;
	DRVShpTable->SR_V9_1.C2 = VIPShpTable->SR_V9_1.C2;
	DRVShpTable->SR_V9_1.C3 = VIPShpTable->SR_V9_1.C3;
	DRVShpTable->SR_V9_1.C4 = VIPShpTable->SR_V9_1.C4;

	DRVShpTable->SR_V9_2.en_tex = VIPShpTable->SR_V9_2.en_tex;
	DRVShpTable->SR_V9_2.en_edg = VIPShpTable->SR_V9_2.en_edg;
	DRVShpTable->SR_V9_2.C0 = VIPShpTable->SR_V9_2.C0;
	DRVShpTable->SR_V9_2.C1 = VIPShpTable->SR_V9_2.C1;
	DRVShpTable->SR_V9_2.C2 = VIPShpTable->SR_V9_2.C2;
	DRVShpTable->SR_V9_2.C3 = VIPShpTable->SR_V9_2.C3;
	DRVShpTable->SR_V9_2.C4 = VIPShpTable->SR_V9_2.C4;

	DRVShpTable->SR_V9_3.en_tex = VIPShpTable->SR_V9_3.en_tex;
	DRVShpTable->SR_V9_3.en_edg = VIPShpTable->SR_V9_3.en_edg;
	DRVShpTable->SR_V9_3.C0 = VIPShpTable->SR_V9_3.C0;
	DRVShpTable->SR_V9_3.C1 = VIPShpTable->SR_V9_3.C1;
	DRVShpTable->SR_V9_3.C2 = VIPShpTable->SR_V9_3.C2;
	DRVShpTable->SR_V9_3.C3 = VIPShpTable->SR_V9_3.C3;
	DRVShpTable->SR_V9_3.C4 = VIPShpTable->SR_V9_3.C4;

	DRVShpTable->SR_Ring_H11.en_tex = VIPShpTable->SR_Ring_H11.en_tex;
	DRVShpTable->SR_Ring_H11.en_edg = VIPShpTable->SR_Ring_H11.en_edg;
	DRVShpTable->SR_Ring_H11.C0 = VIPShpTable->SR_Ring_H11.C0;
	DRVShpTable->SR_Ring_H11.C1 = VIPShpTable->SR_Ring_H11.C1;
	DRVShpTable->SR_Ring_H11.C2 = VIPShpTable->SR_Ring_H11.C2;
	DRVShpTable->SR_Ring_H11.C3 = VIPShpTable->SR_Ring_H11.C3;
	DRVShpTable->SR_Ring_H11.C4 = VIPShpTable->SR_Ring_H11.C4;
	DRVShpTable->SR_Ring_H11.C5 = VIPShpTable->SR_Ring_H11.C5;
	DRVShpTable->SR_Ring_H11.C0H0 = VIPShpTable->SR_Ring_H11.C0H0;
	DRVShpTable->SR_Ring_H11.C0H1 = VIPShpTable->SR_Ring_H11.C0H1;
	DRVShpTable->SR_Ring_H11.C0H2 = VIPShpTable->SR_Ring_H11.C0H2;
	DRVShpTable->SR_Ring_H11.C0H3 = VIPShpTable->SR_Ring_H11.C0H3;

	DRVShpTable->SR_Ring_V9.en_tex = VIPShpTable->SR_Ring_V9.en_tex;
	DRVShpTable->SR_Ring_V9.en_edg = VIPShpTable->SR_Ring_V9.en_edg;
	DRVShpTable->SR_Ring_V9.C0 = VIPShpTable->SR_Ring_V9.C0;
	DRVShpTable->SR_Ring_V9.C1 = VIPShpTable->SR_Ring_V9.C1;
	DRVShpTable->SR_Ring_V9.C2 = VIPShpTable->SR_Ring_V9.C2;
	DRVShpTable->SR_Ring_V9.C3 = VIPShpTable->SR_Ring_V9.C3;
	DRVShpTable->SR_Ring_V9.C4 = VIPShpTable->SR_Ring_V9.C4;
	DRVShpTable->SR_Ring_V9.C0H0 = VIPShpTable->SR_Ring_V9.C0H0;
	DRVShpTable->SR_Ring_V9.C0H1 = VIPShpTable->SR_Ring_V9.C0H1;
	DRVShpTable->SR_Ring_V9.C0H2 = VIPShpTable->SR_Ring_V9.C0H2;
	DRVShpTable->SR_Ring_V9.C0H3 = VIPShpTable->SR_Ring_V9.C0H3;
	/*magellan2 end*/
	DRVShpTable->Sub_Gain_Modify.sub_index_en = VIPShpTable->Sub_Gain_Modify.sub_index_en;
	DRVShpTable->Sub_Gain_Modify.EDG.Gain_Pos = VIPShpTable->Sub_Gain_Modify.EDG_Gain_Pos;
	DRVShpTable->Sub_Gain_Modify.EDG.Gain_Neg = VIPShpTable->Sub_Gain_Modify.EDG_Gain_Neg;
	DRVShpTable->Sub_Gain_Modify.EDG.HV_Pos = VIPShpTable->Sub_Gain_Modify.EDG_HV_Pos;
	DRVShpTable->Sub_Gain_Modify.EDG.HV_Neg = VIPShpTable->Sub_Gain_Modify.EDG_HV_Neg;
	DRVShpTable->Sub_Gain_Modify.EDG.LV = VIPShpTable->Sub_Gain_Modify.EDG_LV;
	DRVShpTable->Sub_Gain_Modify.TEX.Gain_Pos = VIPShpTable->Sub_Gain_Modify.TEX_Gain_Pos;
	DRVShpTable->Sub_Gain_Modify.TEX.Gain_Neg = VIPShpTable->Sub_Gain_Modify.TEX_Gain_Neg;
	DRVShpTable->Sub_Gain_Modify.TEX.HV_Pos = VIPShpTable->Sub_Gain_Modify.TEX_HV_Pos;
	DRVShpTable->Sub_Gain_Modify.TEX.HV_Neg = VIPShpTable->Sub_Gain_Modify.TEX_HV_Neg;
	DRVShpTable->Sub_Gain_Modify.TEX.LV = VIPShpTable->Sub_Gain_Modify.TEX_LV;
	DRVShpTable->Sub_Gain_Modify.V.Gain_Pos = VIPShpTable->Sub_Gain_Modify.V_Gain_Pos;
	DRVShpTable->Sub_Gain_Modify.V.Gain_Neg = VIPShpTable->Sub_Gain_Modify.V_Gain_Neg;
	DRVShpTable->Sub_Gain_Modify.V.HV_Pos = VIPShpTable->Sub_Gain_Modify.V_HV_Pos;
	DRVShpTable->Sub_Gain_Modify.V.HV_Neg = VIPShpTable->Sub_Gain_Modify.V_HV_Neg;
	DRVShpTable->Sub_Gain_Modify.V.LV = VIPShpTable->Sub_Gain_Modify.V_LV;
	DRVShpTable->Sub_Gain_Modify.V_EDG.Gain_Pos = VIPShpTable->Sub_Gain_Modify.V_EDG_Gain_Pos;
	DRVShpTable->Sub_Gain_Modify.V_EDG.Gain_Neg = VIPShpTable->Sub_Gain_Modify.V_EDG_Gain_Neg;
	DRVShpTable->Sub_Gain_Modify.V_EDG.HV_Pos = VIPShpTable->Sub_Gain_Modify.V_EDG_HV_Pos;
	DRVShpTable->Sub_Gain_Modify.V_EDG.HV_Neg = VIPShpTable->Sub_Gain_Modify.V_EDG_HV_Neg;
	DRVShpTable->Sub_Gain_Modify.V_EDG.LV = VIPShpTable->Sub_Gain_Modify.V_EDG_LV;

	DRVShpTable->SEGPK_ISE.ise_en = VIPShpTable->SEGPK_ISE.ise_en;
	DRVShpTable->SEGPK_ISE.ise_step = VIPShpTable->SEGPK_ISE.ise_step;
	DRVShpTable->SEGPK_ISE.ise_scale = VIPShpTable->SEGPK_ISE.ise_scale;
	DRVShpTable->SEGPK_ISE.ise_ub = VIPShpTable->SEGPK_ISE.ise_ub;
	DRVShpTable->SEGPK_ISE.ise_h_st = VIPShpTable->SEGPK_ISE.ise_h_st;
	DRVShpTable->SEGPK_ISE.ise_h_end = VIPShpTable->SEGPK_ISE.ise_h_end;
	DRVShpTable->SEGPK_ISE.ise_v_st = VIPShpTable->SEGPK_ISE.ise_v_st;
	DRVShpTable->SEGPK_ISE.ise_v_end = VIPShpTable->SEGPK_ISE.ise_v_end;
	DRVShpTable->SEGPK_ISE.ise_mul_max = VIPShpTable->SEGPK_ISE.ise_mul_max;
	DRVShpTable->SEGPK_ISE.ise_mul_min = VIPShpTable->SEGPK_ISE.ise_mul_min;

	DRVShpTable->Texture_Flat_Shp.en_tex= VIPShpTable->Texture_Flat_Shp_coef1.en_tex;
	DRVShpTable->Texture_Flat_Shp.C0 = VIPShpTable->Texture_Flat_Shp_coef1.C0;
	DRVShpTable->Texture_Flat_Shp.C1 = VIPShpTable->Texture_Flat_Shp_coef1.C1;
	DRVShpTable->Texture_Flat_Shp.C2 = VIPShpTable->Texture_Flat_Shp_coef1.C2;
	DRVShpTable->Texture_Flat_Shp.C3 = VIPShpTable->Texture_Flat_Shp_coef1.C3;
	DRVShpTable->Texture_Flat_Shp.C0H1= VIPShpTable->Texture_Flat_Shp_coef2.C0;
	DRVShpTable->Texture_Flat_Shp.C0H2= VIPShpTable->Texture_Flat_Shp_coef3.C0;

	memcpy(&(DRVShpTable->Ramp_H),&(VIPShpTable->Ramp_H),sizeof(VIP_SEGPK_RAMP));
	memcpy(&(DRVShpTable->Ramp_V),&(VIPShpTable->Ramp_V),sizeof(VIP_SEGPK_RAMP));
	memcpy(&(DRVShpTable->SR_X),&(VIPShpTable->SR_X),sizeof(VIP_SR_H21));
}

void fwif_color_set_shp_vgain(unsigned char src_idx, unsigned char value)
{
	drvif_color_Sharpness_Vertical_Gain_adjust(_MAIN_DISPLAY,  value);
}



void fwif_color_set_cds_table(unsigned char src_idx, unsigned char TableIdx)
{
	VIP_CDS_Table CDS_Table;

	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	if (TableIdx < Sharp_table_num)	/* bypass = 255*/
	memcpy(&CDS_Table, &(gVip_Table->CDS_ini[TableIdx]), sizeof(VIP_CDS_Table));


	drvif_color_set_cds_table((VIP_CDS_Table *) (&CDS_Table));


}

unsigned char lastLUT_tbl_index = 0xff;
void fwif_color_set_3dLUT(UINT8 TableIdx)
{
	unsigned int *LUT3D = NULL;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	unsigned char onlyEnable = 0;
	if (gVip_Table == NULL)
		return;

	if (TableIdx > 0 && TableIdx <= LUT3D_TBL_Num) { /* bypass = 0*/
		LUT3D = gVip_Table->LUT_3D[TableIdx - 1];
		if (lastLUT_tbl_index == TableIdx - 1)
			onlyEnable = 1;
		else
			lastLUT_tbl_index = TableIdx - 1;
	}else{
		LUT3D = gVip_Table->LUT_3D[0];
	}

	if(!drvif_scalerdisplay_get_force_bg_status() && Scaler_DispGetInputInfoByDisp(SLR_MAIN_DISPLAY, SLR_INPUT_STATE) == _MODE_STATE_ACTIVE)
		fwif_color_WaitFor_DEN_STOP_UZUDTG();

	if (TableIdx == 0)	//disable
		drvif_color_D_3dLUT(0, LUT3D);
	else {
		if (onlyEnable)
			drvif_color_D_3dLUT_Enable(1);
		else
			drvif_color_D_3dLUT(1, LUT3D);
	}
}



void fwif_color_set_unsharp_mask_driver(unsigned char src_idx, unsigned char value)
{
	extern DRV_Un_Shp_Mask gVipUn_Shp_Mask[16];
	DRV_Un_Shp_Mask gVipUn_Shp_Mask_disable = {0};

	if (value >= sizeof(gVipUn_Shp_Mask)/sizeof(DRV_Un_Shp_Mask))
		drvif_color_sharpness_unsharp_mask(&gVipUn_Shp_Mask_disable);
	else
	drvif_color_sharpness_unsharp_mask(&gVipUn_Shp_Mask[value]);
}



void fwif_color_set_egsm_postshp_level_driver(unsigned char src_idx, unsigned char value)/*this function control postshp level*/
{
	drvif_color_edgesmooth_postshp_adjust(_MAIN_DISPLAY, value);
}

#ifdef ENABLE_SUPER_RESOLUTION
void fwif_color_set_SuperResolution_init_table(unsigned char value)
{
	drv_SuperResolution_init_table(value);
}
#endif

void fwif_color_set_dismd_driver(unsigned char src_idx, unsigned char value)
{
	extern DRV_di_smd_table_t gSMDtable[7];
	DRV_di_smd_table_t gSMDtable_disable = {{0}};

	if (value >= sizeof(gSMDtable)/sizeof(DRV_di_smd_table_t))
		drvif_color_smd_table(&gSMDtable_disable);
	else
	drvif_color_smd_table(&gSMDtable[value]);
}

void fwif_color_set_emf_mk2_driver(unsigned char src_idx, unsigned char value)
{
	extern DRV_EMFMk2 gVipEmfMk2[11];
	DRV_EMFMk2 gVipEmfMk2_disable = {0};

	if (value >= sizeof(gVipEmfMk2)/sizeof(DRV_EMFMk2))
		drvif_color_emfmk2(&gVipEmfMk2_disable);
	else
	drvif_color_emfmk2(&gVipEmfMk2[value]);
}

void fwif_color_set_shp_2Dpk_Seg(unsigned char src_idx, unsigned char value)
{
	extern DRV_2Dpk_Seg gVip2Dpk_Seg[];

	drvif_color_2dpk_seg(&gVip2Dpk_Seg[value]);

}

void fwif_color_set_shp_2Dpk_Tex_Detect(unsigned char src_idx, unsigned char value)
{
	extern DRV_2Dpk_Tex_Detect gVip2Dpk_Tex_Detect[];

	drvif_color_2dpk_tex_detect(&gVip2Dpk_Tex_Detect[value]);
}

void fwif_color_set_TwoD_peaking_AdaptiveCtrl(unsigned char src_idx, unsigned char value)
{
	drvif_color_TwoD_peaking_AdaptiveCtrl(_MAIN_DISPLAY, value);
}


void fwif_color_set_ma_BTR(unsigned char src_idx, unsigned char value)
{
	drvif_color_ma_BTR(value);
}


void fwif_color_set_ma_BER(unsigned char src_idx, unsigned char value)
{
	drvif_color_ma_BER(value);
}

void fwif_color_ma_init(void) /* when turning on auto MA (OSD)*/
{
	/*Deinterlace only Main*/
	/* Thur modified 20090114
	DI_Control_Register_RBUS reg18061000_Reg;
	Frame_Motion_Detector_Threshold_A_RBUS reg18061080_Reg;
	Frame_Motion_Detector_Threshold_B_RBUS reg18061084_Reg;
	Frame_Motion_Detector_Threshold_C_RBUS reg18061088_Reg;
	Field_Teeth_Detector_Threshold_A_RBUS reg1806108c_Reg;
	Field_Teeth_Detector_Threshold_B_and_Anti_CC_and_Still_Logo_RBUS reg18061090_Reg;
	Sawtooth__Threshold_RBUS reg18061094_Reg;
	Compensation_Threshold_A_RBUS reg18061098_Reg;
	Compensation_Threshold_B_RBUS reg1806109c_Reg;
	*/
	histogram_ich1_hist_in_cselect_RBUS		ich1_hist_in_cselect_reg;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("fwif_color_ma_init error!! VIP_system_info_structure_table NULL!!\n");
	} else {
		VIPprintf("fwif_color_ma_init\n");
	}

	Scaler_SetMADI_INIT();


	/* LearnRPG new algo on LV*/
	drvif_color_ma_HFD(1);
	drvif_color_ma_TeethCheck(0);

	ich1_hist_in_cselect_reg.regValue = IoReg_Read32(HISTOGRAM_ICH1_Hist_IN_CSELECT_reg);
	ich1_hist_in_cselect_reg.ch1_his_updatelockmode_en = 0;/*disable for histogram lock, 20130314, CSFC*/
	IoReg_Write32(HISTOGRAM_ICH1_Hist_IN_CSELECT_reg, ich1_hist_in_cselect_reg.regValue);



	drvif_color_ma_BTR(1);

	#if defined(PQ_TV005_Style) /* TSB style : do not use pan detection*/
	drvif_color_ma_Pan_Detection(0);
	#else
	drvif_color_ma_Pan_Detection(1);
	#endif
	drvif_color_ma_Pan_Detection(1);

	Scaler_SetMADI_HME(6);
	Scaler_SetMADI_HMC(6);

//	Scaler_SetMA_Chroma_Error(1); // merlin4 remove

// chen 170522
//	drvif_color_ZOOM_MOTION_En(0);
//	drvif_color_ZOOM_MOTION_Level(1);
// end chen 170522
	/*vif_color_ZOOM_MOTION_En(1);*/
// chen 180308 remove
	//drvif_color_SLOW_MOTION_Level(2);
// end chen 180308

	/*vif_color_SLOW_MOTION_En(1);*/

	/*drvif_color_ma_444_and_422_mode(3, 0);*/
}

/*chen 0716*/
void fwif_color_set_rtnr_masnr_driver(unsigned char src_idx, unsigned char value)
{
	/*integrate gVipRtnr_Masnr to manual table*/
	#if 0
	extern DRV_Rtnr_Masnr gVipRtnr_Masnr[];

	drvif_color_DRV_RTNR_MASNR(&gVipRtnr_Masnr[value]);
	#endif
}



/*end chen 0716*/


/*
unsigned int  fwif_color_regRTNR_Noise_measure(DRV_NM_Table *ptr)
{
	if (!ptr)
		return FALSE;
		NM_TABLE = ptr;
	return TRUE;
}


void fwif_color_set_RTNR_Noise_Measure(unsigned char display, unsigned char value)
{
	drvif_color_RTNR_Noise_Measure_flow(NM_TABLE+value);
}
*/


/*Level 0~5*/
void fwif_color_set_RTNR_Noise_Measure_flow(unsigned char display, unsigned char value)
{
	extern DRV_rtnr_nm_thd_t gRtnrNmThd[NM_LEVEL];
	extern DRV_rtnr_nm_ctrl_t gRtnrNmCtrl[2];
	DRV_rtnr_nm_thd_t nm_thd;
	DRV_rtnr_nm_ctrl_t nm_ctrl;
	unsigned char value_tmp;
	value_tmp = (value > 5) ? 5 : value;
	//value_tmp = (value < 0) ? 0 : value;

	/*drvif_color_DRV_NM_Init(value_tmp);*/

	nm_ctrl.main_enable = gRtnrNmCtrl[0].main_enable;
	nm_ctrl.start = gRtnrNmCtrl[0].start;
	nm_ctrl.ref_y_en = gRtnrNmCtrl[0].ref_y_en;
	nm_ctrl.fw_yref = gRtnrNmCtrl[0].fw_yref;
	nm_ctrl.fw_ydiff = gRtnrNmCtrl[0].fw_ydiff;
	nm_ctrl.pixmove_en = gRtnrNmCtrl[0].pixmove_en;
	nm_ctrl.varsel = gRtnrNmCtrl[0].varsel;
	nm_ctrl.debug_conti = gRtnrNmCtrl[0].debug_conti;
	nm_ctrl.samplingbit = gRtnrNmCtrl[0].samplingbit;
	nm_ctrl.topmargin = gRtnrNmCtrl[0].topmargin;
	nm_ctrl.bottommargin = gRtnrNmCtrl[0].bottommargin;
	nm_ctrl.leftmargin = gRtnrNmCtrl[0].leftmargin;
	nm_ctrl.rightmargin = gRtnrNmCtrl[0].rightmargin;

	nm_thd.vardiff_thd = gRtnrNmThd[value_tmp].vardiff_thd;
	nm_thd.varhigh_thd = gRtnrNmThd[value_tmp].varhigh_thd;
	nm_thd.varlow_thd = gRtnrNmThd[value_tmp].varlow_thd;
	nm_thd.meandiff_thd = gRtnrNmThd[value_tmp].meandiff_thd;
	nm_thd.noiselevel_thd0 = gRtnrNmThd[value_tmp].noiselevel_thd0;
	nm_thd.noiselevel_thd1 = gRtnrNmThd[value_tmp].noiselevel_thd1;
	nm_thd.noiselevel_thd2 = gRtnrNmThd[value_tmp].noiselevel_thd2;
	nm_thd.noiselevel_thd3 = gRtnrNmThd[value_tmp].noiselevel_thd3;
	nm_thd.noiselevel_thd4 = gRtnrNmThd[value_tmp].noiselevel_thd4;
	nm_thd.noiselevel_thd5 = gRtnrNmThd[value_tmp].noiselevel_thd5;
	nm_thd.noiselevel_thd6 = gRtnrNmThd[value_tmp].noiselevel_thd6;
	nm_thd.noiselevel_thd7 = gRtnrNmThd[value_tmp].noiselevel_thd7;
	nm_thd.noiselevel_thd8 = gRtnrNmThd[value_tmp].noiselevel_thd8;
	nm_thd.noiselevel_thd9 = gRtnrNmThd[value_tmp].noiselevel_thd9;
	nm_thd.noiselevel_thd10 = gRtnrNmThd[value_tmp].noiselevel_thd10;
	nm_thd.noiselevel_thd11 = gRtnrNmThd[value_tmp].noiselevel_thd11;
	nm_thd.noiselevel_thd12 = gRtnrNmThd[value_tmp].noiselevel_thd12;
	nm_thd.noiselevel_thd13 = gRtnrNmThd[value_tmp].noiselevel_thd13;
	nm_thd.noiselevel_thd14 = gRtnrNmThd[value_tmp].noiselevel_thd14;

//	drvif_color_DRV_NM_Init((DRV_rtnr_nm_ctrl_t *)&nm_ctrl, (DRV_rtnr_nm_thd_t *)&nm_thd);

}

void fwif_set_color_MADI_HMC(unsigned char src_idx, unsigned char level)
{
	extern DRV_di_ma_hmc_table gHMCTable[gHMCTable_MAX];
	DRV_di_ma_hmc_table hmcTableHere;

	if (level >= gHMCTable_MAX)
		level = 0;

	hmcTableHere = gHMCTable[level];
/*
	hmcTableHere.di_ma_hmc_main_control.hmc_en = gHMCTable[level].di_ma_hmc_main_control.hmc_en;
	hmcTableHere.di_ma_hmc_main_control.ma_horicomth = gHMCTable[level].di_ma_hmc_main_control.ma_horicomth;
	hmcTableHere.di_ma_hmc_main_control.hmc_follow_MA_en = gHMCTable[level].di_ma_hmc_main_control.hmc_follow_MA_en;
	hmcTableHere.di_ma_hmc_main_control.hmc_half_mv_blending_en = gHMCTable[level].di_ma_hmc_main_control.hmc_half_mv_blending_en;
	hmcTableHere.di_ma_hmc_main_control.hmc_odd_mv_no_comp_en = gHMCTable[level].di_ma_hmc_main_control.hmc_odd_mv_no_comp_en;
	hmcTableHere.di_ma_hmc_main_control.hmc_even_mv_no_teeth_en = gHMCTable[level].di_ma_hmc_main_control.hmc_even_mv_no_teeth_en;
	hmcTableHere.di_ma_hmc_main_control.hmc_window_en = gHMCTable[level].di_ma_hmc_main_control.hmc_window_en;
	hmcTableHere.di_ma_hmc_main_control.hmc_window_top = gHMCTable[level].di_ma_hmc_main_control.hmc_window_top;
	hmcTableHere.di_ma_hmc_main_control.hmc_window_bot = gHMCTable[level].di_ma_hmc_main_control.hmc_window_bot;
	hmcTableHere.di_ma_hmc_main_control.hmc_window_start_line = gHMCTable[level].di_ma_hmc_main_control.hmc_window_start_line;

	hmcTableHere.di_ma_hmc_mv_refine.mv_refine_en = gHMCTable[level].di_ma_hmc_mv_refine.mv_refine_en;
	hmcTableHere.di_ma_hmc_mv_refine.mv_refine_subPx_en = gHMCTable[level].di_ma_hmc_mv_refine.mv_refine_subPx_en;
	hmcTableHere.di_ma_hmc_mv_refine.mv_refine_Y_thd = gHMCTable[level].di_ma_hmc_mv_refine.mv_refine_Y_thd;
	hmcTableHere.di_ma_hmc_mv_refine.mv_refine_subPx_Y_thd = gHMCTable[level].di_ma_hmc_mv_refine.mv_refine_subPx_Y_thd;
	hmcTableHere.di_ma_hmc_mv_refine.mv_refine_curMotion_en = gHMCTable[level].di_ma_hmc_mv_refine.mv_refine_curMotion_en;
	hmcTableHere.di_ma_hmc_mv_refine.mv_refine_curMotion_thd = gHMCTable[level].di_ma_hmc_mv_refine.mv_refine_curMotion_thd;
	hmcTableHere.di_ma_hmc_mv_refine.mv_refine_sobel_en = gHMCTable[level].di_ma_hmc_mv_refine.mv_refine_sobel_en;
	hmcTableHere.di_ma_hmc_mv_refine.mv_refine_sobel_diff_thd = gHMCTable[level].di_ma_hmc_mv_refine.mv_refine_sobel_diff_thd;
	hmcTableHere.di_ma_hmc_mv_refine.mv_refine_sobel_nonEdge_thd = gHMCTable[level].di_ma_hmc_mv_refine.mv_refine_sobel_nonEdge_thd;

	hmcTableHere.di_ma_hmc_morphology.en = gHMCTable[level].di_ma_hmc_morphology.en;
	hmcTableHere.di_ma_hmc_morphology.hh_h_thd = gHMCTable[level].di_ma_hmc_morphology.hh_h_thd;
	hmcTableHere.di_ma_hmc_morphology.hh_v_thd = gHMCTable[level].di_ma_hmc_morphology.hh_v_thd;
	hmcTableHere.di_ma_hmc_morphology.noise_thd = gHMCTable[level].di_ma_hmc_morphology.noise_thd;
	hmcTableHere.di_ma_hmc_morphology.same_1_thd = gHMCTable[level].di_ma_hmc_morphology.same_1_thd;
	hmcTableHere.di_ma_hmc_morphology.same_2_thd = gHMCTable[level].di_ma_hmc_morphology.same_2_thd;
	hmcTableHere.di_ma_hmc_morphology.same_hh_1_thd = gHMCTable[level].di_ma_hmc_morphology.same_hh_1_thd;
	hmcTableHere.di_ma_hmc_morphology.zero_1_thd = gHMCTable[level].di_ma_hmc_morphology.zero_1_thd;
	hmcTableHere.di_ma_hmc_morphology.zero_2_thd = gHMCTable[level].di_ma_hmc_morphology.zero_2_thd;
	hmcTableHere.di_ma_hmc_morphology.zero_hh_1_thd = gHMCTable[level].di_ma_hmc_morphology.zero_hh_1_thd;

	hmcTableHere.di_ma_hmc_dynamic_control.clip_en = gHMCTable[level].di_ma_hmc_dynamic_control.clip_en;
	hmcTableHere.di_ma_hmc_dynamic_control.clip_max_thd = gHMCTable[level].di_ma_hmc_dynamic_control.clip_max_thd;
	hmcTableHere.di_ma_hmc_dynamic_control.clip_min_thd = gHMCTable[level].di_ma_hmc_dynamic_control.clip_min_thd;
	hmcTableHere.di_ma_hmc_dynamic_control.thd_bias = gHMCTable[level].di_ma_hmc_dynamic_control.thd_bias;
	hmcTableHere.di_ma_hmc_dynamic_control.thd_en = gHMCTable[level].di_ma_hmc_dynamic_control.thd_en;

	hmcTableHere.di_ma_hmc_mv_correct.correct_en	= gHMCTable[level].di_ma_hmc_mv_correct.correct_en;
	hmcTableHere.di_ma_hmc_mv_correct.energy_bias	= gHMCTable[level].di_ma_hmc_mv_correct.energy_bias;
	hmcTableHere.di_ma_hmc_mv_correct.pre_diff_th	= gHMCTable[level].di_ma_hmc_mv_correct.pre_diff_th;
	hmcTableHere.di_ma_hmc_mv_correct.nxt_diff_th 	= gHMCTable[level].di_ma_hmc_mv_correct.nxt_diff_th;
	hmcTableHere.di_ma_hmc_mv_correct.weight1		= gHMCTable[level].di_ma_hmc_mv_correct.weight1;
	hmcTableHere.di_ma_hmc_mv_correct.weight2 		= gHMCTable[level].di_ma_hmc_mv_correct.weight2;
	hmcTableHere.di_ma_hmc_mv_correct.weight3 		= gHMCTable[level].di_ma_hmc_mv_correct.weight3;
	hmcTableHere.di_ma_hmc_mv_correct.weight4 		= gHMCTable[level].di_ma_hmc_mv_correct.weight4;
	hmcTableHere.di_ma_hmc_mv_correct.energy_th1 	= gHMCTable[level].di_ma_hmc_mv_correct.energy_th1;
	hmcTableHere.di_ma_hmc_mv_correct.energy_th2 	= gHMCTable[level].di_ma_hmc_mv_correct.energy_th2;
	hmcTableHere.di_ma_hmc_mv_correct.energy_th3 	= gHMCTable[level].di_ma_hmc_mv_correct.energy_th3;

	hmcTableHere.di_ma_hmc_mv_energy_check.energy_check_en 	= gHMCTable[level].di_ma_hmc_mv_energy_check.energy_check_en;
	hmcTableHere.di_ma_hmc_mv_energy_check.check_pre_th 	= gHMCTable[level].di_ma_hmc_mv_energy_check.check_pre_th;
	hmcTableHere.di_ma_hmc_mv_energy_check.check_nxt_th 	= gHMCTable[level].di_ma_hmc_mv_energy_check.check_nxt_th;
	hmcTableHere.di_ma_hmc_mv_energy_check.check_pre_gain 	= gHMCTable[level].di_ma_hmc_mv_energy_check.check_pre_gain;
	hmcTableHere.di_ma_hmc_mv_energy_check.check_nxt_gain 	= gHMCTable[level].di_ma_hmc_mv_energy_check.check_nxt_gain;

	hmcTableHere.di_ma_hmc_mv_teeth_check.allTeethCheck_en 	= gHMCTable[level].di_ma_hmc_mv_teeth_check.allTeethCheck_en;
	hmcTableHere.di_ma_hmc_mv_teeth_check.all_teeth_th		= gHMCTable[level].di_ma_hmc_mv_teeth_check.all_teeth_th;
	hmcTableHere.di_ma_hmc_mv_teeth_check.notTeethRecover_en= gHMCTable[level].di_ma_hmc_mv_teeth_check.notTeethRecover_en;
	hmcTableHere.di_ma_hmc_mv_teeth_check.notTeeth_Hline_th	= gHMCTable[level].di_ma_hmc_mv_teeth_check.notTeeth_Hline_th;
	hmcTableHere.di_ma_hmc_mv_teeth_check.notTeeth_Dline_th = gHMCTable[level].di_ma_hmc_mv_teeth_check.notTeeth_Dline_th;
*/
	drvif_color_ma_HMC((DRV_di_ma_hmc_table *)(&hmcTableHere));
}

void fwif_set_color_MADI_HME(unsigned char src_idx, unsigned char level)
{
	extern DRV_di_ma_hme_table gHMETable[gHMETable_MAX];
	DRV_di_ma_hme_table hmeTableHere;

	if (level >= gHMETable_MAX)
		level = 0;

	//hmeTableHere.di_ma_hme_prefer_even_mv.en = gHMETable[level].di_ma_hme_prefer_even_mv.en;
	//hmeTableHere.di_ma_hme_prefer_even_mv.ratio = gHMETable[level].di_ma_hme_prefer_even_mv.ratio;

	hmeTableHere.di_ma_hme_avoid_RL.en = gHMETable[level].di_ma_hme_avoid_RL.en;
	hmeTableHere.di_ma_hme_avoid_RL.Nedge = gHMETable[level].di_ma_hme_avoid_RL.Nedge;
	hmeTableHere.di_ma_hme_avoid_RL.RLedge = gHMETable[level].di_ma_hme_avoid_RL.RLedge;

	hmeTableHere.di_ma_hme_ref_y.en = gHMETable[level].di_ma_hme_ref_y.en;
	hmeTableHere.di_ma_hme_ref_y.thd0 = gHMETable[level].di_ma_hme_ref_y.thd0;
	hmeTableHere.di_ma_hme_ref_y.thd1 = gHMETable[level].di_ma_hme_ref_y.thd1;
	hmeTableHere.di_ma_hme_ref_y.thd2 = gHMETable[level].di_ma_hme_ref_y.thd2;
	hmeTableHere.di_ma_hme_ref_y.bias1 = gHMETable[level].di_ma_hme_ref_y.bias1;
	hmeTableHere.di_ma_hme_ref_y.bias2 = gHMETable[level].di_ma_hme_ref_y.bias2;
	hmeTableHere.di_ma_hme_ref_y.bias3 = gHMETable[level].di_ma_hme_ref_y.bias3;

	hmeTableHere.di_ma_hme_invalid_check.chck_1_en = gHMETable[level].di_ma_hme_invalid_check.chck_1_en;
	hmeTableHere.di_ma_hme_invalid_check.chck_2_en = gHMETable[level].di_ma_hme_invalid_check.chck_2_en;
	hmeTableHere.di_ma_hme_invalid_check.zeroMV_en = gHMETable[level].di_ma_hme_invalid_check.zeroMV_en;
	hmeTableHere.di_ma_hme_invalid_check.cnt = gHMETable[level].di_ma_hme_invalid_check.cnt;
	hmeTableHere.di_ma_hme_invalid_check.maxmin_thd = gHMETable[level].di_ma_hme_invalid_check.maxmin_thd;

	hmeTableHere.di_ma_hme_decision.min = gHMETable[level].di_ma_hme_decision.min;
	hmeTableHere.di_ma_hme_decision.x_conti_cnt = gHMETable[level].di_ma_hme_decision.x_conti_cnt;
	hmeTableHere.di_ma_hme_decision.line_ratio = gHMETable[level].di_ma_hme_decision.line_ratio;
	hmeTableHere.di_ma_hme_decision.max_abs = gHMETable[level].di_ma_hme_decision.max_abs;
	hmeTableHere.di_ma_hme_decision.sum_max_ratio = gHMETable[level].di_ma_hme_decision.sum_max_ratio;

	//hmeTableHere.DI_HMC_ME_REFINE_CTRL_1 = gHMETable[level].DI_HMC_ME_REFINE_CTRL_1; // merlin4 remove

	hmeTableHere.di_ma_hmc_blending_with_MA.bMA_en =gHMETable[level].di_ma_hmc_blending_with_MA.bMA_en;
	hmeTableHere.di_ma_hmc_blending_with_MA.bMA_gain_en =gHMETable[level].di_ma_hmc_blending_with_MA.bMA_gain;
	hmeTableHere.di_ma_hmc_blending_with_MA.bMA_gain_factor =gHMETable[level].di_ma_hmc_blending_with_MA.bMA_gain_factor;
	hmeTableHere.di_ma_hmc_blending_with_MA.bMA_gain =gHMETable[level].di_ma_hmc_blending_with_MA.bMA_gain;
	hmeTableHere.di_ma_hmc_blending_with_MA.bMA_line_t_en =gHMETable[level].di_ma_hmc_blending_with_MA.bMA_line_t_en;
	hmeTableHere.di_ma_hmc_blending_with_MA.bMA_line_t_cnt =gHMETable[level].di_ma_hmc_blending_with_MA.bMA_line_t_cnt;
	hmeTableHere.di_ma_hmc_blending_with_MA.bMA_line_t_factor =gHMETable[level].di_ma_hmc_blending_with_MA.bMA_line_t_factor;

	drvif_color_ma_HME((DRV_di_ma_hme_table *)(&hmeTableHere));
}

void fwif_set_color_MADI_PAN(unsigned char src_idx, unsigned char level)
{
	extern DRV_di_ma_pan_table gPanTable[gPANTable_MAX];
	DRV_di_ma_pan_table panTableHere;

	if (level >= gPANTable_MAX)
		level = 0;

	panTableHere.di_ma_pan_control.pan_en = gPanTable[level].di_ma_pan_control.pan_en;
	panTableHere.di_ma_pan_control.force_comp_en = gPanTable[level].di_ma_pan_control.force_comp_en;
	panTableHere.di_ma_pan_control.pan_mc_rls_en = gPanTable[level].di_ma_pan_control.pan_mc_rls_en;
	panTableHere.di_ma_pan_control.sub_px_det_en = gPanTable[level].di_ma_pan_control.sub_px_det_en;
	panTableHere.di_ma_pan_control.pan_mc_adpative_en = gPanTable[level].di_ma_pan_control.pan_mc_adpative_en;
	panTableHere.di_ma_pan_control.pan_mc_teeth_check_en = gPanTable[level].di_ma_pan_control.pan_mc_teeth_check_en;
	panTableHere.di_ma_pan_control.pan_me_hist_sel = gPanTable[level].di_ma_pan_control.pan_me_hist_sel;
	panTableHere.di_ma_pan_control.pan_odd_mv_en = gPanTable[level].di_ma_pan_control.pan_odd_mv_en;
	panTableHere.di_ma_pan_control.sobel_diff_thd = gPanTable[level].di_ma_pan_control.sobel_diff_thd;
	panTableHere.di_ma_pan_control.sobel_diff_thd_rls = gPanTable[level].di_ma_pan_control.sobel_diff_thd_rls;
	panTableHere.di_ma_pan_control.teeth_check_thd = gPanTable[level].di_ma_pan_control.teeth_check_thd;

	panTableHere.di_ma_pan_edge_type.Hedge_en = gPanTable[level].di_ma_pan_edge_type.Hedge_en;
	panTableHere.di_ma_pan_edge_type.Ledge_en = gPanTable[level].di_ma_pan_edge_type.Ledge_en;
	panTableHere.di_ma_pan_edge_type.Nedge_en = gPanTable[level].di_ma_pan_edge_type.Nedge_en;
	panTableHere.di_ma_pan_edge_type.Redge_en = gPanTable[level].di_ma_pan_edge_type.Redge_en;
	panTableHere.di_ma_pan_edge_type.Vedge_en = gPanTable[level].di_ma_pan_edge_type.Vedge_en;

	panTableHere.di_ma_pan_detection.diffMaxMin = gPanTable[level].di_ma_pan_detection.diffMaxMin;
	panTableHere.di_ma_pan_detection.diffMinThd = gPanTable[level].di_ma_pan_detection.diffMinThd;
	panTableHere.di_ma_pan_detection.restIdx = gPanTable[level].di_ma_pan_detection.restIdx;
	panTableHere.di_ma_pan_detection.restIdxThd = gPanTable[level].di_ma_pan_detection.restIdxThd;
	panTableHere.di_ma_pan_detection.panConti_str = gPanTable[level].di_ma_pan_detection.panConti_str;
	panTableHere.di_ma_pan_detection.panConti = gPanTable[level].di_ma_pan_detection.panConti;
	panTableHere.di_ma_pan_detection.panDeb_str = gPanTable[level].di_ma_pan_detection.panDeb_str;
	panTableHere.di_ma_pan_detection.panDeb = gPanTable[level].di_ma_pan_detection.panDeb;
	drvif_color_ma_PAN((DRV_di_ma_pan_table *)(&panTableHere));
}

void fwif_color_ma_set_DI_MA_Adjust_Table(unsigned char src_idx, unsigned char level)
{
	extern DRV_di_ma_adjust_table DI_MA_Adjust_Table[DI_MA_Adjust_Table_MAX];
	DRV_di_ma_adjust_table data;

	/*Table Protection*/
	if (level >=  DI_MA_Adjust_Table_MAX)
		level = 0;

	/*Set DI MA Control Parameters*/
	data.di_ma_control.ma_controlmode = DI_MA_Adjust_Table[level].di_ma_control.ma_controlmode;
//	data.di_ma_control.ma_stilllogoena = DI_MA_Adjust_Table[level].di_ma_control.ma_stilllogoena; // merlin4 remove
	data.di_ma_control.ma_messintra90 = DI_MA_Adjust_Table[level].di_ma_control.ma_messintra90;
	data.di_ma_control.ma_smoothintra90 = DI_MA_Adjust_Table[level].di_ma_control.ma_smoothintra90;

	/*Set Frame Motion*/
	data.di_ma_frame_motion_th.ma_framehtha = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framehtha;
	data.di_ma_frame_motion_th.ma_framemtha = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framemtha;
	data.di_ma_frame_motion_th.ma_framerlvtha = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framerlvtha;
	data.di_ma_frame_motion_th.ma_framestha = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framestha;

	data.di_ma_frame_motion_th.ma_framehthb = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framehthb;
	data.di_ma_frame_motion_th.ma_framemthb = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framemthb;
	data.di_ma_frame_motion_th.ma_framerlvthb = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framerlvthb;
	data.di_ma_frame_motion_th.ma_framesthb = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framesthb;

	data.di_ma_frame_motion_th.ma_framehthc = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framehthc;
	data.di_ma_frame_motion_th.ma_framemthc = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framemthc;
	data.di_ma_frame_motion_th.ma_framerlvthc = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framerlvthc;
	data.di_ma_frame_motion_th.ma_framesthc = DI_MA_Adjust_Table[level].di_ma_frame_motion_th.ma_framesthc;

	/*Set Field teeth TH*/
	data.di_ma_field_teeth_th.ma_fieldteethhtha = DI_MA_Adjust_Table[level].di_ma_field_teeth_th.ma_fieldteethhtha;
	data.di_ma_field_teeth_th.ma_fieldteethmtha = DI_MA_Adjust_Table[level].di_ma_field_teeth_th.ma_fieldteethmtha;
	data.di_ma_field_teeth_th.ma_fieldteethrlvtha = DI_MA_Adjust_Table[level].di_ma_field_teeth_th.ma_fieldteethrlvtha;
	data.di_ma_field_teeth_th.ma_fieldteethstha = DI_MA_Adjust_Table[level].di_ma_field_teeth_th.ma_fieldteethstha;

	drvif_color_ma_set_DI_MA_Adjust_Table((DRV_di_ma_adjust_table *)(&data));

}
void fwif_color_ma_set_DI_MA_Init_Table(void)
{
	extern DRV_di_ma_init_table DI_MA_Init_Table;
	DRV_di_ma_init_table data;
	/*Set Parameters*/

	data.di_ma_control_init.ma_onedirectionweaveen = DI_MA_Init_Table.di_ma_control_init.ma_onedirectionweaveen;
	data.di_ma_control_init.ma_preferintra = DI_MA_Init_Table.di_ma_control_init.ma_preferintra;

	data.di_ma_others_th.ma_fieldteeththb = DI_MA_Init_Table.di_ma_others_th.ma_fieldteeththb;
	data.di_ma_others_th.ma_stilllogovdth = DI_MA_Init_Table.di_ma_others_th.ma_stilllogovdth;
	data.di_ma_others_th.ma_ydiffth = DI_MA_Init_Table.di_ma_others_th.ma_ydiffth;

	data.di_ma_sawtooth_th.ma_sawtoothhth = DI_MA_Init_Table.di_ma_sawtooth_th.ma_sawtoothhth;
	data.di_ma_sawtooth_th.ma_sawtoothmth = DI_MA_Init_Table.di_ma_sawtooth_th.ma_sawtoothmth;
	data.di_ma_sawtooth_th.ma_sawtoothrlvth = DI_MA_Init_Table.di_ma_sawtooth_th.ma_sawtoothrlvth;
	data.di_ma_sawtooth_th.ma_sawtoothsth = DI_MA_Init_Table.di_ma_sawtooth_th.ma_sawtoothsth;

	drvif_color_ma_set_DI_MA_Init_Table((DRV_di_ma_init_table *)(&data));
}





void fwif_color_set_SCurve_driver(unsigned char item_idx, unsigned char value)
{
	unsigned char src_idx = 0;
	unsigned char display = 0;
	StructColorDataType *pTable = NULL;
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	Scaler_Get_Display_info(&display, &src_idx);

	pTable = fwif_color_get_color_data(src_idx, 0);
	if (pTable == NULL)
		return;

	if ((VIP_system_info_structure_table->input_display) == SLR_MAIN_DISPLAY) {
		switch (item_idx) {
		case gamma_mode:
				pTable->Gamma = value;
			break;
		case S_gamma_index:
				pTable->Sindex = value;
			break;
		case S_gamma_high:
				pTable->Shigh = value;
			break;
		case S_gamma_low:
				pTable->Slow = value;
			break;
		}
		fwif_set_gamma(pTable->Gamma, pTable->Sindex, pTable->Shigh, pTable->Slow);
	}
}



void fwif_module_set_film_mode(unsigned char src_idx, unsigned char value)
{
	UINT8 Timing;
	DRV_film_mode data = {0};
	extern DRV_film_mode film_mode;

	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	if (film_mode.film_status == 0)
		value = 0;
	Timing = VIP_system_info_structure_table->Timing;
	switch (value) {
	case 0:
			data.film_status = 0; /*disable film detection*/
			break;
	default:
	case 1:
			if (Timing == _MODE_1080I30 || Timing == _MODE_480I)
				data.film_status = 28; /*enable film detection / 3:2 / 2:2*/
			else if (Timing == _MODE_1080I25 || Timing == _MODE_576I)
				data.film_status = 20; /*enable film detection / 2:2*/
			break;
	case 2:
			if (Timing == _MODE_1080I30 || Timing == _MODE_480I)
				data.film_status = 31; /*enable film detection / 3:2 / 2:2 / 3:2 sub / 2:2 sub*/
			else if (Timing == _MODE_1080I25 || Timing == _MODE_576I)
				data.film_status = 21; /*enable film detection / 2:2 / 2:2 sub*/
			break;
	}
	down(get_DI_semaphore());
	drvif_module_film_mode((DRV_film_mode *) &data);
	up(get_DI_semaphore());

}

void fwif_module_set_film_setting(void)
{
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	_RPC_system_setting_info *RPC_VIP_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	extern DRV_film_table_t2 gFilmInitTable[5];
	DRV_film_table_t2 data;

	unsigned char Table_Idx = 0;
	unsigned char Timing = 0;

	if(RPC_VIP_system_info_structure_table == NULL || VIP_system_info_structure_table == NULL){
		VIPprintf("[%s:%d] Warning here!! RPC_system_info=NULL!(%p,%p) \n",__FILE__, __LINE__, RPC_VIP_system_info_structure_table,VIP_system_info_structure_table);
		return;
	}
	Timing = VIP_system_info_structure_table->Timing;

	switch (Timing) {
	case _MODE_480I: /*60Hz SD*/
			Table_Idx = 0;
			break;
	case _MODE_1080I30: /*60Hz HD*/
			Table_Idx = 1;
			break;
	case _MODE_576I: /*50Hz SD*/
			Table_Idx = 2;
			break;
	case _MODE_1080I25: /*50Hz HD*/
			Table_Idx = 3;
			break;
	default:
			Table_Idx = 0;
	}

	if (RPC_VIP_system_info_structure_table->VIP_source == VIP_QUALITY_DTV_576I){
		Table_Idx = 4; 	/* for WOSQRTK-3233 */
	}

	memcpy(&data,gFilmInitTable+Table_Idx,sizeof(DRV_film_table_t2));

	drvif_module_film_setting((DRV_film_table_t2 *)&data);
}

void fwif_module_set_film_table_t(unsigned char Table_Idx)
{
	extern DRV_film_table_t2 gFilmInitTable[5];
	down(get_DI_semaphore());
	drvif_module_film_setting((DRV_film_table_t2 *)&gFilmInitTable[Table_Idx]);
	up(get_DI_semaphore());
}
/* merlin4 remove
void fwif_color_set_MA_Chroma_Error(unsigned char src_idx, unsigned char value)
{
	DRV_MA_ChromaError data = {0};
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	extern VIP_MA_ChromaError MA_Chroma_Error_Table[t_MA_Chroma_Error_MAX];
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	if (value >= t_MA_Chroma_Error_MAX)
		drvif_color_ma_ChromaError((DRV_MA_ChromaError *) &data);
	else {
		data.chromaerror_all = MA_Chroma_Error_Table[value].chromaerror_all;
		data.chromaerror_en = MA_Chroma_Error_Table[value].chromaerror_en;
		data.chromaerror_framemotionc_th = MA_Chroma_Error_Table[value].chromaerror_framemotionc_th;
		data.chromaerror_th = MA_Chroma_Error_Table[value].chromaerror_th;

		data.di444to422Lowpass = MA_Chroma_Error_Table[value].di444to422Lowpass;

		drvif_color_ma_ChromaError((DRV_MA_ChromaError *)&data);
	}
}

unsigned char fwif_color_get_MA_Chroma_Error_en_from_vipTable(unsigned char src_idx, unsigned char value)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	extern VIP_MA_ChromaError MA_Chroma_Error_Table[t_MA_Chroma_Error_MAX];
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return 0;
	}

	return MA_Chroma_Error_Table[value].chromaerror_en;
}
*/

void fwif_color_set_dlti_driver(unsigned char src_idx, unsigned char value)
{
	/*extern DRV_Shp_Dlti gVipShp_Dlti[];
	DRV_Shp_Dlti Dlti_disabled = {0};*/
	//extern DRV_D_DLTI_Table D_DLTI_Table[D_DLTI_table_num] ;
	VIP_D_DLTI_Table Dlti_disabled = {{0}};
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	if (value >= D_DLTI_table_num) /* 255 = bypass*/
		/*drvif_color_shp_dlti(&Dlti_disabled);*/
		drvif_color_Set_D_DLTI_Table(&Dlti_disabled);
	else
		/*drvif_color_shp_dlti(&gVipShp_Dlti[value]);*/
		drvif_color_Set_D_DLTI_Table(&gVip_Table->vip_D_DLTI_Table[value]);
}

void fwif_color_set_dcti(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	DRV_VipNewDDcti_Table DCTI_disabled = {{0}};
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	if (value >= DCTI_TABLE_LEVEL_MAX)
		value = DCTI_TABLE_LEVEL_MAX - 1;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	VIP_system_info_structure_table->PQ_Setting_Info.I_D_Dcti_INFO.dDcti_table_select = value;

	if (value >= DCTI_TABLE_LEVEL_MAX)	/* 255 = bypass*/
		drvif_color_dnewdcti_table(&DCTI_disabled);
	else
		//drvif_color_dnewdcti_table((DRV_VipNewDDcti_Table *)&gVipDNewDcti_Table[value]);
		drvif_color_dnewdcti_table((DRV_VipNewDDcti_Table *)&gVip_Table->VIP_DNewDcti_Table[value]);
}
void fwif_color_set_Intra_Ver2_driver(unsigned char src_idx, unsigned char value)
{
	extern DRV_Intra_Ver2_Table gVipIntra_Set_Ver2_tab[];

	drvif_color_Intra_Ver2_table(&gVipIntra_Set_Ver2_tab[value]);
}

void fwif_color_set_subscaleup_coef4t256p10b(void)
{
	extern DRV_FIR_Coef FIR_Coef_Ctrl[DRV_FIR_Coef_4Tap_NUM];
	DRV_FIR_Coef* data=FIR_Coef_Ctrl;
    
	drvif_color_scaler_set_subscaleup_coef4t256p10b(0, data );
 	drvif_color_scaler_set_subscaleup_coef4t256p10b(1, data );
   
}

void fwif_color_set_scaleup_hcoef(unsigned char src_idx, unsigned char display, unsigned char TableIdx)
{
	extern DRV_FIR_Coef FIR_Coef_Ctrl[DRV_FIR_Coef_4Tap_NUM];
	DRV_FIR_Coef data;

	#ifdef RUN_ON_TVBOX
		if ((scalerdisplay_get_display_tve_mode() == _MODE_480P) &&
			(scalerdisplay_get_BoxDispInfo(_BOX_DISP_WID) >=  704) &&
			(scalerdisplay_get_BoxDispInfo(_BOX_DISP_WID) < 720))
			memcpy(&data, &(FIR_Coef_Ctrl[20]), sizeof(DRV_FIR_Coef));
		else
			memcpy(&data, &(FIR_Coef_Ctrl[TableIdx]), sizeof(DRV_FIR_Coef));
	#else
		memcpy(&data, &(FIR_Coef_Ctrl[TableIdx]), sizeof(DRV_FIR_Coef));
	#endif


	drvif_color_scaler_set_scaleup_hcoef(display, (DRV_FIR_Coef *)(&data), TableIdx, 0);
}

void fwif_color_set_scaleup_vcoef(unsigned char src_idx, unsigned char display, unsigned char TableIdx)
{
	extern DRV_FIR_Coef FIR_Coef_Ctrl[DRV_FIR_Coef_4Tap_NUM];
	DRV_FIR_Coef data;

	#ifdef RUN_ON_TVBOX
		if ((scalerdisplay_get_display_tve_mode() == _MODE_480P) &&
			(scalerdisplay_get_BoxDispInfo(_BOX_DISP_WID) >=  704) &&
			(scalerdisplay_get_BoxDispInfo(_BOX_DISP_WID) < 720))
			memcpy(&data, &(FIR_Coef_Ctrl[20]), sizeof(DRV_FIR_Coef));
		else
			memcpy(&data, &(FIR_Coef_Ctrl[TableIdx]), sizeof(DRV_FIR_Coef));
	#else
		memcpy(&data, &(FIR_Coef_Ctrl[TableIdx]), sizeof(DRV_FIR_Coef));
	#endif
	drvif_color_scaler_set_scaleup_vcoef(display, (DRV_FIR_Coef *)(&data), TableIdx, 0);
}

void fwif_color_set_scaleup_hv4tap_coef(unsigned char src_idx, unsigned char display, char CoefIdx_HY, char CoefIdx_VY, char CoefIdx_HC, char CoefIdx_VC)
{
	extern DRV_FIR_Coef FIR_Coef_Ctrl[DRV_FIR_Coef_4Tap_NUM];
	//DRV_FIR_Coef data;
	int CoefSel_in[4], CoefSel_out[4], TabSel_out[4];

	#ifdef RUN_ON_TVBOX
		if ((scalerdisplay_get_display_tve_mode() == _MODE_480P) &&
			(scalerdisplay_get_BoxDispInfo(_BOX_DISP_WID) >=  704) &&(scalerdisplay_get_BoxDispInfo(_BOX_DISP_WID) < 720))
		{
			CoefIdx_HY = 20;
			CoefIdx_VY = 20;
		}
	#endif

	CoefSel_in[0] = CoefIdx_HY;
	CoefSel_in[1] = CoefIdx_VY;
	CoefSel_in[2] = CoefIdx_HC;
	CoefSel_in[3] = CoefIdx_VC;

	drvif_color_scaler_scaleup_table_arrange(CoefSel_in, CoefSel_out, TabSel_out);
	/*H_Y*/
	//memcpy(&data, &(FIR_Coef_Ctrl[CoefSel_out[0]]), sizeof(DRV_FIR_Coef));
	drvif_color_scaler_set_scaleup_hcoef(display, &(FIR_Coef_Ctrl[CoefSel_out[0]]), CoefSel_out[0], TabSel_out[0]);
	/*V_Y*/
	//memcpy(&data, &(FIR_Coef_Ctrl[CoefSel_out[1]]), sizeof(DRV_FIR_Coef));
	drvif_color_scaler_set_scaleup_vcoef(display, &(FIR_Coef_Ctrl[CoefSel_out[1]]), CoefSel_out[1], TabSel_out[1]);
	/*H_C*/
	//memcpy(&data, &(FIR_Coef_Ctrl[CoefSel_out[2]]), sizeof(DRV_FIR_Coef));
	drvif_color_scaler_set_scaleup_coefHC(display, &(FIR_Coef_Ctrl[CoefSel_out[2]]), CoefSel_out[2], TabSel_out[2]);
	/*V_C*/
	//memcpy(&data, &(FIR_Coef_Ctrl[CoefSel_out[3]]), sizeof(DRV_FIR_Coef));
	drvif_color_scaler_set_scaleup_coefVC(display, &(FIR_Coef_Ctrl[CoefSel_out[3]]), CoefSel_out[3], TabSel_out[3]);
}


void fwif_color_set_scaleup_dircoef(unsigned char src_idx, unsigned char display, unsigned char TableIdx)
{
	extern DRV_FIR_Coef FIR_Coef_Ctrl[DRV_FIR_Coef_4Tap_NUM];
	DRV_FIR_Coef data;

	memcpy(&data, &(FIR_Coef_Ctrl[TableIdx]), sizeof(DRV_FIR_Coef));
	drvif_color_scaler_set_scaleup_dircoef(display, (DRV_FIR_Coef *)(&data));

}

void fwif_color_set_scaleuph_8tap_driver(unsigned char src_idx, unsigned char display, unsigned char TableIdx)
{
	extern DRV_SU_table_H12tap_t SU_table_h12tap[DRV_SU_table_H12tap_t_NUM];

	VIPprintf("fwif_color_set_scaleuph_8tap_driver, value = %d\n", TableIdx);

	if(TableIdx >= DRV_SU_table_H12tap_t_NUM) {
		TableIdx = 37;
	}

	drvif_color_scaler_setscaleup_hcoef_12tap(display, &(SU_table_h12tap[TableIdx]));
}


void fwif_color_set_scaleupv_6tap_driver(unsigned char src_idx, unsigned char display, unsigned char TableIdx)
{
	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	extern DRV_SU_table_V8tap_t SU_table_v8tap[16];
	DRV_SU_table_V8tap_t data;

	if(VIP_RPC_system_info_structure_table == NULL){
		VIPprintf("[%s:%d] Warning here!! RPC_system_info=NULL! \n",__FILE__, __LINE__);
		return;
	}

	VIPprintf("fwif_color_set_scaleupv_8tap_driver, value = %d\n", TableIdx);

	if (TableIdx >= 16) TableIdx = 12;		//20150804 roger protect the index overflow

	if ((drvif_color_ultrazoom_scalerup_PR_mode(VIP_system_info_structure_table->Mem_Width) == NOT_PR_MODE) &&
	    ((VIP_system_info_structure_table->Mem_Width) <= 3840))
		data.ver_mode_sel = SU_table_v8tap[TableIdx].ver_mode_sel;
	else
		data.ver_mode_sel = 0;	/*PR mode, disable V6 tap*/

	VIP_RPC_system_info_structure_table->ScalingUp_Ctrl.UZU_Vertical_Mode = data.ver_mode_sel;

	data.coef_table = SU_table_v8tap[TableIdx].coef_table;
	data.tap_num = SU_table_v8tap[TableIdx].tap_num;

	/*drvif_color_scaler_setscaleup_vcoef_8tap(display, &(SU_table_v8tap[TableIdx]));*/
	drvif_color_scaler_setscaleup_vcoef_8tap(display, &data);
}

void fwif_color_set_twostep_scaleup_coef(unsigned char src_idx, unsigned char display, unsigned char TableIdx)
{
	// 2016.7/4 add for Merlin2 by jyyang
	// ratio_sel = 0:2X, 1:1.5X
	// when source is 1920x1080_120Hz, 2step_mode = 1, ratio_sel = 0.
	// when source is 2560x1440_120Hz, 2step_mode = 1, ratio_sel = 1.
	// otherwise, 2step_mode = 0, ratio_sel = 0.
	ppoverlay_uzudtg_control1_RBUS ppoverlay_uzudtg_control1_reg;

	extern DRV_FIR_Coef FIR_Coef_Ctrl[DRV_FIR_Coef_4Tap_NUM];
	extern DRV_SU_table_H12tap_t SU_table_h12tap[DRV_SU_table_H12tap_t_NUM];
    SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();
	extern void drvif_color_twostep_scaleup_coef_4taq(DRV_FIR_Coef *ptr_HY, DRV_FIR_Coef *ptr_VY, DRV_FIR_Coef *ptr_HC, DRV_FIR_Coef *ptr_VC , int ratio_sel );
	extern void drvif_color_twostep_scaleup_hcoef_12tap3x(DRV_SU_table_H12tap_t *ptr);
	extern void drvif_color_twostep_scaleup_hcoef_12tap4x(DRV_SU_table_H12tap_t *ptr);
	int TableIdxHY, TableIdxVY, TableIdxHC, TableIdxVC, TableIdxHY_12tap;

	if(TableIdx >= TwoStepSU_Table_NUM) TableIdx = 0;
    
	TableIdxHY = pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_FIR_Sel.Tab4t_HY;
	TableIdxVY = pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_FIR_Sel.Tab4t_VY;
	TableIdxHC = pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_FIR_Sel.Tab4t_HC;
	TableIdxVC = pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_FIR_Sel.Tab4t_VC;
	TableIdxHY_12tap= pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_FIR_Sel.Tab12t_HY; 
    
	if(TableIdxHY >= DRV_FIR_Coef_4Tap_NUM) TableIdxHY = 0;
	if(TableIdxVY >= DRV_FIR_Coef_4Tap_NUM) TableIdxVY = 0;
	if(TableIdxHC >= DRV_FIR_Coef_4Tap_NUM) TableIdxHC = 0;
	if(TableIdxVC >= DRV_FIR_Coef_4Tap_NUM) TableIdxVC = 0;
	if(TableIdxHY_12tap >= DRV_SU_table_H12tap_t_NUM) TableIdxHY_12tap = 0;

	ppoverlay_uzudtg_control1_reg.regValue= IoReg_Read32(PPOVERLAY_uzudtg_control1_reg);
	if( ppoverlay_uzudtg_control1_reg.ai_sr_mode==3 ){
		drvif_color_twostep_scaleup_coef_4tap(&(FIR_Coef_Ctrl[TableIdxHY]), &(FIR_Coef_Ctrl[TableIdxVY]), &(FIR_Coef_Ctrl[TableIdxHC]), &(FIR_Coef_Ctrl[TableIdxVC]));
		drvif_color_twostep_scaleup_hcoef_12tap(&(SU_table_h12tap[TableIdxHY_12tap]));
	}
    
    #ifdef SQM_OFFSET_TBL    
        MFLTI_TBL_forSQM[0] = pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_Mflti.mflti_en;
        MFLTI_TBL_forSQM[1] = pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_Mflti.blend_en;
        MFLTI_TBL_forSQM[2] = pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_Mflti.blend_gain;
        MFLTI_TBL_forSQM[3] = pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_Mflti.blend_offset;
        MFLTI_TBL_forSQM[4] = pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_Mflti.h_range;        
    #endif
	drvif_color_twostep_scaleup_mflti(&(pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_Mflti));
	drvif_color_twostep_scaleup_dering(&(pVipTable->TwoStepSU_Table[TableIdx].TwoStepSU_Dering));
}
void fwif_color_set_twostep_scaleup_coefH12(unsigned char src_idx, unsigned char display, unsigned char TableIdx)
{
	extern DRV_SU_table_H12tap_t SU_table_h12tap[DRV_SU_table_H12tap_t_NUM];

	if(TableIdx >= DRV_SU_table_H12tap_t_NUM) {
		TableIdx = 12;
	}

	drvif_color_twostep_scaleup_hcoef_12tap(&(SU_table_h12tap[TableIdx]));
}

void fwif_color_set_scaleup_dir_weighting_driver(unsigned char src_idx, unsigned char value)
{
	_RPC_system_setting_info *RPC_VIP_system_info_structure_table= NULL;
    SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();
    
    
	if (value >=  MAX_DIRECTIONAL_WEIGHTING_LEVEL)
		value = 0;

	RPC_VIP_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	if (RPC_VIP_system_info_structure_table == NULL) {
		rtd_pr_vpq_emerg("fwif_color_set_scaleup_dir_weighting_driver, system info = NULL\n");
	} else {
	    
        	RPC_VIP_system_info_structure_table->ScalingUp_Ctrl.UZU_Dir_Phase_En = pVipTable->gVipDirsu_Table[value].Dirsu_Ctrl.DS_phase_En;
		/*rtd_pr_vpq_emerg("fwif_color_set_scaleup_dir_weighting_driver=%d\n", system_setting_info->PQ_Setting_Info.ScalingUp_Ctrl.UZU_Dir_Phase_En);*/
	}
        drvif_color_scaler_setscaleup_directionalscaler(&(pVipTable->gVipDirsu_Table[value]));
}

void fwif_color_set_scaledownh_table(unsigned char src_idx, unsigned char value)
{
	unsigned char *index_table = NULL;
	_RPC_system_setting_info *RPC_system_setting_info = NULL;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	index_table = &(gVip_Table->SD_H_table[value][0]);

	RPC_system_setting_info = (_RPC_system_setting_info *) Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	if (RPC_system_setting_info == NULL) {
		VIPprintf("~get system_setting_info return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	/*extern DRV_ScaleDown_COEF_TAB ScaleDown_COEF_TAB;*/

	fwif_color_scaler_setscaledown_hcoef_table(_MAIN_DISPLAY, index_table, &ScaleDown_COEF_TAB, RPC_system_setting_info);
}

void fwif_color_set_scaledownv_table(unsigned char src_idx, unsigned char value)
{
	unsigned char *index_table = NULL;
	_RPC_system_setting_info *RPC_system_setting_info = NULL;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	index_table = &(gVip_Table->SD_V_table[value][0]);

	RPC_system_setting_info = (_RPC_system_setting_info *) Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	if (RPC_system_setting_info == NULL) {
		VIPprintf("~get system_setting_info return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	/*extern DRV_ScaleDown_COEF_TAB ScaleDown_COEF_TAB;*/

	fwif_color_scaler_setscaledown_vcoef_table(_MAIN_DISPLAY, index_table, &ScaleDown_COEF_TAB, RPC_system_setting_info);

}

unsigned char fwif_color_get_scaledownh(unsigned char src_idx)
{
	return fwif_color_scaler_getscaledown_hcoef(_MAIN_DISPLAY);
}

void fwif_color_set_scaledownh(unsigned char src_idx, unsigned char value)
{
	short *coef_table = &(ScaleDown_COEF_TAB.FIR_Coef_Table[value][0]);
	drvif_color_scaler_setscaledown_hcoef(_MAIN_DISPLAY, coef_table);
}

unsigned char fwif_color_get_scaledownv(unsigned char src_idx)
{
	return fwif_color_scaler_getscaledown_vcoef(_MAIN_DISPLAY);
}

void fwif_color_set_scaledownv(unsigned char src_idx, unsigned char value)
{
	short *coef_table = &(ScaleDown_COEF_TAB.FIR_Coef_Table[value][0]);
	drvif_color_scaler_setscaledown_vcoef(_MAIN_DISPLAY, coef_table);
}

unsigned char fwif_color_get_scaledown444To422(unsigned char src_idx)
{
	return fwif_color_scaler_getscaledown_444_to_422_coef(_MAIN_DISPLAY);
}

void fwif_color_set_scaledown444To422(unsigned char src_idx, unsigned char value)
{
	_RPC_system_setting_info *RPC_system_setting_info = NULL;
	RPC_system_setting_info = (_RPC_system_setting_info *) Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	if (RPC_system_setting_info == NULL) {
		VIPprintf("~get system_setting_info return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	RPC_system_setting_info->ScalingDown_Setting_INFO.SDFH444To422Sel = value;

	fwif_color_scaler_setscaledown_444_to_422_coef(_MAIN_DISPLAY, value, &ScaleDown_COEF_TAB);
}


extern VIP_SU_PK_Coeff SU_PK_Coeff[SU_PK_COEF_MAX];
void fwif_color_set_scalepk_driver(unsigned char src_idx, unsigned char value)
{
	DRV_SU_PK_Coeff data = {0};
	signed int Coring, X1;
	signed int ndG1, ndOffset;

	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

#if 0

	if ((Scaler_DispGetInputInfo(SLR_INPUT_DISPLAY) == SLR_SUB_DISPLAY) && ((Scaler_PipGetInfo(SLR_PIP_TYPE) == SUBTYPE_PIPSMALL) || (Scaler_PipGetInfo(SLR_PIP_TYPE) == SUBTYPE_PIPLARGE) || (Scaler_PipGetInfo(SLR_PIP_TYPE) == SUBTYPE_PIPMEDIUM)))
		drvif_color_scaler_setds_pk(&gVip_Table->SU_PK_Coeff[0]);
	else
		drvif_color_scaler_setds_pk(&gVip_Table->SU_PK_Coeff[value]);

#else
	if (value >= SU_PK_COEF_MAX)
		drvif_color_scaler_setds_pk((DRV_SU_PK_Coeff *)(&data));
	else {
		if (((VIP_system_info_structure_table->input_display) == SLR_SUB_DISPLAY) && ((Scaler_PipGetInfo(SLR_PIP_TYPE) == SUBTYPE_PIPSMALL) || (Scaler_PipGetInfo(SLR_PIP_TYPE) == SUBTYPE_PIPLARGE) || (Scaler_PipGetInfo(SLR_PIP_TYPE) == SUBTYPE_PIPMEDIUM))) {
			data.Pk_En = SU_PK_Coeff[0].Pk_En;
			data.Pk_X1 = SU_PK_Coeff[0].Pk_X1;
			data.Pk_Coring = SU_PK_Coeff[0].Pk_Coring;
			data.Pk_NdG1 = SU_PK_Coeff[0].Pk_NdG1;
			data.Pk_NdG2 = SU_PK_Coeff[0].Pk_NdG2;
			data.Pk_NdLmtN = SU_PK_Coeff[0].Pk_NdLmtN;
			data.Pk_NdLmtP = SU_PK_Coeff[0].Pk_NdLmtP;
		} else {
			data.Pk_En = SU_PK_Coeff[value].Pk_En;
			data.Pk_X1 = SU_PK_Coeff[value].Pk_X1;
			data.Pk_Coring = SU_PK_Coeff[value].Pk_Coring;
			data.Pk_NdG1 = SU_PK_Coeff[value].Pk_NdG1;
			data.Pk_NdG2 = SU_PK_Coeff[value].Pk_NdG2;
			data.Pk_NdLmtN = SU_PK_Coeff[value].Pk_NdLmtN;
			data.Pk_NdLmtP = SU_PK_Coeff[value].Pk_NdLmtP;
		}


		Coring = data.Pk_Coring;
		X1 = data.Pk_X1;
		ndG1 = data.Pk_NdG1;
		ndOffset = (X1 - Coring) * ndG1 / 4;

		data.ndOffset = ndOffset;

		drvif_color_scaler_setds_pk((DRV_SU_PK_Coeff *)(&data));
	}

#endif

}

void fwif_color_set_supk_type_driver(unsigned char src_idx, unsigned char value)
{
	extern DRV_SU_PK_Mask gVipSupk_Mask[];
	if (drvif_scaler3d_decide_isPR3dMode() && (drvif_scaler3d_decide_3d_PR_enter_3DDMA() == FALSE)) /*3D pure horizontal scaling PK type for PR 3D line merge mode*/{
		if (value != 6) {
			VIPprintf("Warning!! must set pure horizontal scaling PK for PR 3D mode (for 3D line merge)!!\n");
			VIPprintf("Current setting : %d, change setting to 6!!\n", value);
			value = 6;
		}
	}

	drvif_color_scaler_setds_supk_mask((DRV_SU_PK_Mask *)&gVipSupk_Mask[value]);
}

void fwif_color_set_intra_all_pacific_new_switch (unsigned char src_idx, unsigned char value)	/*Erin 100414*/
{
	drvif_color_intra_all_pacific_new_switch (value);

}

void fwif_color_set_inewdcti(unsigned char src_idx, unsigned char value)
{
	_system_setting_info *VIP_system_info_structure_table = NULL;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	if (value >= DCTI_TABLE_LEVEL_MAX)
		value = DCTI_TABLE_LEVEL_MAX - 1;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	VIP_system_info_structure_table->PQ_Setting_Info.I_D_Dcti_INFO.iDcti_table_select = value;

	//drvif_color_inewdcti_table((DRV_VipNewIDcti_Table *)&gVipINewDcti_Table[value]);
	drvif_color_inewdcti_table((DRV_VipNewIDcti_Table *)&gVip_Table->VIP_INewDcti_Table[value]);
}

void fwif_color_set_v_dcti_driver(unsigned char src_idx, unsigned char value)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	if (value >= DCTI_TABLE_LEVEL_MAX)
		value = 0;

	//drvif_color_scaler_setds_vcti(_MAIN_DISPLAY,&gVipVcti_Table[value]);
	drvif_color_scaler_setds_vcti(_MAIN_DISPLAY,&gVip_Table->VIP_Vcti_Table[value]);
}

void fwif_color_set_v_dcti_lpf_driver(unsigned char src_idx, unsigned char value)
{

	if (value >= DCTI_TABLE_LEVEL_MAX)
		value = 0;

	drvif_color_scaler_setds_vcti_lpf(_MAIN_DISPLAY,&gVipVcti_lpf_Table[value]);
}

unsigned char fwif_color_get_UV_Delay(void)
{
	unsigned char value;
	DRV_VipUV_Delay data;
	drvif_color_Get_UV_Delay(&data);

	value = data.u_delay*16 + data.v_delay;
	return value;
}


void fwif_color_set_UV_Delay(unsigned char src_idx, unsigned char value)
{
	DRV_VipUV_Delay data;

	data.u_delay = value/16;
	data.v_delay = value%16;

	drvif_color_Set_UV_Delay((DRV_VipUV_Delay *) &data);
}

void fwif_color_set_UV_Delay_TOP(unsigned char src_idx, unsigned char value)
{

	if(value == 1) {
		_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
		unsigned char bIsVDSrc = ((VIP_system_info_structure_table->Input_src_Form) == _SRC_FROM_VDC && vdc_power_status);
		value = value-1;
		if (bIsVDSrc)
			drvif_color_Set_UV_Delay_TOP((DRV_VipUV_Delay_TOP_Table*)&gVipUV_Delay_TOP_Table[value]);
	}

}


void fwif_color_UV_Delay_Enable(unsigned char src_idx, unsigned char value)
{
	drvif_color_UV_Delay_Enable((VIP_UV_DELAY_ENABLE)value);
}

#if 0
void fwif_color_set_Adaptive_Gamma(unsigned char src_idx, unsigned char value)
{
	drvif_color_Adaptive_Gamma(_MAIN_DISPLAY, value);
}
#else
//removed from merlin3, by caroline, 20170606
/*
void fwif_color_set_Adaptive_Gamma(unsigned char src_idx, unsigned char TableIdx)
{

	extern DRV_Adaptive_Gamma_Ctrl Adaptive_Gamma_Ctrl_Table[12];
	DRV_Adaptive_Gamma_Ctrl data = {0};

	if (TableIdx >= sizeof(Adaptive_Gamma_Ctrl_Table)/sizeof(DRV_Adaptive_Gamma_Ctrl))
		drvif_color_set_Adaptive_Gamma((DRV_Adaptive_Gamma_Ctrl *)(&data));
	else {
		data.gamma_adapt_en = Adaptive_Gamma_Ctrl_Table[TableIdx].gamma_adapt_en;
		data.sat_thl = Adaptive_Gamma_Ctrl_Table[TableIdx].sat_thl;
		data.sat_thl_mul = Adaptive_Gamma_Ctrl_Table[TableIdx].sat_thl_mul;

		drvif_color_set_Adaptive_Gamma((DRV_Adaptive_Gamma_Ctrl *)(&data));
	}
}
*/

#endif

void fwif_color_data_range_convert(unsigned char channel, unsigned char nSrcType, unsigned char *contrast, unsigned char *brightness)
{
	unsigned char cont_gain, bri_gain;

	if (channel !=  _CHANNEL1)
		return;

	if ((nSrcType == _SRC_CVBS) || (nSrcType == _SRC_SV) || (nSrcType == _SRC_COMPONENT) || (nSrcType == _SRC_YPBPR) || (nSrcType == _SRC_TV)
				|| (nSrcType == _SRC_VO)
#if 1/*def CONFIG_SCART_ENABLE*/
				|| (nSrcType == _SRC_SCART) || (nSrcType == _SRC_SCART_RGB)
#endif
#ifdef CONFIG_INPUT_SOURCE_IPG
				|| (nSrcType == _SRC_IPG)
#endif
				) {
		cont_gain = 141;	/*experimental value, amplify by 128*/
		bri_gain = 105;
	} else if (nSrcType == _SRC_HDMI) {
		unsigned char video_format = drvif_Hdmi_GetColorSpace();

		if (drvif_IsHDMI() && (Scaler_ModeGet_Hdmi_ModeInfo(SLR_MODE_MODECURR) != _MODE_NEW)) /*HDMI Video Mode,  gary for xoceco 20071227*/{
			if (video_format !=  0) {/*YUV444 or YUV422*/
				cont_gain = 141;	/*experimental value, amplify by 128*/
				bri_gain = 105;
			} else {	/*RGB*/
				if (FORCE_DATA_RANGE&0x1) {/*force data as limit range*/
					cont_gain = 141;	/*experimental value, amplify by 128*/
					bri_gain = 105;
				} else if (FORCE_DATA_RANGE&0x2) {/*force data as full range*/
					cont_gain = 128;
					bri_gain = 128;
				} else {/*auto detect, */
					HDMI_RGB_YUV_RANGE_MODE_T yuv_range;
					yuv_range = drvif_IsRGB_YUV_RANGE();
					if (yuv_range == MODE_RAG_LIMIT) {
						cont_gain = 141;	/*experimental value, amplify by 128*/
						bri_gain = 105;
					} else {
						cont_gain = 128;	/*experimental value, amplify by 128*/
						bri_gain = 128;
					}
				}
			}
		} else { /*DVI mode*/
			if ((video_format&(_BIT4|_BIT5))) {  /*YUV444 or YUV422*/
				cont_gain = 141;	/*experimental value, amplify by 128*/
				bri_gain = 105;
			} else {  	/*RGB*/
				if (FORCE_DATA_RANGE&0x1) {/*force data as limit range*/
					cont_gain = 141;	/*experimental value, amplify by 128*/
					bri_gain = 105;
				} else if (FORCE_DATA_RANGE&0x2) {/*force data as full range*/
					cont_gain = 128;
					bri_gain = 128;
				} else {/*auto detect, */
					HDMI_RGB_YUV_RANGE_MODE_T yuv_range;
					yuv_range = drvif_IsRGB_YUV_RANGE();
					if (yuv_range == MODE_RAG_LIMIT) {
						cont_gain = 141;	/*experimental value, amplify by 128*/
						bri_gain = 105;
					} else {
						cont_gain = 128;	/*experimental value, amplify by 128*/
						bri_gain = 128;
					}
				}
			}
		}
	} else {
		cont_gain = 128;
		bri_gain = 128;
	}

	*contrast = ((*contrast) * cont_gain) >> 7;
	*brightness = ((*brightness) * bri_gain) >> 7;

}

/**
 * ColorSpaceTransfer
 * Set Color space rgb2yuv conversion matrix
 * for source CCIR 601 YCbCr: Bypass RGB2YUV
 * for source CCIR 601 RGB: Use Tab -1 as ccir601 RGB2YUV
 * for source CCIR 709 YPbPr: overwrite Tab - 2 as ccir709 YPbPr to 601 YCbCr
 * for source CCIR 709 RGB: overwrite Tab - 2 as ccir709 RGB to 601 YCbCr
 */
 #if 0
unsigned short *fwif_color_get_colorspacergb2yuvtransfer_org_table(unsigned char channel, unsigned char nSrcType, unsigned char nSD_HD, unsigned char VO_Jpeg_Back_YUV, bool bUse_HDMI_Range_Detect)
{
	unsigned char video_format;
	unsigned char which_color_space = 0;
	/*unsigned char temp_value = 0;*/
	unsigned short *table_index = 0;
	unsigned char CHOOSE_DATA_RANGE = 1;
	UINT8 data_range = 0; /*morgan_shen  20121112  choose rgb2yuv table by the flag of data range.*/

	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	VIPprintf("drvif_color_get_colorspacergb2yuvtransfer_org_table, nSrcType = %d, nSD_HD = %d, VO_Jpeg_Back_YUV = %d\n", nSrcType, nSD_HD, VO_Jpeg_Back_YUV);

#ifdef RUN_ON_TVBOX
		VIPprintf("[rgb2yuv] scalerdisplay_get_display_tve_mode = %d\n", scalerdisplay_get_display_tve_mode());
		if ((scalerdisplay_get_display_tve_mode() >=  _MODE_480I) && (scalerdisplay_get_display_tve_mode() <=  _MODE_576P))
			table_index = tRGB2YUV_COEF_TVBOX_SD;
		else if ((scalerdisplay_get_display_tve_mode() >=  _MODE_720P50) && (scalerdisplay_get_display_tve_mode() <=  _MODE_1080I25))
			table_index = tRGB2YUV_COEF_TVBOX_720;
		else
			table_index = tRGB2YUV_COEF_TVBOX_1080;
#else
		if (nSrcType == _SRC_VGA) {
			table_index = tRGB2YUV_COEF_601_RGB_0_255;

			RGB2YUV_if_RGB_mode = TRUE;

		} else if (nSrcType == _SRC_YPBPR) {
			if (!nSD_HD) {
				table_index = tRGB2YUV_COEF_601_YCbCr_0_255;
			} else {
				table_index = tRGB2YUV_COEF_709_YUV_0_255;
			}
		}
#ifdef CONFIG_INPUT_SOURCE_IPG
		else if (nSrcType == _SRC_IPG) {
			if (!nSD_HD) {
				table_index = tRGB2YUV_COEF_601_YCbCr_0_255;
			} else {
				table_index = tRGB2YUV_COEF_709_YUV_0_255;
			}
		}
#endif
#if 1/*def CONFIG_TV_ENABLE*/
		else if (nSrcType == _SRC_TV) {
			/*table_index = tRGB2YUV_COEF_601_YCbCr_16_235;*/
			table_index = tRGB2YUV_COEF_601_YCbCr_0_255;

		}
#endif

			else if ((nSrcType == _SRC_CVBS) || (nSrcType == _SRC_SV) || (nSrcType == _SRC_COMPONENT)
#if 1/*def CONFIG_SCART_ENABLE*/
			|| (nSrcType == _SRC_SCART) || (nSrcType == _SRC_SCART_RGB)
#endif
			) {
			/*table_index = tRGB2YUV_COEF_601_YCbCr_16_235;*/
			table_index = tRGB2YUV_COEF_601_YCbCr_0_255;

		} else if (nSrcType == _SRC_HDMI) {

			/*read HDMI color space and info*/
			/*Thur modified for compile 20090113*/
			/***********Must Check Here �I�I�I�I�I�I**********************
			video_format = IoReg_ReadByte0(HDMI_HDMI_ACRCR_RO_VADDR);
			IoReg_Write32(HDMI_HDMI_PSAPR_VADDR, 0x05);
			temp_value =  IoReg_ReadByte0(HDMI_HDMI_PSDPR_D_VADDR);
			*/
			/************Must Check Here �I�I�I�I�I�I***********************/
			video_format = drvif_Hdmi_GetColorSpace();
			VIPprintf("=== RGB2YUV video_format = %d  ===	\n", video_format);
			if (CHOOSE_DATA_RANGE) {
				data_range = drvif_IsRGB_YUV_RANGE();  /*0 :default 1 : Limited Range 2: Full Range*/
													   /*	MODE_RAG_DEFAULT	 = 0x0, */
													   /*	MODE_RAG_LIMIT  = 0x1, */
													   /*	MODE_RAG_FULL  		 = 0x2, */
					VIPprintf("===  RGB2YUV  DATA_RANGE = %d  (0 :default 1 : Limited Range 2: Full Range)===   \n", data_range);
			}


			/*modified since Darwin, so marked by nick187 @20101223*/
	/*
				IoReg_Write32(HDMI_HDMI_PSAP_VADDR, 0x05);
				temp_value =  IoReg_ReadByte0(HDMI_HDMI_PSDP_VADDR);
	*/
			/*
			HDMI_RGB_YUV_RANGE_MODE_T yuv_range;
			yuv_range = drvif_IsRGB_YUV_RANGE();
			if (yuv_range == MODE_RAG_LIMIT) { //CCIR 601
				which_color_space = 1;
			} else if (yuv_range == MODE_RAG_FULL) { //CCIR 709
				which_color_space = 2;
			}
			*/

			if (drvif_IsHDMI() && (Scaler_ModeGet_Hdmi_ModeInfo(SLR_MODE_MODECURR) != _MODE_NEW)) /*HDMI Video Mode,  gary for xoceco 20071227*/{
				if (video_format !=  0) {/*YUV444 or YUV422*/
					/*
					mark due to only need SD/HD detection
					if (which_color_space == 1)
					{
						table_index = tRGB2YUV_COEF_601_YCbCr_0_255;//tRGB2YUV_COEF_601_YCbCr_16_235; for JP inhouse demo
					}
					else if (which_color_space == 2)
					{
						table_index = tRGB2YUV_COEF_709_YUV_0_255;//tRGB2YUV_COEF_709_YUV_16_235; for JP inhouse demo
					}
					else
					*/
					{

						 /*modified by Jerry Wu 20080516 for solve hdmi color space input detect error*/
						if (!nSD_HD) {
							if (bUse_HDMI_Range_Detect && data_range == MODE_RAG_LIMIT)
								table_index = tRGB2YUV_COEF_601_YCbCr_16_235;
							else
								table_index = tRGB2YUV_COEF_601_YCbCr_0_255;
						} else {
							if (bUse_HDMI_Range_Detect && data_range == MODE_RAG_LIMIT)
								table_index = tRGB2YUV_COEF_709_YUV_16_235;
							else
								table_index = tRGB2YUV_COEF_709_YUV_0_255;
						}
					}
						VIPprintf("RGB2YUV_SRC_HDMI_YUV\n");
				} else {/*RGB*/

					RGB2YUV_if_RGB_mode = TRUE;
					/*
					if (which_color_space == 1)
					{
						table_index  = tRGB2YUV_COEF_601_RGB_0_255; //tRGB2YUV_COEF_601_RGB_16_235; modify by Jerry 20080317
					}
					else if (which_color_space == 2)
					{
						table_index  = tRGB2YUV_COEF_709_RGB_0_255; //tRGB2YUV_COEF_709_RGB_16_235; modify by Jerry 20080317
					}
					else
						//table_index = tRGB2YUV_COEF_709_RGB_0_255;  //tRGB2YUV_COEF_709_RGB_16_235; modify by Jerry 20080317
					*/
					{	 /*modified by Jerry Wu 20080516 for solve hdmi color space input detect error*/

						if (!nSD_HD) {
							table_index = tRGB2YUV_COEF_601_RGB_0_255;
						} else {
							table_index = tRGB2YUV_COEF_709_RGB_0_255;
						}
					}

						VIPprintf("RGB2YUV_SRC_HDMI_RGB\n");
				}

			} else { /*DVI mode*/
				if ((video_format&(_BIT4|_BIT5))) { /*YUV444 or YUV422*/
					if (which_color_space == 1) {/*20071107 gary for HDMI gray saturation*/
						if (bUse_HDMI_Range_Detect && data_range == MODE_RAG_LIMIT)
							table_index = tRGB2YUV_COEF_601_YCbCr_16_235;
						else
							table_index = tRGB2YUV_COEF_601_YCbCr_0_255;
					} else if (which_color_space == 2) {
						if (bUse_HDMI_Range_Detect && data_range == MODE_RAG_LIMIT)
							table_index = tRGB2YUV_COEF_709_YUV_16_235;
						else
							table_index = tRGB2YUV_COEF_709_YUV_0_255;
					} else {
						if (bUse_HDMI_Range_Detect && data_range == MODE_RAG_LIMIT)
							table_index = tRGB2YUV_COEF_709_YUV_16_235;
						else
							table_index = tRGB2YUV_COEF_709_YUV_0_255;
					}
					VIPprintf("RGB2YUV_SRC_DVI_YUV\n");

						/*VIPprintf("RGB2YUV_SRC_HDMI_YUV\n");*/
				} else {/*RGB*/
					RGB2YUV_if_RGB_mode = TRUE;
					if (which_color_space == 1) {
						if (bUse_HDMI_Range_Detect && data_range == MODE_RAG_LIMIT)
							table_index = tRGB2YUV_COEF_601_RGB_16_235;
						else
							table_index = tRGB2YUV_COEF_601_RGB_0_255;
						}
					else if (which_color_space == 2) {
						if (bUse_HDMI_Range_Detect && data_range == MODE_RAG_LIMIT)
							table_index = tRGB2YUV_COEF_709_RGB_16_235;
						else
							table_index = tRGB2YUV_COEF_709_RGB_0_255;
					} else {
						if (bUse_HDMI_Range_Detect && data_range == MODE_RAG_LIMIT)
							table_index = tRGB2YUV_COEF_709_RGB_16_235;
						else
							table_index = tRGB2YUV_COEF_709_RGB_0_255;
					}
						VIPprintf("RGB2YUV_SRC_DVI_RGB\n");
				}

			}
		} else if (nSrcType == _SRC_VO) {/*VIPprintf("RGB2YUV_SRC_FROM_HDMI\n");*/
			/*GAME source must enter RGB to YUV*/
			/*if (Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()) == 2)*/
		    if (((VIP_system_info_structure_table->HDMI_color_space) == COLOR_RGB) || (VIP_system_info_structure_table->Input_VO_Form) == 2) {
				if (!nSD_HD)
					table_index = tRGB2YUV_COEF_601_RGB_0_255;
				else
					table_index = tRGB2YUV_COEF_709_RGB_0_255;
			} else if (VIP_system_info_structure_table->Input_VO_Form == 0) { /*DTV source*/
				/*chang by frank@0305*/
				if (!nSD_HD) {
				/*frank@20100601 solve mantice26967 to show red word on white board*/
				/*	table_index = tRGB2YUV_COEF_601_YCbCr_16_235;*/
					table_index = tRGB2YUV_COEF_601_YCbCr_0_255;

				} else {
				/*frank@20100601 solve mantice26967 to show red word on white board*/
				/*	table_index = tRGB2YUV_COEF_709_YUV_16_235;*/
					table_index = tRGB2YUV_COEF_709_YUV_0_255;
				}
			} else {  /*Jpeg source*/
	/*
				if (VO_Jpeg_Back_YUV)//20100413 set Jpeg 2 mode.  March
				{
					table_index = tRGB2YUV_COEF_601_RGB_0_255;
				}
				else
				{
					table_index = tRGB2YUV_COEF_Input_YCbCr;
				}
	*/
				/*20110711 Since Darwin. No longer use VGE for scene - change - effect (M - domain VGE at Atlantic adopts RGB)*/
				table_index = tRGB2YUV_COEF_601_YCbCr_0_255;
			}
		} else {
			/*which_tab = 0;*/
			VIPprintf("unhandler type%d\n", nSrcType);
			return NULL;
	  }
	  return table_index;
#endif

}

unsigned short *fwif_color_get_colorspacergb2yuvtransfer_new_table(unsigned char nSrcType, unsigned char nSD_HD, UINT8 mode)
{
	unsigned short *table_index = 0;

	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	VIPprintf("drvif_color_get_colorspacergb2yuvtransfer_new_table, nSrcType = %d, nSD_HD = %d, mode = %d\n", nSrcType, nSD_HD, mode);
	if (mode !=  RGB2YUV_OUT_DATA_16_235 && mode !=  RGB2YUV_OUT_DATA_0_255)		/*data protect*/
		return NULL;

#ifdef RUN_ON_TVBOX
	if ((scalerdisplay_get_display_tve_mode() >=  _MODE_480I) && (scalerdisplay_get_display_tve_mode() <=  _MODE_576P))
		table_index = tRGB2YUV_COEF_TVBOX_SD;
	else if ((scalerdisplay_get_display_tve_mode() >=  _MODE_720P50) && (scalerdisplay_get_display_tve_mode() <=  _MODE_1080I25))
		table_index = tRGB2YUV_COEF_TVBOX_720;
	else
		table_index = tRGB2YUV_COEF_TVBOX_1080;
#else
	if (nSrcType == _SRC_VGA) {
		table_index = tRGB2YUV_COEF_601_RGB_0_255;
		RGB2YUV_if_RGB_mode = TRUE;
		if (mode == RGB2YUV_OUT_DATA_16_235)
			VIPprintf("colorspacergb2yuvtransfer_new WARNING!! in VGA input, 16 - 235 do not make sense in colorspacergb2yuvtransfer!!");
	} else if (nSrcType == _SRC_YPBPR) {
		if (mode == RGB2YUV_OUT_DATA_16_235) {
			if (!nSD_HD) {
				table_index = tRGB2YUV_COEF_601_YCbCr_0_255;
			} else {
				table_index = tRGB2YUV_COEF_709_YUV_0_255;
			}
		} else if (mode == RGB2YUV_OUT_DATA_0_255) {
			if (!nSD_HD) {
				table_index = tRGB2YUV_COEF_601_YCbCr_16_235;
			} else {
				table_index = tRGB2YUV_COEF_709_YUV_16_235;
			}
		} else
			table_index = NULL;	/*mode error*/
	}
	#ifdef CONFIG_INPUT_SOURCE_IPG
	else if (nSrcType == _SRC_IPG) {
		if (mode == RGB2YUV_OUT_DATA_16_235) {
			if (!nSD_HD) {
				table_index = tRGB2YUV_COEF_601_YCbCr_0_255;
			} else {
				table_index = tRGB2YUV_COEF_709_YUV_0_255;
			}
		} else if (mode == RGB2YUV_OUT_DATA_0_255) {
			if (!nSD_HD) {
				table_index = tRGB2YUV_COEF_601_YCbCr_16_235;
			} else {
				table_index = tRGB2YUV_COEF_709_YUV_16_235;
			}
		} else
			table_index = NULL;	/*mode error*/
	}
	#endif
	#if 1/*def CONFIG_TV_ENABLE*/
	else if (nSrcType == _SRC_TV) {
		if (mode == RGB2YUV_OUT_DATA_16_235)
			table_index = tRGB2YUV_COEF_601_YCbCr_0_255;
		else if (mode == RGB2YUV_OUT_DATA_0_255)
			table_index = tRGB2YUV_COEF_601_YCbCr_16_235;
		else
			table_index = NULL;	/*mode error*/
	}
	#endif

	else if ((nSrcType == _SRC_CVBS) || (nSrcType == _SRC_SV) || (nSrcType == _SRC_COMPONENT)
	#if 1/*def CONFIG_SCART_ENABLE*/
		|| (nSrcType == _SRC_SCART) || (nSrcType == _SRC_SCART_RGB)
	#endif
	) {
		if (mode == RGB2YUV_OUT_DATA_16_235)
			table_index = tRGB2YUV_COEF_601_YCbCr_0_255;
		else if (mode == RGB2YUV_OUT_DATA_0_255)
			table_index = tRGB2YUV_COEF_601_YCbCr_16_235;
		else
			table_index = NULL;	/*mode error*/
	} else if (nSrcType == _SRC_HDMI) {

		/*read HDMI color space and info*/
		/*Thur modified for compile 20090113*/
		/***********Must Check Here **********************
		video_format = IoReg_ReadByte0(HDMI_HDMI_ACRCR_RO_VADDR);
		IoReg_Write32(HDMI_HDMI_PSAPR_VADDR, 0x05);
		temp_value =  IoReg_ReadByte0(HDMI_HDMI_PSDPR_D_VADDR);
		*/
		/************Must Check Here ***********************/
		unsigned char video_format = drvif_Hdmi_GetColorSpace();
		VIPprintf("=== RGB2YUV video_format = %d  ===	\n", video_format);
	#if 0
		if (CHOOSE_DATA_RANGE) {
			data_range = drvif_IsRGB_YUV_RANGE();  /*0 :default 1 : Limited Range 2: Full Range*/
			VIPprintf("=== RGB2YUV  DATA_RANGE = %d  (0 :default 1 : Limited Range 2: Full Range)===  \n", data_range);
		}
	#endif

		/*modified since Darwin, so marked by nick187 @20101223*/
		/*

		IoReg_Write32(HDMI_HDMI_PSAP_VADDR, 0x05);
		temp_value =  IoReg_ReadByte0(HDMI_HDMI_PSDP_VADDR);
		*/
		/*
		HDMI_RGB_YUV_RANGE_MODE_T yuv_range;
		yuv_range = drvif_IsRGB_YUV_RANGE();
		if (yuv_range == MODE_RAG_LIMIT) { //CCIR 601
		which_color_space = 1;
		} else if (yuv_range == MODE_RAG_FULL) { //CCIR 709
		which_color_space = 2;
		}
		*/

		if (drvif_IsHDMI() && (Scaler_ModeGet_Hdmi_ModeInfo(SLR_MODE_MODECURR) != _MODE_NEW)) { /*HDMI Video Mode,  gary for xoceco 20071227*/
			if (video_format !=  0) { /*YUV444 or YUV422*/ 			/*modified by Jerry Wu 20080516 for solve hdmi color space input detect error*/
				if (mode == RGB2YUV_OUT_DATA_16_235) {
					if (!nSD_HD) {
						table_index = tRGB2YUV_COEF_601_YCbCr_0_255;/*tRGB2YUV_COEF_601_YCbCr_16_235;*/ /*for JP inhouse demo*/
					} else {
						table_index = tRGB2YUV_COEF_709_YUV_0_255;/*tRGB2YUV_COEF_601_YCbCr_16_235;*/ /*for JP inhouse demo*/
					}
				} else if (mode == RGB2YUV_OUT_DATA_0_255) {
					if (!nSD_HD) {
						table_index = tRGB2YUV_COEF_601_YCbCr_16_235;
					} else {
						table_index = tRGB2YUV_COEF_709_YUV_16_235;
					}
				} else
					table_index = NULL; /*mode error*/
				VIPprintf("RGB2YUV_SRC_HDMI_YUV\n");
			} else {/*RGB*/
				RGB2YUV_if_RGB_mode = TRUE;
				/*modified by Jerry Wu 20080516 for solve hdmi color space input detect error*/
				if (!nSD_HD) {
					table_index = tRGB2YUV_COEF_601_RGB_0_255;
				} else {
					table_index = tRGB2YUV_COEF_709_RGB_0_255;
				}
				VIPprintf("RGB2YUV_SRC_HDMI_RGB\n");

				if (mode == RGB2YUV_OUT_DATA_16_235)
					VIPprintf("colorspacergb2yuvtransfer_new WARNING!! in HDMI RGB input, 16 - 235 do not make sense in colorspacergb2yuvtransfer!!");
			}

		} else { /*DVI mode*/
			if ((video_format&(_BIT4|_BIT5))) { /*YUV444 or YUV422*/
				if (mode == RGB2YUV_OUT_DATA_16_235)
					table_index = tRGB2YUV_COEF_709_YUV_0_255;
				else if (mode == RGB2YUV_OUT_DATA_0_255)
					table_index = tRGB2YUV_COEF_709_YUV_16_235;
				else
					table_index = NULL; /*mode error*/
				VIPprintf("RGB2YUV_SRC_DVI_YUV\n");
				/*VIPprintf("RGB2YUV_SRC_HDMI_YUV\n");*/
			} else {/*RGB*/
				RGB2YUV_if_RGB_mode = TRUE;
				table_index = tRGB2YUV_COEF_709_RGB_0_255;
				VIPprintf("RGB2YUV_SRC_DVI_RGB\n");

				if (mode == RGB2YUV_OUT_DATA_16_235)
					VIPprintf("colorspacergb2yuvtransfer_new WARNING!! in DVI RGB input, 16 - 235 do not make sense in colorspacergb2yuvtransfer!!");
			}
		}
		/*VIPprintf("RGB2YUV_SRC_FROM_HDMI\n");*/
	} else if (nSrcType == _SRC_VO) {
		/*GAME source must enter RGB to YUV*/
		/*if (Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()) == 2)*/
		if (((VIP_system_info_structure_table->HDMI_color_space) == COLOR_RGB) || (VIP_system_info_structure_table->Input_VO_Form) == 2) {
			if (!nSD_HD)
				table_index = tRGB2YUV_COEF_601_RGB_0_255;
			else
				table_index = tRGB2YUV_COEF_709_RGB_0_255;

			if (mode == RGB2YUV_OUT_DATA_16_235)
				VIPprintf("colorspacergb2yuvtransfer_new WARNING!! in VO RGB input, 16 - 235 do not make sense in colorspacergb2yuvtransfer!!");
		} else if (VIP_system_info_structure_table->Input_VO_Form == 0) { /*DTV source*/
			if (mode == RGB2YUV_OUT_DATA_16_235) {
				if (!nSD_HD) {
					table_index = tRGB2YUV_COEF_601_YCbCr_0_255;
				} else {
					table_index = tRGB2YUV_COEF_709_YUV_0_255;
				}
			} else if (mode == RGB2YUV_OUT_DATA_0_255) {
				if (!nSD_HD) {
					table_index = tRGB2YUV_COEF_601_YCbCr_16_235;
				} else {
					table_index = tRGB2YUV_COEF_709_YUV_16_235;
				}
			} else
				table_index = NULL; /*mode error*/
		} else {  /*Jpeg source*/
			table_index = tRGB2YUV_COEF_601_YCbCr_0_255;
		}
	} else {
		/*which_tab = 0;*/
		VIPprintf("colorspacergb2yuvtransfer_new ERROR!! unhandler type, %d\n", nSrcType);
		return NULL;
	}
#endif

	return table_index;

}

unsigned char fwif_color_get_colorspacergb2yuvtransfer_new_table_new_path(unsigned char nSrcType, unsigned char nSD_HD, UINT8 mode, _system_setting_info *VIP_system_info_structure_table)
{
	unsigned  char table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
	unsigned char data_range;

	printk("fwif_color_get_colorspacergb2yuvtransfer_new_table_new_path, nSrcType = %d, nSD_HD = %d, mode = %d\n", nSrcType, nSD_HD, mode);
	if (mode !=  RGB2YUV_OUT_DATA_newTable_newPath_Mode)		/*data protect*/
		return RGB2YUV_COEF_BYPASS_NORMAL_GAIN;

#ifdef CONFIG_Support_RTK_HDR
	if(VIP_system_info_structure_table->DolbyHDR_flag == 1) {
		/* for bt2020*/
		if (VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag == 1 && VIP_system_info_structure_table->BT2020_CTRL.Mode == BT2020_MODE_Constant) {
			table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
			return table_Num;
		} else if (VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag == 1 && VIP_system_info_structure_table->BT2020_CTRL.Mode == BT2020_MODE_Non_Constant) {
			table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
			return table_Num;
		}
	} else {
		/* for bt2020*/
		if (VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag == 1 && VIP_system_info_structure_table->BT2020_CTRL.Mode == BT2020_MODE_Constant) {
			table_Num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_0_255;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
			return table_Num;
		} else if (VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag == 1 && VIP_system_info_structure_table->BT2020_CTRL.Mode == BT2020_MODE_Non_Constant) {
			table_Num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_0_255;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
			return table_Num;
		}
	}
#else
	/* for bt2020*/
	if (VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag == 1 && VIP_system_info_structure_table->BT2020_CTRL.Mode == BT2020_MODE_Constant) {
		table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_ConstantY;
		return table_Num;
	} else if (VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag == 1 && VIP_system_info_structure_table->BT2020_CTRL.Mode == BT2020_MODE_Non_Constant) {
		table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
		return table_Num;
	}
#endif

	if (nSrcType == _SRC_VGA) {
		if (!nSD_HD) {
			table_Num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else {
			table_Num = RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
		}
		RGB2YUV_if_RGB_mode = TRUE;
	} else if ((nSrcType == _SRC_YPBPR) || (nSrcType == _SRC_COMPONENT) || (nSrcType == _SRC_SCART_RGB)) {
		if (!nSD_HD) {
			table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else {
			table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
		}
	}
#ifdef CONFIG_INPUT_SOURCE_IPG
	else if (nSrcType == _SRC_IPG) {
		if (!nSD_HD) {
			table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else {
			table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
		}
	}
#endif
	else if ((nSrcType == _SRC_TV) || (nSrcType == _SRC_CVBS) || (nSrcType == _SRC_SV) || (nSrcType == _SRC_SCART)) {
		table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
	} else if (nSrcType == _SRC_HDMI) {
		/*read HDMI color space and info*/
		/*Thur modified for compile 20090113*/
		/***********Must Check Here **********************
		video_format = IoReg_ReadByte0(HDMI_HDMI_ACRCR_RO_VADDR);
		IoReg_Write32(HDMI_HDMI_PSAPR_VADDR, 0x05);
		temp_value =  IoReg_ReadByte0(HDMI_HDMI_PSDPR_D_VADDR);
		*/
		/************Must Check Here ***********************/
		unsigned char video_format = drvif_Hdmi_GetColorSpace();
		VIPprintf("=== RGB2YUV video_format = %d  ===	\n", video_format);
	#if 0
		if (CHOOSE_DATA_RANGE) {
			data_range = drvif_IsRGB_YUV_RANGE();  /*0 :default 1 : Limited Range 2: Full Range*/
			VIPprintf("=== RGB2YUV  DATA_RANGE = %d  (0 :default 1 : Limited Range 2: Full Range)===  \n", data_range);
		}
	#endif

		/*modified since Darwin, so marked by nick187 @20101223*/
		/*

		IoReg_Write32(HDMI_HDMI_PSAP_VADDR, 0x05);
		temp_value =  IoReg_ReadByte0(HDMI_HDMI_PSDP_VADDR);
		*/
		/*
		HDMI_RGB_YUV_RANGE_MODE_T yuv_range;
		yuv_range = drvif_IsRGB_YUV_RANGE();
		if (yuv_range == MODE_RAG_LIMIT) { //CCIR 601
		which_color_space = 1;
		} else if (yuv_range == MODE_RAG_FULL) { //CCIR 709
		which_color_space = 2;
		}
		*/
		data_range = drvif_IsRGB_YUV_RANGE();  /*0 :default 1 : Limited Range 2: Full Range*/

		if (drvif_IsHDMI() && (Scaler_ModeGet_Hdmi_ModeInfo(SLR_MODE_MODECURR) != _MODE_NEW)) {
			if (video_format !=  0) { /*YUV444 or YUV422*/
				if (!nSD_HD) {
					table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
					if (data_range == MODE_RAG_FULL) {
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Full;
					} else {
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {
					table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
					if (data_range == MODE_RAG_FULL) {
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Full;
					} else {
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
					}
				}
				VIPprintf("RGB2YUV_SRC_HDMI_YUV\n");
			} else {/*RGB*/
				RGB2YUV_if_RGB_mode = TRUE;
				/*modified by Jerry Wu 20080516 for solve hdmi color space input detect error*/
				if (!nSD_HD) {
					table_Num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
					if (data_range == MODE_RAG_FULL) {
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Full;
					} else {
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {
					table_Num = RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235;
					if (data_range == MODE_RAG_FULL) {
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Full;
					} else {
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
					}
				}
				VIPprintf("RGB2YUV_SRC_HDMI_RGB\n");
			}
		} else { /*DVI mode*/
			if ((video_format&(_BIT4|_BIT5))) { /*YUV444 or YUV422*/
				if (!nSD_HD) {
					table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
				}
				VIPprintf("RGB2YUV_SRC_DVI_YUV\n");
				/*VIPprintf("RGB2YUV_SRC_HDMI_YUV\n");*/
			} else {/*RGB*/
				RGB2YUV_if_RGB_mode = TRUE;
				if (!nSD_HD) {
					table_Num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_Num = RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
				}
				VIPprintf("RGB2YUV_SRC_DVI_RGB\n");
			}
		}
		/*VIPprintf("RGB2YUV_SRC_FROM_HDMI\n");*/
	} else if (nSrcType == _SRC_VO) {
		/*GAME source must enter RGB to YUV*/
		/*if (Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()) == 2)*/
		if (((VIP_system_info_structure_table->HDMI_color_space) == COLOR_RGB) || (VIP_system_info_structure_table->Input_VO_Form) == 2) {/*RGB*/
			if (!nSD_HD) {
				table_Num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
			} else {
				table_Num = RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235;
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
			}
		} else if (VIP_system_info_structure_table->Input_VO_Form == 0) { /*DTV source*/
			if (!nSD_HD) {
				table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
			} else {
				table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
			}
		} else {  /*Jpeg source*/
			if (!nSD_HD) {
				table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
			} else {
				table_Num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
			}
		}
	} else {
		/*which_tab = 0;*/
		VIPprintf("colorspacergb2yuvtransfer_new ERROR!! unhandler type, %d\n", nSrcType);
		return RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
	}

	return table_Num;

}
#endif

unsigned char fwif_color_get_I3DDMA_colorspacergb2yuvtransfer_table(unsigned char channel, unsigned char nSrcType, unsigned char nSD_HD, bool bUse_HDMI_Range_Detect)
{
	unsigned char table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_0_255;
	SLR_VOINFO* pVOInfo = NULL;
	HDMI_AVI_T pAviInfo = {0};
	unsigned char colorFMT_info = COLORSPACE_MAX;
	_system_setting_info *VIP_system_info_structure_table = NULL;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());
	drvif_Hdmi_GetAviInfoFrame((HDMI_AVI_T *) (&pAviInfo));

	if(VIP_system_info_structure_table == NULL || pVOInfo == NULL){
		rtd_pr_vpq_emerg("~get NULL warning return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return 0;
	}

	// check color format from header, and data range
	if (nSrcType == _SRC_HDMI) {

		if ((pAviInfo.EC == 5 || pAviInfo.EC == 6) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED)) {
			colorFMT_info = isBT2020;
		} else if (((pAviInfo.EC == 0 || pAviInfo.EC == 2 || pAviInfo.EC == 3) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED))) {
			colorFMT_info = is601;
		} else if (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_SMPTE170) {
			colorFMT_info = is601;
		} else if ((pAviInfo.EC == 1 && pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED) || (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_ITU709)) {
			colorFMT_info = is709;
		} else {
			if (nSD_HD == 0) {
				colorFMT_info = is601;
			} else {
				colorFMT_info = is709;
			}
		}

	} else if (nSrcType == _SRC_VO) {
		if (pVOInfo->colour_primaries == 1) {
			colorFMT_info = is709;
		} else if (pVOInfo->colour_primaries == 6 || pVOInfo->colour_primaries == 7) {
			colorFMT_info = is601;
		} else if (pVOInfo->colour_primaries == 9) {
			colorFMT_info = isBT2020;
		} else {
			if (nSD_HD == 0) {
				colorFMT_info = is601;
			} else {
				colorFMT_info = is709;
			}
		}

	} else {
		if (nSD_HD == 0) {
			colorFMT_info = is601;
		} else {
			colorFMT_info = is709;
		}
	}

	if (ColorFMT_601_in_IMD_Domain_Enable == 1) {
#ifdef CONFIG_CUSTOMER_TV002
		_RPC_system_setting_info *VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
		if (VIP_RPC_system_info_structure_table != NULL && (VIP_system_info_structure_table ->HDR_flag == HAL_VPQ_HDR_MODE_SDR)) {
			if (g_bIsRGB_FULL_Input_for_I3DDMA)
				table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
			else
				table_num = TV002_RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
		} else {
			if (drvif_IsRGB_YUV_RANGE()==MODE_RAG_FULL)
				table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC2020_0_255;
			else
				table_num = TV002_RGB2YUV_COEF_RGB_16_235_TO_YCC2020_16_235;
		}
#else
		table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC2020_0_255_style2;
#endif
	} else {
		if (colorFMT_info == isBT2020) {
			table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC2020_0_255;
            rtd_pr_vpq_emerg("[%s:%d][I3DDMA_RGB2YUV]RGB2YUV_COEF_RGB_0_255_TO_YCC2020_0_255\n", __FUNCTION__, __LINE__);
		} else if (colorFMT_info == is709) {
			table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_0_255;
            rtd_pr_vpq_emerg("[%s:%d][I3DDMA_RGB2YUV]RGB2YUV_COEF_RGB_0_255_TO_YCC709_0_255\n", __FUNCTION__, __LINE__);
		} else if (colorFMT_info == is601) {
			table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
            rtd_pr_vpq_emerg("[%s:%d][I3DDMA_RGB2YUV]RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235\n", __FUNCTION__, __LINE__);
		}
	}

	return table_num;

}

unsigned char fwif_color_get_colorspacergb2yuvtransfer_table_SDR_MAX_RGB(unsigned char channel, unsigned char nSrcType, unsigned char nSD_HD, bool bUse_HDMI_Range_Detect)
{
	unsigned char table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235;
	SLR_VOINFO* pVOInfo = NULL;
	HDMI_AVI_T pAviInfo = {0};
	unsigned char colorFMT_info = COLORSPACE_MAX;
	//extern unsigned char RGB2YUV_if_RGB_mode;
	_system_setting_info *VIP_system_info_structure_table = NULL;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());
	drvif_Hdmi_GetAviInfoFrame((HDMI_AVI_T *) (&pAviInfo));

	if(VIP_system_info_structure_table == NULL || pVOInfo == NULL){
		rtd_pr_vpq_emerg("~get NULL warning return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return 0;
	}

	// check color format from header, and data range
	if (nSrcType == _SRC_HDMI) {
		if ((pAviInfo.EC == 5 || pAviInfo.EC == 6) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED)) {
			colorFMT_info = isBT2020;
		} else if (((pAviInfo.EC == 0 || pAviInfo.EC == 2 || pAviInfo.EC == 3) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED))) {
			colorFMT_info = is601;
		} else if (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_SMPTE170) {
			colorFMT_info = is601;
		} else if ((pAviInfo.EC == 1 && pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED) || (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_ITU709)) {
			colorFMT_info = is709;
		} else {
			if (nSD_HD == 0) {
				colorFMT_info = is601;
			} else {
				colorFMT_info = is709;
			}
		}
	} else if (nSrcType == _SRC_VO) {
		if (pVOInfo->colour_primaries == 1) {
			colorFMT_info = is709;
		} else if (pVOInfo->colour_primaries == 6 || pVOInfo->colour_primaries == 7) {
			colorFMT_info = is601;
		} else if (pVOInfo->colour_primaries == 9) {
			colorFMT_info = isBT2020;
		} else {
			if (nSD_HD == 0) {
				colorFMT_info = is601;
			} else {
				colorFMT_info = is709;
			}
		}
	} else {
		if (nSD_HD == 0) {
			colorFMT_info = is601;
		} else {
			colorFMT_info = is709;
		}
	}

	// "Input_Data_Mode" always use limited, D-doamin will always use "limit to full", output of DM is RGB full
	if (colorFMT_info == isBT2020) {
		table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
        rtd_pr_vpq_emerg("[%s:%d][I_RGB2YUV]RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235\n", __FUNCTION__, __LINE__);
	} else if (colorFMT_info == is709) {
		table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
        rtd_pr_vpq_emerg("[%s:%d][I_RGB2YUV]RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235\n", __FUNCTION__, __LINE__);  
	} else if (colorFMT_info == is601) {
		table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
        rtd_pr_vpq_emerg("[%s:%d][I_RGB2YUV]RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235\n", __FUNCTION__, __LINE__); 
	}

	rtd_pr_vpq_info("CSC_SMR,ch=%d, Src=%d,HD=%d,.EC=%d,.C=%d,colour_primaries=%d,\n",
		channel, nSrcType, nSD_HD, pAviInfo.EC, pAviInfo.C, pVOInfo->colour_primaries);

	return table_num;
}

unsigned char fwif_color_get_colorspacergb2yuvtransfer_table_SDR_MAX_RGB_TV006(unsigned char channel, unsigned char nSrcType, unsigned char nSD_HD, bool bUse_HDMI_Range_Detect)
{
	unsigned char table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_0_255;
	SLR_VOINFO* pVOInfo = NULL;
	HDMI_AVI_T pAviInfo = {0};
	unsigned char colorFMT_info = COLORSPACE_MAX;
	//extern unsigned char RGB2YUV_if_RGB_mode;
	_system_setting_info *VIP_system_info_structure_table = NULL;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());
	drvif_Hdmi_GetAviInfoFrame((HDMI_AVI_T *) (&pAviInfo));

	if(VIP_system_info_structure_table == NULL || pVOInfo == NULL){
		rtd_pr_vpq_emerg("~get NULL warning return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return 0;
	}

	// check color format from header, and data range
	if (nSrcType == _SRC_HDMI) {
		if ((pAviInfo.EC == 5 || pAviInfo.EC == 6) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED)) {
			colorFMT_info = isBT2020;
		} else if (((pAviInfo.EC == 0 || pAviInfo.EC == 2 || pAviInfo.EC == 3) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED))) {
			colorFMT_info = is601;
		} else if (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_SMPTE170) {
			colorFMT_info = is601;
		} else if ((pAviInfo.EC == 1 && pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED) || (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_ITU709)) {
			colorFMT_info = is709;
		} else {
			if (nSD_HD == 0) {
				colorFMT_info = is601;
			} else {
				colorFMT_info = is709;
			}
		}
	} else if (nSrcType == _SRC_VO) {
		if (pVOInfo->colour_primaries == 1) {
			colorFMT_info = is709;
		} else if (pVOInfo->colour_primaries == 6 || pVOInfo->colour_primaries == 7) {
			colorFMT_info = is601;
		} else if (pVOInfo->colour_primaries == 9) {
			colorFMT_info = isBT2020;
		} else {
			if (nSD_HD == 0) {
				colorFMT_info = is601;
			} else {
				colorFMT_info = is709;
			}
		}
	} else {
		if (nSD_HD == 0) {
			colorFMT_info = is601;
		} else {
			colorFMT_info = is709;
		}
	}

	// "Input_Data_Mode" always use limited, D-doamin will always use "limit to full", output of DM is RGB full
	if (colorFMT_info == isBT2020) {
		table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
	} else if (colorFMT_info == is709) {
		table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
	} else if (colorFMT_info == is601) {
		table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
	}

	return table_num;

	rtd_pr_vpq_info("CSC_SMR06,ch=%d, Src=%d,HD=%d,.EC=%d,.C=%d,colour_primaries=%d,\n",
		channel, nSrcType, nSD_HD, pAviInfo.EC, pAviInfo.C, pVOInfo->colour_primaries);
}

unsigned char fwif_color_get_colorspacergb2yuvtransfer_table_ColorFMT_601_in_IMD_Domain(unsigned char channel, unsigned char nSrcType, unsigned char nSD_HD, bool bUse_HDMI_Range_Detect)
{
	unsigned char video_format = COLOR_UNKNOW;
	unsigned char table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
	UINT8 data_range = HDMI_CSC_DATA_RANGE_MODE_AUTO;
	SLR_VOINFO* pVOInfo = NULL;
	HDMI_AVI_T pAviInfo = {0};
	unsigned char colorFMT_info = COLORSPACE_MAX;
	extern unsigned char RGB2YUV_if_RGB_mode;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	unsigned char HDMI_CSC_DataRange_Mode = 255;
	unsigned char IsRGB_YUV_RANGE = 255;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());
	drvif_Hdmi_GetAviInfoFrame((HDMI_AVI_T *) (&pAviInfo));

	if(VIP_system_info_structure_table == NULL || pVOInfo == NULL){
		rtd_pr_vpq_emerg("~get NULL warning return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return 0;
	}

	// check color format from header, and data range
	if (nSrcType == _SRC_HDMI) {
		HDMI_CSC_DataRange_Mode = Scaler_GetHDMI_CSC_DataRange_Mode();
		IsRGB_YUV_RANGE = drvif_IsRGB_YUV_RANGE();
		video_format = drvif_Hdmi_GetColorSpace();

		if ((pAviInfo.EC == 5 || pAviInfo.EC == 6) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED)) {
			colorFMT_info = isBT2020;
		} else if (((pAviInfo.EC == 0 || pAviInfo.EC == 2 || pAviInfo.EC == 3) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED))) {
			colorFMT_info = is601;
		} else if (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_SMPTE170) {
			colorFMT_info = is601;
		} else if ((pAviInfo.EC == 1 && pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED) || (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_ITU709)) {
			colorFMT_info = is709;
		} else {
			if (nSD_HD == 0) {
				colorFMT_info = is601;
			} else {
				colorFMT_info = is709;
			}
		}

		if (HDMI_CSC_DataRange_Mode == HDMI_CSC_DATA_RANGE_MODE_AUTO) {
			if (IsRGB_YUV_RANGE==MODE_RAG_FULL)
				data_range = HDMI_CSC_DATA_RANGE_MODE_FULL;
			else if (IsRGB_YUV_RANGE==MODE_RAG_LIMIT)
				data_range = HDMI_CSC_DATA_RANGE_MODE_LIMITED;
			else
				data_range = HDMI_CSC_DATA_RANGE_MODE_AUTO;
		} else {
			data_range = HDMI_CSC_DataRange_Mode;
		}

	} else if (nSrcType == _SRC_VO) {
		if (pVOInfo->colour_primaries == 1) {
			colorFMT_info = is709;
		} else if (pVOInfo->colour_primaries == 6 || pVOInfo->colour_primaries == 7) {
			colorFMT_info = is601;
		} else if (pVOInfo->colour_primaries == 9) {
			colorFMT_info = isBT2020;
		} else {
			if (nSD_HD == 0) {
				colorFMT_info = is601;
			} else {
				colorFMT_info = is709;
			}
		}
	} else {
		if (nSD_HD == 0) {
			colorFMT_info = is601;
		} else {
			colorFMT_info = is709;
		}
	}

	if (fwif_color_get_force_run_i3ddma_enable(channel)) {
		if (nSrcType == _SRC_VGA || nSrcType == _SRC_HDMI || nSrcType == _SRC_SCART_RGB)
			nSrcType = _SRC_VO;
	}

	if (nSrcType == _SRC_VGA) {
		if (colorFMT_info == is601) {
			table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else {
			table_num = RGB2YUV_COEF_RGB709_0_255_TO_YCC601_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		}
		RGB2YUV_if_RGB_mode = TRUE;

	} else if ((nSrcType == _SRC_YPBPR) || (nSrcType == _SRC_COMPONENT))  {
		if (colorFMT_info == is601) {
			table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else {
			table_num = RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		}
	} else if (nSrcType == _SRC_SCART_RGB) {
		if (colorFMT_info == is601) {
			table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else {
			table_num = RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		}
	} else if ((nSrcType == _SRC_TV) || (nSrcType == _SRC_CVBS) || (nSrcType == _SRC_SV) || (nSrcType == _SRC_SCART)) {
		table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
	} else if (nSrcType == _SRC_HDMI) {
		if (drvif_IsHDMI() && (Scaler_ModeGet_Hdmi_ModeInfo(SLR_MODE_MODECURR) != _MODE_NEW)) {
			if (video_format !=  0) {/*YUV444 or YUV422*/
				if (colorFMT_info == isBT2020) {
					if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
						table_num = RGB2YUV_COEF_YCC2020_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_YCC2020_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else if (colorFMT_info == is709) {
					if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
						table_num = RGB2YUV_COEF_YCC709_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else if (colorFMT_info == is601) {
					if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
						table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
			} else {/*RGB*/
				RGB2YUV_if_RGB_mode = TRUE;
				if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_LIMITED) {
					if (colorFMT_info == isBT2020) {
						table_num = RGB2YUV_COEF_RGB2020_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = RGB2YUV_COEF_RGB709_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
						} else if (colorFMT_info == is601) {
						table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {
					if (colorFMT_info == isBT2020) {
						table_num = RGB2YUV_COEF_RGB2020_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = RGB2YUV_COEF_RGB709_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is601) {
						table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
			}
		} else { /*DVI mode*/
			if ((video_format&(_BIT4|_BIT5))) { /*YUV444 or YUV422*/
				if (colorFMT_info == is601) {
					if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
						table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {// 709
					if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
						table_num = RGB2YUV_COEF_YCC709_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
				//VIPprintf("RGB2YUV_SRC_DVI_YUV\n");
			} else {/*RGB*/
				RGB2YUV_if_RGB_mode = TRUE;
				if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_LIMITED) {
					if (colorFMT_info == is601) {
						table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_RGB709_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {
					if (colorFMT_info == is601) {
						table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_RGB709_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
				//VIPprintf("RGB2YUV_SRC_DVI_RGB\n");
			}
		}
	} else if (nSrcType == _SRC_VO) {
		/*GAME source must enter RGB to YUV*/
	    if ((Scaler_DispGetInputInfo(SLR_INPUT_COLOR_SPACE) == COLOR_RGB) || (Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()) == 2)) {
			if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_LIMITED) {
				if (colorFMT_info == isBT2020) {
					table_num = RGB2YUV_COEF_RGB2020_16_235_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else if (colorFMT_info == is709) {
					table_num = RGB2YUV_COEF_RGB709_16_235_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else if (colorFMT_info == is601) {
					table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				}
			} else {
				if (colorFMT_info == isBT2020) {
					table_num = RGB2YUV_COEF_RGB2020_0_255_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else if (colorFMT_info == is709) {
					table_num = RGB2YUV_COEF_RGB709_0_255_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else if (colorFMT_info == is601) {
					table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				}
			}
		} else if (Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()) == 0) { /*DTV source*/
			if (video_format == COLOR_RGB) {	// RGB input, yuv after i3d
				if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_LIMITED) {
					if (colorFMT_info == isBT2020) {
						table_num = RGB2YUV_COEF_YCC2020_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = RGB2YUV_COEF_Inv2020_RGB709toYUV601_FtoF;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is601) {
						table_num = RGB2YUV_COEF_Inv2020_RGB601toYUV601_FtoF;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {
					if (colorFMT_info == isBT2020) {
						table_num = RGB2YUV_COEF_YCC2020_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = RGB2YUV_COEF_Inv2020_RGB709toYUV601_FtoL;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is601) {
						table_num = RGB2YUV_COEF_Inv2020_RGB601toYUV601_FtoL;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
			} else {
				if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
					if (colorFMT_info == isBT2020) {
						table_num = RGB2YUV_COEF_YCC2020_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = RGB2YUV_COEF_YCC709_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is601) {
						table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {
					if (colorFMT_info == isBT2020) {
						table_num = RGB2YUV_COEF_YCC2020_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is601) {
						table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
			}
		} else {  /*Jpeg source*/
			if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
				if (colorFMT_info == is601) {
					table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_num = RGB2YUV_COEF_YCC709_0_255_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				}
			} else {
				if (colorFMT_info == is601) {
					table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_num = RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				}
			}
		}
		//if (Get_DisplayMode_Src(SLR_MAIN_DISPLAY) == VSC_INPUTSRC_JPEG)
			//VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
	} else {
		/*which_tab = 0;*/
		//VIPprintf("unhandler type%d\n", nSrcType);
		table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		/*return NULL;*/
	  }

	rtd_pr_vpq_info("CSC_all_601,disp=%d,Src=%d,HD=%d,detect=%d,i3ddma_en()=%d,IsHDMI()=%d,video_format=%d,colorFMT_info=%d,data_range=%d,\n",
		channel, nSrcType, nSD_HD, bUse_HDMI_Range_Detect, fwif_color_get_force_run_i3ddma_enable(channel), drvif_IsHDMI(), video_format, colorFMT_info, data_range);

	if(pVOInfo != NULL){
		rtd_pr_vpq_info("CSC_all_601,Hdmi_Mode()=%d,HDMI_CSC_DataRange=%d,IsRGB_YUV=%d,C=%d,EC=%d,colour_primaries=%d,InputInfo()=%d,VOFrom()=%d,\n",
			Scaler_ModeGet_Hdmi_ModeInfo(SLR_MODE_MODECURR), HDMI_CSC_DataRange_Mode, IsRGB_YUV_RANGE, pAviInfo.C, pAviInfo.EC, pVOInfo->colour_primaries,
			Scaler_DispGetInputInfo(SLR_INPUT_COLOR_SPACE), Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()));
	}
	return table_num;

}

unsigned char fwif_color_get_colorspacergb2yuvtransfer_table_ColorFMT_601_in_IMD_Domain_TV002(unsigned char channel, unsigned char nSrcType, unsigned char nSD_HD, bool bUse_HDMI_Range_Detect)
{
	unsigned char video_format = COLOR_UNKNOW;
	unsigned char table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
	UINT8 data_range = HDMI_CSC_DATA_RANGE_MODE_AUTO;
	SLR_VOINFO* pVOInfo = NULL;
	HDMI_AVI_T pAviInfo = {0};
	unsigned char colorFMT_info = COLORSPACE_MAX;
	extern unsigned char RGB2YUV_if_RGB_mode;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	unsigned char HDMI_CSC_DataRange_Mode = 255;
	unsigned char IsRGB_YUV_RANGE = 255;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());
	drvif_Hdmi_GetAviInfoFrame((HDMI_AVI_T *) (&pAviInfo));

	if(VIP_system_info_structure_table == NULL || pVOInfo == NULL){
		rtd_pr_vpq_emerg("~get NULL warning return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return 0;
	}

	// check color format from header, and data range
	if (nSrcType == _SRC_HDMI) {
		HDMI_CSC_DataRange_Mode = Scaler_GetHDMI_CSC_DataRange_Mode();
		IsRGB_YUV_RANGE = drvif_IsRGB_YUV_RANGE();
		video_format = drvif_Hdmi_GetColorSpace();

		if ((pAviInfo.EC == 5 || pAviInfo.EC == 6) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED)) {
			colorFMT_info = isBT2020;
		} else if (((pAviInfo.EC == 0 || pAviInfo.EC == 2 || pAviInfo.EC == 3) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED))) {
			colorFMT_info = is601;
		} else if (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_SMPTE170) {
			colorFMT_info = is601;
		} else if ((pAviInfo.EC == 1 && pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED) || (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_ITU709)) {
			colorFMT_info = is709;
		} else {
			if (nSD_HD == 0) {
				colorFMT_info = is601;
			} else {
				colorFMT_info = is709;
			}
		}

		if (HDMI_CSC_DataRange_Mode == HDMI_CSC_DATA_RANGE_MODE_AUTO) {
			if (IsRGB_YUV_RANGE==MODE_RAG_FULL)
				data_range = HDMI_CSC_DATA_RANGE_MODE_FULL;
			else if (IsRGB_YUV_RANGE==MODE_RAG_LIMIT)
				data_range = HDMI_CSC_DATA_RANGE_MODE_LIMITED;
			else
				data_range = HDMI_CSC_DATA_RANGE_MODE_AUTO;
		} else {
			data_range = HDMI_CSC_DataRange_Mode;
		}

	} else if (nSrcType == _SRC_VO) {
		if (pVOInfo->colour_primaries == 1) {
			colorFMT_info = is709;
		} else if (pVOInfo->colour_primaries == 6 || pVOInfo->colour_primaries == 7) {
			colorFMT_info = is601;
		} else if (pVOInfo->colour_primaries == 9) {
			colorFMT_info = isBT2020;
		} else {
			if (nSD_HD == 0) {
				colorFMT_info = is601;
			} else {
				colorFMT_info = is709;
			}
		}
	} else {
		if (nSD_HD == 0) {
			colorFMT_info = is601;
		} else {
			colorFMT_info = is709;
		}
	}

	if (fwif_color_get_force_run_i3ddma_enable(channel)) {
		if (nSrcType == _SRC_VGA || nSrcType == _SRC_HDMI || nSrcType == _SRC_SCART_RGB)
			nSrcType = _SRC_VO;
	}

	if (nSrcType == _SRC_VGA) {
		if (colorFMT_info == is601) {
			table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else {
			table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		}
		RGB2YUV_if_RGB_mode = TRUE;

	} else if ((nSrcType == _SRC_YPBPR) || (nSrcType == _SRC_COMPONENT))  {
		if (colorFMT_info == is601) {
			table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else {
			table_num = TV002_RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		}
	} else if (nSrcType == _SRC_SCART_RGB) {
		if (colorFMT_info == is601) {
			table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else {
			table_num = TV002_RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		}
	} else if ((nSrcType == _SRC_TV) || (nSrcType == _SRC_CVBS) || (nSrcType == _SRC_SV) || (nSrcType == _SRC_SCART)) {
		table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
	} else if (nSrcType == _SRC_HDMI) {
		if (drvif_IsHDMI() && (Scaler_ModeGet_Hdmi_ModeInfo(SLR_MODE_MODECURR) != _MODE_NEW)) {
			if (video_format !=  0) {/*YUV444 or YUV422*/
				if (colorFMT_info == isBT2020) {
					if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
						table_num = TV002_RGB2YUV_COEF_YCC2020_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = TV002_RGB2YUV_COEF_YCC2020_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else if (colorFMT_info == is709) {
					if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
						table_num = TV002_RGB2YUV_COEF_YCC709_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = TV002_RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else if (colorFMT_info == is601) {
					if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
						table_num = TV002_RGB2YUV_COEF_YCC601_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
			} else {/*RGB*/
				RGB2YUV_if_RGB_mode = TRUE;
				if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_LIMITED) {
					if (colorFMT_info == isBT2020) {
						table_num = TV002_RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = TV002_RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
						} else if (colorFMT_info == is601) {
						table_num = TV002_RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {
					if (colorFMT_info == isBT2020) {
						table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is601) {
						table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
			}
		} else { /*DVI mode*/
			if ((video_format&(_BIT4|_BIT5))) { /*YUV444 or YUV422*/
				if (colorFMT_info == is601) {
					if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
						table_num = TV002_RGB2YUV_COEF_YCC601_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {// 709
					if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
						table_num = TV002_RGB2YUV_COEF_YCC709_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = TV002_RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
				//VIPprintf("RGB2YUV_SRC_DVI_YUV\n");
			} else {/*RGB*/
				RGB2YUV_if_RGB_mode = TRUE;
				if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_LIMITED) {
					if (colorFMT_info == is601) {
						table_num = TV002_RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = TV002_RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {
					if (colorFMT_info == is601) {
						table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
				//VIPprintf("RGB2YUV_SRC_DVI_RGB\n");
			}
		}
	} else if (nSrcType == _SRC_VO) {
		/*GAME source must enter RGB to YUV*/
		if(Scaler_VOFromJPEG(Scaler_Get_CurVoInfo_plane()) == 1) {
				table_num = TV002_RGB2YUV_COEF_YCC601_0_255_TO_YCC601_16_235;
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else if ((Scaler_DispGetInputInfo(SLR_INPUT_COLOR_SPACE) == COLOR_RGB) || (Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()) == 2)) {
			if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_LIMITED) {
				if (colorFMT_info == isBT2020) {
					table_num = TV002_RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else if (colorFMT_info == is709) {
					table_num = TV002_RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else if (colorFMT_info == is601) {
					table_num = TV002_RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				}
			} else {
				if (colorFMT_info == isBT2020) {
					table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else if (colorFMT_info == is709) {
					table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else if (colorFMT_info == is601) {
					table_num = TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				}
			}
		} else if (Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()) == 0) { /*DTV source*/
			if (video_format == COLOR_RGB) {	// RGB input, yuv after i3d
				if (bUse_HDMI_Range_Detect && (data_range == HDMI_CSC_DATA_RANGE_MODE_LIMITED || (data_range == HDMI_CSC_DATA_RANGE_MODE_AUTO && IsRGB_YUV_RANGE == MODE_RAG_DEFAULT))) {
					g_bIsRGB_FULL_Input_for_I3DDMA = FALSE;
					if (colorFMT_info == isBT2020) {
						table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is601) {
						table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {
					g_bIsRGB_FULL_Input_for_I3DDMA = TRUE;
					if (colorFMT_info == isBT2020) {
						table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is601) {
						table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
			} else {
				if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
					if (colorFMT_info == isBT2020) {
						table_num = TV002_RGB2YUV_COEF_YCC2020_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = TV002_RGB2YUV_COEF_YCC709_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is601) {
						table_num = TV002_RGB2YUV_COEF_YCC601_0_255_TO_YCC601_16_235;;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				} else {
					if (colorFMT_info == isBT2020) {
						table_num = TV002_RGB2YUV_COEF_YCC2020_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is709) {
						table_num = TV002_RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else if (colorFMT_info == is601) {
						table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					}
				}
			}
		} else {  /*Jpeg source*/
			if (bUse_HDMI_Range_Detect && data_range == HDMI_CSC_DATA_RANGE_MODE_FULL) {
				if (colorFMT_info == is601) {
					table_num = TV002_RGB2YUV_COEF_YCC601_0_255_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_num = TV002_RGB2YUV_COEF_YCC709_0_255_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				}
			} else {
				if (colorFMT_info == is601) {
					table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_num = TV002_RGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				}
			}
		}
		//if (Get_DisplayMode_Src(SLR_MAIN_DISPLAY) == VSC_INPUTSRC_JPEG)
			//VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
	} else {
		/*which_tab = 0;*/
		//VIPprintf("unhandler type%d\n", nSrcType);
		table_num = TV002_RGB2YUV_COEF_YCC601_16_235_TO_YCC601_16_235;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		/*return NULL;*/
	  }

	rtd_pr_vpq_info("CSC_all_601,disp=%d,Src=%d,HD=%d,detect=%d,i3ddma_en()=%d,IsHDMI()=%d,video_format=%d,colorFMT_info=%d,data_range=%d,\n",
		channel, nSrcType, nSD_HD, bUse_HDMI_Range_Detect, fwif_color_get_force_run_i3ddma_enable(channel), drvif_IsHDMI(), video_format, colorFMT_info, data_range);

	if(pVOInfo != NULL){
		rtd_pr_vpq_info("CSC_all_601,Hdmi_Mode()=%d,HDMI_CSC_DataRange=%d,IsRGB_YUV=%d,C=%d,EC=%d,colour_primaries=%d,InputInfo()=%d,VOFrom()=%d,\n",
			Scaler_ModeGet_Hdmi_ModeInfo(SLR_MODE_MODECURR), HDMI_CSC_DataRange_Mode, IsRGB_YUV_RANGE, pAviInfo.C, pAviInfo.EC, pVOInfo->colour_primaries,
			Scaler_DispGetInputInfo(SLR_INPUT_COLOR_SPACE), Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()));
	}
	return table_num;

}

unsigned char fwif_color_get_colorspacergb2yuvtransfer_table(unsigned char channel, unsigned char nSrcType, unsigned char nSD_HD, bool bUse_HDMI_Range_Detect)
{
	unsigned char video_format;
	/*unsigned short *table_index = 0;*/
	unsigned char table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
	unsigned char CHOOSE_DATA_RANGE = 1;
	UINT8 data_range = 0; /*morgan_shen  20121112  choose rgb2yuv table by the flag of data range.*/
	RGB2YUV_BLACK_LEVEL blk_lv = fwif_color_get_rgb2yuv_black_level_tv006();
	UINT8 isBt2020_Vo =0, isBt2020_HDMI = 0;
	UINT8 isHDMIFullRangeYCC = 0;
	SLR_VOINFO* pVOInfo = NULL;
	/*pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());*/

	HDMI_AVI_T pAviInfo = {0};
	/*drvif_Hdmi_GetAviInfoFrame((unsigned char*) (&pAviInfo)); //pAviInfo size = 16 bytes*/

	extern unsigned char RGB2YUV_if_RGB_mode;
	/*extern unsigned short tRGB2YUV_COEF_YCC601_BYPASS_NORMAL_GAIN[];*/
	/*extern unsigned short tRGB2YUV_COEF_YCC709_BYPASS_NORMAL_GAIN[];*/
	/*extern unsigned short tRGB2YUV_COEF_YCC601_0_255_TO_YCC601_16_235[];*/
	/*extern unsigned short tRGB2YUV_COEF_YCC709_0_255_TO_YCC709_16_235[];*/
	/*extern unsigned short tRGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235[];*/
	/*extern unsigned short tRGB2YUV_COEF_YCC709_0_255_TO_YCC601_16_235[];*/
	/*extern unsigned short tRGB2YUV_COEF_BYPASS_NORMAL_GAIN[];*/
	/*extern unsigned short tRGB2YUV_COEF_BYPASS_0_255_TO_16_235[];*/
	/*extern unsigned short tRGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235[];*/
	/*extern unsigned short tRGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235[];*/
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());

	if(VIP_system_info_structure_table == NULL){
		VIPprintf("~get VIP_system_info_structure_table warning return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return 0;
	}

	if (RGB2YUV_BLACK_LEVEL_AUTO == blk_lv)
		bUse_HDMI_Range_Detect = true;
	else
		bUse_HDMI_Range_Detect = false;

	if (fwif_color_get_force_run_i3ddma_enable(channel)) {
		if (nSrcType == _SRC_HDMI) {
			if (drvif_IsHDMI() && drvif_Hdmi_GetColorSpace() != 0 && (Scaler_ModeGet_Hdmi_ModeInfo(SLR_MODE_MODECURR) != _MODE_NEW)) {

				switch(Scaler_GetHDMI_CSC_DataRange_Mode()) {
				case HDMI_CSC_DATA_RANGE_MODE_AUTO:
					isHDMIFullRangeYCC = drvif_IsRGB_YUV_RANGE()==MODE_RAG_FULL?1:0;
					break;
				case HDMI_CSC_DATA_RANGE_MODE_FULL:
					isHDMIFullRangeYCC = 1;
					break;
				case HDMI_CSC_DATA_RANGE_MODE_LIMITED:
				default:
					isHDMIFullRangeYCC = 0;
					break;
					;
				}
			}
		}
		if (nSrcType == _SRC_VGA || nSrcType == _SRC_HDMI || nSrcType == _SRC_SCART_RGB)
			nSrcType = _SRC_VO;
	}

	//VIPprintf("drvif_color_get_colorspacergb2yuvtransfer_table_tv006, nSrcType = %d, nSD_HD = %d\n", nSrcType, nSD_HD);
#if 0	/* move to HDMI and vo case*/
	/* for bt2020*/
	if (VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag == 1 && VIP_system_info_structure_table->BT2020_CTRL.Mode == BT2020_MODE_Constant) {
		table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_ConstantY;
		return table_num;
	} else if (VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag == 1 && VIP_system_info_structure_table->BT2020_CTRL.Mode == BT2020_MODE_Non_Constant) {
		table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
		return table_num;
	}
#endif
		if (nSrcType == _SRC_VGA) {
			if (RGB2YUV_BLACK_LEVEL_LOW == blk_lv) {
				if (!nSD_HD) {
					table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
				}
			} else {
				if (!nSD_HD) {
					table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
				}
			}
			RGB2YUV_if_RGB_mode = TRUE;

		} else if ((nSrcType == _SRC_YPBPR) || (nSrcType == _SRC_COMPONENT))  {
			if (RGB2YUV_BLACK_LEVEL_HIGH == blk_lv) {
				if (!nSD_HD) {
					table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
				}
			} else {
				if (!nSD_HD) {
					table_num = RGB2YUV_COEF_TV006_YPP_LOW;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_num = RGB2YUV_COEF_TV006_YPP_LOW;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
				}
			}
		} else if (nSrcType == _SRC_SCART_RGB) {
			if (RGB2YUV_BLACK_LEVEL_HIGH == blk_lv) {
				if (!nSD_HD) {
					table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
				}
			} else {
				if (!nSD_HD) {
					table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
				} else {
					table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
				}
			}
		} else if ((nSrcType == _SRC_TV) || (nSrcType == _SRC_CVBS) || (nSrcType == _SRC_SV) || (nSrcType == _SRC_SCART)) {
			table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else if (nSrcType == _SRC_HDMI) {
			video_format = drvif_Hdmi_GetColorSpace();
			//VIPprintf(" == =  RGB2YUV video_format = %d == = 	\n", video_format);
			if (CHOOSE_DATA_RANGE) {
				data_range = drvif_IsRGB_YUV_RANGE();  /*0 :default 1 : Limited Range 2: Full Range*/
				//VIPprintf(" == =  RGB2YUV  DATA_RANGE = %d  (0 :default 1 : Limited Range 2: Full Range) == =   \n", data_range);
			}
			/* get csc*/
			drvif_Hdmi_GetAviInfoFrame((HDMI_AVI_T *) (&pAviInfo)); //pAviInfo size = 16 bytes
			if (pAviInfo.EC == 5 || pAviInfo.EC == 6 || VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag == 1)
				isBt2020_HDMI = 1;
			else
				isBt2020_HDMI = 0;

			if (drvif_IsHDMI() && (Scaler_ModeGet_Hdmi_ModeInfo(SLR_MODE_MODECURR) != _MODE_NEW)) /*HDMI Video Mode,  gary for xoceco 20071227*/{
				if (video_format !=  0) {/*YUV444 or YUV422*/
					if (isBt2020_HDMI == 1) {
						if ((bUse_HDMI_Range_Detect && data_range == MODE_RAG_FULL) || (RGB2YUV_BLACK_LEVEL_HIGH == blk_lv)) {
							table_num = RGB2YUV_COEF_YCC2020_0_255_TO_YCC709_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
						} else {
							table_num = RGB2YUV_COEF_YCC2020_16_235_TO_YCC709_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
						}
					} else if (!nSD_HD) {
						if ((bUse_HDMI_Range_Detect && data_range == MODE_RAG_FULL) || (RGB2YUV_BLACK_LEVEL_HIGH == blk_lv)) {
							table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
						} else {
							table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
						}
					} else {
						if ((bUse_HDMI_Range_Detect && data_range == MODE_RAG_FULL) || (RGB2YUV_BLACK_LEVEL_HIGH == blk_lv)) {
							table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
						} else {
							table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
						}
					}
						//VIPprintf("RGB2YUV_SRC_HDMI_YUV\n");
				} else {/*RGB*/

					RGB2YUV_if_RGB_mode = TRUE;
					if (RGB2YUV_BLACK_LEVEL_LOW == blk_lv) {
						if (isBt2020_HDMI == 1) {
							table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC2020_0_255;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
						} else if (!nSD_HD) {
							table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
						} else {
							table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
						}
					} else {
						if (isBt2020_HDMI == 1) {
							table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
						} else if (!nSD_HD) {
							table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
						} else {
							table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
						}
					}

					//VIPprintf("RGB2YUV_SRC_HDMI_RGB\n");
				}
			} else { /*DVI mode*/
				if ((video_format&(_BIT4|_BIT5))) { /*YUV444 or YUV422*/
					if (!nSD_HD) {
						if (RGB2YUV_BLACK_LEVEL_HIGH == blk_lv) {
							table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
						} else {
							table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
						}
					} else {
						if (RGB2YUV_BLACK_LEVEL_HIGH == blk_lv) {
							table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
						} else {
							table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
						}
					}
					//VIPprintf("RGB2YUV_SRC_DVI_YUV\n");
				} else {/*RGB*/
					RGB2YUV_if_RGB_mode = TRUE;
					if (RGB2YUV_BLACK_LEVEL_LOW == blk_lv) {
						if (!nSD_HD) {
							table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
						} else {
							table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
						}
					} else {
						if (!nSD_HD) {
							table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
						} else {
							table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235;
							VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
						}
					}
					//VIPprintf("RGB2YUV_SRC_DVI_RGB\n");
				}
			}
		} else if (nSrcType == _SRC_VO) {
			/*GAME source must enter RGB to YUV*/
			/*if (Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()) == 2)*/
			//pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());
			if (pVOInfo == NULL) {
				isBt2020_Vo = 0;
			} else {
				if (pVOInfo->colour_primaries == 9 /*||pVOInfo->colour_primaries == 2*/ || VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag == 1)	/* bt2020*/
					isBt2020_Vo = 1;
				else
					isBt2020_Vo = 0;
			}

		    if ((Scaler_DispGetInputInfo(SLR_INPUT_COLOR_SPACE) == COLOR_RGB) || (Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()) == 2)) {
				if (RGB2YUV_BLACK_LEVEL_LOW == blk_lv) {
					if (isBt2020_Vo == 1) {
						table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC2020_0_255;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
					}
					else if (!nSD_HD) {
						table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
					}
				} else {
					if (isBt2020_Vo == 1) {
						table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
					}
					else if (!nSD_HD) {
						table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
					}
				}
			} else if (Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()) == 0) { /*DTV source*/
				if (RGB2YUV_BLACK_LEVEL_HIGH == blk_lv || isHDMIFullRangeYCC) {
					if (isBt2020_Vo == 1) {
						table_num = RGB2YUV_COEF_YCC2020_0_255_TO_YCC709_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
					} else if (!nSD_HD) {
						table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
					}
				} else {
					if (isBt2020_Vo == 1) {
						table_num = RGB2YUV_COEF_YCC2020_16_235_TO_YCC709_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
					} else if (!nSD_HD) {
						table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
					}
				}
			} else {  /*Jpeg source*/
				if (RGB2YUV_BLACK_LEVEL_HIGH == blk_lv) {
					if (!nSD_HD) {
						table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_BYPASS_0_255_TO_16_235;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
					}
				} else {
					if (!nSD_HD) {
						table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
					} else {
						table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
					}
				}
			}
			if (Get_DisplayMode_Src(SLR_MAIN_DISPLAY) == VSC_INPUTSRC_JPEG)
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
		} else {
			/*which_tab = 0;*/
			//VIPprintf("unhandler type%d\n", nSrcType);
			table_num = RGB2YUV_COEF_BYPASS_NORMAL_GAIN;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
			/*return NULL;*/
	  }

	rtd_pr_vpq_info("ch=%d, Src=%d, nSD_HD=%d, HDMI_Range_Detect=%d, blk_lv=%d, force_run_i3ddma_en()=%d, IsHDMI()=%d, Hdmi_ColorSpace()=%d\n",
		channel, nSrcType, nSD_HD, bUse_HDMI_Range_Detect, blk_lv, fwif_color_get_force_run_i3ddma_enable(channel), drvif_IsHDMI(), drvif_Hdmi_GetColorSpace());

	if(pVOInfo != NULL){
		rtd_pr_vpq_info("Hdmi_ModeInfo()=%d, HDMI_CSC_DataRange()=%d, IsRGB_YUV()=%d, EC=%d, colour_primaries=%d,InputInfo()=%d,VOFrom()=%d, Src()=%d\n",
			Scaler_ModeGet_Hdmi_ModeInfo(SLR_MODE_MODECURR), Scaler_GetHDMI_CSC_DataRange_Mode(), drvif_IsRGB_YUV_RANGE(), pAviInfo.EC, pVOInfo->colour_primaries,
			Scaler_DispGetInputInfo(SLR_INPUT_COLOR_SPACE), Scaler_VOFrom(Scaler_Get_CurVoInfo_plane()), Get_DisplayMode_Src(SLR_MAIN_DISPLAY));
	}
	return table_num;

}

extern void scalerVIP_Write_RGB2YUV(unsigned long arg);
extern bool get_support_vo_force_v_top(unsigned int func_flag);
extern unsigned char g_LGE_HDR_CSC_CTRL;
void fwif_color_colorspacergb2yuvtransfer(unsigned char channel, unsigned char nSrcType, unsigned char nSD_HD, unsigned char VO_Jpeg_Back_YUV, unsigned char useSendRPC)
{
	/*VIP_QUALITY_Extend2_Coef* pVipCoefArray = fwif_color_get_VIP_Extend2_CoefArray(fwif_vip_source_check(3, 0));*/
	//unsigned char *pVipCoefArray = (unsigned char *)fwif_color_get_VIP_Extend2_CoefArray(fwif_vip_source_check(3, 0));
	//UINT8 colorspace_control = 0;
	unsigned short *table_index = NULL;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	unsigned char table_num = RGB2YUV_COEF_MATRIX_MODE_Max;
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

#if 0
	SLR_VOINFO* pVOInfo = NULL;
	pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());

	if (pVipCoefArray)
		/*colorspace_control = pVipCoefArray->ColorSpace_control;*/
		colorspace_control = pVipCoefArray[VIP_QUALITY_FUNCTION_ColorSpace_Control];
	/*VIPprintf("csp_control = %d, fwif_vip_source_check(3, 0) = %d\n", csp_control, fwif_vip_source_check(3, 0));*/
#endif
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL || VIP_RPC_system_info_structure_table == NULL)
		return;

	//20150915 roger, LGE HDR flow not perfect, so using flag to control
	if (vpq_project_id == 0x00060000 && vpqex_project_id == 0x00060000) {
		if (channel == SLR_SUB_DISPLAY) {
			if (VIP_system_info_structure_table->HDR2_flag == HAL_VPQ_HDR_MODE_SDR) { 	//20160107 roger, sub == non-HDR in K2L
						table_num = fwif_color_get_colorspacergb2yuvtransfer_table_tv006(channel, nSrcType, nSD_HD, true);
						table_index = &(tRGB2YUV_COEF[table_num][0]);
			} else {
				table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
			}

		} else {
			if ((VIP_system_info_structure_table->DolbyHDR_flag == 1) && (channel == SLR_MAIN_DISPLAY)) {
				table_num = 0;
				table_index = &(tRGB2YUV_COEF[table_num][0]);
			} else if (VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_SDR) {		//20160107 roger, sub == non-HDR in K2L
				table_num = fwif_color_get_colorspacergb2yuvtransfer_table_tv006(channel, nSrcType, nSD_HD, true);
				table_index = &(tRGB2YUV_COEF[table_num][0]);
			} else if (VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_SDR_MAX_RGB) {
				table_num = fwif_color_get_colorspacergb2yuvtransfer_table_SDR_MAX_RGB_TV006(channel, nSrcType, nSD_HD, true);
				table_index = &(tRGB2YUV_COEF[table_num][0]);
			} else {
				if (g_LGE_HDR_CSC_CTRL == 1) {	/*HAL_VPQ_HDR_CSC1_BT709 = 1, HAL_VPQ_HDR_BT2020 = 2*/
						table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235][0]);
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
				} else {
						table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
						VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
				}
			}
		}
	}
#ifdef CONFIG_SUPPORT_IPQ
	else
	{
		if(get_support_vo_force_v_top(support_sdr_max_rgb)) {
			if (channel == SLR_SUB_DISPLAY) {
				if (VIP_system_info_structure_table->HDR2_flag == HAL_VPQ_HDR_MODE_SDR) {	//20160107 roger, sub == non-HDR in K2L
							table_num = fwif_color_get_colorspacergb2yuvtransfer_table(channel, nSrcType, nSD_HD, true);
							table_index = &(tRGB2YUV_COEF[table_num][0]);
				} else {
					table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
				}
			
			} else {

				if (VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_ST2094) {
					table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
				} else if(VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_HDR10){
					table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
				} else if(VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_HLG){
					table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
					VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
				} else {
				table_num = fwif_color_get_colorspacergb2yuvtransfer_table_SDR_MAX_RGB_TV043(channel, nSrcType, nSD_HD, true);
				table_index = &(tRGB2YUV_COEF[table_num][0]);
				}
			}

	} else {


		rtd_pr_vpq_info("rgb2yuv,TV006_HDR_En=%d,HDR_flag=%d\n",VIP_RPC_system_info_structure_table->HDR_info.Ctrl_Item[TV006_HDR_En], VIP_system_info_structure_table ->HDR_flag);
		if (/*(VIP_RPC_system_info_structure_table->HDR_info.Ctrl_Item[TV006_HDR_En] == 0) || */(channel == SLR_SUB_DISPLAY)) {		//20160107 roger, sub == non-HDR in K2L
			//table_num = fwif_color_get_colorspacergb2yuvtransfer_table_TV043(channel, nSrcType, nSD_HD, true);
			//table_index = &(tRGB2YUV_COEF[table_num][0]);
			if (VIP_system_info_structure_table->HDR2_flag == HAL_VPQ_HDR_MODE_SDR) { 	//20160107 roger, sub == non-HDR in K2L
						table_num = fwif_color_get_colorspacergb2yuvtransfer_table(channel, nSrcType, nSD_HD, true);
						table_index = &(tRGB2YUV_COEF[table_num][0]);
			} else {
				table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
			}			
		} else {
			if (VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_ST2094) {
				table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
			}
			else if(VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_HDR10){
				table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
			} else {
				table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235][0]);
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
			}
		}
		}
	}
#else
	 else if (ColorFMT_601_in_IMD_Domain_Enable == 1) {
		if (channel == SLR_SUB_DISPLAY) {
			if (VIP_system_info_structure_table->HDR2_flag == HAL_VPQ_HDR_MODE_SDR) { 	//20160107 roger, sub == non-HDR in K2L
						table_num = fwif_color_get_colorspacergb2yuvtransfer_table(channel, nSrcType, nSD_HD, true);
						table_index = &(tRGB2YUV_COEF[table_num][0]);
			} else {
				table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
			}

		} else {	 	
			if (VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_SDR) {
#ifdef CONFIG_CUSTOMER_TV002
				table_num = fwif_color_get_colorspacergb2yuvtransfer_table_ColorFMT_601_in_IMD_Domain_TV002(channel, nSrcType, nSD_HD, true);
#else
				table_num = fwif_color_get_colorspacergb2yuvtransfer_table_ColorFMT_601_in_IMD_Domain(channel, nSrcType, nSD_HD, true);
#endif
				table_index = &(tRGB2YUV_COEF[table_num][0]);
			} else {
#ifdef CONFIG_CUSTOMER_TV002
				table_index = &(tRGB2YUV_COEF[TV002_RGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235][0]);
#else
				if (VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_ST2094)
					table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB709_0_255_TO_YCC601_16_235][0]);
				else
					table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB709_0_255_TO_YCC601_16_235][0]);
#endif
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
			}
		}
	} else {
		if (channel == SLR_SUB_DISPLAY) {
			if (VIP_system_info_structure_table->HDR2_flag == HAL_VPQ_HDR_MODE_SDR) {	//20160107 roger, sub == non-HDR in K2L
						table_num = fwif_color_get_colorspacergb2yuvtransfer_table(channel, nSrcType, nSD_HD, true);
						table_index = &(tRGB2YUV_COEF[table_num][0]);
			} else {
				table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
			}
		
		} else {

			if (VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_SDR) {		//20160107 roger, sub == non-HDR in K2L
				table_num = fwif_color_get_colorspacergb2yuvtransfer_table(channel, nSrcType, nSD_HD, true);
				table_index = &(tRGB2YUV_COEF[table_num][0]);
			} else if (VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_SDR_MAX_RGB) {
				table_num = fwif_color_get_colorspacergb2yuvtransfer_table_SDR_MAX_RGB(channel, nSrcType, nSD_HD, true);
				table_index = &(tRGB2YUV_COEF[table_num][0]);
			} else {
				if (VIP_system_info_structure_table->HDR_flag == HAL_VPQ_HDR_MODE_ST2094)
					table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235][0]);
				else
					table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235][0]);
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
			}
		}
	}
#endif
#if 1
	/* KTASKWBS-5741, V com pattern, use 601->709 matrix*/
	if ((Get_DISPLAY_PANEL_MPLUS_RGBW() == TRUE /*|| Get_DISPLAY_PANEL_BOW_RGBW() == TRUE*/) && get_vsc_run_pc_mode() == 1
		&& Get_DisplayMode_Src(SLR_MAIN_DISPLAY)  == VSC_INPUTSRC_JPEG && drvif_M_Plus_Status_Check() == 0) {
		table_num = RGB2YUV_COEF_YCC601_0_255_TO_YCC709_0_255;
		table_index = &(tRGB2YUV_COEF[table_num][0]);
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;

	}
#endif

//	if((Scaler_DispGetStatus(SLR_MAIN_DISPLAY, SLR_DISP_422CAP) == FALSE) && (get_scaler_connect_source(SLR_MAIN_DISPLAY) == _SRC_HDMI)){
//		table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_BYPASS_NORMAL_GAIN][0]);
//	}

	rtd_pr_vpq_info("rgb2yuv,display=%d,tab_num=%d,input_mode=%d,M+=%d,BOE=%d, M+_En=%d,RGB444=%d,Mode_src=%d,HDR_en=%d, HDR_csc=%d,hdr_flag=%d,\n",
		channel, table_num, VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode, Get_DISPLAY_PANEL_MPLUS_RGBW(),
		Get_DISPLAY_PANEL_BOW_RGBW(), drvif_M_Plus_Status_Check(), get_vsc_run_pc_mode(), Get_DisplayMode_Src(SLR_MAIN_DISPLAY),
		VIP_RPC_system_info_structure_table->HDR_info.Ctrl_Item[TV006_HDR_En], g_LGE_HDR_CSC_CTRL,VIP_system_info_structure_table ->HDR_flag);

	if (NULL !=  table_index) {
		/*set using matrix to share memory*/
		if (VIP_system_info_structure_table !=  NULL) {

#ifdef CONFIG_ARM64
			memcpy_toio((unsigned short *)(&VIP_system_info_structure_table->RGB2YUV_COEF_CSMatrix), table_index, sizeof(VIP_RGB2YUV_COEF_CSMatrix));
#else  //CONFIG_ARM64
			memcpy((unsigned short *)(&VIP_system_info_structure_table->RGB2YUV_COEF_CSMatrix), table_index, sizeof(VIP_RGB2YUV_COEF_CSMatrix));
#endif  //CONFIG_ARM64
			fwif_color_ChangeUINT16Endian((unsigned short *)&VIP_system_info_structure_table->RGB2YUV_COEF_CSMatrix, sizeof(VIP_RGB2YUV_COEF_CSMatrix)/sizeof(short), 0);
		} else {
			rtd_pr_vpq_emerg("rgb2yuv, VIP_system_info_structure_table = NULL, 11\n");
		}

		if (useSendRPC && (channel == SLR_MAIN_DISPLAY)) {
			VIP_RGB2YUV_COEF_CSMatrix CurMainMatrix;
			int cmpFlag = 0;

			{
				drvif_color_get_rgb2yuvtransfer(SLR_MAIN_DISPLAY, (unsigned short*)&CurMainMatrix);
				cmpFlag = memcmp(&CurMainMatrix, table_index, sizeof(VIP_RGB2YUV_COEF_CSMatrix));

				if (cmpFlag == 0)
					return;
			}
			scalerVIP_Write_RGB2YUV(1);
		} else {
			/*fwif_color_colorspacergb2yuv_set_yuv2rgb_inputMode(channel, table_index);*/

			drvif_color_colorspacergb2yuvtransfer(channel, table_index);
		}

#ifdef CONFIG_FORCE_RUN_I3DDMA
		if (channel == SLR_MAIN_DISPLAY && fwif_color_get_force_run_i3ddma_enable(channel)) {
			//drvif_HDMI_HDR_I3DDMA_RGB2YUV_only_Matrix(tRGB2YUV_COEF[(nSD_HD?RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235:RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235)]);
#ifdef CONFIG_SUPPORT_IPQ
			table_num = fwif_color_get_I3DDMA_colorspacergb2yuvtransfer_table_SDR_MAX_RGB_TV043(channel, nSrcType, nSD_HD, true);
			drvif_HDMI_HDR_I3DDMA_RGB2YUV_only_Matrix(tRGB2YUV_COEF[table_num]);
#else
			table_num = fwif_color_get_I3DDMA_colorspacergb2yuvtransfer_table(channel, nSrcType, nSD_HD, true);
			drvif_HDMI_HDR_I3DDMA_RGB2YUV_only_Matrix(tRGB2YUV_COEF[table_num]);
#endif
}
#endif

#ifdef CONFIG_ENABLE_HDMITX
		if (channel == SLR_MAIN_DISPLAY && (ScalerHdmiTx_Get_Timing_Status() != TX_TIMING_INIT_STATE)) {
			table_num = RGB2YUV_COEF_RGB_0_255_TO_YCC2020_0_255;
			drvif_HDMITX_RGB2YUV_only_Matrix(tRGB2YUV_COEF[table_num]);
		}
#endif // #ifdef CONFIG_ENABLE_HDMITX

	} else {
		rtd_pr_vpq_emerg("rgb2yuv, ERROR, table_index == NULL !!\n");
	}

	if (VIP_system_info_structure_table == NULL || VIP_RPC_system_info_structure_table == NULL) {
		rtd_pr_vpq_emerg("rgb2yuv, ERROR, VIP_system_info_structure_table == NULL !!\n");
	} else {
		fwif_color_set_DCC_YUV2RGB_CTRL(channel, nSrcType, nSD_HD, VO_Jpeg_Back_YUV, VIP_system_info_structure_table);
		fwif_color_set_ICM_YUV2RGB_CTRL(channel, nSrcType, nSD_HD, VO_Jpeg_Back_YUV, VIP_system_info_structure_table);
	}



}

#ifdef CONFIG_HDR_SDR_SEAMLESS
void fwif_color_colorspacergb2yuvtransfer_Seamless(unsigned char HDR_Mode, unsigned char nSrcType, unsigned char useSendRPC)
{
	unsigned short *table_index = NULL;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	unsigned char table_num = RGB2YUV_COEF_MATRIX_MODE_Max;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL)
		return;

	if (HDR_Mode == 0) {
		table_num = fwif_color_get_colorspacergb2yuvtransfer_table_tv006(SLR_MAIN_DISPLAY, nSrcType, 1, true);
		//table_num = fwif_color_get_colorspacergb2yuvtransfer_new_table_new_path(nSrcType, 1, RGB2YUV_OUT_DATA_newTable_newPath_Mode, VIP_system_info_structure_table);
		table_index = &(tRGB2YUV_COEF[table_num][0]);
	} else {
		/* use webos flag to determine csc*/
		if (g_LGE_HDR_CSC_CTRL == 1) {	/*HAL_VPQ_HDR_CSC1_BT709 = 1, HAL_VPQ_HDR_BT2020 = 2*/
				table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235][0]);
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
		} else {
				table_index = &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC2020_16_235][0]);
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_2020_NonConstantY;
		}
	}

	/* seamless is in porch*/
	if (NULL !=  table_index) {
		/*set using matrix to share memory*/
		if (VIP_system_info_structure_table !=  NULL) {
#ifdef CONFIG_ARM64
			memcpy_toio((unsigned short *)(&VIP_system_info_structure_table->RGB2YUV_COEF_CSMatrix), table_index, sizeof(VIP_RGB2YUV_COEF_CSMatrix));
#else
			memcpy((unsigned short *)(&VIP_system_info_structure_table->RGB2YUV_COEF_CSMatrix), table_index, sizeof(VIP_RGB2YUV_COEF_CSMatrix));
#endif
			fwif_color_ChangeUINT16Endian((unsigned short *)&VIP_system_info_structure_table->RGB2YUV_COEF_CSMatrix, sizeof(VIP_RGB2YUV_COEF_CSMatrix)/sizeof(short), 0);
		} else {
			VIPprintf("VIP_system_info_structure_table = NULL, fwif_color_colorspacergb2yuvtransfer\n");
		}

		if (useSendRPC /*&& (channel == SLR_MAIN_DISPLAY)*/) {
#if 0
			VIP_RGB2YUV_COEF_CSMatrix CurMainMatrix;
			int cmpFlag = 0;
			drvif_color_get_rgb2yuvtransfer(SLR_MAIN_DISPLAY, (unsigned short*)&CurMainMatrix);
			cmpFlag = memcmp(&CurMainMatrix, table_index, sizeof(VIP_RGB2YUV_COEF_CSMatrix));

			if (cmpFlag == 0)
				return;
#endif
			scalerVIP_Write_RGB2YUV(1);
		} else {
			/*fwif_color_colorspacergb2yuv_set_yuv2rgb_inputMode(channel, table_index);*/
			drvif_color_colorspacergb2yuvtransfer(SLR_MAIN_DISPLAY, table_index);
		}
#if 0
#ifdef CONFIG_FORCE_RUN_I3DDMA
		if (channel == SLR_MAIN_DISPLAY && fwif_color_get_force_run_i3ddma_enable(channel)) {
			drvif_HDMI_HDR_I3DDMA_RGB2YUV_only_Matrix(tRGB2YUV_COEF[(nSD_HD?RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235:RGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235)]);
		}
#endif
#endif
	} else {
		VIPprintf("ERROR, table_index == NULL !!\n");
	}
}
#endif

void fwif_color_set_DCC_YUV2RGB_CTRL(unsigned char display, unsigned char nSrcType, unsigned char nSD_HD, unsigned char VO_Jpeg_Back_YUV,  _system_setting_info *VIP_system_info_structure_table)
{
	unsigned char isHD, isFull_range;

	unsigned char data_format_range;

	data_format_range = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode;

	switch (data_format_range) {
		case YUV2RGB_INPUT_601_Limted:
			isHD = 0;
			isFull_range = 0;
			break;

		case YUV2RGB_INPUT_709_Limted:
		case YUV2RGB_INPUT_2020_NonConstantY:
		case YUV2RGB_INPUT_2020_ConstantY:
			isHD = 1;
			isFull_range = 0;
			break;

		case YUV2RGB_INPUT_601_Full:
			isHD = 0;
			isFull_range = 1;
			break;

		case YUV2RGB_INPUT_709_Full:
		case YUV2RGB_INPUT_2020_NonConstantY_Full:
		case YUV2RGB_INPUT_2020_ConstantY_Full:
			isHD = 1;
			isFull_range = 1;
			break;

		default:
			isHD = 1;
			isFull_range = 1;
			break;

	}
#ifdef CONFIG_SUPPORT_IPQ
	isFull_range = 1;
#endif
	drvif_color_DCC_ctrl_YUV2RGB(isHD, isFull_range);

}

void fwif_color_set_ICM_YUV2RGB_CTRL(unsigned char display, unsigned char nSrcType, unsigned char nSD_HD, unsigned char VO_Jpeg_Back_YUV,  _system_setting_info *VIP_system_info_structure_table)
{
	unsigned char isHD, isFull_range;

	unsigned char data_format_range;

	data_format_range = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode;

	switch (data_format_range) {
		case YUV2RGB_INPUT_601_Limted:
			isHD = 0;
			isFull_range = 0;
			break;

		case YUV2RGB_INPUT_709_Limted:
		case YUV2RGB_INPUT_2020_NonConstantY:
		case YUV2RGB_INPUT_2020_ConstantY:
			isHD = 1;
			isFull_range = 0;
			break;

		case YUV2RGB_INPUT_601_Full:
			isHD = 0;
			isFull_range = 1;
			break;

		case YUV2RGB_INPUT_709_Full:
		case YUV2RGB_INPUT_2020_NonConstantY_Full:
		case YUV2RGB_INPUT_2020_ConstantY_Full:
			isHD = 1;
			isFull_range = 1;
			break;

		default:
			isHD = 1;
			isFull_range = 1;
			break;

	}

	//if (vpq_project_id == 0x00060000 && vpqex_project_id == 0x00060000)
		isFull_range = 1; //force full range
	drvif_color_Icm_ctrl_YUV2RGB(isHD, isFull_range);

}

#if 0
void fwif_color_colorspacergb2yuv_set_yuv2rgb_inputMode(unsigned char display, unsigned short *table_idx)
{

	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL) {
		VIPprintf("~get VIP_system_info_structure_table Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	if (table_idx == tRGB2YUV_COEF_YCC601_BYPASS_NORMAL_GAIN)
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
	else if (table_idx == tRGB2YUV_COEF_YCC601_0_255_TO_YCC601_16_235)
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
	/*else if (table_idx == tRGB2YUV_COEF_YCC709_16_235_TO_YCC601_16_235)
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
	else if (table_idx == tRGB2YUV_COEF_YCC709_0_255_TO_YCC601_16_235)
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;*/
	else if (table_idx == tRGB2YUV_COEF_RGB_0_255_TO_YCC601_16_235)
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
	else if (table_idx == tRGB2YUV_COEF_RGB_16_235_TO_YCC601_16_235)
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;
	else if (table_idx == tRGB2YUV_COEF_YCC709_BYPASS_NORMAL_GAIN)
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
	else if (table_idx == tRGB2YUV_COEF_YCC709_0_255_TO_YCC709_16_235)
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_709_Limted;
	else		/* other matrix is old path, use 601 YUV2RGB matrix*/
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode = YUV2RGB_INPUT_601_Limted;

}
#endif

void fwif_color_setycontrastbrightness(unsigned char display, unsigned char Contrast, unsigned char Brightness)
{
	/*VIP_QUALITY_Extend2_Coef* pVipCoefArray = fwif_color_get_VIP_Extend2_CoefArray(fwif_vip_source_check(3, 0));*/
	/*UINT8 csp_control = pVipCoefArray->ColorSpace_control;*/
	unsigned char *pVipCoefArray = (unsigned char *)fwif_color_get_VIP_Extend2_CoefArray(fwif_vip_source_check(3, 0));
	UINT8 csp_control;

	if (NULL == pVipCoefArray)
		return;

	csp_control = pVipCoefArray[VIP_QUALITY_FUNCTION_ColorSpace_Control];
	VIPprintf("csp_control = %d, fwif_vip_source_check(3, 0) = %d\n", csp_control, fwif_vip_source_check(3, 0));

	drvif_color_setycontrastbrightness_new(display, Contrast, Brightness, csp_control);
}

void fwif_colo_load_vip_table(SLR_VIP_TABLE *ptr)
{
	if (ptr == NULL) {
		VIPprintf("load pq table error\n");
		return;
	}
	/*memcpy((SLR_VIP_TABLE *)&gVip_Table, (SLR_VIP_TABLE *)ptr, sizeof(SLR_VIP_TABLE));*/
    gVip_Table = ptr;

	VIPprintf(" ===load_vip_table=== \n");
	fwif_colo_vip_ShareMemory_init(ptr);
}

SLR_VIP_TABLE *fwif_colo_get_AP_vip_table_gVIP_Table(void)
{
	if (gVip_Table == NULL) {
		VIPprintf("gVip_Table is NULL\n");
		return NULL;
	}
	return (SLR_VIP_TABLE *)gVip_Table;

	/*return (SLR_VIP_TABLE *)&gVip_Table;*/
}

void fwif_colo_vip_ShareMemory_init(SLR_VIP_TABLE *pVIPtable)
{
/*send all vip table to share memory*/
	VIPprintf("fwif_colo_vip_ShareMemory_init start\n");
	fwif_color_Send_VIP_Table(pVIPtable);
	fwif_color_Send_RPC_VIP_Table(pVIPtable);
#ifdef ENABLE_VIP_TABLE_CHECKSUM
/* =========	checksum ============*/
	fwif_color_check_VIPTable_crc(&vip_table_crc, pVIPtable);
	fwif_color_Send_VIP_Table_crc(&vip_table_crc);
	fwif_color_Send_RPC_VIP_Table(pVIPtable);
	VIPprintf("[%s %d] vip table checkSum: %x\n", __FILE__, __LINE__, vip_table_crc.checkSum);
/*=============================*/
#endif
	fwif_color_set_VIP_system_info_structure();
	fwif_color_set_VIP_RPC_system_info_structure();
	Scaler_Init_ColorLib_customer_share_memory_struct();/*for custom share memory init by each project*/
	fwif_color_init_PQ_device_struct_ShareMemory();
	VIPprintf("fwif_colo_vip_ShareMemory_init end\n");
}


unsigned char fwif_OsdMapToRegValue(APP_Video_OsdItemType_t bOsdItem, unsigned char value)
{
#ifdef OSD_FOUR_LEVEL_MAPPING_ENABLE
	unsigned int temp = 0;
	unsigned char startPoint = 0, endPoint = 0;
	unsigned char reg_point0 = 0;
	unsigned char reg_point25 = 0;
	unsigned char reg_point50 = 0;
	unsigned char reg_point75 = 0;
	unsigned char reg_point100 = 0;

	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	StructColorDataFacModeType *pColorFacTable;

#endif

#ifdef CONFIG_OSD_VALUE_NO_NEED_MAP_RANGE
	return value;
#endif

	if(vpq_project_id == 0x00060000 && vpqex_project_id == 0x00100000)   // no re-mapping
	{
     		if (Scaler_VOFromJPEG(Scaler_Get_CurVoInfo_plane()) == 1)
           		value=128;

	  	return value;
	}else if(fwif_VIP_get_Project_ID() == VIP_Project_ID_TV030)
		return value;
#ifdef OSD_FOUR_LEVEL_MAPPING_ENABLE
	if (g_bUseMiddleWareOSDmap)
		pColorFacTable = &g_curColorFacTableEx;
	else
		pColorFacTable = fwif_color_get_color_fac_mode(VIP_system_info_structure_table->color_fac_src_idx, 0);

	if (pColorFacTable == NULL)
		return 0;

	switch (bOsdItem) {
	case APP_VIDEO_OSD_ITEM_BRIGHTNESS:
		reg_point0 = pColorFacTable->Brightness_0;
		reg_point25 = pColorFacTable->Brightness_25;
		reg_point50 = pColorFacTable->Brightness_50;
		reg_point75 = pColorFacTable->Brightness_75;
		reg_point100 = pColorFacTable->Brightness_100;
		break;
	case APP_VIDEO_OSD_ITEM_CONTRAST:
		reg_point0 = pColorFacTable->Contrast_0;
		reg_point25 = pColorFacTable->Contrast_25;
		reg_point50 = pColorFacTable->Contrast_50;
		reg_point75 = pColorFacTable->Contrast_75;
		reg_point100 = pColorFacTable->Contrast_100;
		break;
	case APP_VIDEO_OSD_ITEM_SATURTUION:
		reg_point0 = pColorFacTable->Saturation_0;
		reg_point25 = pColorFacTable->Saturation_25;
		reg_point50 = pColorFacTable->Saturation_50;
		reg_point75 = pColorFacTable->Saturation_75;
		reg_point100 = pColorFacTable->Saturation_100;
		break;
	case APP_VIDEO_OSD_ITEM_HUE:
		reg_point0 = pColorFacTable->Hue_0;
		reg_point25 = pColorFacTable->Hue_25;
		reg_point50 = pColorFacTable->Hue_50;
		reg_point75 = pColorFacTable->Hue_75;
		reg_point100 = pColorFacTable->Hue_100;
		break;
	case APP_VIDEO_OSD_ITEM_SHARPNESS:
	default:
		reg_point0 = pColorFacTable->Sharpness_0;
		reg_point25 = pColorFacTable->Sharpness_25;
		reg_point50 = pColorFacTable->Sharpness_50;
		reg_point75 = pColorFacTable->Sharpness_75;
		reg_point100 = pColorFacTable->Sharpness_100;
#ifdef CONFIG_CUSTOMER_TV002
#ifdef CONFIG_TV002_DE_SHARPNESS
		reg_point0 = reg_point25 = reg_point50 = 0;
#endif
#endif
		break;
	}

	VIPprintf(" === bOsdItem = %d, reg_point0 = %d  reg_point25 = %d \n\n", bOsdItem, reg_point0, reg_point25);
	VIPprintf(" === reg_point50 = %d  reg_point75 = %d  reg_point100 = %d \n\n", reg_point50, reg_point75, reg_point100);
	if (value < 25) {
		startPoint = reg_point0;
		endPoint = reg_point25;
		temp = value;
	} else if ((value >=  25) && (value < 50)) {
		startPoint = reg_point25;
		endPoint = reg_point50;
		temp = value - 25;
	} else if ((value >=  50) && (value < 75)) {
		startPoint = reg_point50;
		endPoint = reg_point75;
		temp = value - 50;
	} else if (value >=  75) {
		startPoint = reg_point75;
		endPoint = reg_point100;
		temp = value - 75;
	}

	if (endPoint >= startPoint) {
		temp = (endPoint - startPoint) * temp / 25;
		temp +=  startPoint;
	} else if ((endPoint < startPoint)) {
		temp = (startPoint-endPoint) * temp / 25;
		temp = startPoint - temp;
	}

	if (temp > 255)
		temp = 255;

	return (unsigned char)temp;
#else

	unsigned int temp = 0;
	unsigned char startPoint, endPoint;
	unsigned char reg_point0 = 0;
	unsigned char reg_point50 = 0;
	unsigned char reg_point100 = 0;

	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	StructColorDataFacModeType *pColorFacTable;
	
	pColorFacTable = fwif_color_get_color_fac_mode(VIP_system_info_structure_table->color_fac_src_idx, 0);

	if (pColorFacTable == NULL)
		return 0;

	switch (bOsdItem) {
	case APP_VIDEO_OSD_ITEM_BRIGHTNESS:
		reg_point0 = pColorFacTable->Brightness_0;
		reg_point50 = pColorFacTable->Brightness_50;
		reg_point100 = pColorFacTable->Brightness_100;
		break;
	case APP_VIDEO_OSD_ITEM_CONTRAST:
		reg_point0 = pColorFacTable->Contrast_0;
		reg_point50 = pColorFacTable->Contrast_50;
	reg_point100 = pColorFacTable->Contrast_100;
		break;
	case APP_VIDEO_OSD_ITEM_SATURTUION:
		reg_point0 = pColorFacTable->Saturation_0;
		reg_point50 = pColorFacTable->Saturation_50;
		reg_point100 = pColorFacTable->Saturation_100;
		break;
	case APP_VIDEO_OSD_ITEM_HUE:
		reg_point0 = pColorFacTable->Hue_0;
		reg_point50 = pColorFacTable->Hue_50;
		reg_point100 = pColorFacTable->Hue_100;
		break;
	case APP_VIDEO_OSD_ITEM_SHARPNESS:
	default:
		reg_point0 = pColorFacTable->Sharpness_0;
		reg_point50 = pColorFacTable->Sharpness_50;
		reg_point100 = pColorFacTable->Sharpness_100;
		break;
	}

	if (value < 50) {
		startPoint = reg_point0;
		endPoint = reg_point50;
	} else {
		startPoint = reg_point50;
		endPoint = reg_point100;
		value -=  50;
	}

	if (endPoint >= startPoint) {
		temp = (unsigned char)(startPoint + (endPoint - startPoint)*value/50);
	} else if (endPoint < startPoint) {
		temp = (unsigned char)(startPoint - (startPoint-endPoint)*value/50);
	}

	if (temp > 255)
		temp = 255;

	VIPprintf("mapping = %d, %d, %d, %d, %d, %d \n", bOsdItem, value, temp, reg_point0, reg_point50, reg_point100);

	return (unsigned char)temp;

#endif
}



/*==============================rord.tsao end=====================================================*/
#if 0
void fwif_color_set_YUV2RGB_COEF_BY_Y_driver(unsigned char src_idx, unsigned char which_table)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	drvif_color_colorspaceyuv2rgbtransfer_coef_by_y(_MAIN_DISPLAY, which_table, gVip_Table->YUV2RGB_COEF_BY_Y[which_table]);
}

void fwif_color_set_YUV2RGB_UV_OFFSET_BY_Y_driver(unsigned char src_idx, unsigned char which_table)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	drvif_color_colorspaceyuv2rgbtransfer_uv_offset_by_y(_MAIN_DISPLAY, which_table, gVip_Table->YUV2RGB_UV_OFFSET_BY_Y[which_table]);
}
#endif

unsigned char fwif_color_get_Decide_YUV2RGB_TBL_Index(unsigned char src_idx, unsigned char display, unsigned char Input_Data_Mode)
{
	unsigned char ret_idx;

	switch (Input_Data_Mode) {
		case  YUV2RGB_INPUT_601_Limted:
			ret_idx = YUV2RGB_TBL_SELECT_601_Limted_235_240_to_255;
			break;
		case  YUV2RGB_INPUT_601_Full:
			ret_idx = YUV2RGB_TBL_SELECT_601_Limted_NO_Gain;
			break;
		case  YUV2RGB_INPUT_709_Limted:
			ret_idx = YUV2RGB_TBL_SELECT_709_Limted_235_240_to_255;
			break;
		case  YUV2RGB_INPUT_709_Full:
			ret_idx = YUV2RGB_TBL_SELECT_709_Limted_NO_Gain;
			break;
		case  YUV2RGB_INPUT_2020_NonConstantY:
			ret_idx = YUV2RGB_TBL_SELECT_2020_NonConstantY;
			break;
		case  YUV2RGB_INPUT_2020_ConstantY:
			ret_idx = YUV2RGB_TBL_SELECT_2020_ConstantY;
			break;
		default:
			ret_idx = YUV2RGB_TBL_SELECT_601_Limted_NO_Gain;
			break;
	}
	return ret_idx;
}

void fwif_color_set_YUV2RGB(unsigned char src_idx, unsigned char display, unsigned char which_table, unsigned char drvSkip_Flag_coefByY, unsigned char drvSkip_Flag_uvOffset)
{
	/*base default setting*/
	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t;
	/*unsigned char i;*/
	SLR_VIP_TABLE *gVip_Table = NULL;
	//UINT8 i;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	//unsigned char YUV2RGB_TBL_Idx;
	//unsigned char Input_mode;

	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if (VIP_system_info_structure_table == NULL)
		return;

	//Input_mode = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode;
	gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	/*use VIP_YUV2RGB_LEVEL_OFF as deault, set level by picture mode*/
	/*Coef and offset is set by OSD con, bri, hue,sat*/
	VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.RGB_Offset_Level = VIP_YUV2RGB_LEVEL_OFF;
	VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.UV_Offset_Level = VIP_YUV2RGB_LEVEL_OFF;
	VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.CoefByY_CtrlItem_Level = VIP_YUV2RGB_LEVEL_OFF;
	VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_TBL_Select = which_table;

	memcpy(&drv_vipCSMatrix_t, &(gVip_Table->YUV2RGB_CSMatrix_Table[which_table].YUV2RGB_CSMatrix[VIP_YUV2RGB_LEVEL_OFF]), sizeof(DRV_VIP_YUV2RGB_CSMatrix));

	//YUV2RGB_TBL_Idx = fwif_color_get_Decide_YUV2RGB_TBL_Index(src_idx, display, Input_mode);

	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_YUV2RGB_Base_Ctrl, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_CoefByY_ctrl, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);

	/*TBL2 (Sub channel)*/
	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_YUV2RGB_Base_Ctrl, VIP_YUV2RGB_Y_Seg_0, SLR_SUB_DISPLAY, VIP_Table_Select_2);
	if (drvSkip_Flag_coefByY == 0) {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_CoefByY_Index, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	}

	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_UVOffset_ctrl, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	if (drvSkip_Flag_uvOffset == 0) {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_UVOffset_Coef, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_UVOffset_Index, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	}

}
#if 0 /*for LG DB, chane to fwif_color_set_YUV2RGB_UV_Offset_tv006, no more use this*/
int fwif_color_set_YUV2RGB_UV_Offset(unsigned char src_idx, unsigned char display, unsigned char level)
{
	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t;
	unsigned char which_table, vip_src;
	/*unsigned char i;*/
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	if (gVip_Table == NULL || VIP_system_info_structure_table == NULL) {
		/*VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);*/
		VIPprintf("~get vipTable|shareMem Error return");
		return  -1;
	}

	if (display == SLR_MAIN_DISPLAY) {
		vip_src = VIP_system_info_structure_table->VIP_source;
		which_table = VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_TBL_Select;
		drv_vipCSMatrix_t.CTRL_ITEM.UVOffset_En = 1;
		drv_vipCSMatrix_t.CTRL_ITEM.UVOffset_Mode_Ctrl = 0;	/*default setting, */
		VIPprintf("UV offset %d, %d, %d\n", which_table, vip_src, level);
		/*setting from UI*/
		memcpy(&drv_vipCSMatrix_t.UV_Offset, &(gVip_Table->YUV2RGB_CSMatrix_Table[which_table].YUV2RGB_CSMatrix[level].UV_Offset), sizeof(DRV_VIP_YUV2RGB_UV_Offset));
		/*info setting to share mem*/
		VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.UV_Offset_Level = level;
		memcpy(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.UV_Offset), &(gVip_Table->YUV2RGB_CSMatrix_Table[which_table].YUV2RGB_CSMatrix[level].UV_Offset), sizeof(DRV_VIP_YUV2RGB_UV_Offset));

		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_UVOffset_ctrl, VIP_YUV2RGB_Y_Seg_Max, display, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_UVOffset_Coef, VIP_YUV2RGB_Y_Seg_Max, display, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_UVOffset_Index, VIP_YUV2RGB_Y_Seg_Max, display, VIP_Table_Select_1);
	} else {
		VIPprintf("~No Sub~ return\n");
	}

	return 0;
}
#endif
void fwif_color_set_CS_Matrix_byTBL_Level(unsigned char src_idx, unsigned char display, unsigned char which_table, VIP_YUV2RGB_LEVEL_SELECT which_Lv, unsigned char drvSkip_Flag_coefByY, unsigned char drvSkip_Flag_uvOffset)
{
	/*now no use, set by con, bri, sat, hue*/
}

void fwif_color_set_UV_Offset_byTBL_Level(unsigned char src_idx, unsigned char display, unsigned char which_table, VIP_YUV2RGB_LEVEL_SELECT which_Lv, unsigned char drvSkip_Flag_coefByY, unsigned char drvSkip_Flag_uvOffset)
{
	/* base default setting*/
	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t;
	/*unsigned char i;*/

	_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	if (VIP_system_info_structure_table == NULL)
		return;

	VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.UV_Offset_Level = which_Lv;
	VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_TBL_Select = which_table;

	memcpy(&(drv_vipCSMatrix_t.UV_Offset), &(gVip_Table->YUV2RGB_CSMatrix_Table[which_table].YUV2RGB_CSMatrix[which_Lv].UV_Offset), sizeof(DRV_VIP_YUV2RGB_UV_Offset));

	/* set using matrix to share memory*/
	if (VIP_system_info_structure_table != NULL) {
#ifdef CONFIG_ARM64
		memcpy_toio(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.UV_Offset), &drv_vipCSMatrix_t.UV_Offset, sizeof(DRV_VIP_YUV2RGB_UV_Offset));
#else
		memcpy(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix.UV_Offset), &drv_vipCSMatrix_t.UV_Offset, sizeof(DRV_VIP_YUV2RGB_UV_Offset));
#endif
	} else
		VIPprintf("VIP_system_info_structure_table = NULL, fwif_color_colorspaceyuv2rgbtransfer\n");

	if (drvSkip_Flag_uvOffset == 0) {
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_UVOffset_Coef, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_UVOffset_Index, VIP_YUV2RGB_Y_Seg_Max, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	}

}


/*initialization in quality handler, mark thiss function. elieli*/
/*using fwif_color_set_YUV2RGB instead of both fwif_color_set_YUV2RGB_COEF_BY_Y and fwif_color_set_YUV2RGB_UV_OFFSET_BY_Y*/
#if 0
void fwif_color_set_YUV2RGB_COEF_BY_Y(unsigned char src_idx, unsigned char display, unsigned char which_table)
{
	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t;
	/*unsigned short *table_idx[YUV2RGB_COEF_BY_Y_Curve_Num];*/
	unsigned char i;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	drv_vipCSMatrix_t.CTRL_ITEM.CoefByY_En = 1;
	VIPprintf("YUV2RGB Coef by Y ON, table is %d\n", which_table);

	/*
	for (i = 0; i < YUV2RGB_COEF_BY_Y_Curve_Num; i++)
		table_idx[i] = (&(gVip_Table->YUV2RGB_COEF_BY_Y[0][i][0]) + (YUV2RGB_COEF_BY_Y_Curve_Num*YUV2RGB_COEF_BY_Y_Seg_Num*which_table));
	*/

	memcpy(&(drv_vipCSMatrix_t.COEF_By_Y), &(gVip_Table->YUV2RGB_CSMatrix[which_table].COEF_By_Y), sizeof(DRV_VIP_YUV2RGB_COEF_By_Y));
	/*
	for (i = 0; i < YUV2RGB_COEF_BY_Y_Seg_Num; i++)
	{
		drv_vipCSMatrix_t.COEF_By_Y.K11[i] = table_idx[0][i];
		drv_vipCSMatrix_t.K12[i] = table_idx[1][i];
		drv_vipCSMatrix_t.K13[i] = table_idx[2][i];
		drv_vipCSMatrix_t.K22[i] = table_idx[3][i];
		drv_vipCSMatrix_t.K23[i] = table_idx[4][i];
		drv_vipCSMatrix_t.K32[i] = table_idx[5][i];
		drv_vipCSMatrix_t.K33[i] = table_idx[6][i];
	}
	*/

	/*o-------------base setting----------o*/
	drv_vipCSMatrix_t.CTRL_ITEM.CoefByY_En = 1;
	/*o-------------base setting----------o*/

	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_CoefByY_ctrl);
	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_Y_Only, VIP_YUV2RGB_Y_Seg_Max);
	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_Coef_C_Only, VIP_YUV2RGB_Y_Seg_Max);

}

void fwif_color_set_YUV2RGB_UV_OFFSET_BY_Y(unsigned char src_idx, unsigned char display, unsigned char which_table)
{
	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t;
	/*unsigned int *table_idx[YUV2RGB_UV_OFFSET_BY_Y_Curve_Num];*/
	unsigned char i;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	drv_vipCSMatrix_t.CTRL_ITEM.UVOffset_En = 1;
	drv_vipCSMatrix_t.CTRL_ITEM.UVOffset_Mode_Ctrl = 0;	/*default setting, */
	VIPprintf("UV offset ON, table is %d\n", which_table);
	/*
	for (i = 0; i < YUV2RGB_UV_OFFSET_BY_Y_Curve_Num; i++)
		table_idx[i] = (&(gVip_Table->YUV2RGB_UV_OFFSET_BY_Y[0][i][0]) + (YUV2RGB_UV_OFFSET_BY_Y_Curve_Num*YUV2RGB_UV_OFFSET_BY_Y_Seg_Num*which_table));

	for (i = 0; i < YUV2RGB_UV_OFFSET_BY_Y_Seg_Num; i++)
	{
		drv_vipCSMatrix_t.Uoffset[i] = table_idx[0][i];
		drv_vipCSMatrix_t.Voffset[i] = table_idx[1][i];
		drv_vipCSMatrix_t.Ustep[i] = table_idx[2][i];
		drv_vipCSMatrix_t.Vstep[i] = table_idx[3][i];
	}
	*/

	memcpy(&(drv_vipCSMatrix_t.UV_Offset), &(gVip_Table->YUV2RGB_CSMatrix[which_table].UV_Offset), sizeof(DRV_VIP_YUV2RGB_UV_Offset));

	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_UVOffset_ctrl);
	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_UVOffset_Coef);

}


void fwif_color_colorspaceyuv2rgbtransfer(unsigned char display, unsigned char nSrcType, unsigned char VO_Jpeg_Back_YUV)
{
	/*base default setting*/
	unsigned int *table_idx = 0;
	unsigned int *uvOffset_tableIdx = 0;
	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t;
	unsigned char i;

	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	/*use first table for default*/
	table_idx = &(gVip_Table->YUV2RGB_COEF_BY_Y[0][0][0]);
	uvOffset_tableIdx = &(gVip_Table->YUV2RGB_UV_OFFSET_BY_Y[0][0][0]);

	for (i = 0; i < VIP_CSMatrix_Index_Max; i++) {
		drv_vipCSMatrix_t.K11[i] = table_idx[i];
		drv_vipCSMatrix_t.K12[i] = table_idx[i+VIP_CSMatrix_Index_Max];
		drv_vipCSMatrix_t.K13[i] = table_idx[i+VIP_CSMatrix_Index_Max*2];
		drv_vipCSMatrix_t.K22[i] = table_idx[i+VIP_CSMatrix_Index_Max*3];
		drv_vipCSMatrix_t.K23[i] = table_idx[i+VIP_CSMatrix_Index_Max*4];
		drv_vipCSMatrix_t.K32[i] = table_idx[i+VIP_CSMatrix_Index_Max*5];
		drv_vipCSMatrix_t.K33[i] = table_idx[i+VIP_CSMatrix_Index_Max*6];
		drv_vipCSMatrix_t.Uoffset[i] = table_idx[i];
		drv_vipCSMatrix_t.Voffset[i] = table_idx[i+VIP_CSMatrix_Index_Max];
		drv_vipCSMatrix_t.Ustep[i] = table_idx[i+VIP_CSMatrix_Index_Max*2];
		drv_vipCSMatrix_t.Vstep[i] = table_idx[i+VIP_CSMatrix_Index_Max*3];
	}

	/*o-------------default base setting----------o*/
	drv_vipCSMatrix_t.Overlay = 0;
	drv_vipCSMatrix_t.YUV2RGB_Enable = 1;
	drv_vipCSMatrix_t.Table_Select = display;	/*main CH use table 1*/
	drv_vipCSMatrix_t.OutShift_En = 0;
	drv_vipCSMatrix_t.CbCr_Clamp = 1;
	drv_vipCSMatrix_t.Y_Clamp = 0;
	drv_vipCSMatrix_t.R_offset  = 0;
	drv_vipCSMatrix_t.G_offset  = 0;
	drv_vipCSMatrix_t.B_offset  = 0;
	drv_vipCSMatrix_t.CoefByY_En = 1;
	drv_vipCSMatrix_t.UVOffset_En = 1;
	drv_vipCSMatrix_t.UVOffset_Mode_Ctrl = 0; /*use and mode to avoid color distortion.*/
	/*o-------------default base setting----------o*/

	for (i = 0; i < VIP_CSMatrix_MAX; i++)
		drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, (VIP_CSMatrix_WriteType)i, VIP_CSMatrix_Index_Max);

	if (table_idx !=  NULL) {
		/*set using matrix to share memory*/
		if (VIP_system_info_structure_table !=  NULL) {
			memcpy((unsigned short *)(&VIP_system_info_structure_table->YUV2RGB_COEF_CSMatrix), &drv_vipCSMatrix_t, sizeof(DRV_VIP_YUV2RGB_CSMatrix));
		} else {
			VIPprintf("VIP_system_info_structure_table = NULL, fwif_color_colorspaceyuv2rgbtransfer\n");
		}
	} else {
		VIPprintf("ERROR, table_index == NULL, fwif_color_colorspaceyuv2rgbtransfer !!\n");
	}

#if 0
#ifdef RUN_ON_TVBOX
	if ((scalerdisplay_get_display_tve_mode() >=  _MODE_480I) && (scalerdisplay_get_display_tve_mode() <=  _MODE_576P))
		table_index = tYUV2RGB_COEF_TVBOX_SD;
	else
		table_index = tYUV2RGB_COEF_TVBOX_HD;
#else
	table_index = tYUV2RGB_COEF_601_YCbCr_NOClampY;
#endif

	drvif_color_colorspaceyuv2rgbtransfer(display, table_index);

	if (table_index !=  NULL) {
		/*set using matrix to share memory*/
		if (VIP_system_info_structure_table !=  NULL) {
			memcpy((unsigned short *)(&VIP_system_info_structure_table->YUV2RGB_COEF_CSMatrix), table_index, sizeof(VIP_YUV2RGB_COEF_CSMatrix));
		} else {
			VIPprintf("VIP_system_info_structure_table = NULL, fwif_color_colorspaceyuv2rgbtransfer\n");
		}
	} else {
		VIPprintf("ERROR, table_index == NULL, fwif_color_colorspaceyuv2rgbtransfer !!\n");
	}
#endif
}
#endif

unsigned int quality_init_value[QUALITY_INIT_MAX];
void fwif_color_set_quality_init_value(unsigned char item_index, unsigned short value)
{
	VIPprintf("1.set_quality_init_value[%d] = %d\n", item_index, value);

	if (item_index >=  QUALITY_INIT_MAX)
		return;
	quality_init_value[item_index] = (int)value;

	VIPprintf("2.set_quality_init_value[%d] = %x\n", item_index, quality_init_value[item_index]);
}
int fwif_color_set_quality_init_sendRPC(void)
{
	int ret = 1;
	int i  = 0;

	unsigned int *pwTemp = (unsigned int *)Scaler_GetShareMemVirAddr(SCALERIOC_SET_VIP_QUALITY_INIT);
	if (pwTemp) {
#ifdef CONFIG_ARM64
		memcpy_toio((unsigned int *)Scaler_GetShareMemVirAddr(SCALERIOC_SET_VIP_QUALITY_INIT),
			&quality_init_value[0], sizeof(unsigned int) * QUALITY_INIT_MAX);
#else
		memcpy((unsigned int *)Scaler_GetShareMemVirAddr(SCALERIOC_SET_VIP_QUALITY_INIT),
			&quality_init_value[0], sizeof(unsigned int) * QUALITY_INIT_MAX);
#endif

		for (i = 0; i < QUALITY_INIT_MAX; i++) {
			pwTemp[i] = fwif_color_ChangeOneUINT32Endian(pwTemp[i], 0);
			VIPprintf("set_quality_init_sendRPC[%d] = %x\n", i, pwTemp[i]);
		}

		ret = Scaler_SendRPC(SCALERIOC_SET_VIP_QUALITY_INIT, 0, 0);
	}
	return ret;
}
//   Local_Dimming for OSD

unsigned char fwif_color_BackLight_Remap(unsigned char nValue)
{
	unsigned char nBackLight_Value;
	UINT16 temp;
	nBackLight_Value = nValue;

	temp = fwif_OsdMapToRegValue(APP_VIDEO_OSD_ITEM_BACKLIGHT,nBackLight_Value);
	if(temp > 255)
		nBackLight_Value = 255;
	else
		nBackLight_Value = (UINT8)(temp);
	return nBackLight_Value;
}

// =============

/*#ifdef LocalDimming*/

void fwif_color_set_LD_Enable(unsigned char src_idx, bool enable)
{
	drvif_color_set_LD_Enable(enable);
}


void fwif_color_set_LD_Global_Ctrl(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_LD_Global_Ctrl data;
	extern DRV_Local_Dimming_Table Local_Dimming_Table[LD_Table_NUM];

	data.ld_comp_en = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_comp_en;
	data.ld_db_en = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_db_en;
	data.ld_db_apply = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_db_apply;
	data.ld_db_read_level = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_db_read_level;
	data.ld_blk_hnum = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_blk_hnum;
	data.ld_blk_vnum = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_blk_vnum;
	data.ld_gdim_mode = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_gdim_mode;
	data.ld_blk_type = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_blk_type;
	data.ld_hist_mode = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_hist_mode;
	data.ld_tenable = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_tenable;
	data.ld_valid = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_valid;
	data.ld_blk_hsize = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_blk_hsize;
	data.ld_blk_vsize = Local_Dimming_Table[TableIdx].LD_Global_Ctrl.ld_blk_vsize;

	drvif_color_set_LD_Global_Ctrl((DRV_LD_Global_Ctrl *) &data);
}

void fwif_color_set_LD_Backlight_Decision(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_LD_Backlight_Decision data;
	extern DRV_Local_Dimming_Table Local_Dimming_Table[LD_Table_NUM];

	data.ld_maxgain = Local_Dimming_Table[TableIdx].LD_Backlight_Decision.ld_maxgain;
	data.ld_avegain = Local_Dimming_Table[TableIdx].LD_Backlight_Decision.ld_avegain;
	data.ld_histshiftbit = Local_Dimming_Table[TableIdx].LD_Backlight_Decision.ld_histshiftbit;
	data.ld_hist0gain = Local_Dimming_Table[TableIdx].LD_Backlight_Decision.ld_hist0gain;
	data.ld_hist1gain = Local_Dimming_Table[TableIdx].LD_Backlight_Decision.ld_hist1gain;
	data.ld_hist2gain = Local_Dimming_Table[TableIdx].LD_Backlight_Decision.ld_hist2gain;
	data.ld_hist3gain = Local_Dimming_Table[TableIdx].LD_Backlight_Decision.ld_hist3gain;
	data.ld_hist4gain = Local_Dimming_Table[TableIdx].LD_Backlight_Decision.ld_hist4gain;
	data.ld_hist5gain = Local_Dimming_Table[TableIdx].LD_Backlight_Decision.ld_hist5gain;
	data.ld_hist6gain = Local_Dimming_Table[TableIdx].LD_Backlight_Decision.ld_hist6gain;
	data.ld_hist7gain = Local_Dimming_Table[TableIdx].LD_Backlight_Decision.ld_hist7gain;

	drvif_color_set_LD_Backlight_Decision((DRV_LD_Backlight_Decision *) &data);
}

void fwif_color_set_LD_Spatial_Filter(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_LD_Spatial_Filter data;
	extern DRV_Local_Dimming_Table Local_Dimming_Table[LD_Table_NUM];

	data.ld_spatialcoef0 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialcoef0;
	data.ld_spatialcoef1 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialcoef1;
	data.ld_spatialcoef2 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialcoef2;
	data.ld_spatialcoef3 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialcoef3;
	data.ld_spatialcoef4 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialcoef4;
	data.ld_spatialcoef5 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialcoef5;
	data.ld_spatialcoef6 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialcoef6;
	data.ld_spatialcoef7 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialcoef7;
	data.ld_spatialcoef8 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialcoef8;
	data.ld_spatialcoef9 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialcoef9;
	data.ld_spatialcoef10 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialcoef10;
	data.spatial_new_mode = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.spatial_new_mode;
	data.ld_spatialnewcoef00 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef00;
	data.ld_spatialnewcoef01 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef01;
	data.ld_spatialnewcoef02 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef02;
	data.ld_spatialnewcoef03 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef03;
	data.ld_spatialnewcoef04 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef04;
	data.ld_spatialnewcoef10 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef10;
	data.ld_spatialnewcoef11 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef11;
	data.ld_spatialnewcoef12 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef12;
	data.ld_spatialnewcoef13 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef13;
	data.ld_spatialnewcoef14 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef14;
	data.ld_spatialnewcoef20 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef20;
	data.ld_spatialnewcoef21 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef21;
	data.ld_spatialnewcoef22 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef22;
	data.ld_spatialnewcoef23 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef23;
	data.ld_spatialnewcoef24 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef24;
	data.ld_spatialnewcoef30 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef30;
	data.ld_spatialnewcoef31 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef31;
	data.ld_spatialnewcoef32 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef32;
	data.ld_spatialnewcoef33 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef33;
	data.ld_spatialnewcoef34 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef34;
	data.ld_spatialnewcoef05 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef05;
	data.ld_spatialnewcoef15 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef15;
	data.ld_spatialnewcoef25 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef25;
	data.ld_spatialnewcoef35 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef35;
	data.ld_spatialnewcoef40 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef40;
	data.ld_spatialnewcoef41 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef41;
	data.ld_spatialnewcoef50 = Local_Dimming_Table[TableIdx].LD_Spatial_Filter.ld_spatialnewcoef50;

	drvif_color_set_LD_Spatial_Filter((DRV_LD_Spatial_Filter *) &data);
}

void fwif_color_set_LD_Spatial_Remap(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_LD_Spatial_Remap data;
	extern DRV_Local_Dimming_Table Local_Dimming_Table[LD_Table_NUM];

	data.ld_spatialremapen = Local_Dimming_Table[TableIdx].LD_Spatial_Remap.ld_spatialremapen;
	memcpy(&(data.ld_spatialremaptab), &(Local_Dimming_Table[TableIdx].LD_Spatial_Remap.ld_spatialremaptab),sizeof(unsigned short)*65);

	drvif_color_set_LD_Spatial_Remap((DRV_LD_Spatial_Remap *) &data);
}

void fwif_color_set_LD_Boost(unsigned char src_idx, unsigned char TableIdx)
{
	DRV_LD_Boost data;
	extern DRV_Local_Dimming_Table Local_Dimming_Table[LD_Table_NUM];

	data.ld_backlightboosten= Local_Dimming_Table[TableIdx].LD_Boost.ld_backlightboosten;
	memcpy(&(data.ld_boost_gain_lut), &(Local_Dimming_Table[TableIdx].LD_Boost.ld_boost_gain_lut),sizeof(unsigned short)*65);
	memcpy(&(data.ld_boost_curve_lut), &(Local_Dimming_Table[TableIdx].LD_Boost.ld_boost_curve_lut),sizeof(unsigned short)*65);
	drvif_color_set_LD_Boost((DRV_LD_Boost *) &data);
}


void fwif_color_set_LD_Temporal_Filter(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_LD_Temporal_Filter data;
	extern DRV_Local_Dimming_Table Local_Dimming_Table[LD_Table_NUM];

	data.ld_tmp_pos0thd = Local_Dimming_Table[TableIdx].LD_Temporal_Filter.ld_tmp_pos0thd;
	data.ld_tmp_pos1thd = Local_Dimming_Table[TableIdx].LD_Temporal_Filter.ld_tmp_pos1thd;
	data.ld_tmp_posmingain = Local_Dimming_Table[TableIdx].LD_Temporal_Filter.ld_tmp_posmingain;
	data.ld_tmp_posmaxgain = Local_Dimming_Table[TableIdx].LD_Temporal_Filter.ld_tmp_posmaxgain;
	data.ld_tmp_neg0thd = Local_Dimming_Table[TableIdx].LD_Temporal_Filter.ld_tmp_neg0thd;
	data.ld_tmp_neg1thd = Local_Dimming_Table[TableIdx].LD_Temporal_Filter.ld_tmp_neg1thd;
	data.ld_tmp_negmingain = Local_Dimming_Table[TableIdx].LD_Temporal_Filter.ld_tmp_negmingain;
	data.ld_tmp_negmaxgain = Local_Dimming_Table[TableIdx].LD_Temporal_Filter.ld_tmp_negmaxgain;
	data.ld_tmp_maxdiff = Local_Dimming_Table[TableIdx].LD_Temporal_Filter.ld_tmp_maxdiff;
	data.ld_tmp_scenechangegain1 = Local_Dimming_Table[TableIdx].LD_Temporal_Filter.ld_tmp_scenechangegain1;

	drvif_color_set_LD_Temporal_Filter((DRV_LD_Temporal_Filter *) &data);
}

void fwif_color_set_LD_Backlight_Final_Decision(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_LD_Backlight_Final_Decision data;
	extern DRV_Local_Dimming_Table Local_Dimming_Table[LD_Table_NUM];

	data.ld_blu_wr_num = Local_Dimming_Table[TableIdx].LD_Backlight_Final_Decision.ld_blu_wr_num;
	data.ld_blu_spitotal = Local_Dimming_Table[TableIdx].LD_Backlight_Final_Decision.ld_blu_spitotal;
	data.ld_blu_spien = Local_Dimming_Table[TableIdx].LD_Backlight_Final_Decision.ld_blu_spien;
	data.ld_blu_nodim = Local_Dimming_Table[TableIdx].LD_Backlight_Final_Decision.ld_blu_nodim;
	data.ld_blu_usergain = Local_Dimming_Table[TableIdx].LD_Backlight_Final_Decision.ld_blu_usergain;

	drvif_color_set_LD_Backlight_Final_Decision((DRV_LD_Backlight_Final_Decision *) &data);
}


void fwif_color_set_LD_Data_Compensation(unsigned char src_idx, unsigned char TableIdx)
{
	DRV_LD_Data_Compensation data;
	extern DRV_Local_Dimming_Table Local_Dimming_Table[LD_Table_NUM];

	data.ld_data_comp_mode = Local_Dimming_Table[TableIdx].LD_Data_Compensation.ld_data_comp_mode;
	data.ld_comp_satrange = Local_Dimming_Table[TableIdx].LD_Data_Compensation.ld_comp_satrange;
	data.ld_comp_softmax = Local_Dimming_Table[TableIdx].LD_Data_Compensation.ld_comp_softmax;
	data.ld_comp_minlimit = Local_Dimming_Table[TableIdx].LD_Data_Compensation.ld_comp_minlimit;
	data.ld_softcomp_gain = Local_Dimming_Table[TableIdx].LD_Data_Compensation.ld_softcomp_gain;
	data.ld_comp_maxmode = Local_Dimming_Table[TableIdx].LD_Data_Compensation.ld_comp_maxmode;
	data.ld_comp_inv_shift = Local_Dimming_Table[TableIdx].LD_Data_Compensation.ld_comp_inv_shift;
	data.ld_comp_inv_mode = Local_Dimming_Table[TableIdx].LD_Data_Compensation.ld_comp_inv_mode;
	data.ld_srcgainsel = Local_Dimming_Table[TableIdx].LD_Data_Compensation.ld_srcgainsel;
	data.ld_uv_comp_en = Local_Dimming_Table[TableIdx].LD_Data_Compensation.ld_uv_comp_en; // Merlin6 add
	data.ld_uv_comp_coeff = Local_Dimming_Table[TableIdx].LD_Data_Compensation.ld_uv_comp_coeff; // Merlin6 add

	drvif_color_set_LD_Data_Compensation((DRV_LD_Data_Compensation *) &data);
}

unsigned char g_bNotFirstRun_LD_Data_Compensation_NewMode_2DTable = 0;
void fwif_color_set_LD_Data_Compensation_NewMode_2DTable(unsigned char src_idx, unsigned char TableIdx)
{
	static DRV_LD_Data_Compensation_NewMode_2DTable data;
	extern DRV_LD_Data_Compensation_NewMode_2DTable LD_Data_Compensation_NewMode_2DTable[LD_Table_NUM];

	if (g_bNotFirstRun_LD_Data_Compensation_NewMode_2DTable &&
		memcmp(&LD_Data_Compensation_NewMode_2DTable[TableIdx], &data, sizeof(DRV_LD_Data_Compensation_NewMode_2DTable)) == 0)
		return;

	memcpy(&(data.ld_comp_2Dtable), &(LD_Data_Compensation_NewMode_2DTable[TableIdx].ld_comp_2Dtable),sizeof(unsigned int)*17*17);
	drvif_color_set_LD_Data_Compensation_NewMode_2DTable((DRV_LD_Data_Compensation_NewMode_2DTable *) &data);

	g_bNotFirstRun_LD_Data_Compensation_NewMode_2DTable = 1;
}




void fwif_color_set_LD_Backlight_Profile_Interpolation(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_LD_Backlight_Profile_Interpolation data;
	extern DRV_Local_Dimming_Table Local_Dimming_Table[LD_Table_NUM];

	data.ld_tab_hsize = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_tab_hsize;
	data.ld_hfactor = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_hfactor;
	data.ld_hboundary = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_hboundary;
	data.ld_hinitphase1 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_hinitphase1;
	data.ld_hinitphase2 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_hinitphase2;
	data.ld_hinitphase3_left = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_hinitphase3_left;
	data.ld_tab_vsize = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_tab_vsize;
	data.ld_vfactor = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vfactor;
	data.ld_vboundary = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vboundary;
	data.ld_vinitphase1 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vinitphase1;
	data.ld_vinitphase2 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vinitphase2;
	data.ld_vinitphase3_left = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vinitphase3_left;
	data.ld_blight_update_en = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_blight_update_en;
	data.ld_blight_sw_mode = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_blight_sw_mode;
	data.ld_table_sw_mode = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_table_sw_mode;
	data.ld_htabsel_0 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_0;
	data.ld_htabsel_1 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_1;
	data.ld_htabsel_2 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_2;
	data.ld_htabsel_3 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_3;
	data.ld_htabsel_4 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_4;
	data.ld_htabsel_5 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_5;
	data.ld_htabsel_6 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_6;
	data.ld_htabsel_7 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_7;
	data.ld_htabsel_8 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_8;
	data.ld_htabsel_9 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_9;
	data.ld_htabsel_10 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_10;
	data.ld_htabsel_11 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_11;
	data.ld_htabsel_12 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_12;
	data.ld_htabsel_13 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_13;
	data.ld_htabsel_14 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_14;
	data.ld_htabsel_15 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_15;
	data.ld_htabsel_16 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_16;
	data.ld_htabsel_17 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_17;
	data.ld_htabsel_18 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_18;
	data.ld_htabsel_19 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_19;
	data.ld_htabsel_20 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_20;
	data.ld_htabsel_21 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_21;
	data.ld_htabsel_22 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_22;
	data.ld_htabsel_23 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_23;
	data.ld_htabsel_24 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_24;
	data.ld_htabsel_25 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_25;
	data.ld_htabsel_26 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_26;
	data.ld_htabsel_27 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_27;
	data.ld_htabsel_28 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_28;
	data.ld_htabsel_29 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_29;
	data.ld_htabsel_30 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_30;
	data.ld_htabsel_31 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_htabsel_31;
	data.ld_vtabsel_0 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_0;
	data.ld_vtabsel_1 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_1;
	data.ld_vtabsel_2 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_2;
	data.ld_vtabsel_3 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_3;
	data.ld_vtabsel_4 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_4;
	data.ld_vtabsel_5 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_5;
	data.ld_vtabsel_6 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_6;
	data.ld_vtabsel_7 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_7;
	data.ld_vtabsel_8 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_8;
	data.ld_vtabsel_9 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_9;
	data.ld_vtabsel_10 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_10;
	data.ld_vtabsel_11 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_11;
	data.ld_vtabsel_12 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_12;
	data.ld_vtabsel_13 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_13;
	data.ld_vtabsel_14 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_14;
	data.ld_vtabsel_15 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_15;
	data.ld_vtabsel_16 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_16;
	data.ld_vtabsel_17 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_17;
	data.ld_vtabsel_18 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_18;
	data.ld_vtabsel_19 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_19;
	data.ld_vtabsel_20 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_20;
	data.ld_vtabsel_21 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_21;
	data.ld_vtabsel_22 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_22;
	data.ld_vtabsel_23 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_23;
	data.ld_vtabsel_24 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_24;
	data.ld_vtabsel_25 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_25;
	data.ld_vtabsel_26 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_26;
	data.ld_vtabsel_27 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_27;
	data.ld_vtabsel_28 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_28;
	data.ld_vtabsel_29 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_29;
	data.ld_vtabsel_30 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_30;
	data.ld_vtabsel_31 = Local_Dimming_Table[TableIdx].LD_Backlight_Profile_Interpolation.ld_vtabsel_31;
	drvif_color_set_LD_Backlight_Profile_Interpolation((DRV_LD_Backlight_Profile_Interpolation *) &data);
}

void fwif_color_set_LD_BL_Profile_Interpolation_Table(unsigned char src_idx, unsigned char TableIdx)
{

	int i, j, k = 0;
	extern unsigned int LD_Backlight_Profile_Interpolation_table[LD_Table_NUM][BL_Profile_Table_NUM][BL_Profile_Table_ROW][BL_Profile_Table_COLUMN];
	static unsigned int data[BL_Profile_Table_NUM][BL_Profile_Table_ROW][BL_Profile_Table_COLUMN];

	for (i = 0; i < BL_Profile_Table_NUM; i++) {
		for (j = 0; j < BL_Profile_Table_ROW; j++) {
			for (k = 0; k < BL_Profile_Table_COLUMN; k++) {
				data[i][j][k] = LD_Backlight_Profile_Interpolation_table[TableIdx][i][j][k];
				VIPprintf(" %d\t", data[i][j][k]);
			}
			VIPprintf("\n");
		}
		VIPprintf("\n");
	}
	drvif_color_set_LD_BL_Profile_Interpolation_Table((unsigned int *)&data);

}

void fwif_color_set_LD_BL_Profile_Interpolation_Table_HV(unsigned char src_idx, unsigned char TableIdx)
{


	extern SLR_VIP_TABLE_BLPF m_defaultVipTableBLPF;
	drvif_color_set_LD_BL_Profile_Interpolation_Table_HV((unsigned int *) &m_defaultVipTableBLPF.LD_Backlight_Profile_Interpolation_table_H, (unsigned int *) &m_defaultVipTableBLPF.LD_Backlight_Profile_Interpolation_table_V);


}

void fwif_color_set_LD_Demo_Window(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_LD_Demo_Window data;
	extern DRV_Local_Dimming_Table Local_Dimming_Table[LD_Table_NUM];

	data.ld_demo_en = Local_Dimming_Table[TableIdx].LD_Demo_Window.ld_demo_en;
	data.ld_demo_mode = Local_Dimming_Table[TableIdx].LD_Demo_Window.ld_demo_mode;
	data.ld_demo_top = Local_Dimming_Table[TableIdx].LD_Demo_Window.ld_demo_top;
	data.ld_demo_bottom = Local_Dimming_Table[TableIdx].LD_Demo_Window.ld_demo_bottom;
	data.ld_demo_left = Local_Dimming_Table[TableIdx].LD_Demo_Window.ld_demo_left;
	data.ld_demo_right = Local_Dimming_Table[TableIdx].LD_Demo_Window.ld_demo_right;

	drvif_color_set_LD_Demo_Window((DRV_LD_Demo_Window *) &data);
}

unsigned char ucLD_Init_Done;
void fwif_color_Set_LD_Init_Done(unsigned char status)
{
	ucLD_Init_Done = status;
}

void fwif_color_set_LD_SPIDataSRAM_Duty(unsigned short duty) /*12bits input*/
{

	unsigned int i=0;
	DRV_LD_Global_Ctrl tLD_Global_Ctrl;
	DRV_LD_LDSPI_DATASRAM_TYPE tLD_LDSPI_DataSRAM;

	drvif_color_get_LD_Global_Ctrl(&tLD_Global_Ctrl);
	tLD_LDSPI_DataSRAM.SRAM_Position = 0;
	tLD_LDSPI_DataSRAM.SRAM_Length = (tLD_Global_Ctrl.ld_blk_hnum+1)*(tLD_Global_Ctrl.ld_blk_vnum+1);
	tLD_LDSPI_DataSRAM.SRAM_Value = (unsigned short *)dvr_malloc(tLD_LDSPI_DataSRAM.SRAM_Length*sizeof(unsigned short));
	if(tLD_LDSPI_DataSRAM.SRAM_Value == NULL){
		rtd_pr_vpq_err("[ERROR]fwif_color_set_LD_SPIDataSRAM_Duty Allocate SRAM_Length=%x fail\n",tLD_LDSPI_DataSRAM.SRAM_Length);
		return;
	}
	for(i=0;i<tLD_LDSPI_DataSRAM.SRAM_Length;i++) {
		*(tLD_LDSPI_DataSRAM.SRAM_Value+i) = duty;
	}
	drvif_color_set_LDSPI_DataSRAM_Data_Continuous(&tLD_LDSPI_DataSRAM, 1);
	dvr_free(tLD_LDSPI_DataSRAM.SRAM_Value);
	
}



/*LocalDimming Related Function End*/


void fwif_color_set_LC_Enable(unsigned char src_idx,bool enable)
{
	if (get_vsc_run_pc_mode() && (Get_DisplayMode_Src(SLR_MAIN_DISPLAY) == VSC_INPUTSRC_HDMI)) //RGB444
		drvif_color_set_LC_Enable(0);
	else
		drvif_color_set_LC_Enable(enable);
}

extern DRV_Local_Contrast_Table Local_Contrast_Table[LC_Table_NUM];

void fwif_color_set_LC_Global_Ctrl(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_Global_Ctrl *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_Global_Ctrl;
	
	drvif_color_set_LC_Global_Ctrl(pData);
	fwif_color_set_LC_Global_Region_Num_Size(TableIdx, LC_BLOCK_48x27);
}

void fwif_color_set_LC_Temporal_Filter(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_Temporal_Filter *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_Temporal_Filter;
	drvif_color_set_LC_Temporal_Filter(pData);
}



void fwif_color_set_LC_Backlight_Profile_Interpolation(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_Backlight_Profile_Interpolation *pData;
	unsigned short *tmp;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	down(&LC_Semaphore);
	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_Backlight_Profile_Interpolation;
	drvif_color_set_LC_Backlight_Profile_Interpolation(pData);
	
	tmp = pVipTable->VIP_Local_Contrast_Table[TableIdx].LC_Backlight_Profile_Interpolation_table[0];
	drvif_color_set_LC_BL_Profile_Interpolation_Table(tmp,0,(pData->lc_tab_hsize+1)*5);
	
	tmp = pVipTable->VIP_Local_Contrast_Table[TableIdx].LC_Backlight_Profile_Interpolation_table[1];
	drvif_color_set_LC_BL_Profile_Interpolation_Table(tmp,1,(pData->lc_tab_vsize+1)*5);
	up(&LC_Semaphore);
}

void fwif_color_set_LC_Demo_Window(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_Demo_Window *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_Demo_Window;

	drvif_color_set_LC_Demo_Window(pData);
}


void fwif_color_set_LC_ToneMapping_SetGrid0(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_ToneMapping_Grid0 *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_ToneMapping_Grid0;

	drvif_color_set_LC_ToneMapping_Grid0(pData);
}

void fwif_color_set_LC_ToneMapping_SetGrid2(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_ToneMapping_Grid2 *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_ToneMapping_Grid2;

	drvif_color_set_LC_ToneMapping_Grid2(pData);
}

void fwif_color_set_LC_ToneMapping_CurveSelect(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_ToneMapping_CurveSelect *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_ToneMapping_CurveSelect;

	drvif_color_set_LC_ToneMapping_CurveSelect(pData);
}

extern DRV_AI_SCENE_Ctrl_table ai_scene_ctrl;
void fwif_color_set_LC_ToneMapping_Blend(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_ToneMapping_Blend *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_ToneMapping_Blend;

	drvif_color_set_LC_ToneMapping_Blend(pData);
}

void fwif_color_set_LC_Shpnr_Gain1st(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_Shpnr_Gain1st *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_Shpnr_Gain1st;

	drvif_color_set_LC_Shpnr_Gain1st(pData);
}

void fwif_color_set_LC_Shpnr_Gain2nd(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_Shpnr_Gain2nd *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_Shpnr_Gain2nd;

	drvif_color_set_LC_Shpnr_Gain2nd(pData);
}

void fwif_color_set_LC_Diff_Ctrl0(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_Diff_Ctrl0 *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_Diff_Ctrl0;

	drvif_color_set_LC_Diff_Ctrl0(pData);
}

//juwen, add LC : tone mapping curve
void fwif_color_set_LC_ToneMappingSlopePoint(unsigned char src_idx,unsigned char TableIdx)
{
	unsigned int *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = pVipTable->VIP_Local_Contrast_Table[TableIdx].LC_ToneMappingSlopePoint_Table;

	down(&LC_Semaphore);
	drvif_color_set_LC_ToneMappingSlopePoint(pData);
	up(&LC_Semaphore);
}

void fwif_color_set_LC_DebugMode(unsigned char src_idx, unsigned char DebugMode)
{
	unsigned char mode;

	if(DebugMode > 3)
		mode = 0;
	else
		mode  = DebugMode;

	drvif_color_set_LC_DebugMode(mode);
}

char fwif_color_get_LC_Enable(void)
{
	return drvif_color_get_LC_Enable();
}

char fwif_color_get_LC_DebugMode(void)
{
	return drvif_color_get_LC_DebugMode();
}

void fwif_color_set_LC_Global_Region_Num_Size(unsigned char TableIdx, unsigned char TotalBlkNum)
{
	unsigned char sizeValid = 0;
	unsigned char nMaxBlkHNum = 0, nMaxBlkVNum = 0;
	unsigned char tab_hsize = 0, tab_vsize = 0;
	unsigned int  nImageHsize = 0, nImageVsize = 0;
	VIP_DRV_Local_Contrast_Region_Num_Size LC_Region_Num_Size;
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = NULL;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	// size information
	ppoverlay_main_active_h_start_end_RBUS ppoverlay_main_active_h_start_end_reg;
	ppoverlay_main_active_v_start_end_RBUS ppoverlay_main_active_v_start_end_reg;

	ppoverlay_main_active_h_start_end_reg.regValue = rtd_inl(PPOVERLAY_MAIN_Active_H_Start_End_reg);
	ppoverlay_main_active_v_start_end_reg.regValue = rtd_inl(PPOVERLAY_MAIN_Active_V_Start_End_reg);

	VIP_RPC_system_info_structure_table = (_RPC_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	if(VIP_RPC_system_info_structure_table == NULL || VIP_system_info_structure_table == NULL || pVipTable == NULL)
	{
		VIPprintf("[%s:%d] Warning here!! RPC_system_info or VipTable NULL! \n",__FILE__, __LINE__);
		return;
	}

	if( TableIdx >= LC_Table_NUM)
		TableIdx = LC_Table_NUM-1;

	switch(TotalBlkNum)
	{
		case LC_BLOCK_4x3:
			nMaxBlkHNum = 4;
			nMaxBlkVNum = 3;
			break;
		case LC_BLOCK_16x16:
			nMaxBlkHNum = 16;
			nMaxBlkVNum = 16;
			break;
		case LC_BLOCK_32x16:
			nMaxBlkHNum = 32;
			nMaxBlkVNum = 16;
			break;
		case LC_BLOCK_48x27:
			nMaxBlkHNum = 48;
			nMaxBlkVNum = 27;
			break;
		case LC_BLOCK_60x34:
			nMaxBlkHNum = 60;
			nMaxBlkVNum = 34;
			break;
		case LC_BLOCK_96x54:
			nMaxBlkHNum = 96;
			nMaxBlkVNum = 54;
			break;
		default:
			rtd_pr_vpq_emerg("[LC]block mode error, set mode=%d\n", TotalBlkNum);
			nMaxBlkHNum = 16;
			nMaxBlkVNum = 16;
			break;
	}

	nMaxBlkHNum = nMaxBlkHNum-1;
	nMaxBlkVNum = nMaxBlkVNum-1;

	tab_hsize = pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_Backlight_Profile_Interpolation.lc_tab_hsize;
	tab_vsize = pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Table.LC_Backlight_Profile_Interpolation.lc_tab_vsize;

	//nImageHsize = Get_DISP_ACT_END_HPOS()-Get_DISP_ACT_STA_HPOS();
	//nImageVsize = Get_DISP_ACT_END_VPOS()-Get_DISP_ACT_STA_VPOS();
	//nImageHsize = VIP_system_info_structure_table->D_Width;
	//nImageVsize = VIP_system_info_structure_table->D_Height;
	nImageHsize = ppoverlay_main_active_h_start_end_reg.mh_act_end - ppoverlay_main_active_h_start_end_reg.mh_act_sta;
	nImageVsize = ppoverlay_main_active_v_start_end_reg.mv_act_end - ppoverlay_main_active_v_start_end_reg.mv_act_sta;

	rtd_pr_vpq_info("[%s] GetSize %d %d\n", __FUNCTION__, nImageHsize, nImageVsize);
	rtd_pr_vpq_info("[%s] Info2VideoFW Tbl=%d TabH/V=%d/%d NumH/V=%d/%d\n",
		__FUNCTION__, TableIdx, tab_hsize, tab_vsize, nMaxBlkHNum, nMaxBlkVNum);

	/* recording info for videoFW */
	VIP_RPC_system_info_structure_table->Local_Contrast_Ctrl.LC_Table_Idx = TableIdx;
	VIP_RPC_system_info_structure_table->Local_Contrast_Ctrl.BL_Profile_Interpolation_lc_tab_hsize = tab_hsize;
	VIP_RPC_system_info_structure_table->Local_Contrast_Ctrl.BL_Profile_Interpolation_lc_tab_vsize = tab_vsize;
	VIP_RPC_system_info_structure_table->Local_Contrast_Ctrl.Local_Contrast_Region_Num_Size.nBlk_Hnum = nMaxBlkHNum;
	VIP_RPC_system_info_structure_table->Local_Contrast_Ctrl.Local_Contrast_Region_Num_Size.nBlk_Vnum = nMaxBlkVNum;

	sizeValid = fwif_color_Cal_LC_Global_Region_Num_Size(&LC_Region_Num_Size, nImageHsize, nImageVsize, tab_hsize, tab_vsize, nMaxBlkHNum, nMaxBlkVNum);
	drvif_color_set_LC_size_support(sizeValid);

	rtd_pr_vpq_info("[%s][H] Num=%d, Size=%d, Tab=%d, Factor=%d\n",
		__FUNCTION__, LC_Region_Num_Size.nBlk_Hnum, LC_Region_Num_Size.nBlk_Hsize, tab_hsize, LC_Region_Num_Size.lc_hfactor);
	rtd_pr_vpq_info("[%s][V] Num=%d, Size=%d, Tab=%d, Factor=%d\n",
		__FUNCTION__, LC_Region_Num_Size.nBlk_Vnum, LC_Region_Num_Size.nBlk_Vsize, tab_vsize, LC_Region_Num_Size.lc_vfactor);

	drvif_color_set_HV_Num_Fac_Size(&LC_Region_Num_Size);

}

char fwif_color_LC_check_Hblk_size(unsigned short nRegionHSize)
{
	lc_lc_global_ctrl2_RBUS blu_lc_global_ctrl2;//jw, 171106, add size constrain
	char Ret = 1;

	blu_lc_global_ctrl2.regValue = rtd_inl(LC_LC_Global_Ctrl2_reg);//jw, 171106, add size constrain

	// region size should be even
	if((nRegionHSize%2)!= 0)
	{
		Ret = 0;
	}

	// region size check according to hist mode
	switch (blu_lc_global_ctrl2.lc_hist_mode)
	{
		case 0:
			if(nRegionHSize <= 24)
			{
	          	Ret = 0;
			}
			break;
		case 1:
			if(nRegionHSize <= 48)
			{
	          	Ret = 0;
			}
			break;
		case 2:
			if(nRegionHSize <= 96)
			{
	          	Ret = 0;
			}
			break;
		default:
			if(nRegionHSize <= 128)
			{
	          	Ret = 0;
			}
			break;
	}
	return Ret;
}


unsigned char fwif_color_Cal_LC_Global_Region_Num_Size(
	VIP_DRV_Local_Contrast_Region_Num_Size *LC_Region_Num_Size,
	unsigned short nImageHsize, unsigned short nImageVsize,
	unsigned char tab_hsize, unsigned char tab_vsize,
	unsigned char nMaxBlkHNum, unsigned char nMaxBlkVNum
)
{
	unsigned int nBlkHNum = 0;
	unsigned int nBlkVNum = 0;
	unsigned short nRegionHSize = 0;
	unsigned short nRegionVSize = 0;
	unsigned int h_factor = 0;
	unsigned int v_factor = 0;
	unsigned char ValidHBlk = 0;
	unsigned char ValidVBlk = 0;
	unsigned int i = 0;
	const unsigned int PxlMode = 2;

	// Constrains
	// max block num = 60x34
	// min block num = 16x16
	// max block size = 240x135
	// min H block size >= 40 (include last block)
	// h factor < (1048576/2/PxlMode)
	// H block size should be even
	// HTab <= ImageH/(HBlkNum*10)

	if(nImageHsize == 0 || nImageVsize == 0)
	{
		nBlkHNum = 0;
		nRegionHSize = 0;
		h_factor = 0;

		nBlkVNum = 0;
		nRegionVSize = 0;
		v_factor = 0;

		return 0;
	}
	else
	{
		// Horizontal information, try to find max suitable block nums
		for( i=nMaxBlkHNum+1; i>=16; i-- )
		{
			nRegionHSize = (nImageHsize%i==0)? (nImageHsize/i) : (nImageHsize/i)+1;
			h_factor = (1048576*i*(tab_hsize+1))/nImageHsize;

			if( ValidHBlk==0 )
			{
				// constrains
				if( h_factor >= (1048576/(5*PxlMode)) )
					continue;
				if( nRegionHSize < 40 || nRegionHSize > 240 )
					continue;
				if( fwif_color_LC_check_Hblk_size(nRegionHSize) == 0 )
					continue;
				if( (signed short)(nImageHsize-(nRegionHSize*(i-1))) < 40 )
					continue;
				if( nRegionHSize%2 == 1 )
					continue;
				if( tab_hsize > ((nImageHsize/(i*10))-1) )
					continue;

				ValidHBlk = 1;
				nBlkHNum = i-1;
				break;
			}
		}

		// Vertical information, try to find max suitable block nums
		for( i=nMaxBlkVNum+1; i>=16; i--)
		{
			nRegionVSize = (nImageVsize%i)==0? (nImageVsize/i) : (nImageVsize/i)+1;
			v_factor = (1048576 *i*(tab_vsize+1))/nImageVsize;

			if( ValidVBlk==0 )
			{
				// constrains
				if( v_factor >= 1048576 )
					continue;
				if( nRegionVSize < 1 || nRegionVSize > 135 )
					continue;
				if( nRegionVSize*i != nImageVsize )
					continue;

				ValidVBlk = 1;
				nBlkVNum = i-1;
				break;
			}
		}
	}

	rtd_pr_vpq_info("[%s][%d][H] Num = %d, Tab = %d, Factor = %d, RgnSize = %d\n",
		__FUNCTION__, ValidHBlk, nBlkHNum, tab_hsize, h_factor, nRegionHSize);
	rtd_pr_vpq_info("[%s][%d][V] Num = %d, Tab = %d, Factor = %d, RgnSize = %d\n",
		__FUNCTION__, ValidVBlk, nBlkVNum, tab_vsize, v_factor, nRegionVSize);

	LC_Region_Num_Size->nBlk_Hnum = nBlkHNum;
	LC_Region_Num_Size->nBlk_Hsize = nRegionHSize;
	LC_Region_Num_Size->nBlk_Vnum = nBlkVNum;
	LC_Region_Num_Size->nBlk_Vsize = nRegionVSize;
	LC_Region_Num_Size->lc_hfactor = h_factor;
	LC_Region_Num_Size->lc_vfactor = v_factor;

	return (ValidHBlk==1 && ValidVBlk==1)? 1 : 0;
}


#if 1//juwen, k5lp
extern DRV_LC_saturation Local_Contrast_saturation_Table[LC_Table_NUM];
void fwif_color_set_LC_saturation(unsigned char src_idx,unsigned char TableIdx)
{
	DRV_LC_saturation *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_saturation_Table;
	
	drvif_color_set_LC_saturation(pData);
}

void fwif_color_set_LC_flicker(unsigned char src_idx,unsigned char TableIdx)
{
#if 0 // removed at K7Lp
	extern DRV_LC_avoid_flicker Local_Contrast_avoid_Flicker_Table[LC_Table_NUM];
	DRV_LC_avoid_flicker data;
	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	data.lc_tmap_avoid_flicker_en= Local_Contrast_avoid_Flicker_Table[TableIdx].lc_tmap_avoid_flicker_en;
	data.lc_tmap_diff_counter	 = Local_Contrast_avoid_Flicker_Table[TableIdx].lc_tmap_diff_counter;
	data.lc_tmap_slow_add_thl  	 = Local_Contrast_avoid_Flicker_Table[TableIdx].lc_tmap_slow_add_thl;

	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_0= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_0;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_1= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_1;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_2= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_2;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_3= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_3;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_4= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_4;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_5= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_5;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_6= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_6;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_7= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_thl_7;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_0= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_0;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_1= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_1;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_2= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_2;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_3= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_3;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_4= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_4;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_5= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_5;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_6= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_6;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_7= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_7;
	data.LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_8= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_ratio_thl.lc_tmap_blend_factor_ratio_8;

	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_0= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_0;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_1= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_1;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_2= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_2;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_3= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_3;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_4= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_4;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_5= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_5;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_6= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_6;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_7= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_7;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_8= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_8;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_9= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_9;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_10= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_10;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_11= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_11;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_12= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_12;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_13= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_13;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_14= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_14;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_15= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_15;
	data.LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_16= Local_Contrast_avoid_Flicker_Table[TableIdx].LC_avoid_flicker_diff_thl.lc_tmap_diff_thl_16;

	drvif_color_set_LC_avoid_flicker((DRV_LC_avoid_flicker*) &data);
#endif
}

#endif

void fwif_color_set_LC_decontour(unsigned char src_idx,unsigned char TableIdx,unsigned char level)
{
	DRV_LC_decontour *pData;
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (pVipTable == NULL)
		return;

	if(TableIdx>=LC_Table_NUM)
		TableIdx=LC_Table_NUM-1;

	pData = &pVipTable->VIP_Local_Contrast_Table[TableIdx].Local_Contrast_Decontour_Table[level];
	
	drvif_color_set_LC_decontour(pData);
}

void fwif_color_Set_SLC_Histogram(unsigned char TblIdx)
{
	extern DRV_SLC_Histogram_Info SLC_TBL[SLC_Table_NUM];
	extern DYNAMIC_SLC_CTRL_ST DSLC_TBL[SLC_Table_NUM];

	if( TblIdx >= SLC_Table_NUM)
		TblIdx = SLC_Table_NUM - 1;

	fwif_color_Set_SLC_Histogram_Region_Num_Size(DSLC_TBL[TblIdx].u8LC_Hist_H, DSLC_TBL[TblIdx].u8LC_Hist_V);
	drvif_color_set_SLC_Hist_Info(&SLC_TBL[TblIdx]);
}

void fwif_color_Init_SLC_Curve(unsigned char TblIdx)
{
	extern DYNAMIC_SLC_CTRL_ST DSLC_TBL[SLC_Table_NUM];
	int i=0;
	unsigned int LinearCurve[35] = {0, 64, 128, 192, 256, 384, 512, 640, 768, 896, 1024, 1152, 1280, 1408, 1536, 1664, 1792, 1920, 2048, 2176, 2304, 2432, 2560, 2688, 2816, 2944, 3072, 3200, 3328, 3456, 3584, 3712, 3840, 3968, 4095};

	if( TblIdx >= SLC_Table_NUM)
		TblIdx = SLC_Table_NUM - 1;

	fwif_color_Set_SLC_Curve_Region_Num_Size(DSLC_TBL[TblIdx].u8LC_Hist_H, DSLC_TBL[TblIdx].u8LC_Hist_V);

	down(&LC_Semaphore);
	for(i=0;i<256;i++)
	{
		drvif_color_set_SLC_Curve(LinearCurve, i);
	}
	up(&LC_Semaphore);
}

void fwif_color_Set_SLC_Curve_Region_Num_Size(unsigned char MaxBlkHNum, unsigned char MaxBlkVNum)
{
	// parameters
	DRV_SLC_Curve_Size Sz;
	unsigned char Valid = 0;

	// input size information
	unsigned int ImgHSize = 0, ImgVSize = 0;
	ppoverlay_main_active_h_start_end_RBUS ppoverlay_main_active_h_start_end_reg;
	ppoverlay_main_active_v_start_end_RBUS ppoverlay_main_active_v_start_end_reg;

	ppoverlay_main_active_h_start_end_reg.regValue = rtd_inl(PPOVERLAY_MAIN_Active_H_Start_End_reg);
	ppoverlay_main_active_v_start_end_reg.regValue = rtd_inl(PPOVERLAY_MAIN_Active_V_Start_End_reg);

	if( MaxBlkHNum > 16 )
		MaxBlkHNum = 16;
	if( MaxBlkVNum > 16 )
		MaxBlkVNum = 16;

	ImgHSize = ppoverlay_main_active_h_start_end_reg.mh_act_end - ppoverlay_main_active_h_start_end_reg.mh_act_sta;
	ImgVSize = ppoverlay_main_active_v_start_end_reg.mv_act_end - ppoverlay_main_active_v_start_end_reg.mv_act_sta;

	rtd_pr_vpq_info("[%s] GetSize %d %d, TryBlk %2d %2d\n", __FUNCTION__, ImgHSize, ImgVSize, MaxBlkHNum, MaxBlkVNum);

	Valid = fwif_color_Cal_SLC_Curve_Region_Num_Size(&Sz, ImgHSize, ImgVSize, MaxBlkHNum, MaxBlkVNum);

	if(Valid)
	{
		drvif_color_set_SLC_Curve_Size(&Sz);
	}

}

unsigned char fwif_color_Cal_SLC_Curve_Region_Num_Size(
	DRV_SLC_Curve_Size *ptr,
	unsigned int ImgH, unsigned int ImgV,
	unsigned char MaxBlkHNum, unsigned char MaxBlkVNum
)
{
	int i=0;
	unsigned char HorValid = 0;
	unsigned char VerValid = 0;
	unsigned char VldBlkHNum = MaxBlkHNum;
	unsigned char VldBlkVNum = MaxBlkVNum;

	// Horizontal
	// Constrain
	// block size >= 16
	// block num  <= 16
	for(i=((MaxBlkHNum>16)?16:MaxBlkHNum); i>0; i--)
	{
		if(ImgH/i>=16)
		{
			ptr->H_Factor = (((i*4096*4096)+(ImgH>>1))/ImgH);
			ptr->H_InitPhase1 = 0x0;
			ptr->H_InitPhase2 = 0x80;
			HorValid = 1;
			VldBlkHNum = i;
			break;
		}
	}

	// Vertical
	// Constrain
	// block size >= 16
	// block num  <= 16
	for(i=((MaxBlkVNum>16)?16:MaxBlkVNum); i>0; i--)
	{
		if(ImgV/i>=16)
		{
			ptr->V_Factor = (((i*4096*4096)+(ImgV>>1))/ImgV);
			ptr->V_InitPhase1 = 0x0;
			ptr->V_InitPhase2 = 0x80;
			VerValid = 1;
			VldBlkVNum = i;
			break;
		}
	}

	rtd_pr_vpq_info("[%s][H][%1d] Blk=%2d Fac=%d\n", __FUNCTION__, HorValid, VldBlkHNum, ptr->H_Factor);
	rtd_pr_vpq_info("[%s][V][%1d] Blk=%2d Fac=%d\n", __FUNCTION__, VerValid, VldBlkVNum, ptr->V_Factor);

	return ((HorValid == 1) && (VerValid == 1));

}

void fwif_color_Set_SLC_Histogram_Region_Num_Size(unsigned char MaxBlkHNum, unsigned char MaxBlkVNum)
{
	// parameters
	DRV_SLC_Histogram_Size Sz;
	unsigned char Valid = 0;

	// input size information
	unsigned int ImgHSize = 0, ImgVSize = 0;
	ppoverlay_main_active_h_start_end_RBUS ppoverlay_main_active_h_start_end_reg;
	ppoverlay_main_active_v_start_end_RBUS ppoverlay_main_active_v_start_end_reg;

	ppoverlay_main_active_h_start_end_reg.regValue = rtd_inl(PPOVERLAY_MAIN_Active_H_Start_End_reg);
	ppoverlay_main_active_v_start_end_reg.regValue = rtd_inl(PPOVERLAY_MAIN_Active_V_Start_End_reg);

	if( MaxBlkHNum > 16 )
		MaxBlkHNum = 16;
	if( MaxBlkVNum > 16 )
		MaxBlkVNum = 16;

	ImgHSize = ppoverlay_main_active_h_start_end_reg.mh_act_end - ppoverlay_main_active_h_start_end_reg.mh_act_sta;
	ImgVSize = ppoverlay_main_active_v_start_end_reg.mv_act_end - ppoverlay_main_active_v_start_end_reg.mv_act_sta;

	rtd_pr_vpq_info("[%s] GetSize %d %d, TryBlk %2d %2d\n", __FUNCTION__, ImgHSize, ImgVSize, MaxBlkHNum, MaxBlkVNum);

	Valid = fwif_color_Cal_SLC_Histogram_Region_Num_Size(&Sz, ImgHSize, ImgVSize, MaxBlkHNum, MaxBlkVNum);

	if(Valid)
	{
		drvif_color_set_SLC_Hist_Size(&Sz);
	}

}

unsigned char fwif_color_Cal_SLC_Histogram_Region_Num_Size(
	DRV_SLC_Histogram_Size *ptr,
	unsigned int ImgH, unsigned int ImgV,
	unsigned char MaxBlkHNum, unsigned char MaxBlkVNum
)
{
	int i=0;
	unsigned char HorValid = 0;
	unsigned char VerValid = 0;
	unsigned int HorBlkSize = 0;
	unsigned int VerBlkSize = 0;

	// Horizontal
	// Constrain
	// block size >= 24
	// Last block size >= 20
	// block num <= 16
	for(i=((MaxBlkHNum>16)?16:MaxBlkHNum); i>0; i--)
	{
		HorBlkSize = (ImgH/i==0)? (ImgH/i) : ((ImgH/i)+1);

		if( HorBlkSize<24 )
			continue;

		if( (ImgH-HorBlkSize*(i-1))<20 )
			continue;

		ptr->HorBlkNum = i;
		ptr->HorBlkSize = HorBlkSize;
		HorValid = 1;
		break;
	}

	// Vertical
	// Constrain
	// block size >= 16
	// block num  <= 16
	for(i=((MaxBlkVNum>16)?16:MaxBlkVNum); i>0; i--)
	{
		VerBlkSize = (ImgV/i==0)? (ImgV/i) : ((ImgV/i)+1);

		if( VerBlkSize<16 )
			continue;

		ptr->VerBlkNum = i;
		ptr->VerBlkSize = VerBlkSize;
		VerValid = 1;
		break;
	}

	rtd_pr_vpq_info("[%s][H][%1d] Blk=%2d Sz=%4d\n", __FUNCTION__, HorValid, ptr->HorBlkNum, ptr->HorBlkSize);
	rtd_pr_vpq_info("[%s][V][%1d] Blk=%2d Sz=%4d\n", __FUNCTION__, VerValid, ptr->VerBlkNum, ptr->VerBlkSize);

	// Translate to register value
	ptr->HorBlkNum  = ptr->HorBlkNum - 1;
	ptr->HorBlkSize = (ptr->HorBlkSize/2)-1;
	ptr->VerBlkNum  = ptr->VerBlkNum - 1;
	ptr->VerBlkSize = ptr->VerBlkSize - 1;

	return ((HorValid == 1) && (VerValid == 1));

}

void fwif_color_dynamic_SLC_Curve_Ctrl(void)
{
	unsigned char HBlk = 0, VBlk = 0;
	unsigned int bx = 0, by = 0;
	unsigned int Histogram[16] = {0};
	unsigned int DynamicCurve[35] = {0, 64, 128, 192, 256, 384, 512, 640, 768, 896, 1024, 1152, 1280, 1408, 1536, 1664, 1792, 1920, 2048, 2176, 2304, 2432, 2560, 2688, 2816, 2944, 3072, 3200, 3328, 3456, 3584, 3712, 3840, 3968, 4095};
	extern DYNAMIC_SLC_CTRL_ST DSLC_TBL[SLC_Table_NUM];
	DYNAMIC_SLC_CTRL_ST *pCtrl = NULL;

	pCtrl = &DSLC_TBL[0];

	HBlk = drvif_color_get_SLC_Hist_HorBlkNum();
	VBlk = drvif_color_get_SLC_Hist_VerBlkNum();

	if (down_trylock(&LC_Semaphore) == 0) {//get semaphore ok
		if (pCtrl->u8LC_Target_Y_en) {
			for(by=0; by<VBlk; by++)
			{
				for(bx=0; bx<HBlk; bx++)
				{
					drvif_color_get_SLC_Hist(Histogram, 2, by*HBlk+bx);
					SoftwareBaseLocalContrast_SimpleDCC(pCtrl, Histogram, DynamicCurve);
					SoftwareBaseLocalContrast_APL_Gain(pCtrl, Histogram, DynamicCurve);
					SoftwareBaseLocalContrast_Black_Level_Saturation_Protect(pCtrl, DynamicCurve);
					SoftwareBaseLocalContrast_Final_BlendWeight(pCtrl, DynamicCurve);
					drvif_color_set_SLC_Curve(DynamicCurve, by*HBlk+bx);
				}
			}
		} else {
			for(by=0; by<VBlk; by++) {
				for(bx=0; bx<HBlk; bx++) {
					drvif_color_set_SLC_Curve(DynamicCurve, by*HBlk+bx);
				}
			}
		}
		up(&LC_Semaphore);
	}
}

extern struct semaphore VPQ_NNSR_Model_TBL_Semaphore;
char fwif_color_set_SLC_TBL(unsigned int *pTBL)
{
	char ret = 0;
	unsigned char check_times = 0, check_times_max = 30;

	down(&VPQ_NNSR_Model_TBL_Semaphore);
	do {
		drvif_SLC_Err_Reset();
		check_times++;
	} while((drvif_SLC_DMA_Err_Check(0) != 0) && (check_times<check_times_max));

	if (check_times >= check_times_max) {
		rtd_pr_vpq_emerg("SLC_DMA, can't reset DM2 DMA Err status, check times = %d,\n", check_times);
		drvif_SLC_DMA_Err_Check(1);
		ret = -1;
	} else {
		fwif_color_Set_SLC_By_DMA(pTBL); 
		if (drvif_SLC_Wait_for_DMA_Apply_Done() < 0) {
			rtd_pr_vpq_emerg("SLC_DMA, DMA wait not finish.\n");
			//drvif_srnn_bbbsr_enable_set(0);
			ret = -1;
		} else {
			if (drvif_SLC_DMA_Err_Check(1) != 0) {
				//drvif_srnn_bbbsr_enable_set(0);
				ret = -1;
				rtd_pr_vpq_emerg("SLC_DMA, error status ~= 0..\n");
			} else {
				ret = 0;
				rtd_pr_vpq_info("SLC_DMA, write done\n");
			}
		}
	}

	up(&VPQ_NNSR_Model_TBL_Semaphore);
	
	return ret;
}


void fwif_color_Set_SLC_By_DMA(unsigned int *pTBL){
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif


       addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_SLC); //use SIP_2 addr
       addr = drvif_memory_get_data_align(addr, (1 << 12));
       size = drvif_memory_get_data_align(VIP_DMAto3DTable_TC_LUT_and_SIP1_and_SLC_SIZE, (1 << 12)); // use SIP_2?


	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_Set_SLC_By_DMA, addr = NULL\n");
		return;
	}

        
        	pVir_addr = dvr_remap_uncached_memory(addr, size, __builtin_return_address(0));

        	size_aligned = size;
        	addr_aligned = addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
        	va_temp = (unsigned long)pVir_addr;
#else
        	va_temp = (unsigned int)pVir_addr;
#endif
        	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
        	size_aligned = dvr_size_alignment(size);
        	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
        	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
        	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
        	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

        	rtd_pr_vpq_info("fwif_color_Set_SLC_By_DMA, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
        		addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);

        	drvif_Wait_UZUDTG_start(10, -200);
        	drvif_color_Set_SLC_By_DMA(addr_aligned, (unsigned int*) pVir_addr_aligned, pTBL); 
        	dvr_unmap_memory((void *)pVir_addr, size);
        
	return;

}

void fwif_color_Set_CDLC(unsigned char TblIdx)
{
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();
    DRV_CDLC_Offset *pOffset;
    DRV_CDLC_Shape *pShape;
    DRV_CDLC_Distance *pDistance;
        
	if (pVipTable == NULL)
		return;

	if( TblIdx >= CDLC_Table_NUM)
		TblIdx = CDLC_Table_NUM - 1;
    
    pOffset = &pVipTable->CDLC_TBL[TblIdx].Offset;
    pShape = &pVipTable->CDLC_TBL[TblIdx].Shape;
    pDistance = &pVipTable->CDLC_TBL[TblIdx].Distance;
   
	drvif_color_set_CDLC_Enable(pVipTable->CDLC_TBL[TblIdx].Y_BldEnable, pVipTable->CDLC_TBL[TblIdx].U_BldEnable, pVipTable->CDLC_TBL[TblIdx].V_BldEnable);
	drvif_color_set_CDLC_Offset(pOffset);
	drvif_color_set_CDLC_Shape(pShape);
	drvif_color_set_CDLC_Distance(pDistance);
}
void fwif_color_Set_LC_overlay_APL(unsigned char TblIdx)
{
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();
    DRV_LC_overlay_APL *overlay;
	lc_lc_global_ctrl2_RBUS blu_lc_global_ctrl2;
	int real_blk_x1=0,real_blk_y1=0;
	int real_blk_x2=0,real_blk_y2=0;

	if( TblIdx >= LC_overlay_Table_NUM)
		TblIdx = LC_overlay_Table_NUM - 1;
        
	/* work around for RTL bug: modify overlaymode2 x_blk1, y_blk1, x_blk2, y_blk2 if lc_blk_hnum is even (real horizontal block number is an odd number)*/
	blu_lc_global_ctrl2.regValue = IoReg_Read32(LC_LC_Global_Ctrl2_reg);
	
	if(blu_lc_global_ctrl2.lc_blk_hnum%2==0)
	{
		if(pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_yblk1 == 0)
		{
			real_blk_x1 =   pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_xblk1;
			real_blk_y1 =   pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_yblk1;
		}
		else
		{
			real_blk_x1 =   pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_xblk1  +   pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_yblk1;
			real_blk_y1 =   pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_yblk1;
            
			while(real_blk_x1 > blu_lc_global_ctrl2.lc_blk_hnum)
			{
				real_blk_x1 =   real_blk_x1-(blu_lc_global_ctrl2.lc_blk_hnum+1);
				real_blk_y1 =   real_blk_y1+1;
			}
		}

		if(pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_yblk2   ==  0)
		{
			real_blk_x2 =   pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_xblk2;
			real_blk_y2 =   pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_yblk2;
		}
		else
		{
			real_blk_x2 =   pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_xblk2 + pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_yblk2;
			real_blk_y2 =   pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_yblk2;
            
			while(real_blk_x2 > blu_lc_global_ctrl2.lc_blk_hnum)
			{
				real_blk_x2 =   real_blk_x2-(blu_lc_global_ctrl2.lc_blk_hnum+1);
				real_blk_y2 =   real_blk_y2+1;
			}
		}
        
		pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_xblk1  =   real_blk_x1;
		pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_xblk2  =   real_blk_x2;
		pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_yblk1  =   real_blk_y1;
		pVipTable->LC_OVERLAY_APL_TBL[TblIdx].lc_overlay_yblk2  =   real_blk_y2;
	}
	/* work around for RTL bug */
    
	overlay= &pVipTable->LC_OVERLAY_APL_TBL[TblIdx];
	drvif_color_set_LC_overlayAPL(overlay);
}

unsigned int fwif_color_di_pow_Cal(unsigned int x, unsigned int p)
{
	int i=0;
	unsigned int r = 1;

	  if(p == 0) return 1;
	  if(x == 0) return 0;


	for(i=0;i<p;i++)
	{
		r*=x;
	}
	return r;
}

void fwif_set_pq_dir_path(char *path, char *patch_path)
{
	path = "system\\project\\TvServer\\Custom\\Vip_Sirius ";
	patch_path = "system\\project\\TvServer\\Custom\\Vip_Sirius ";
	/*VIPprintf("\n fwif_set_pq_dir_path = %s  \n", path);*/
}
void fwif_get_average_luma(unsigned char *val)
{
	*val = fwif_color_Debug_Get_HIST_MEAN_VALUE();
	/*VIPprintf("\n fwif_get_average_luma = %d  \n", *val);*/
}

unsigned char fwif_get_Y_Total_Hist_Cnt_distribution(unsigned char MODE,unsigned char size, unsigned int *Y_Hist_distr_cnt)
{
	UINT8 i = 0;
	unsigned int Y_Hist_Cnt[COLOR_HISTOGRAM_LEVEL];
	unsigned int luma_distribution[COLOR_HISTOGRAM_LEVEL];
#if 0
	unsigned int Pixel_Total_Cnt = 0, Hist_Wid = 0, Hist_Len = 0;
	unsigned short Ratio_check = 0;
#endif
	_clues *smartPic_clue = NULL;

	//histogram_ich1_hist_in_range_hor_RBUS ich1_hist_in_range_hor_Reg;
	//histogram_ich1_hist_in_range_ver_RBUS ich1_hist_in_range_ver_Reg;

	if (Y_Hist_distr_cnt == NULL) {
		return FALSE;
	}

	if (MODE) {
#if 1
		if ( (size > COLOR_HISTOGRAM_LEVEL)||((COLOR_HISTOGRAM_LEVEL%size)!=0)) {
			return FALSE;
		} else {
			fwif_get_luma_level_distribution(&luma_distribution[0], size);

			for (i = 0; i < size; i++) {
				Y_Hist_distr_cnt[i] = luma_distribution[i];
			}

			return TRUE;
		}
#else
		fwif_get_luma_level_distribution(&luma_distribution[0], size);

		ich1_hist_in_range_hor_Reg.regValue = IoReg_Read32(HISTOGRAM_ICH1_Hist_IN_Range_Hor_reg);
		ich1_hist_in_range_ver_Reg.regValue = IoReg_Read32(HISTOGRAM_ICH1_Hist_IN_Range_Ver_reg);
		Hist_Wid = ich1_hist_in_range_hor_Reg.ch1_his_horend - ich1_hist_in_range_hor_Reg.ch1_his_horstart;
		Hist_Len = ich1_hist_in_range_ver_Reg.ch1_his_verend - ich1_hist_in_range_ver_Reg.ch1_his_verstart;
		Pixel_Total_Cnt = Hist_Wid*Hist_Len;

		for (i = 0; i < COLOR_HISTOGRAM_LEVEL; i++) {
			Ratio_check += luma_distribution[i];
			Y_Hist_Cnt[i] = (unsigned int)(luma_distribution[i] * Pixel_Total_Cnt) / 100;
			Y_Hist_distr_cnt[i] = Y_Hist_Cnt[i];
		}

		if (Ratio_check <= 99) {
			return FALSE;
		} else {
			return TRUE;
		}
#endif
	} else {

		smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

		if (smartPic_clue == NULL) {
			return FALSE;
		}

		fwif_color_ChangeUINT32Endian_Copy(&smartPic_clue->Y_Main_Hist[0], COLOR_HISTOGRAM_LEVEL, &Y_Hist_Cnt[0], 0);

		for (i = 0; i < COLOR_HISTOGRAM_LEVEL; i++) {
			Y_Hist_distr_cnt[i] = Y_Hist_Cnt[i];
		}

		return TRUE;

	}

}


void fwif_get_luma_level_distribution(unsigned int *luma_distribution, unsigned char size)
{
	unsigned char nTotalSize = COLOR_HISTOGRAM_LEVEL;
	unsigned char nSegment = nTotalSize / size;
	unsigned char nIndex = 0, nSegIndx = 0;
	unsigned short nPoint = 1;
	unsigned int nSumPoint = 0;
	_clues *smartPic_clue;
	unsigned int pwCopyTemp = 0;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return;
	}

	for (nIndex = 0; nIndex < size; nIndex++) {
		luma_distribution[nIndex] = 0;
	}
	for (nIndex = 0; nIndex < size; nIndex++) {
		nSumPoint = 0;
		for (nSegIndx = 0; nSegIndx < nSegment; nSegIndx++) {
			pwCopyTemp = 0;
			if (nIndex * nSegment + nSegIndx < nTotalSize) {
				fwif_color_ChangeUINT32Endian_Copy(&smartPic_clue->Y_Main_Hist[nIndex * nSegment + nSegIndx], 1, &pwCopyTemp, 0);
				nSumPoint +=  pwCopyTemp;
				/*VIPprintf("\n Y_Main_Hist_Ratio[%d] = %d  ", nIndex*nSegment+nSegIndx, pwCopyTemp);*/
			}
		}
		luma_distribution[nIndex]  = (nSumPoint*nPoint);
	}
	#if 0
	for (nIndex = 0; nIndex < size; nIndex++) {
		VIPprintf("\n luma_distribution[%d] = %d  ", nIndex, luma_distribution[nIndex]);
	}
	#endif
}

int fwif_color_get_rgb_pixel_info(RGB_pixel_info *data)
{
	//return drvif_color_get_rgb_pixel_info(data);//removed from merlin3, by caroline,20170606
	return 0;
}

void drvif_color_reg_UV_Gains_Table(void *table)
{
#if 0
    if (!table)
        return;

    UV_Gains = (UINT32 (*)[0][9])table;
#endif
}


short CAdjustCosine(short fDegree)
{
	/*Lewis, the curve value table have multiplied by 1024*/
	unsigned short fCosCurveAngle[14] = {   0,    6,   12,  18,  24,  30,  37,  44,  52,  60,  68,  78, 90, 91};
	unsigned short fCosCurveValue[14] = {1024, 1018, 1002, 974, 935, 887, 818, 737, 630, 512, 384, 213,  0,  0};
	unsigned char  i, cQuadrant;
	signed short  fDegreeTemp, fDegreeSpan, fCosValueSpan, fCosValue;

	if (fDegree < 0)
		fDegree +=  360;

	fDegree = fDegree%360;

	/*locate degree on which quadrant*/
	cQuadrant = (unsigned char)(fDegree / 90);
	cQuadrant++;
	if (cQuadrant == 1) /*first quadrant*/ {
		//fDegree = fDegree;
	} else if (cQuadrant == 2) /*second quadrant*/
		fDegree = 180 - fDegree;
	else if (cQuadrant == 3) /*third quadrant*/
		fDegree = fDegree - 180;
	else if (cQuadrant == 4) /*forth quadrant*/
		fDegree = 360 - fDegree;
	/*locate degree on which quadrant*/

	if (fDegree <= fCosCurveAngle[0]) {
		fCosValue = fCosCurveValue[0];
	} else {
		for (i = 1; i < 13; i++)
			if (fCosCurveAngle[i] >= fDegree)
				break;

		i--;
		fDegreeTemp = fDegree - fCosCurveAngle[i];
		fDegreeSpan = fCosCurveAngle[i + 1] - fCosCurveAngle[i];
		fCosValueSpan = fCosCurveValue[i + 1] - fCosCurveValue[i];
		fCosValue = fCosCurveValue[i]+fDegreeTemp*fCosValueSpan/fDegreeSpan;
	}

	if (cQuadrant == 2 || cQuadrant == 3)
		fCosValue = fCosValue*(-1);

	return fCosValue;
}

short CAdjustSine(short fDegree)
{
	/*Lewis, this table have multiplied by 1024*/
	unsigned short fSinCurveAngle[14] = {0,   6,  12,  18,  24,  30,  37,  44,  52,  60,  68,  78,    90,   91};
	unsigned short fSinCurveValue[14] = {0, 107, 213, 316, 416, 512, 616, 711, 807, 887, 949, 1002, 1024, 1024};
	unsigned char  i, cQuadrant;
	signed short  fDegreeTemp, fDegreeSpan, fSinValueSpan, fSinValue;

	if (fDegree < 0)
		fDegree +=  360;

	fDegree = fDegree%360;

	/*locate degree on which quadrant*/
	cQuadrant = (unsigned char)(fDegree / 90);
	cQuadrant++;
	if (cQuadrant == 1) /*first quadrant*/ {
		//fDegree = fDegree;
	} else if (cQuadrant == 2) /*second quadrant*/
		fDegree = 180 - fDegree;
	else if (cQuadrant == 3) /*third quadrant*/
		fDegree = fDegree - 180;
	else if (cQuadrant == 4) /*forth quadrant*/
		fDegree = 360  - fDegree;
	/*locate degree on which quadrant*/

	if (fDegree <= fSinCurveAngle[0]) {
		fSinValue = fSinCurveValue[0];
	} else {
		for (i = 1; i < 13; i++)
			if (fSinCurveAngle[i] >= fDegree)
				break;
		i--;
		fDegreeTemp = fDegree - fSinCurveAngle[i];
		fDegreeSpan = fSinCurveAngle[i + 1] - fSinCurveAngle[i];
		fSinValueSpan = fSinCurveValue[i + 1] - fSinCurveValue[i];
		fSinValue = fSinCurveValue[i]+fDegreeTemp*fSinValueSpan/fDegreeSpan;
	}

	if (cQuadrant == 3 || cQuadrant == 4)
		fSinValue = fSinValue * (-1);

	return fSinValue;
}

void CAdjustMatrixMultiply(short (*arrayA)[3], short (*arrayB)[3], short (*arrayC)[3])
{
	unsigned char i, j;
	signed int Temp[3][3];

	for (i = 0; i < 3; i++) {
		for (j = 0; j < 3; j++) {
			Temp[i][j] = ((signed int)(arrayA[i][0] * arrayB[0][j]))
						+ ((signed int)(arrayA[i][1] * arrayB[1][j]))
						+ ((signed int)(arrayA[i][2] * arrayB[2][j]));

			arrayC[i][j] = (signed short)(Temp[i][j] >> 14);
		}
	}
}

short abs_value(short original_value)
{
	if (original_value < 0)
		original_value = -original_value;
	return original_value;
}

void fwif_sRGB_SetHueSat(unsigned char display, unsigned short Hue, unsigned short Sat,
	BOOL User_Sat_en, BOOL User_Sat_Mapping)
{
/*	Color_SetICMHSI(display, 0, Sat <<  1,  0);*/
	/*static unsigned char m_table = 0;*/
	/*static unsigned char s_table = 0;*/
#if 0


	signed short  temp_buff0[3][3];
	signed short temp_buff1[3][3];
	signed short sRGB_Matrix[3][3];
	signed short ii, jj, kk, mm;
	signed short MATRIX_GAIN[3][3];
	signed short MATRIX_HUE[3][3];
	signed short temp_hue, temp_saturation;
	/*signed short index_gain[2];*/
	unsigned char i, j;
	/*unsigned char out_data[3];*/
/*	char fifo_status;*/
/*	unsigned char status;*/

	/*extern unsigned short sRGB_Hue_Mapping[129];*/
	extern unsigned char sRGB_RGB_LUT[3][129];
	extern signed short sRGB_YUV2RGB[3][3];
	extern signed short sRGB_RGB2YUV[3][3];

#ifdef CONFIG_sRGB_User_Hue_Mapping
	signed short sRGB_Matrix_User_def[Bin_Num_sRGB+1][3][3];

	if (Sat > 98)
		Sat = 98;
	temp_saturation =  Sat;
	for (ii = 0; ii < (Bin_Num_sRGB + 1); ii++) {
		temp_hue = 50 - sRGB_Hue_Mapping[ii];
		temp_hue  = (temp_hue * 19) / 12; /*Jerry 20070131*/

		/*this table have multiplied by 1024*/
		MATRIX_GAIN[0][0] = 1024;
		MATRIX_GAIN[0][1] = 0;
		MATRIX_GAIN[0][2] = 0;
		MATRIX_GAIN[1][0] = 0;
		MATRIX_GAIN[1][1] = ((temp_saturation << 7)/25)<<2;
		MATRIX_GAIN[1][2] = 0;
		MATRIX_GAIN[2][0] = 0;
		MATRIX_GAIN[2][1] = 0;
		MATRIX_GAIN[2][2] = MATRIX_GAIN[1][1];

		/*this table have multiplied by 16384*/

		MATRIX_HUE[0][0] = 1024;
		MATRIX_HUE[0][1] = 0;
		MATRIX_HUE[0][2] = 0;
		MATRIX_HUE[1][0] = 0;
		MATRIX_HUE[1][1] = CAdjustCosine(temp_hue);
		MATRIX_HUE[1][2] = CAdjustSine(temp_hue);
		MATRIX_HUE[2][0] = 0;
		MATRIX_HUE[2][1] = (-1)*MATRIX_HUE[1][2];
		MATRIX_HUE[2][2] = MATRIX_HUE[1][1];

		CAdjustMatrixMultiply(MATRIX_GAIN, sRGB_RGB2YUV, temp_buff0);
		CAdjustMatrixMultiply(MATRIX_HUE, temp_buff0, temp_buff1);
		CAdjustMatrixMultiply(sRGB_YUV2RGB, temp_buff1, sRGB_Matrix);
		for (mm = 0; mm < 3; mm++) {
			for (kk = 0; kk < 3; kk++) {
				/*KWarning: checked ok by allen_zhang*/
				sRGB_Matrix_User_def[ii][mm][kk] = sRGB_Matrix[mm][kk];
			}
		}

/*	RTD_Log(LOGGER_INFO, "\nMATRIX_GAIN = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", MATRIX_GAIN[0][0], MATRIX_GAIN[0][1], MATRIX_GAIN[0][2], MATRIX_GAIN[1][0], MATRIX_GAIN[1][1], MATRIX_GAIN[1][2], MATRIX_GAIN[2][0], MATRIX_GAIN[2][1], MATRIX_GAIN[2][2]);*/
/*	RTD_Log(LOGGER_INFO, "\ntemp_buff0 = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", temp_buff0[0][0], temp_buff0[0][1], temp_buff0[0][2], temp_buff0[1][0], temp_buff0[1][1], temp_buff0[1][2], temp_buff0[2][0], temp_buff0[2][1], temp_buff0[2][2]);*/
/*	RTD_Log(LOGGER_INFO, "\nMATRIX_HUE = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", MATRIX_HUE[0][0], MATRIX_HUE[0][1], MATRIX_HUE[0][2], MATRIX_HUE[1][0], MATRIX_HUE[1][1], MATRIX_HUE[1][2], MATRIX_HUE[2][0], MATRIX_HUE[2][1], MATRIX_HUE[2][2]);*/
/*	RTD_Log(LOGGER_INFO, "\ntemp_buff1 = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", temp_buff1[0][0], temp_buff1[0][1], temp_buff1[0][2], temp_buff1[1][0], temp_buff1[1][1], temp_buff1[1][2], temp_buff1[2][0], temp_buff1[2][1], temp_buff1[2][2]);*/


/*	RTD_Log(LOGGER_INFO, "\n-----sRGB_Hue_Mapping %d = %d, temp_hue = %d\n", ii, sRGB_Hue_Mapping[ii], temp_hue);*/
/*	RTD_Log(LOGGER_INFO, "sRGB_Matrix_User_def = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", sRGB_Matrix_User_def[ii][0][0], sRGB_Matrix_User_def[ii][0][1], sRGB_Matrix_User_def[ii][0][2], sRGB_Matrix_User_def[ii][1][0], sRGB_Matrix_User_def[ii][1][1], sRGB_Matrix_User_def[ii][1][2], sRGB_Matrix_User_def[ii][2][0], sRGB_Matrix_User_def[ii][2][1], sRGB_Matrix_User_def[ii][2][2]);*/
/*	RTD_Log(LOGGER_INFO, "sRGB_Matrix = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", sRGB_Matrix[0][0], sRGB_Matrix[0][1], sRGB_Matrix[0][2], sRGB_Matrix[1][0], sRGB_Matrix[1][1], sRGB_Matrix[1][2], sRGB_Matrix[2][0], sRGB_Matrix[2][1], sRGB_Matrix[2][2]);*/


	}

/*	RTD_Log(LOGGER_INFO, "\n--------------------------------------------------------------");*/
#else
	static INT16 sRGB_Matrix_by_Light[Bin_Num_sRGB + 1][3][3];
	INT16  temp_saturation_u, temp_saturation_v;

	VIPprintf("===[scalerColor.cpp] sRGB Control Hue: %d, Sat: %d\n", Hue, Sat);

	/*RTD_Log(LOGGER_INFO, "\n------sRGB_Matrix_by_Light[33] = {");*/
	VIPprintf("===[Color.cpp] sRGB_User_Sat_Mapping = %d, sRGB_User_Sat_Enable = %d", User_Sat_Mapping, User_Sat_en);
	if ((User_Sat_Mapping == 1) && (User_Sat_en == 1)) {
		for (ii = 0; ii < (Bin_Num_sRGB + 1); ii++) {
			if (Sat > 98)
				Sat = 98;
			temp_saturation =  Sat;

#if defined(IS_TV05_STYLE_PICTUREMODE)	/*20120426 roger, for CONFIG50 compiler error*/
			if (Scaler_GetPictureMode() == VIP_PICTURE_MODE_ECO) {
				temp_saturation_u = ((UINT32)(temp_saturation * UV_Gains[1][ii][4]) >> 14);
				temp_saturation_v = ((UINT32)(temp_saturation * UV_Gains[1][ii][8]) >> 14);
			} else
#endif
			{
				temp_saturation_u = ((UINT32)(temp_saturation * UV_Gains[0][ii][4]) >> 14);
				temp_saturation_v = ((UINT32)(temp_saturation * UV_Gains[0][ii][8]) >> 14);
			}

			if (temp_saturation_u > 98) {
				temp_saturation_u = 98;
			}
			if (temp_saturation_v > 98) {
				temp_saturation_v = 98;
			}
			/*RTD_Log(LOGGER_INFO, "drvif_color_sRGB_SetHueSat:::::ii = %d, sat = %d, temp_saturation_u = %d, temp_saturation_v = %d\n", ii, temp_saturation, temp_saturation_u, temp_saturation_v);*/

			temp_hue = 50 - Hue;
			temp_hue = temp_hue * 19 >> 5; /*Lewis, 20060720, limited Hue range to prevent grey bar have color*/
			temp_hue  = 	(temp_hue * 19) / 12; /*Jerry 20070131*/

			/*this table have multiplied by 1024*/
			MATRIX_GAIN[0][0] = 16384;
			MATRIX_GAIN[0][1] = 0;
			MATRIX_GAIN[0][2] = 0;
			MATRIX_GAIN[1][0] = 0;
			MATRIX_GAIN[1][1] = ((temp_saturation_u << 11) / 25) << 2;
			MATRIX_GAIN[1][2] = 0;
			MATRIX_GAIN[2][0] = 0;
			MATRIX_GAIN[2][1] = 0;
			MATRIX_GAIN[2][2] = ((temp_saturation_v << 11) / 25) << 2;

			/*RTD_Log(LOGGER_INFO, "drvif_color_sRGB_SetHueSat:::::MATRIX_GAIN[1][1] = %d, MATRIX_GAIN[2][2] = %d\n", MATRIX_GAIN[1][1], MATRIX_GAIN[2][2]);*/

			/*VIPprintf(" ===[Color.cpp] ii = %d, U = %d, V = %d\n", ii, MATRIX_GAIN[1][1], MATRIX_GAIN[2][2]);*/
		/*this table have multiplied by 16384*/


			MATRIX_HUE[0][0] = 16384;
			MATRIX_HUE[0][1] = 0;
			MATRIX_HUE[0][2] = 0;
			MATRIX_HUE[1][0] = 0;
			MATRIX_HUE[1][1] = 16384;/*CAdjustCosine(temp_hue);*/
			MATRIX_HUE[1][2] = 0;/*CAdjustSine(temp_hue);*/
			MATRIX_HUE[2][0] = 0;
			MATRIX_HUE[2][1] = 0;/*(-1)*MATRIX_HUE[1][2];*/
			MATRIX_HUE[2][2] = 16384;/*MATRIX_HUE[1][1];*/


			CAdjustMatrixMultiply(MATRIX_GAIN, sRGB_RGB2YUV, temp_buff0);
			CAdjustMatrixMultiply(MATRIX_HUE, temp_buff0, temp_buff1);
			CAdjustMatrixMultiply(sRGB_YUV2RGB, temp_buff1, sRGB_Matrix);
			for (mm = 0; mm < 3; mm++) {
				for (kk = 0; kk < 3; kk++) {
/*KWarning: checked ok by allen_zhang*/
					sRGB_Matrix_by_Light[ii][mm][kk] = sRGB_Matrix[mm][kk];
				}
			}

			/*RTD_Log(LOGGER_INFO, "\nMATRIX_GAIN = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", MATRIX_GAIN[0][0], MATRIX_GAIN[0][1], MATRIX_GAIN[0][2], MATRIX_GAIN[1][0], MATRIX_GAIN[1][1], MATRIX_GAIN[1][2], MATRIX_GAIN[2][0], MATRIX_GAIN[2][1], MATRIX_GAIN[2][2]);*/
			/*RTD_Log(LOGGER_INFO, "\ntemp_buff0 = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", temp_buff0[0][0], temp_buff0[0][1], temp_buff0[0][2], temp_buff0[1][0], temp_buff0[1][1], temp_buff0[1][2], temp_buff0[2][0], temp_buff0[2][1], temp_buff0[2][2]);*/
			/*RTD_Log(LOGGER_INFO, "\nMATRIX_HUE = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", MATRIX_HUE[0][0], MATRIX_HUE[0][1], MATRIX_HUE[0][2], MATRIX_HUE[1][0], MATRIX_HUE[1][1], MATRIX_HUE[1][2], MATRIX_HUE[2][0], MATRIX_HUE[2][1], MATRIX_HUE[2][2]);*/
			/*RTD_Log(LOGGER_INFO, "\ntemp_buff1 = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", temp_buff1[0][0], temp_buff1[0][1], temp_buff1[0][2], temp_buff1[1][0], temp_buff1[1][1], temp_buff1[1][2], temp_buff1[2][0], temp_buff1[2][1], temp_buff1[2][2]);*/

			/*RTD_Log(LOGGER_INFO, "%d, ",  sRGB_Matrix_by_Light[ii]);*/
			/*RTD_Log(LOGGER_INFO, "\n-----sRGB_Matrix_by_Light %d = %d, temp_saturation_u = %d\n", ii, sRGB_Matrix_by_Light[ii], temp_saturation_u);*/
			/*RTD_Log(LOGGER_INFO, "sRGB_Matrix_by_Light = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", sRGB_Matrix_by_Light[ii][0][0], sRGB_Matrix_by_Light[ii][0][1], sRGB_Matrix_by_Light[ii][0][2], sRGB_Matrix_by_Light[ii][1][0], sRGB_Matrix_by_Light[ii][1][1], sRGB_Matrix_by_Light[ii][1][2], sRGB_Matrix_by_Light[ii][2][0], sRGB_Matrix_by_Light[ii][2][1], sRGB_Matrix_by_Light[ii][2][2]);*/
			/*RTD_Log(LOGGER_INFO, "sRGB_Matrix = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", sRGB_Matrix[0][0], sRGB_Matrix[0][1], sRGB_Matrix[0][2], sRGB_Matrix[1][0], sRGB_Matrix[1][1], sRGB_Matrix[1][2], sRGB_Matrix[2][0], sRGB_Matrix[2][1], sRGB_Matrix[2][2]);*/


		}
	/*RTD_Log(LOGGER_INFO, "};\n----------------------------------\n");*/
	} else {

		/*VIPprintf(" ===[Color.cpp]  U = %d, V = %d\n", MATRIX_GAIN[1][1], MATRIX_GAIN[2][2]);*/
		if (Sat > 98)
			Sat = 98;
		temp_saturation =  Sat;
	  temp_hue = 50 - Hue;
		/*rtd_pr_vpq_debug("sRGB Contro final Hue: %d, final Sat: %d\n", temp_hue, temp_saturation);*/

		temp_hue = temp_hue * 19 >> 5; /*Lewis, 20060720, limited Hue range to prevent grey bar have color*/
    temp_hue =  (temp_hue * 19) / 12; /*Jerry 20070131*/

		/*this table have multiplied by 1024*/
		MATRIX_GAIN[0][0] = 16384;
		MATRIX_GAIN[0][1] = 0;
		MATRIX_GAIN[0][2] = 0;
		MATRIX_GAIN[1][0] = 0;
		MATRIX_GAIN[1][1] = ((temp_saturation << 11) / 25) << 2;
		MATRIX_GAIN[1][2] = 0;
		MATRIX_GAIN[2][0] = 0;
		MATRIX_GAIN[2][1] = 0;
		MATRIX_GAIN[2][2] = MATRIX_GAIN[1][1];


		/*this table have multiplied by 16384*/
	#if 0
		MATRIX_HUE[0][0] = 16384;
		MATRIX_HUE[0][1] = 0;
		MATRIX_HUE[0][2] = 0;
		MATRIX_HUE[1][0] = 0;
		MATRIX_HUE[1][1] = CAdjustCosine(temp_hue) << 4;
		MATRIX_HUE[1][2] = CAdjustSine(temp_hue) << 4;
		MATRIX_HUE[2][0] = 0;
		MATRIX_HUE[2][1] = (-1) * MATRIX_HUE[1][2];
		MATRIX_HUE[2][2] = MATRIX_HUE[1][1];

	#else
		MATRIX_HUE[0][0] = 16384;
		MATRIX_HUE[0][1] = 0;
		MATRIX_HUE[0][2] = 0;
		MATRIX_HUE[1][0] = 0;
		MATRIX_HUE[1][1] = 16384;/*CAdjustCosine(temp_hue);*/
		MATRIX_HUE[1][2] = 0;/*CAdjustSine(temp_hue);*/
		MATRIX_HUE[2][0] = 0;
		MATRIX_HUE[2][1] = 0;/*(-1)*MATRIX_HUE[1][2];*/
		MATRIX_HUE[2][2] = 16384;/*MATRIX_HUE[1][1];*/
	#endif

		CAdjustMatrixMultiply(MATRIX_GAIN, sRGB_RGB2YUV, temp_buff0);
		CAdjustMatrixMultiply(MATRIX_HUE, temp_buff0, temp_buff1);
		CAdjustMatrixMultiply(sRGB_YUV2RGB, temp_buff1, sRGB_Matrix);

		/*RTD_Log(LOGGER_INFO, "sRGB_Matrix = \n%d, %d, %d, \n%d, %d, %d, \n%d, %d, %d, \n", sRGB_Matrix[0][0], sRGB_Matrix[0][1], sRGB_Matrix[0][2], sRGB_Matrix[1][0], sRGB_Matrix[1][1], sRGB_Matrix[1][2], sRGB_Matrix[2][0], sRGB_Matrix[2][1], sRGB_Matrix[2][2]);*/
	}
#endif


	if ((User_Sat_Mapping == 1) && (User_Sat_en == 1)) {
		for (ii = 0; ii < (Bin_Num_sRGB + 1); ii++) {
			for (i = 0; i < 3; i++) {
				for (j = 0; j < 3; j++) {
					/*KWarning: checked ok by allen_zhang*/
					if (abs_value(sRGB_Matrix_by_Light[ii][i][j]) < 10) {
						/*KWarning: checked ok by allen_zhang*/
						sRGB_Matrix_by_Light[ii][i][j] = 0;
					}
					/*KWarning: checked ok by allen_zhang*/
					sRGB_Matrix_by_Light[ii][i][j] >>=  4;
				}
			}
		}
	} else {
		for (i = 0; i < 3; i++) {
			for (j = 0; j < 3; j++) {
			/*RTD_Log(LOGGER_INFO, "\n abs(sRGB_Matrix[i][j]) = %d\n", abs(sRGB_Matrix[i][j]));*/
			/*RTD_Log(LOGGER_INFO, "\ncoring  = %d\n", coring_level);*/
				if (abs_value(sRGB_Matrix[i][j]) < 10) {
					/*RTD_Log(LOGGER_INFO, "-------sRGB_Matrix = %d------\n", sRGB_Matrix[i][j]);*/
					sRGB_Matrix[i][j] = 0;
				}
				sRGB_Matrix[i][j] >>=  4;
			}
		}
	}

	for (ii  = 0; ii < (Bin_Num_sRGB + 1); ii++) {
		mm = 0;
		for (jj = 0, kk  = 0; jj < 9; jj++) {
			/*
			if ((jj == 0) || (jj == 3) || (jj == 6))
				mm = 0;
			else
				mm++;

			if ((mm == 0) && (jj > 1))
				kk++;
			*/
			mm = jj%3;
			kk = jj/3;
#ifdef CONFIG_sRGB_User_Hue_Mapping
/*KWarning: checked ok by allen_zhang*/
			sRGB_grid[jj][ii] =  (sRGB_Matrix_User_def[ii][mm][kk] * sRGB_RGB_LUT[mm][ii]) >> 4;
#else
			if ((User_Sat_Mapping == 1) && (User_Sat_en == 1)) {
/*KWarning: checked ok by allen_zhang*/
				sRGB_grid[jj][ii] =  ((INT32)(sRGB_Matrix_by_Light[ii][mm][kk] * sRGB_RGB_LUT[mm][ii])) >> 4;
			} else {
				/*sRGB_Matrix 12 - bit signed,  sRGB_RGB_LUT 8 - bit unsigned, 12+8 = 20 --> truncate to 14 - bit signed*/
				/*sRGB_Matrix 12 - bit signed,  sRGB_RGB_LUT 8 - bit unsigned, 12+8 = 20 --> truncate to 16 - bit signed (Sirius)*/
				/*KWarning: checked ok by allen_zhang*/
				sRGB_grid[jj][ii] =  (sRGB_Matrix[mm][kk] * sRGB_RGB_LUT[mm][ii]) >> 4;
#endif

				if (sRGB_grid[jj][ii] > 0) {
					/*KWarning: checked ok by allen_zhang*/
		      if (sRGB_grid[jj][ii] > 32767) { /*Mac2 = 8191, Sirius = 32767 (jyyang_2013/12/28)*/
						/*KWarning: checked ok by allen_zhang*/
				    sRGB_grid[jj][ii] = 32767;
					}
		    } else {
					/*KWarning: checked ok by allen_zhang*/
if (sRGB_grid[jj][ii] < -32768) {
					   /*KWarning: checked ok by allen_zhang*/
						sRGB_grid[jj][ii] = -32768;
					}
			  }
			/*	rtd_pr_vpq_debug("kk = %d, mm = %d, sRGB_Matrix[mm][ii]  = %d, sRGB_Grid_%d_%d = %d \n", kk, mm, sRGB_Matrix[mm][ii],   jj, ii, sRGB_grid[jj][ii]);*/
			}
		}
	}

	/*encode and write sRGB coefficient to IC*/

	drvif_sRGB_SetGrid(display,(signed int *) sRGB_grid);
#endif
}

void fwif_sRGB_SetMatrix(unsigned char display, short (*sRGB_Matrix)[3], unsigned char forceUpdate)
{
#if 0
	extern unsigned char sRGB_RGB_LUT[3][129];
	/*static int sRGB_grid[9][Bin_Num_sRGB + 1];*/
	signed short ii, jj, kk, mm;
	extern short sRGB_APPLY[3][3];

	if (memcmp(sRGB_APPLY, sRGB_Matrix, sizeof(sRGB_APPLY)) == 0 && !forceUpdate)
		return;
	memcpy(sRGB_APPLY, sRGB_Matrix, sizeof(sRGB_APPLY));

	/*
	for (ii = 0; ii < 3; ii++)
		for (jj = 0; jj < 3; jj++)
			{
				VIPprintf("sRGB_Matrix[%d][%d] = %d\n", ii, jj, sRGB_Matrix[ii][jj]);
			}
	*/

	for (ii  = 0; ii < (Bin_Num_sRGB + 1); ii++) {
		mm = 0;
		for (jj = 0, kk  = 0; jj < 9; jj++) {
			/*
			if ((jj == 0) || (jj == 3) || (jj == 6))
				mm = 0;
			else
				mm++;

			if ((mm == 0) && (jj > 1))
				kk++;
			*/

			mm = jj%3;
			kk = jj/3;

			sRGB_grid[jj][ii] = (sRGB_Matrix[mm][kk] * sRGB_RGB_LUT[mm][ii]) >> 4;
			sRGB_grid[jj][ii] = (sRGB_grid[jj][ii] > 32767) ? 32767 : ((sRGB_grid[jj][ii] < -32768) ? (-32768) : (sRGB_grid[jj][ii]));
		}
	}

	/*encode and write sRGB coefficient to IC*/
	drvif_sRGB_SetGrid(display, (signed int *)sRGB_grid);
#endif
}

/*Hawaii add for TSB projects 20131001*/
#if defined (IS_TV05_STYLE_PICTUREMODE)

/*Hawaii add for new AutoView 20131001*/

/*Parameter description : following six matrix is used to save the decode Gamma curve.*/
unsigned short Gamma_Decode_R_MAX[Bin_Num_Gamma + 1];
unsigned short Gamma_Decode_G_MAX[Bin_Num_Gamma + 1];
unsigned short Gamma_Decode_B_MAX[Bin_Num_Gamma + 1];

unsigned short Gamma_Decode_R_MIN[Bin_Num_Gamma + 1];
unsigned short Gamma_Decode_G_MIN[Bin_Num_Gamma + 1];
unsigned short Gamma_Decode_B_MIN[Bin_Num_Gamma + 1];


/*Hawaii add for new AutoView 20131001*/
/*Function description : This function is used to set the OSD value of ambient light type*/
void fwif_color_set_Ambient_type(unsigned char  value)
{
	/*Ambient_type :*/
	/*0 : for*/
	/*1 : for*/
	Ambient_light_type = value;
}

/*Funciton description : This function is used to get the OSD value of ambient light type*/
unsigned char  fwif_color_get_Ambient_type()
{
	return Ambient_light_type;
}

extern unsigned char fwif_color_get_AutoView_Max_Min_Table_Para(unsigned char light_src, VIP_AUTOVIEW_MAX_MIN MAX_or_MIN, source_TV05_index src_idx, VIP_AUTOVIEW_ITEM Autoview_item);
extern UINT8 fwif_vip_Get_Input_DataArrayIndex(UINT8 display);
#endif

void fwif_color_set_od(unsigned char bOD)
{
	if (!bODInited)
	{
		rtd_printk(KERN_EMERG,"VPQ_OD", "[Warn] %s, enable od failed due to oddma doesn't be initialized\n", __func__);
		return;
	}

	drvif_color_od_enable_set(bOD);
}
void fwif_color_safe_od_enable(unsigned char bEnable)
{
	extern unsigned char bODInited;

	if (!bODInited)
		return;
	pr_notice("fwif_color_safe_od_enable(%d)\n", bEnable);
	drvif_color_safe_od_enable(bEnable, bODPreEnable);
}
#if 0
static void fwif_color_od_dma_pqc_120hz(DRV_od_dma *oddma)
{
	unsigned short dispH = Get_DISP_ACT_END_HPOS()-Get_DISP_ACT_STA_HPOS();
	unsigned short dispV = Get_DISP_ACT_END_VPOS()-Get_DISP_ACT_STA_VPOS();
	unsigned int align_value = 0;
	unsigned int pqc_line_sum_bit = 0;

	oddma->dma_ctrl.hact = dispH;
	oddma->dma_ctrl.vact = dispV;
	oddma->dma_ctrl.dma_2p_enable = 1;// 120hz
	oddma->dma_ctrl.dma_clk_sel = 1;// 120hz

	/* DMA constrain for PQC */
	oddma->dma_ctrl.bit_sel = 2;
	oddma->dma_ctrl.pixel_encoding = 0;

	/* DMA pair */
	oddma->dma_pair.line_num = dispV;
	oddma->dma_pair.max_outstanding = 3;

	/* PQC setting */
	oddma->dma_comp.compensation_en= 1;
	oddma->dma_comp.g_ratio = 14;
	oddma->dma_comp.first_predict_nc_mode = 1;
	oddma->dma_comp.variation_maxmin_en = 0;
	oddma->dma_comp.block_limit_bit = 0x3f;

	oddma->dma_pqc_pair.width_div32 = (dispH >> 6); // 120hz half width of frame
	oddma->dma_pqc_pair.height = dispV;
	oddma->dma_pqc_pair.dic_mode = 1;
	oddma->dma_pqc_pair.jump4_en = 1;
	oddma->dma_pqc_pair.qp_mode = 1; // 120hz
	oddma->dma_pqc_pair.data_bitwidth = 1;
	oddma->dma_pqc_pair.data_color = 1; // 120hz yuv
	oddma->dma_pqc_pair.data_format = 1; // 120hz 422

	oddma->dma_pqc_alloc.dynamic_allocate_ratio_max = 16;
	oddma->dma_pqc_alloc.dynamic_allocate_ratio_min = 13;
	oddma->dma_pqc_alloc.dynamic_allocate_line = 4;
	oddma->dma_pqc_alloc.dynamic_allocate_less = 2;
	oddma->dma_pqc_alloc.dynamic_allocate_more = 2;

	oddma->dma_pqc_balance.balance_rb_ov_th = 0;
	oddma->dma_pqc_balance.balance_rb_ud_th = 3;
	oddma->dma_pqc_balance.balance_rb_give = 3;
	oddma->dma_pqc_balance.balance_g_ov_th = 0;
	oddma->dma_pqc_balance.balance_g_ud_th = 3;
	oddma->dma_pqc_balance.balance_g_give = 3;


	/* setting for line mode or frame mode */
	if(oddma->dma_ctrl.dma_mode == 0)
	{
		/* line mode setting */
		oddma->dma_pair.rolling_en = 1;
		oddma->dma_pair.rolling_space = oddma->dma_ctrl.vact + 2;
		oddma->dma_pqc_pair.line_mode = 1;
		oddma->dma_pqc_pair.two_line_predict = 1;

		/* line mode constratin */
		oddma->dma_comp.fisrt_line_more_en = 0;
		oddma->dma_comp.guarantee_max_qp_en = 0;
		oddma->dma_comp.frame_limit_bit = 8;
		oddma->dma_comp.line_limit_bit = oddma->dma_comp.frame_limit_bit;
		oddma->dma_pqc_pair.old_400_mode = 0;

		pqc_line_sum_bit = ((oddma->dma_pqc_pair.width_div32 << 5) * oddma->dma_comp.line_limit_bit + 256) / 128;
		pqc_line_sum_bit += ((((oddma->dma_pqc_pair.width_div32 << 5) * oddma->dma_comp.line_limit_bit + 256) % 128)!=0); // ceil

#ifdef CONFIG_BW_96B_ALIGNED
		// for cap/disp line_step (128 bits unit)
	    align_value = drvifget_align_value(pqc_line_sum_bit, 6);
		oddma->dma_pair.burst_length = 0x30; //must be check 96 alignment,

#else
	    align_value = pqc_line_sum_bit;
		oddma->dma_pair.burst_length = 0x20;
#endif

		oddma->dma_pqc_pair.line_sum_bit = pqc_line_sum_bit;
		oddma->dma_pair.line_step = align_value;
		oddma->dma_pair.line128_num = pqc_line_sum_bit;
	}
	else
	{
		oddma->dma_pair.rolling_en = 0;
		oddma->dma_pair.line128_num = 0x7fffff;
		oddma->dma_comp.line_limit_bit = oddma->dma_comp.frame_limit_bit + 6;
	}
}
static void fwif_color_od_dma_pqc_60hz(DRV_od_dma *oddma, unsigned char ymode)
{
	unsigned short dispH = Get_DISP_ACT_END_HPOS()-Get_DISP_ACT_STA_HPOS();
	unsigned short dispV = Get_DISP_ACT_END_VPOS()-Get_DISP_ACT_STA_VPOS();
	unsigned int align_value = 0;
	unsigned int pqc_line_sum_bit = 0;

	oddma->dma_ctrl.hact = dispH;
	oddma->dma_ctrl.vact = dispV;
	oddma->dma_ctrl.dma_2p_enable = 0;
	oddma->dma_ctrl.dma_clk_sel = 0;

	/* DMA constrain for PQC */
	oddma->dma_ctrl.bit_sel = 2;
	oddma->dma_ctrl.pixel_encoding = 0;

	/* DMA pair */
	oddma->dma_pair.line_num = dispV;
	oddma->dma_pair.max_outstanding = 3;

	/* PQC setting */
	oddma->dma_comp.compensation_en= 1;
	oddma->dma_comp.g_ratio = 14;
	oddma->dma_comp.first_predict_nc_mode = 1;
	oddma->dma_comp.variation_maxmin_en = 0;
	oddma->dma_comp.block_limit_bit = 0x3f;

	oddma->dma_pqc_pair.width_div32 = (dispH >> 5);
	oddma->dma_pqc_pair.height = dispV;
	oddma->dma_pqc_pair.data_color = ymode?1:0; // yuv, rgb
	oddma->dma_pqc_pair.data_format = ymode?3:1; // 400, 422
	oddma->dma_pqc_pair.dic_mode = 1;
	oddma->dma_pqc_pair.jump4_en = 1;
	oddma->dma_pqc_pair.qp_mode = 0;
	if(oddma->dma_comp.frame_limit_bit <= 6)
		oddma->dma_pqc_pair.data_bitwidth = 0;
	else
		oddma->dma_pqc_pair.data_bitwidth = 1; // 10 bit

	oddma->dma_pqc_alloc.dynamic_allocate_ratio_max = 16;
	oddma->dma_pqc_alloc.dynamic_allocate_ratio_min = 13;
	oddma->dma_pqc_alloc.dynamic_allocate_line = 4;
	oddma->dma_pqc_alloc.dynamic_allocate_less = 2;
	oddma->dma_pqc_alloc.dynamic_allocate_more = 2;

	oddma->dma_pqc_balance.balance_rb_ov_th = 0;
	oddma->dma_pqc_balance.balance_rb_ud_th = 3;
	oddma->dma_pqc_balance.balance_rb_give = 3;
	oddma->dma_pqc_balance.balance_g_ov_th = 0;
	oddma->dma_pqc_balance.balance_g_ud_th = 3;
	oddma->dma_pqc_balance.balance_g_give = 3;

	/* setting for line mode or frame mode */
	if(oddma->dma_ctrl.dma_mode == 0)
	{
		/* line mode setting */
		oddma->dma_pair.rolling_en = 1;
		oddma->dma_pair.rolling_space = oddma->dma_ctrl.vact + 2;
		oddma->dma_pqc_pair.line_mode = 1;
		oddma->dma_pqc_pair.two_line_predict = 1;

		/* line mode constratin */
		oddma->dma_comp.fisrt_line_more_en = 0;
		oddma->dma_comp.guarantee_max_qp_en = 0;
		oddma->dma_comp.frame_limit_bit = 4;
		oddma->dma_comp.line_limit_bit = oddma->dma_comp.frame_limit_bit;
		oddma->dma_pqc_pair.old_400_mode = 0;

		pqc_line_sum_bit = (oddma->dma_ctrl.hact * oddma->dma_comp.line_limit_bit + 256) / 128;
		pqc_line_sum_bit += ((oddma->dma_ctrl.hact * oddma->dma_comp.line_limit_bit + 256) % 128!=0); // ceil

#ifdef CONFIG_BW_96B_ALIGNED
		// for cap/disp line_step (128 bits unit)
	    align_value = drvifget_align_value(pqc_line_sum_bit, 6);
		oddma->dma_pair.burst_length = 0x30; //must be check 96 alignment,

#else
	    align_value = pqc_line_sum_bit;
		oddma->dma_pair.burst_length = 0x20;
#endif

		oddma->dma_pqc_pair.line_sum_bit = pqc_line_sum_bit;
		oddma->dma_pair.line_step = align_value;
		oddma->dma_pair.line128_num = pqc_line_sum_bit;
	}
	else
	{
		oddma->dma_pair.rolling_en = 0;
		oddma->dma_pair.line128_num = 0x7fffff;
		oddma->dma_comp.line_limit_bit = oddma->dma_comp.frame_limit_bit + 6;
	}
}

static void fwif_color_od_dma_line_init(DRV_od_ymode od_ymode)
{
	extern DRV_od_dma oddma_g[];
	DRV_od_dma oddma_local;

	oddma_local = oddma_g[0];
	
	if (Get_DISPLAY_REFRESH_RATE()==60)
	{
		fwif_color_od_dma_pqc_60hz((DRV_od_dma *)(&oddma_local), od_ymode.enable);
			
		rtd_printk(KERN_EMERG,"OD_MEM", "%s, set for 60hz dma\n", __func__);
	}
	else
	{
		fwif_color_od_dma_pqc_120hz((DRV_od_dma *)(&oddma_local));
		rtd_printk(KERN_EMERG,"OD_MEM", "%s, set for 120hz dma\n", __func__);
	}

	#ifdef VPQ_COMPILER_ERROR_ENABLE_MERLIN6
	if (strcmp(webos_strToolOption.eBackLight, "oled") == 0) {
		bODInited = 0;
		rtd_printk(KERN_EMERG,"OD_MEM", "%s, OLED need to disable OD\n", __func__);
		goto final;
	}
	#endif

	bODInited = drvif_color_od_dma_line_size_get((DRV_od_dma *)(&oddma_local));
	if(bODInited==FALSE) goto final;

	drvif_color_od_dma_pqc_set((DRV_od_dma *)(&oddma_local));
	drvif_color_od_dma_pqc_bit_set((DRV_od_dma *)(&oddma_local));
	drvif_color_od_dma_pqc_pair_set((DRV_od_dma *)(&oddma_local));

	drvif_color_od_dma_addr_set((DRV_od_dma *)(&oddma_local));
	drvif_color_od_dma_ctrl_set((DRV_od_dma *)(&oddma_local));
	drvif_color_od_dma_pair_set((DRV_od_dma *)(&oddma_local));

	drvif_color_od_dma_pqc_enable_set(oddma_local.dma_comp.bypass_en, oddma_local.dma_pqc_pair.comp_en);
	drvif_color_od_dma_cap_enable_set(oddma_local.dma_pair.cap_en);
	drvif_color_od_dma_disp_enable_set(oddma_local.dma_pair.cap_en);

final:
	return;
}
#endif

bool fwif_color_od_init(unsigned char ymode)
{
	extern DRV_od_ctrl od_ctrl_g[];
	extern DRV_od_dma  oddma_g[];
	DRV_od_ctrl od_ctrl = od_ctrl_g[ymode];
	DRV_od_dma oddma_local;

        unsigned short dispH;
	unsigned short dispV;
	unsigned int align_value = 0;
        unsigned int sub_pixel_num;
	unsigned int pqc_line_sum_bit_pure_rgb = 0;
	unsigned int pqc_line_sum_bit_32_dummy = 0;
	unsigned int pqc_line_sum_bit_real = 0;	
	unsigned int pqc_line_sum_bit = 0;
	unsigned int llb_step = 0;
	unsigned int llb_init = 0;
        
	UINT8 bit_sel = 2;
        UINT8 oddma_mode_sel = 0; // realy case always use line mode no frame mode 
        UINT8 FrameLimitBit_reg =4 <<2; // lsb 2-bit represents fix point , realy case default use 4bit, it balance  with bw and performance.  


	dispV = Get_DISP_ACT_END_VPOS()-Get_DISP_ACT_STA_VPOS();//VIP_system_info_structure_table->D_Height;
	dispH = Get_DISP_ACT_END_HPOS()-Get_DISP_ACT_STA_HPOS();//VIP_system_info_structure_table->D_Width;
	rtd_printk(KERN_INFO,"OD_MEM", "end_v=%d,sta_v=%d,end_h=%d,sta_h=%d, OD_Height=%d,OD_Width=%d,freq=%d\n", 
		Get_DISP_ACT_END_VPOS(), Get_DISP_ACT_STA_VPOS(), Get_DISP_ACT_END_HPOS(), Get_DISP_ACT_STA_HPOS(), 
		dispV,dispH,Get_DISPLAY_REFRESH_RATE());

	// set od clk and latency

	// y mode
	
	drvif_color_od_Ymode_set(od_ctrl.od_ymode);
	drvif_color_od_nr_set(od_ctrl.od_nr);
	drvif_color_od_gain_set(od_ctrl.od_gain.r_gain);

        oddma_local = oddma_g[0];
#if 0
	if (strcmp(webos_strToolOption.eBackLight, "oled") == 0) { //OLED model skip enable OD
		bODInited = 0;
       		rtd_printk(KERN_EMERG,"OD_MEM", "%s, OLED need to disable OD\n", __func__);
                return bODInited;
	}
#endif	

        /* 1st dma_ctrl*/
	oddma_local.dma_ctrl.hact = dispH;
	oddma_local.dma_ctrl.vact = dispV;
        oddma_local.dma_ctrl.dma_mode = oddma_mode_sel; //always use line mode, 
	oddma_local.dma_ctrl.bit_sel = bit_sel;	/* DMA constrain for PQC */
	oddma_local.dma_ctrl.pixel_encoding = 0;
	oddma_local.dma_pqc_pair.width_div32 = (dispH + 31)>>5;

	/* 2nd DMA pair ,3rd dma_comp*/

        /*
        oddma_local.dma_pair.start_addr1 = set by drvif_color_od_dma_line_size_get()
        oddma_local.dma_pair.start_addr2 = ?
        oddma_local.dma_pair.up_limit = set by drvif_color_od_dma_line_size_get()
	oddma_local.dma_pair.low_limit = set by drvif_color_od_dma_line_size_get()
        */
	oddma_local.dma_pair.line_num = dispV;
	oddma_local.dma_pair.max_outstanding = 0xf;
        
      	/* for OD only use line mode,no more use frame mode  */
	if(oddma_local.dma_ctrl.dma_mode == 0)
	{

                /* line mode setting */
		oddma_local.dma_pair.rolling_en = 1;
		oddma_local.dma_pair.rolling_space = oddma_local.dma_ctrl.vact + 2;
		oddma_local.dma_pqc_pair.line_mode = 1;
		oddma_local.dma_pqc_pair.two_line_predict = 1;

		/* line mode constratin */
		//oddma_local.dma_comp.fisrt_line_more_en = 0;
		oddma_local.dma_comp.guarantee_max_qp_en = 0;
		oddma_local.dma_comp.frame_limit_bit = FrameLimitBit_reg;  
        	// b802cd0c Llb 

        	llb_init = (oddma_local.dma_comp.frame_limit_bit*4) +32 ;
                llb_step = (llb_init*(2<<4)-oddma_local.dma_comp.frame_limit_bit*(2<<6))/ (oddma_local.dma_pqc_pair.width_div32);

                oddma_local.dma_comp.llb_init =llb_init;
                oddma_local.dma_comp.llb_step =llb_step;
                
                sub_pixel_num =  3;
                pqc_line_sum_bit_pure_rgb = oddma_local.dma_pqc_pair.width_div32*32* (oddma_local.dma_comp.frame_limit_bit/4);
                pqc_line_sum_bit_32_dummy = (6+1) * 32 * sub_pixel_num;
                pqc_line_sum_bit_real = pqc_line_sum_bit_pure_rgb + pqc_line_sum_bit_32_dummy; 
                pqc_line_sum_bit = ((pqc_line_sum_bit_real)/128)+(pqc_line_sum_bit_real % 128!=0);
#if 0				
printk("OD_MEM, pqc_line_sum_bit=%d,width_div32=%d,frame_limit_bit=%d,,pqc_line_sum_bit_32_dummy=%d,,\n", 
	pqc_line_sum_bit, oddma_local.dma_pqc_pair.width_div32, oddma_local.dma_comp.frame_limit_bit, pqc_line_sum_bit_32_dummy);
#endif
#ifdef CONFIG_BW_96B_ALIGNED
		// for cap/disp line_step (128 bits unit)
	        align_value = drvifget_align_value(pqc_line_sum_bit, 6);
		oddma_local.dma_pair.burst_length = 0x60; //must be check 96 alignment,

#else
	        align_value = pqc_line_sum_bit;
		oddma_local.dma_pair.burst_length = 0x60;
#endif

		oddma_local.dma_pqc_pair.line_sum_bit = pqc_line_sum_bit;
		oddma_local.dma_pair.line_step = align_value;
		oddma_local.dma_pair.line128_num = pqc_line_sum_bit;
	}
	else
	{
		oddma_local.dma_pair.rolling_en = 0;
		oddma_local.dma_pair.line128_num = 0x7fffff;
	}  

        oddma_local.dma_comp.bypass_en =0;
	oddma_local.dma_comp.compensation_en= 1;
	oddma_local.dma_comp.g_ratio = 14;
	oddma_local.dma_comp.first_predict_nc_mode = 1;
	oddma_local.dma_comp.variation_maxmin_en = 0;
	oddma_local.dma_comp.block_limit_bit = 0x3f;

	/* 4th dma_pqc_pair */

	oddma_local.dma_pqc_pair.width_div32 = (dispH >> 5);
	oddma_local.dma_pqc_pair.height = dispV;
	oddma_local.dma_pqc_pair.data_color = ymode?1:0; // yuv, rgb
	oddma_local.dma_pqc_pair.data_format = ymode?3:1; // 400, 422
	oddma_local.dma_pqc_pair.jump4_en = 1;
	oddma_local.dma_pqc_pair.jump6_en = 1;
	oddma_local.dma_pqc_pair.qp_mode = 0;
	if(oddma_local.dma_comp.frame_limit_bit <= (6<<2))
		oddma_local.dma_pqc_pair.data_bitwidth = 0;
	else
		oddma_local.dma_pqc_pair.data_bitwidth = 1; // 10 bit


	/* 5th dma_pqc_alloc */

	oddma_local.dma_pqc_alloc.dynamic_allocate_ratio_max = 16;
	oddma_local.dma_pqc_alloc.dynamic_allocate_ratio_min = 13;
	oddma_local.dma_pqc_alloc.dynamic_allocate_line = 4;
	oddma_local.dma_pqc_alloc.dynamic_allocate_less = 2;
	oddma_local.dma_pqc_alloc.dynamic_allocate_more = 2;

	/* 6th dma_pqc_balance */

	oddma_local.dma_pqc_balance.balance_rb_ov_th = 0;
	oddma_local.dma_pqc_balance.balance_rb_ud_th = 3;
	oddma_local.dma_pqc_balance.balance_rb_give = 3;
	oddma_local.dma_pqc_balance.balance_g_ov_th = 0;
	oddma_local.dma_pqc_balance.balance_g_ud_th = 3;
	oddma_local.dma_pqc_balance.balance_g_give = 3;

        oddma_local.dma_comp.frame_limit_bit = FrameLimitBit_reg;

        bODInited = drvif_color_od_dma_line_size_get((DRV_od_dma *)(&oddma_local));
	if(bODInited==FALSE){ //if carvedout memory fail , return fail

                return bODInited;
        }


	drvif_color_od_dma_pqc_set((DRV_od_dma *)(&oddma_local));
	drvif_color_od_dma_pqc_bit_set((DRV_od_dma *)(&oddma_local));
	drvif_color_od_dma_pqc_pair_set((DRV_od_dma *)(&oddma_local));

	drvif_color_od_dma_addr_set((DRV_od_dma *)(&oddma_local));
	drvif_color_od_dma_ctrl_set((DRV_od_dma *)(&oddma_local));
	drvif_color_od_dma_pair_set((DRV_od_dma *)(&oddma_local));

	drvif_color_od_dma_pqc_enable_set(oddma_local.dma_comp.bypass_en, oddma_local.dma_pqc_pair.comp_en);
	drvif_color_od_dma_cap_enable_set(oddma_local.dma_pair.cap_en);
	drvif_color_od_dma_disp_enable_set(oddma_local.dma_pair.cap_en);


	return bODInited;

}

unsigned char fwif_color_set_od_bits(unsigned char bits)
{
	unsigned short dispH;
	unsigned short dispV;
	unsigned int od_mem_size_pre_allocated = 0;
	unsigned int od_mem_size_will_used = 0;
	unsigned long od_addr = 0;
#if 0 //thread+semaphore have risk if STR retry many times
	static unsigned int arg = 4;
	struct task_struct *p_thread = NULL;
	static unsigned char od_sema_inited = FALSE;
#endif
	if (!bODInited)
		return FALSE;

	dispV = Get_DISP_ACT_END_VPOS()-Get_DISP_ACT_STA_VPOS();//VIP_system_info_structure_table->D_Height;
	dispH = Get_DISP_ACT_END_HPOS()-Get_DISP_ACT_STA_HPOS();//VIP_system_info_structure_table->D_Width;

#ifdef CONFIG_OPTEE_SECURE_SVP_PROTECTION
	od_mem_size_pre_allocated = carvedout_buf_query_secure(CARVEDOUT_SCALER_OD, (void *)&od_addr);
#else
	od_mem_size_pre_allocated = carvedout_buf_query(CARVEDOUT_SCALER_OD, (void *)&od_addr);
#endif
	if (drvif_color_get_od_dma_mode() == 0)
		od_mem_size_will_used = dispH*dispV*bits*1; //line mode: 1 frame + 1 line
	else
		od_mem_size_will_used = dispH*dispV*bits*2; //frame mode: 2 frame

	if (od_mem_size_will_used >= (od_mem_size_pre_allocated << 3)) //need burst
		return FALSE;

#if 0 //thread+semaphore have risk when STR retry many times
	if (!od_sema_inited) {
		sema_init(&OD_Semaphore,1);
		od_sema_inited = TRUE;
	}

	/* Use thread to prevent too much delay */
	arg = bits;
	p_thread = kthread_create(thread_set_od_bits, (void *)&arg, "thread_set_od_bits");

	if (IS_ERR(p_thread)) {
		rtd_pr_vpq_err("Unable to creat thread_set_od_bits (err_id = %ld).\n", PTR_ERR(p_thread));
		drvif_color_set_od_bits(bits); //10bit color depth
	} else {
		wake_up_process(p_thread);
	}
#else
	drvif_color_set_od_bits(bits); //10bit color depth
#endif

	return TRUE;
}

unsigned char fwif_color_od_test(unsigned char en)
{
	extern unsigned char bODInited;
	extern unsigned char bODTableLoaded;
	extern unsigned char bODPreEnable;
	extern char od_table_mode_store;
	extern unsigned char od_delta_table_g[OD_table_length];
	extern unsigned char od_target_table_g[OD_table_length];
	extern unsigned char od_table_default[17][17];

	if (en) {
		if (!bODInited){
			if (!Scaler_Init_OD())
				return FALSE;
		}
		if(OD_table_length == 289)
		{
			fwif_color_od_table_transform(0, 0, (unsigned char *)&od_table_default, od_delta_table_g);
			drvif_color_od_table_17x17_set(od_delta_table_g, 0, 3); // 3: write to rgb channel
		}
		else if(OD_table_length == 1089)
		{
			fwif_color_od_table_interpolation((unsigned char *)&od_table_default, od_target_table_g);
			fwif_color_od_table_transform(0, 0, od_target_table_g, od_delta_table_g);
			drvif_color_od_table_33x33_set(od_delta_table_g, 0, 11); // 11: write to sram 0~5 for 120 2 pixel
		}

		rtd_printk(KERN_EMERG,"VPQ_OD", "%s, od_delta_table_g updated\n", __func__);
		od_table_mode_store = 1;// 0:target mode 1:delta mode
		bODTableLoaded = TRUE;
		bODPreEnable = TRUE;
		//fwif_color_set_od_dma_enable(TRUE);
		drvif_color_od_dma_cap_enable_set(TRUE);
		drvif_color_od_dma_disp_enable_set(TRUE);
		fwif_color_set_od(TRUE);
	} else {
		fwif_color_set_od(FALSE);
	}

	return TRUE;
}
void fwif_color_set_od_lut_indices(unsigned char recursive)
{
	/* This function accesses the global variable to write LUT indices to HW reg */
	DRV_od_lut_ctrl *od_lut_local = drvif_color_od_access_lut_struct(recursive);

	if (Get_DISPLAY_REFRESH_RATE() == 60)
	{
		drif_color_od_lut_index_set(recursive, od_lut_local->pre_idx, od_lut_local->cur_idx);
	}
	else
	{
		/* for 120hz using sram 0~5 */
		drif_color_od_lut_index_set(0, od_lut_local->pre_idx, od_lut_local->cur_idx);
		drif_color_od_lut_index_set(1, od_lut_local->pre_idx, od_lut_local->cur_idx);
	}
}
void fwif_color_set_od_liner_indices(bool recursive)
{
	int i = 0;
	DRV_od_lut_ctrl *od_lut_local = drvif_color_od_access_lut_struct(recursive);

	for(i=0;i<32;i++) {
		od_lut_local->pre_idx[i] = i*8;
		od_lut_local->cur_idx[i] = i*8;
	}
	od_lut_local->pre_idx[32] = 255;
	od_lut_local->cur_idx[32] = 255;
	
	fwif_color_set_od_lut_indices(recursive);
}
unsigned char fwif_color_set_od_liner_table(bool recursive)
{
	int i, j;
	extern unsigned char bODTableLoaded;
	extern char od_table_mode_store;
	extern unsigned char od_delta_table_g[OD_table_length];
	extern unsigned char od_target_table_g[OD_table_length];

	if(OD_table_length == 289)
	{
		for (i = 0; i < 17; i++)
			for (j = 0; j < 17; j++)
				od_target_table_g[i*17+j] = j << 4;

		for (i = 0; i < 17; i++)
			od_target_table_g[i*17+16] -= 1;

		fwif_color_od_table_transform(0, 0, od_target_table_g, od_delta_table_g);
		drvif_color_od_table_17x17_set(od_delta_table_g, 0, 3); // 3: write to rgb channel
		rtd_printk(KERN_EMERG,"VPQ_OD", "%s, od_delta_table_g updated\n", __func__);
	}
	else if(OD_table_length == 1089)
	{
		for (i = 0; i < 33; i++)
			for (j = 0; j < 33; j++)
				od_target_table_g[i*33+j] = j << 3;

		for (i = 0; i < 33; i++)
			od_target_table_g[i*33+32] -= 1;

		fwif_color_od_table_transform(0, recursive, od_target_table_g, od_delta_table_g);
		if(recursive)
		{
			drvif_color_od_table_33x33_set(od_delta_table_g, 0, 7); // 7: write to rec rgb channel
		}
		else
		{
			if (Get_DISPLAY_REFRESH_RATE() == 60)
				drvif_color_od_table_33x33_set(od_delta_table_g, 0, 3); // 3: write to rgb channel sram 0~2
			else
				drvif_color_od_table_33x33_set(od_delta_table_g, 0, 11); // 11: write to sram 0~5 for 120 2 pixel
		}
		rtd_printk(KERN_EMERG,"VPQ_OD", "%s, od_delta_table_g updated\n", __func__);
	}
	else
	{
		return FALSE;
	}

	return TRUE;
}

unsigned char fwif_color_set_od_default_table(void)
{
	/* set default table tuned by Endo san to OD LUT, and linear table to Recursive OD LUT */
	
	extern unsigned char bODTableLoaded;
	extern char od_table_mode_store;
  	extern unsigned char od_table_default[17][17];
	extern unsigned char od_delta_table_g[OD_table_length];
	extern unsigned char od_target_table_g[OD_table_length];

	if(OD_table_length == 289)
	{
		fwif_color_od_table_transform(0, 0, (unsigned char *)&od_table_default, od_delta_table_g);
		drvif_color_od_table_17x17_set(od_delta_table_g, 0, 3); // 3: write to rgb channel
		rtd_printk(KERN_EMERG,"VPQ_OD", "%s, od_delta_table_g updated\n", __func__);
	}
	else if(OD_table_length == 1089)
	{
		fwif_color_od_table_interpolation((unsigned char *)&od_table_default, od_target_table_g);
		fwif_color_od_table_transform(0, 0, od_target_table_g, od_delta_table_g);
		if (Get_DISPLAY_REFRESH_RATE() == 60)
		{
			drvif_color_od_table_33x33_set(od_delta_table_g, 0, 3); // 3: write to sram 0~2
			fwif_color_set_od_liner_table(1); // recursive set linear
		}
		else
		{
			drvif_color_od_table_33x33_set(od_delta_table_g, 0, 11); // 11: write to sram 0~5 for 120 2 pixel
		}
		rtd_printk(KERN_EMERG,"VPQ_OD", "%s, od_delta_table_g updated\n", __func__);
	}
	else
	{
		return FALSE;
	}

	od_table_mode_store = 1;// 0:target mode 1:delta mode
	bODTableLoaded = TRUE;

	return TRUE;
}
#if 0
//tv006 DB trans to delta mode table
void fwif_color_od_table_tv006_convert(unsigned char *pTableIn, unsigned int *pTableOut)
{
	extern unsigned int od_table_store_target[OD_table_length];
	int x, y, xp, yp, yp2;
	unsigned char tmp[3][34];

	if (pTableIn == NULL || pTableOut == NULL)
		return;

	for (y = 0; y < 17; y++) {
		if (y == 0) {
			yp = 0;
			yp2 = 17;
			for (x = 0; x < 17; x++) {
				xp = x<<1;
				tmp[0][xp] = pTableIn[yp+x];
				tmp[2][xp] = pTableIn[yp2+x];
			}
			for (x = 1; x < 32; x+=2) {
				tmp[0][x] = (tmp[0][x-1]+tmp[0][x+1])>>1;
				tmp[2][x] = (tmp[2][x-1]+tmp[2][x+1])>>1;
			}
			for (x = 0; x < 33; x++) {
				tmp[1][x] = (tmp[0][x]+tmp[2][x])>>1;
			}
			tmp[0][33] = tmp[0][32];
			tmp[1][33] = tmp[1][32];
			tmp[2][33] = tmp[2][32];

			for (x = 0; x < 17; x++) {
				xp = x<<1;
				od_table_store_target[yp+x] =
					(tmp[0][xp]<<24)+
					(tmp[1][xp]<<16)+
					(tmp[0][xp+1]<<8)+
					tmp[1][xp+1];
			}

			memcpy(tmp[0], tmp[2], 34);
		} else if (y < 16) {
			yp = 17*y;
			yp2 = 17*(y+1);
			for (x = 0; x < 17; x++) {
				xp = x<<1;
				tmp[2][xp] = pTableIn[yp2+x];
			}
			for (x = 1; x < 32; x+=2) {
				tmp[2][x] = (tmp[2][x-1]+tmp[2][x+1])>>1;
			}
			for (x = 0; x < 33; x++) {
				tmp[1][x] = (tmp[0][x]+tmp[2][x])>>1;
			}
			tmp[1][33] = tmp[1][32];
			tmp[2][33] = tmp[2][32];

			for (x = 0; x < 17; x++) {
				xp = x<<1;
				od_table_store_target[yp+x] =
					(tmp[0][xp]<<24)+
					(tmp[1][xp]<<16)+
					(tmp[0][xp+1]<<8)+
					tmp[1][xp+1];
			}

			memcpy(tmp[0], tmp[2], 34);
		} else {
			yp = 17*y;
			memcpy(tmp[1], tmp[0], 34);
			for (x = 0; x < 17; x++) {
				xp = x<<1;
				od_table_store_target[yp+x] =
					(tmp[0][xp]<<24)+
					(tmp[1][xp]<<16)+
					(tmp[0][xp+1]<<8)+
					tmp[1][xp+1];
			}
		}
	}

	// trans target mode to delta mode
	/*
	fwif_color_od_table_tv006_transform(0, od_table_store_target, pTableOut);

	for (x = 0; x < 17; x++) {
		y = x*17;
		printk(KERN_EMERG "OD_table %x : %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d, %d\n",
				x, pTableOut[y+0], pTableOut[y+1], pTableOut[y+2], pTableOut[y+3], pTableOut[y+4], pTableOut[y+5],
				pTableOut[y+6], pTableOut[y+7], pTableOut[y+8], pTableOut[y+9], pTableOut[y+10], pTableOut[y+11],
				pTableOut[y+12], pTableOut[y+13], pTableOut[y+14], pTableOut[y+15], pTableOut[y+16]
			);
	}*/
	memcpy(pTableOut, od_table_store_target, sizeof(od_table_store_target));
}


// 33x33 to 33x33
// row first
// 160825 henry
void fwif_color_od_table_tv006_transform(bool transType, unsigned int *pTableIn, unsigned int *pTableOut)
{
#define targer2delta 0
#define delta2target 1

	int i, j;
	//short tmp[2][2] = {0};
	unsigned char tmp[2][2] = {{0}};
	unsigned char tmp_p[2][2] = {{0}}; // 2's complemnt

	if (pTableIn == NULL || pTableOut == NULL)
		return;

	for(i = 0; i < 17; i++)	{
		for(j = 0; j < 17; j++) {

			tmp[0][0] = pTableIn[i*17+j] >> 24;
			tmp[0][1] = (pTableIn[i*17+j] >> 16) & 0xFF;
			tmp[1][0] = (pTableIn[i*17+j] >> 8) & 0xFF;
			tmp[1][1] = (pTableIn[i*17+j]) & 0xFF;

			if(transType == targer2delta) {
				int j2 = j * 2;

				if (j == 15) {
					tmp_p[0][0] = tmp[0][0]-j2*8;
					tmp_p[0][1] = tmp[0][1]-j2*8;
					tmp_p[1][0] = tmp[0][0]-247;
					tmp_p[1][1] = tmp[0][1]-247;
				}
				else if(j == 16) {
					tmp_p[0][0] = tmp[0][0]-255;
					tmp_p[0][1] = tmp[0][1]-255;
					tmp_p[1][0] = tmp_p[0][0];
					tmp_p[1][1] = tmp_p[0][1];
				}
				else {
					//if(tmp[0][0]-j2*8 < 0)
					//	tmp_p[0][0] = ~(-(tmp[0][0]-j2*8));
					//else
						tmp_p[0][0] = tmp[0][0]-j2*8;

					//if(tmp[0][1]-j2*8 < 0)
					//	tmp_p[0][1] = ~(-(tmp[0][1]-j2*8));
					//else
						tmp_p[0][1] = tmp[0][1]-j2*8 ;

					//if(tmp[1][0]-(j2+1)*8 < 0)
						//tmp_p[1][0] = ~(-(tmp[1][0]-(j2+1)*8));
					//else
						tmp_p[1][0] = tmp[1][0]-(j2+1)*8;

					//if(tmp[1][1]-(j2+1)*8 < 0)
					//	tmp_p[1][1] = ~(-(tmp[1][1]-(j2+1)*8));
					//else
						tmp_p[1][1] = tmp[1][1]-(j2+1)*8;

				}
				pTableOut[i*17+j] = (tmp_p[0][0]<<24) +
									(tmp_p[0][1]<<16) +
									(tmp_p[0][0]<<8)  +
									 tmp_p[0][1];
			}



			else if(transType == delta2target) {

			}
		}
	}

}
#endif
void fwif_color_od_table_interpolation(unsigned char *pTableIn, unsigned char *pTableOut)
{
	/* this function is uesd to interpolate 17x17 LUT to 33x33
	c1 is existed value in 17x17, others x1 to x3 need to be interpolated
	| c1 | X1 |
	| -- | -- |
	| x2 | x3 |
	*/
	int i = 0, j = 0;

	for(i=0;i<16;i++)
	{
		for(j=0;j<16;j++)
		{	// cur index c1
			pTableOut[(i*33+j)*2] = pTableIn[i*17+j];
			// down side index x2
			pTableOut[(i*2+1)*33+j*2] = (pTableIn[i*17+j] + pTableIn[(i+1)*17+j])/2;

			if(j!=15) {
				// left side index x1
				pTableOut[(i*33+j)*2+1] = (pTableIn[i*17+j] + pTableIn[i*17+j+1])/2;
				// diagnoal side index x3
				pTableOut[(i*2+1)*33+j*2+1] = (pTableIn[i*17+j] + pTableIn[i*17+j+1] + pTableIn[(i+1)*17+j] + pTableIn[(i+1)*17+j+1])/4;
			}
			else {  // handel 255 to 256 interpolation problem
				// left side index x1
				pTableOut[(i*33+j)*2+1] = (pTableIn[i*17+j] + pTableIn[i*17+j+1] + 1)/2;
				// diagnoal side index x3
				pTableOut[(i*2+1)*33+j*2+1] = (pTableIn[i*17+j] + pTableIn[i*17+j+1] + pTableIn[(i+1)*17+j] + pTableIn[(i+1)*17+j+1]+2)/4;
			}
		}
	}

	// last row
	for(j=0;j<16;j++)
	{
		i=16;
		pTableOut[(i*33+j)*2] = pTableIn[i*17+j];
		if(j!=15) {
			pTableOut[(i*33+j)*2+1] = (pTableIn[i*17+j] + pTableIn[i*17+j+1])/2;
		}
		else {
			pTableOut[(i*33+j)*2+1] = (pTableIn[i*17+j] + pTableIn[i*17+j+1] + 1)/2;
		}
	}

	// last col
	for(i=0;i<33;i++)
	{
		pTableOut[i*33+32] = 255;
	}
}
void fwif_color_od_table_transform(bool transType, bool recursive, unsigned char *pTableIn, unsigned char *pTableOut)
{
	/* this function is uesd to transform LUT between target and delta table */

#define targer2delta 0
#define delta2target 1

	int i, j;
	unsigned char tmp = 0, tmp_p = 0;

	if (pTableIn == NULL || pTableOut == NULL)
		return;

	if(OD_table_length == 289)
	{
		for(i = 0; i < 17; i++)	{ // y: pre
			for(j = 0; j < 17; j++) { // x: cur

				tmp = pTableIn[i*17+j];

				if(transType == targer2delta) {

					if(j == 16) {
						tmp_p = tmp - 255;
					}
					else {
						tmp_p = tmp - 16 * j;
					}

					pTableOut[i*17+j] = tmp_p;
				}
				else if(transType == delta2target) {
					// TODO:
				}
			}
		}
	}
	else if(OD_table_length == 1089)
	{
		DRV_od_lut_ctrl *od_lut_local = drvif_color_od_access_lut_struct(recursive);
		drif_color_od_lut_index_get(recursive, (unsigned char *)&(od_lut_local->pre_idx), (unsigned char *)&(od_lut_local->cur_idx));

		for(i = 0; i < 33; i++)	{ // y: pre
			for(j = 0; j < 33; j++) { // x: cur

				tmp = pTableIn[i*33+j];

				if(transType == targer2delta) {
					#if 0
					if(j == 32) {
						tmp_p = tmp - 255;
					}
					else {
						tmp_p = tmp - 8 * j;
					}
					#else
					// programmable indices
					tmp_p = tmp - od_lut_local->cur_idx[j];
					#endif
					pTableOut[i*33+j] = tmp_p;
				}
				else if(transType == delta2target) {
					// TODO:
				}
			}
		}
	}
	else
	{
		return;
	}
}

void fwif_color_od_table_restore(void)
{

	extern char od_table_mode_store;
	extern unsigned char od_delta_table_g[OD_table_length];

	if (od_table_mode_store == 1 && OD_table_length == 289) // 0:target mode 1:delta mode
	{
		drvif_color_od_table_17x17_set(od_delta_table_g, 0, 3); // 3: write to rgb channel
	}
	else if (od_table_mode_store == 1 && OD_table_length == 1089) // 0:target mode 1:delta mode
	{
		if(Get_DISPLAY_REFRESH_RATE() == 60)
		{
			// OD LUT and index
			fwif_color_set_od_liner_indices(0);
			drvif_color_od_table_33x33_set(od_delta_table_g, 0, 3); // 3: write to sram 0~2

			// recursive OD LUT and index
			// TODO: restore from global structure instead of linear table
			fwif_color_set_od_liner_indices(1);
			fwif_color_set_od_liner_table(1); // recursive set linear
		}
		else
		{
			fwif_color_set_od_liner_indices(0);
			drvif_color_od_table_33x33_set(od_delta_table_g, 0, 11); // 11: write to sram 0~5 for 120hz 2 pixel
		}
		rtd_printk(KERN_EMERG,"VPQ_OD", "%s, od_delta_table_g updated\n", __func__);
	}	
}
void fwif_color_od_table_dynamic_for_VRR(void)
{
	/* This function is used for adaptively setting OD LUT in VRR application */
	
	extern unsigned char vbe_disp_get_VRR_timingMode_flag(void);
	extern unsigned char od_delta_table_g[OD_table_length];
  	extern unsigned char od_table_default[17][17];
  	extern unsigned char od_table1[OD_table_length];
  	extern unsigned char od_table2[OD_table_length];
  	extern unsigned char od_table3[OD_table_length];

	unsigned char vrr_enable = vbe_disp_get_VRR_timingMode_flag();
	ppoverlay_ivs_cnt_3_RBUS ppoverlay_ivs_cnt_3_reg;
	unsigned int intputVsyncCount=0;
	unsigned int intputFrameRate = 0;

	return; // k7 not verified

	/* check VRR enable */
	if(vrr_enable == 0)
		goto final;

	/* get timing */
	ppoverlay_ivs_cnt_3_reg.regValue = IoReg_Read32(PPOVERLAY_IVS_cnt_3_reg);
	intputVsyncCount = ppoverlay_ivs_cnt_3_reg.ivs_cnt_ori;
	intputFrameRate = 2700000000UL/intputVsyncCount;	//multiple 100, e.g. 60 hz will show intputFrameRate=6000

	/* set 120hz OD table */
	if(intputFrameRate >= 4800 && intputFrameRate < 6000)
	{
		fwif_color_od_table_transform(0, 0, (unsigned char *)&od_table1, od_delta_table_g);
		drvif_color_od_table_33x33_set(od_delta_table_g, 0, 11); // 11: write to sram 0~5 for 120hz 2 pixel
		rtd_pr_vpq_emerg("%s, VRR OD FrameRate:%d, od_table: 1\n", __func__, intputFrameRate);
	}
	else if(intputFrameRate >= 6000 && intputFrameRate < 7500)
	{
		fwif_color_od_table_transform(0, 0, (unsigned char *)&od_table2, od_delta_table_g);
		drvif_color_od_table_33x33_set(od_delta_table_g, 0, 11); // 11: write to sram 0~5 for 120hz 2 pixel
		rtd_pr_vpq_emerg("%s, VRR OD FrameRate:%d, od_table: 2\n", __func__, intputFrameRate);
	}
	else if(intputFrameRate >= 7500 && intputFrameRate < 10000)
	{
		fwif_color_od_table_transform(0, 0, (unsigned char *)&od_table3, od_delta_table_g);
		drvif_color_od_table_33x33_set(od_delta_table_g, 0, 11); // 11: write to sram 0~5 for 120hz 2 pixel
		rtd_pr_vpq_emerg("%s, VRR OD FrameRate:%d, od_table: 3\n", __func__, intputFrameRate);
	}
	else if(intputFrameRate >= 10000)
	{
		fwif_color_od_table_transform(0, 0, (unsigned char *)&od_table_default, od_delta_table_g);
		drvif_color_od_table_33x33_set(od_delta_table_g, 0, 11); // 11: write to sram 0~5 for 120hz 2 pixel
		rtd_pr_vpq_emerg("%s, VRR OD FrameRate:%d, od_table: default\n", __func__, intputFrameRate);
	}

final:
	return;
}
void fwif_color_handler(void)
{
	SCALER_DISP_CHANNEL display;
	//unsigned short UZD_outH;
	//unsigned short UZD_outV;

	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*Scaler_Setswitch_DVIandHDMI(SLR_Switch_Auto_MODE);	*/ /*=== marked by Elsie ===*/

	display = (SCALER_DISP_CHANNEL)(VIP_system_info_structure_table->input_display);
	//UZD_outV = VIP_system_info_structure_table->Cap_Height;
	//UZD_outH = VIP_system_info_structure_table->Cap_Width;

	drvif_color_digital_filtering_init(display);	/*hsinyi 20090617*/

/*==============peaking init=========================*/
	drvif_color_sharpness_init(display);
	if (vpq_project_id != 0x00060000 || vpqex_project_id != 0x00060000)
		drvif_color_2dpk_init(display, 1);/*0 - ->old function, 1 - ->new function*/

	/*FixMe*/
	/*drvif_color_2dpk_MKIII_init(display, 1);*/ /*20130221 March add*/
/*=================================================*/




	drvif_color_noisereduction_impulse(display, 0, Scaler_DispGetStatus(display, SLR_DISP_FSYNC));

	drvif_color_noise_estimation_init(display, TRUE/*enable*/);

	/*default gamma*/
	/*drvif_color_S_Curve(0, 0, 0, 0, 0);*/
	/*swap sRGB sequnce, elieli 20131209*/
	/*IoReg_SetBits(SRGB_sRGB_CTRL_reg, _BIT5);*/
}
void fwif_color_set_new_uvc(unsigned char src_idx, unsigned char level)
{
	extern DRV_NEW_UVC gUVCTable[new_UVC_MAX];
	DRV_NEW_UVC UVCTableHere;

	if (level >= new_UVC_MAX)
		level = 0;

	if (level == 255) {
		UVCTableHere.UVC_ctrl.UVC_main_en = 0;
		UVCTableHere.UVC_ctrl.UVC_sub_en = 0;
	} else {
		UVCTableHere.UVC_ctrl.UVC_main_en = gUVCTable[level].UVC_ctrl.UVC_main_en;
		UVCTableHere.UVC_ctrl.UVC_sub_en = gUVCTable[level].UVC_ctrl.UVC_sub_en;
	}

	UVCTableHere.UVC_ctrl.UVC_overlay_sel = gUVCTable[level].UVC_ctrl.UVC_overlay_sel;
	UVCTableHere.UVC_ctrl.UVC_skin_sel = gUVCTable[level].UVC_ctrl.UVC_skin_sel;
	UVCTableHere.UVC_ctrl.UVC_qdrt1_en = gUVCTable[level].UVC_ctrl.UVC_qdrt1_en;
	UVCTableHere.UVC_ctrl.UVC_qdrt2_en = gUVCTable[level].UVC_ctrl.UVC_qdrt2_en;
	UVCTableHere.UVC_ctrl.UVC_qdrt3_en = gUVCTable[level].UVC_ctrl.UVC_qdrt3_en;
	UVCTableHere.UVC_ctrl.UVC_qdrt4_en = gUVCTable[level].UVC_ctrl.UVC_qdrt4_en;
	UVCTableHere.UVC_ctrl.UVC_y0 = gUVCTable[level].UVC_ctrl.UVC_y0;
	UVCTableHere.UVC_ctrl.UVC_y_slope = gUVCTable[level].UVC_ctrl.UVC_y_slope;

	UVCTableHere.UVC_set_global.UVC_U_thd1 = gUVCTable[level].UVC_set_global.UVC_U_thd1;
	UVCTableHere.UVC_set_global.UVC_U_slope1 = gUVCTable[level].UVC_set_global.UVC_U_slope1;
	UVCTableHere.UVC_set_global.UVC_U_thd2 = gUVCTable[level].UVC_set_global.UVC_U_thd2;
	UVCTableHere.UVC_set_global.UVC_U_slope2 = gUVCTable[level].UVC_set_global.UVC_U_slope2;
	UVCTableHere.UVC_set_global.UVC_V_thd1 = gUVCTable[level].UVC_set_global.UVC_V_thd1;
	UVCTableHere.UVC_set_global.UVC_V_slope1 = gUVCTable[level].UVC_set_global.UVC_V_slope1;
	UVCTableHere.UVC_set_global.UVC_V_thd2 = gUVCTable[level].UVC_set_global.UVC_V_thd2;
	UVCTableHere.UVC_set_global.UVC_V_slope2 = gUVCTable[level].UVC_set_global.UVC_V_slope2;

	UVCTableHere.UVC_set_skin.UVC_U_thd1 = gUVCTable[level].UVC_set_skin.UVC_U_thd1;
	UVCTableHere.UVC_set_skin.UVC_U_slope1 = gUVCTable[level].UVC_set_skin.UVC_U_slope1;
	UVCTableHere.UVC_set_skin.UVC_U_thd2 = gUVCTable[level].UVC_set_skin.UVC_U_thd2;
	UVCTableHere.UVC_set_skin.UVC_U_slope2 = gUVCTable[level].UVC_set_skin.UVC_U_slope2;
	UVCTableHere.UVC_set_skin.UVC_V_thd1 = gUVCTable[level].UVC_set_skin.UVC_V_thd1;
	UVCTableHere.UVC_set_skin.UVC_V_slope1 = gUVCTable[level].UVC_set_skin.UVC_V_slope1;
	UVCTableHere.UVC_set_skin.UVC_V_thd2 = gUVCTable[level].UVC_set_skin.UVC_V_thd2;
	UVCTableHere.UVC_set_skin.UVC_V_slope2 = gUVCTable[level].UVC_set_skin.UVC_V_slope2;
	drvif_color_set_new_uvc((DRV_NEW_UVC *)(&UVCTableHere));
}

#if 0 //k5l hw remove
void fwif_color_set_blue_stretch(unsigned char src_idx, unsigned char table)
{
	extern DRV_Gamma_BS gBSTable[Blue_Stretch_MAX];

	if (table >= Blue_Stretch_MAX)
		table = 0;
	drvif_color_set_Blue_Stretch((DRV_Gamma_BS *)(&(gBSTable[table])));
}
#endif

void fwif_color_set_LGD_POD(unsigned char* pInputLUT)
{
	drvif_color_set_LGD_POD(pInputLUT);
}

void fwif_color_set_pcid2(unsigned char bpcid2)
{
	unsigned int TblIdx = 0, i = 0;
	unsigned int timeout_cnt = 0x0325000;
	sys_reg_sys_clken3_RBUS sys_reg_sys_clken3_reg;

	sys_reg_sys_clken3_reg.regValue = IoReg_Read32(SYS_REG_SYS_CLKEN3_reg);

	if(bpcid2!=0)
	{
		// disable pcid 1 and pcid 2
		timeout_cnt = 0x0325000;
		if (drvif_color_get_pcid_enable() == 1 ) {
			drvif_color_set_pcid_enable(0);
			while ((PPOVERLAY_Double_Buffer_CTRL_get_dreg_dbuf_set(IoReg_Read32(PPOVERLAY_Double_Buffer_CTRL_reg)) == 1) && (timeout_cnt > 10)) {
				timeout_cnt--;
			}
			if (timeout_cnt <= 10) {
				rtd_pr_vpq_emerg("kernel copy VPQ_IOC_SET_OdExtentions_pData(PCID1) disable time out\n");
			}
		}

		timeout_cnt = 0x0325000;
		if (drvif_color_get_pcid2_enable() == 1 ) {
			drvif_color_set_pcid2_enable(0);
			while ((PPOVERLAY_Double_Buffer_CTRL_get_dreg_dbuf_set(IoReg_Read32(PPOVERLAY_Double_Buffer_CTRL_reg)) == 1) && (timeout_cnt > 10)) {
				timeout_cnt--;
			}
			if (timeout_cnt <= 10) {
				rtd_pr_vpq_emerg("kernel copy VPQ_IOC_SET_OdExtentions_pData(PCID2) disable time out\n");
			}
		}

		// disable FCIC clock and enable
		drvif_color_set_fcic_enable(0);
		sys_reg_sys_clken3_reg.regValue = 0;
		sys_reg_sys_clken3_reg.clken_disp_lg_hcic = 1;
		IoReg_Write32(SYS_REG_SYS_CLKEN3_reg, sys_reg_sys_clken3_reg.regValue);

		// start to write settings
		fwif_color_set_pcid2_data_setting(_PCID_DATA_DEFAULT);
		fwif_color_set_pcid2_pixel_reference_setting(_PCID_PXLREF_DEFAULT);
		fwif_color_set_pcid_RgnTable_Setting(_PCID_RGN_19x19_1x10);

		fwif_color_refresh_pcid_RgnTable();
		for(TblIdx=0;TblIdx<((drvif_color_get_pcid_RegionType()==_PCID_RGN_4x4)?16:10);TblIdx++)
		{
			for(i=0; i<PCID_TBL_LEN; i++)
			{
				PCID_SampleRgnTbl[i] = TblIdx*128 + 256;
			}
			fwif_color_set_pcid_RgnTableValue(PCID_SampleRgnTbl, TblIdx, _PCID_COLOR_ALL);
		}
		drvif_color_set_LGD_POD_enable(0);
		drvif_color_set_pcid_enable(0);
		drvif_color_set_pcid2_enable(1);
	}
	else
	{
		drvif_color_set_pcid2_enable(0);
	}
}

void fwif_color_set_pcid2_data_setting(unsigned char DataSet)
{
	extern DRV_pcid_data_t LineOD_DataTBL[_PCID_DATA_MAX];
	if( DataSet >= _PCID_DATA_MAX )
		DataSet = _PCID_DATA_DEFAULT;
	drvif_color_set_pcid_data_setting(&LineOD_DataTBL[DataSet]);
}

void fwif_color_set_pcid2_pixel_reference_setting(unsigned char PxlRefSet)
{
	extern DRV_pcid_ref_setting_t LineOD_PxlRefTBL[_PCID_PXLREF_MAX];

	if( PxlRefSet >= _PCID_PXLREF_MAX )
		PxlRefSet = _PCID_PXLREF_DEFAULT;

	drvif_color_set_pcid_pixel_reference_setting(&LineOD_PxlRefTBL[PxlRefSet]);
}

void fwif_color_set_pcid_RgnTable_Setting_TV006(unsigned char RgnSettingSet, unsigned int RowBnd[17], unsigned int ColBnd[17])
{
	int i=0;
	extern DRV_pcid_RgnTbl_t LineOD_RgnTblSettingTBL[_PCID_RGN_MAX];
	if( RgnSettingSet >= _PCID_RGN_MAX )
		RgnSettingSet = _PCID_RGN_MAX - 1;
	for(i=0; i<17; i++)
	{
		LineOD_RgnTblSettingTBL[RgnSettingSet].RowBnd[i] = RowBnd[i];
		LineOD_RgnTblSettingTBL[RgnSettingSet].ColBnd[i] = ColBnd[i];
	}
	drvif_color_set_pcid_regional_table_setting(&LineOD_RgnTblSettingTBL[RgnSettingSet]);
}

void fwif_color_set_pcid_RgnTable_Setting(unsigned char RgnSettingSet)
{
	extern DRV_pcid_RgnTbl_t LineOD_RgnTblSettingTBL[_PCID_RGN_MAX];
	if( RgnSettingSet >= _PCID_RGN_MAX )
		RgnSettingSet = _PCID_RGN_MAX - 1;
	drvif_color_set_pcid_regional_table_setting(&LineOD_RgnTblSettingTBL[RgnSettingSet]);
}

void fwif_color_refresh_pcid_RgnTable(void)
{
	// This force the all table (SRAM/DriverRecord) value to be 0
	unsigned int i=0, j=0, k=0;
	for(i=0; i<16; i++)
	{
		for(j=0; j<3; j++)
		{
			for(k=0; k<PCID_TBL_LEN; k++)
			{
				pcidRgnTbl[i][j][k] = 0;
			}
		}
	}

	for(i=0; i<PCID_TBL_LEN; i++)
	{
		PCID_RgnWriteTbl[i] = 0;
	}

	for(i=0; i<9; i++)
	{
		drvif_color_set_pcid_regional_table_valuetable(PCID_RgnWriteTbl, i ,_PCID_COLOR_ALL);
	}

}

void fwif_color_pcid_Transpose_TV006(unsigned char *p_iTbl, unsigned int tblsz, unsigned int *p_oTbl)
{
	/*
	1. transpose the LG table and put them to 19x19 table
	2. output a 19x19 table with data type unsigned int
	3. increase the data precision from 8bit to 12bit
	*/
	unsigned int x=0, y=0;
	
	if( tblsz > 19 )
		tblsz = 19;	
	
	for(y=0; y<tblsz; y++)
	{
		for(x=0; x<tblsz; x++)
		{
			p_oTbl[x*tblsz + y] = p_iTbl[y*tblsz + x] << 4;
		}
	}
}

void fwif_color_set_pcid_RgnTableValue(unsigned int* pTblValue, unsigned int ucTblIdx, unsigned char ucChannel)
{
	unsigned int i=0, j=0, Tbl1Idx=0, Tbl2Idx=0, Tbl3Idx=0, Tbl4Idx=0;
	unsigned char ucRgnIdx=0, ucTblSz=17;
	DRV_pcid_RgnType_t RgnType = _PCID_RGN_4x4;
	bool isSameTbl = true;

	RgnType = drvif_color_get_pcid_RegionType();
	ucTblSz = drvif_color_get_pcid_TableSize();

	if( ucChannel > 3 )
		ucChannel = 3;
	
	if( ucTblIdx >= (RgnType==_PCID_RGN_4x4? 16 : 10) )
	{
		rtd_pr_vpq_info("[%s] RgnType = %d, ucTblIdx = %d, exceed range, clip at max\n", __func__, RgnType, ucTblIdx);		
		ucTblIdx = (RgnType==_PCID_RGN_4x4? 15 : 9);
	}

	// Update the stored table from SRAM
	for(i=0; i<((RgnType==_PCID_RGN_4x4)?16:10); i++)
	{
		for(j=0; j<3; j++)
		{
			fwif_color_get_pcid_RgnTableValue(pcidRgnTbl[i][j], i, j);
		}
	}

	// Check the table is the same or not
	if(ucChannel<3)
	{
		for(i=0; i<ucTblSz*ucTblSz; i++)
		{
			if(pcidRgnTbl[ucTblIdx][ucChannel][i] != pTblValue[i])
			{
				pcidRgnTbl[ucTblIdx][ucChannel][i] = pTblValue[i];
				if( isSameTbl == true )
				{
					isSameTbl = false;
				}
			}
		}
	}
	else
	{
		for(j=0; j<3; j++)
		{
			for(i=0; i<ucTblSz*ucTblSz; i++)
			{
				if(pcidRgnTbl[ucTblIdx][j][i] != pTblValue[i])
				{
					pcidRgnTbl[ucTblIdx][j][i] = pTblValue[i];
					if( isSameTbl == true )
					{
						isSameTbl = false;
					}
				}
			}
		}
	}

	// Write the table when table is not the same
	if(isSameTbl == false)
	{
		if(RgnType == _PCID_RGN_4x4)
		{
			if(ucChannel < 3)
			{
				for(i=0; i<4; i++)
				{
					ucRgnIdx = Rgn4x4MappingTbl[ucTblIdx][i];
					if(ucRgnIdx == RGN_NA)
						continue;

					Tbl1Idx = (ucRgnIdx/3)*4 + (ucRgnIdx)%3 + 0;
					Tbl2Idx = (ucRgnIdx/3)*4 + (ucRgnIdx)%3 + 1;
					Tbl3Idx = (ucRgnIdx/3)*4 + (ucRgnIdx)%3 + 4;
					Tbl4Idx = (ucRgnIdx/3)*4 + (ucRgnIdx)%3 + 5;

					for(j=0; j<ucTblSz*ucTblSz; j++)
					{
						PCID_RgnWriteTbl[j*2  ] = ((pcidRgnTbl[Tbl1Idx][ucChannel][j] & 0xfff) << 16) + ( pcidRgnTbl[Tbl2Idx][ucChannel][j] & 0xfff );
						PCID_RgnWriteTbl[j*2+1] = ((pcidRgnTbl[Tbl3Idx][ucChannel][j] & 0xfff) << 16) + ( pcidRgnTbl[Tbl4Idx][ucChannel][j] & 0xfff );
					}
					drvif_color_set_pcid_regional_table_valuetable(PCID_RgnWriteTbl, ucRgnIdx ,ucChannel);
				}
			}
			else
			{
				for(i=0; i<4; i++)
				{
					ucRgnIdx = Rgn4x4MappingTbl[ucTblIdx][i];
					if(ucRgnIdx == RGN_NA)
						continue;

					Tbl1Idx = (ucRgnIdx/3)*4 + (ucRgnIdx)%3 + 0;
					Tbl2Idx = (ucRgnIdx/3)*4 + (ucRgnIdx)%3 + 1;
					Tbl3Idx = (ucRgnIdx/3)*4 + (ucRgnIdx)%3 + 4;
					Tbl4Idx = (ucRgnIdx/3)*4 + (ucRgnIdx)%3 + 5;

					for(j=0; j<ucTblSz*ucTblSz; j++)
					{
						PCID_RgnWriteTbl[j*2  ] = ((pcidRgnTbl[Tbl1Idx][0][j] & 0xfff) << 16) + ( pcidRgnTbl[Tbl2Idx][0][j] & 0xfff );
						PCID_RgnWriteTbl[j*2+1] = ((pcidRgnTbl[Tbl3Idx][0][j] & 0xfff) << 16) + ( pcidRgnTbl[Tbl4Idx][0][j] & 0xfff );
					}
					drvif_color_set_pcid_regional_table_valuetable(PCID_RgnWriteTbl, ucRgnIdx ,ucChannel);
				}
			}
		}
		else
		{
			if(ucChannel < 3)
			{
				for(i=0; i<2; i++)
				{
					ucRgnIdx = Rgn1x10MappingTbl[ucTblIdx][i];
					if(ucRgnIdx == RGN_NA)
						continue;

					Tbl1Idx = ucRgnIdx;
					Tbl2Idx = ucRgnIdx+1;

					for(j=0; j<ucTblSz*ucTblSz; j++)
					{
						PCID_RgnWriteTbl[j] = ((pcidRgnTbl[Tbl1Idx][ucChannel][j] & 0xfff) << 16) + ( pcidRgnTbl[Tbl2Idx][ucChannel][j] & 0xfff );
					}
					drvif_color_set_pcid_regional_table_valuetable(PCID_RgnWriteTbl, ucRgnIdx ,ucChannel);
				}
			}
			else
			{
				for(i=0; i<2; i++)
				{
					ucRgnIdx = Rgn1x10MappingTbl[ucTblIdx][i];
					if(ucRgnIdx == RGN_NA)
						continue;

					Tbl1Idx = ucRgnIdx;
					Tbl2Idx = ucRgnIdx+1;

					for(j=0; j<ucTblSz*ucTblSz; j++)
					{
						PCID_RgnWriteTbl[j] = ((pcidRgnTbl[Tbl1Idx][0][j] & 0xfff) << 16) + ( pcidRgnTbl[Tbl2Idx][0][j] & 0xfff );
					}
					drvif_color_set_pcid_regional_table_valuetable(PCID_RgnWriteTbl, ucRgnIdx ,ucChannel);
				}
			}
		}

	}

}

void fwif_color_get_pcid_RgnTableValue(unsigned int* pTblValue, unsigned int ucTblIdx, unsigned char ucChannel)
{
	unsigned int i=0, j=0, TableValue=0;
	unsigned char ucRgnIdx=0, ucTblSz=17;
	DRV_pcid_RgnType_t RgnType = _PCID_RGN_4x4;

	RgnType = drvif_color_get_pcid_RegionType();
	ucTblSz = drvif_color_get_pcid_TableSize();

	if( ucChannel > 2 )
		ucChannel = 2;
	
	if( ucTblIdx >= (RgnType==_PCID_RGN_4x4? 16 : 10) )
	{
		rtd_pr_vpq_info("[%s] RgnType = %d, ucTblIdx = %d, exceed range, clip at max\n", __func__, RgnType, ucTblIdx);		
		ucTblIdx = (RgnType==_PCID_RGN_4x4? 15 : 9);
	}

	if(RgnType ==_PCID_RGN_4x4)
	{
		//if( ucTblIdx > 15 ) //Coverity 445692, already clip at the beginning, need check again
		//	ucTblIdx = 15;

		for(i=0; i<4; i++)
		{
			ucRgnIdx = Rgn4x4MappingTbl[ucTblIdx][i];
			if( ucRgnIdx!=RGN_NA )
			{
				// read the encoded data from SRAM
				drvif_color_get_pcid_regional_table_valuetable(PCID_RgnReadTbl, ucRgnIdx, ucChannel);

				// read and check the table is same in each region
				for(j=0; j<ucTblSz*ucTblSz; j++)
				{
					switch(i)
					{
						case 0:
							TableValue = (PCID_RgnReadTbl[j*2+1] >> 0 ) & 0xfff;
							break;
						case 1:
							TableValue = (PCID_RgnReadTbl[j*2+1] >> 16) & 0xfff;
							break;
						case 2:
							TableValue = (PCID_RgnReadTbl[j*2  ] >> 0 ) & 0xfff;
							break;
						case 3:
							TableValue = (PCID_RgnReadTbl[j*2  ] >> 16) & 0xfff;
							break;
						default:
							TableValue = (PCID_RgnReadTbl[j*2+1] >> 0 ) & 0xfff;
							break;
					}
					pTblValue[j] = TableValue;
				}
			}
		}
	}
	else
	{
		//if( ucTblIdx > 10 ) //Coverity 445692, already clip at the beginning, need check again
		//	ucTblIdx = 10;

		for(i=0; i<2; i++)
		{
			ucRgnIdx = Rgn1x10MappingTbl[ucTblIdx][i];
			if( ucRgnIdx!=RGN_NA )
			{
				// read the encoded data from SRAM
				drvif_color_get_pcid_regional_table_valuetable(PCID_RgnReadTbl, ucRgnIdx, ucChannel);

				// read and check the table is same in each region
				for(j=0; j<ucTblSz*ucTblSz; j++)
				{
					switch(i)
					{
						case 0:
							TableValue = (PCID_RgnReadTbl[j] >> 0 ) & 0xfff;
							break;
						case 1:
							TableValue = (PCID_RgnReadTbl[j] >> 16) & 0xfff;
							break;
						default:
							TableValue = (PCID_RgnReadTbl[j] >> 0 ) & 0xfff;
							break;
					}
					pTblValue[j] = TableValue;
				}
			}
		}
	}
}

void fwif_color_set_valc(unsigned char bValc)
{
	// Just for ip firmware verification
	extern DRV_valc_ctrl_t VALC_TBL[VALC_PATTERN_MAX];
	int i=0;

	if( bValc != 0 )
	{
		drvif_color_set_valc_enable(1);
		drvif_color_set_valc_SpatialPattern(&VALC_TBL[VALC_PATTERN_H2V2].Pattern);
		drvif_color_set_valc_HPF_protect(&VALC_TBL[VALC_PATTERN_H2V2].HPFCtrl);
		drvif_color_set_valc_SAT_protect(&VALC_TBL[VALC_PATTERN_H2V2].SATCtrl);

		// write sample exp table
		for(i=0; i<VALC_TBL_LEN; i++)
		{
			VALC_SampleTbl[i] = CLIP(0, 4095, i*4+128);
		}
		fwif_color_set_valc_table(VALC_SampleTbl, 0, _VALC_COLOR_R);
		fwif_color_set_valc_table(VALC_SampleTbl, 0, _VALC_COLOR_G);
		fwif_color_set_valc_table(VALC_SampleTbl, 0, _VALC_COLOR_B);

		for(i=0; i<VALC_TBL_LEN; i++)
		{
			VALC_SampleTbl[i] = CLIP(0, 4095, i*4-128);
		}
		fwif_color_set_valc_table(VALC_SampleTbl, 1, _VALC_COLOR_R);
		fwif_color_set_valc_table(VALC_SampleTbl, 1, _VALC_COLOR_G);
		fwif_color_set_valc_table(VALC_SampleTbl, 1, _VALC_COLOR_B);
	}
	else
	{
		drvif_color_set_valc_enable(0);
	}
}

void fwif_color_set_valc_table(unsigned int* pTbl, unsigned char ucTblIdx, unsigned char ucChannel)
{
	int i=0;


	if( ucTblIdx > 1 )
		ucTblIdx = 1;
	if( ucChannel > 2 )
		ucChannel = 2;

	// Update the necessary TABLE from SRAM
	fwif_color_get_valc_table(valcTbl[ucChannel][(ucTblIdx+1)%2], (ucTblIdx+1)%2, ucChannel);

	// VALC_WriteTbl
	for(i=0; i<VALC_TBL_LEN; i++)
	{
		if(ucTblIdx==0)
			VALC_WriteTbl[i] = (pTbl[i] << 16) + valcTbl[ucChannel][1][i];
		else
			VALC_WriteTbl[i] = (valcTbl[ucChannel][0][i] << 16) + pTbl[i];
	}

	drvif_color_set_valc_table(VALC_WriteTbl, ucChannel);

}

void fwif_color_get_valc_table(unsigned int* pTbl, unsigned char ucTblIdx, unsigned char ucChannel)
{
	int i=0;

	if( ucTblIdx > 1 )
		ucTblIdx = 1;
	if( ucChannel > 2 )
		ucChannel = 2;

	drvif_color_get_valc_table(VALC_ReadTbl, ucChannel);
	for(i=0; i<VALC_TBL_LEN; i++)
	{
		pTbl[i] = (ucTblIdx==0)? ((VALC_ReadTbl[i] >> 16) & 0xfff) : ( VALC_ReadTbl[i] & 0xfff );
	}
}

UINT8 TV006_WB_Pattern_En = 0;
#undef rtd_setbits
#define rtd_setbits(offset, Mask) rtd_outl(offset, (rtd_inl(offset) | Mask))
#undef rtd_clearbits
#define rtd_clearbits(offset, Mask) rtd_outl(offset, ((rtd_inl(offset) & ~(Mask))))
extern struct semaphore VBE_LowDelay_Semaphore;
static void disable_uzu_dtg_remove_multiple(unsigned char m_lowdelay_en)
{
    ppoverlay_double_buffer_ctrl_RBUS double_buffer_ctrl_reg;
    ppoverlay_iv2dv_double_buffer_ctrl_RBUS ppoverlay_iv2dv_double_buffer_ctrl_reg;
    ppoverlay_double_buffer_ctrl2_RBUS ppoverlay_double_buffer_ctrl2_reg;
    ppoverlay_dispd_smooth_toggle1_RBUS dispd_smooth_toggle1_reg;
    ppoverlay_dispd_stage1_sm_ctrl_RBUS     dispd_stage1_sm_ctrl_reg;
    ppoverlay_uzudtg_fractional_fsync_RBUS uzudtg_fractional_fsync_reg;
    ppoverlay_uzudtg_countrol_RBUS ppoverlay_uzudtg_countrol_reg;
    unsigned char uzu_valid_framecnt = 0;
    ppoverlay_dtg_frame_cnt1_RBUS dtg_frame_cnt1_reg;

    SCALER_DISP_CHANNEL channel = (SCALER_DISP_CHANNEL)SLR_MAIN_DISPLAY;

    unsigned int count = 0xfffff;
    unsigned long flags;//for spin_lock_irqsave

    drivf_scaler_reset_freerun();

    ppoverlay_uzudtg_countrol_reg.regValue = IoReg_Read32(PPOVERLAY_UZUDTG_COUNTROL_reg);
    ppoverlay_uzudtg_countrol_reg.uzudtg_mode_revised = 0;
    IoReg_Write32(PPOVERLAY_UZUDTG_COUNTROL_reg, ppoverlay_uzudtg_countrol_reg.regValue);
    printk(KERN_EMERG "[disable_uzu_dtg_remove_multiple] uzudtg_mode_revised == 0\n");

    down(get_forcebg_semaphore());/*semaphore must added for not effect mute function when setting b8028300*/
    //double buffer D0
    spin_lock_irqsave(get_DBreg_spinlock(SLR_MAIN_DISPLAY), flags);//lock double buffer spinlock
    //D2
    ppoverlay_iv2dv_double_buffer_ctrl_reg.regValue = IoReg_Read32(PPOVERLAY_iv2dv_Double_Buffer_CTRL_reg);
    ppoverlay_iv2dv_double_buffer_ctrl_reg.iv2dv_db_en = 0;
    IoReg_Write32(PPOVERLAY_iv2dv_Double_Buffer_CTRL_reg, ppoverlay_iv2dv_double_buffer_ctrl_reg.regValue);
    double_buffer_ctrl_reg.regValue = IoReg_Read32(PPOVERLAY_Double_Buffer_CTRL_reg);
    double_buffer_ctrl_reg.dreg_dbuf_en = 0;
    double_buffer_ctrl_reg.drm_multireg_dbuf_en = 1;
    double_buffer_ctrl_reg.drm_multireg_dbuf_read_sel = 1;
    double_buffer_ctrl_reg.drm_multireg_dbuf_vsync_sel = 1;
    IoReg_Write32(PPOVERLAY_Double_Buffer_CTRL_reg, double_buffer_ctrl_reg.regValue);
    spin_unlock_irqrestore(get_DBreg_spinlock(SLR_MAIN_DISPLAY), flags);//unlock double buffer spinlock
    up(get_forcebg_semaphore());/*semaphore must added for not effect mute function when setting b8028300*/
    ppoverlay_double_buffer_ctrl2_reg.regValue = IoReg_Read32(PPOVERLAY_Double_Buffer_CTRL2_reg);
    ppoverlay_double_buffer_ctrl2_reg.memcdtgreg_dbuf_en = 0;
    ppoverlay_double_buffer_ctrl2_reg.uzudtgreg_dbuf_en = 0;
    IoReg_Write32(PPOVERLAY_Double_Buffer_CTRL2_reg, ppoverlay_double_buffer_ctrl2_reg.regValue);

    down(&VBE_LowDelay_Semaphore);
    dispd_smooth_toggle1_reg.regValue = IoReg_Read32(PPOVERLAY_dispd_smooth_toggle1_reg);
    dispd_smooth_toggle1_reg.dispd_stage1_smooth_toggle_apply=0;
    IoReg_Write32(PPOVERLAY_dispd_smooth_toggle1_reg, dispd_smooth_toggle1_reg.regValue);
    dispd_stage1_sm_ctrl_reg.regValue = IoReg_Read32(PPOVERLAY_dispd_stage1_sm_ctrl_reg);
    dispd_stage1_sm_ctrl_reg.dispd_stage1_smooth_toggle_protect = 1;
    IoReg_Write32(PPOVERLAY_dispd_stage1_sm_ctrl_reg, dispd_stage1_sm_ctrl_reg.regValue);

    uzudtg_fractional_fsync_reg.regValue = IoReg_Read32(PPOVERLAY_uzudtg_fractional_fsync_reg);
    uzu_valid_framecnt = uzudtg_fractional_fsync_reg.uzudtg_multiple_vsync; //if 2:5, valid_framecnt = 1, if 1:2, valid_framecnt = 0
    //wait to front porch
    count = 0xfffff;
    dtg_frame_cnt1_reg.regValue = IoReg_Read32(PPOVERLAY_DTG_FRAME_CNT1_reg);
    while(!((dtg_frame_cnt1_reg.uzudtg_output_frame_cnt == uzu_valid_framecnt) &&
        (PPOVERLAY_new_meas2_linecnt_real_get_uzudtg_dly_line_cnt_rt(IoReg_Read32(PPOVERLAY_new_meas2_linecnt_real_reg)) > 100) &&
        (PPOVERLAY_new_meas2_linecnt_real_get_uzudtg_dly_line_cnt_rt(IoReg_Read32(PPOVERLAY_new_meas2_linecnt_real_reg)) < 1900)) && --count){
        dtg_frame_cnt1_reg.regValue = IoReg_Read32(PPOVERLAY_DTG_FRAME_CNT1_reg);
    }
    if(count == 0)
        printk(KERN_EMERG "[DTG] Wait to uzu_valid_framecnt timeout!!, uzu_valid_framecnt = %d, uzudtg_output_frame_cnt = %d\n",uzu_valid_framecnt, dtg_frame_cnt1_reg.uzudtg_output_frame_cnt);

    modestate_set_lowdelay_fractional_framesync(channel, m_lowdelay_en);
    modestate_set_lowdelay_display_timing_gen_clock(channel, m_lowdelay_en);
    count = 0xfffff;

    dispd_stage1_sm_ctrl_reg.regValue = IoReg_Read32(PPOVERLAY_dispd_stage1_sm_ctrl_reg);
    dispd_smooth_toggle1_reg.dispd_stage1_smooth_toggle_apply=1;
    IoReg_Write32(PPOVERLAY_dispd_smooth_toggle1_reg, dispd_smooth_toggle1_reg.regValue);

    dispd_smooth_toggle1_reg.regValue = IoReg_Read32(PPOVERLAY_dispd_smooth_toggle1_reg);
    while((dispd_smooth_toggle1_reg.dispd_stage1_smooth_toggle_apply)&& --count){
        dispd_smooth_toggle1_reg.regValue = IoReg_Read32(PPOVERLAY_dispd_smooth_toggle1_reg);
    }
    if(count==0){
        printk(KERN_EMERG "dispd_smooth_toggle1 timeout !!!\n");
        dispd_smooth_toggle1_reg.dispd_stage1_smooth_toggle_apply = 0;
        IoReg_Write32(PPOVERLAY_dispd_smooth_toggle1_reg, dispd_smooth_toggle1_reg.regValue);
        dispd_stage1_sm_ctrl_reg.regValue = IoReg_Read32(PPOVERLAY_dispd_stage1_sm_ctrl_reg);
        dispd_stage1_sm_ctrl_reg.dispd_stage1_smooth_toggle_protect = 0;
        IoReg_Write32(PPOVERLAY_dispd_stage1_sm_ctrl_reg, dispd_stage1_sm_ctrl_reg.regValue);
        dispd_smooth_toggle1_reg.dispd_stage1_smooth_toggle_apply = 1;
        IoReg_Write32(PPOVERLAY_dispd_smooth_toggle1_reg, dispd_smooth_toggle1_reg.regValue);
    }
    ppoverlay_double_buffer_ctrl2_reg.regValue = IoReg_Read32(PPOVERLAY_Double_Buffer_CTRL2_reg);
    ppoverlay_double_buffer_ctrl2_reg.memcdtgreg_dbuf_en = 0;
    ppoverlay_double_buffer_ctrl2_reg.uzudtgreg_dbuf_en = 0;
    IoReg_Write32(PPOVERLAY_Double_Buffer_CTRL2_reg, ppoverlay_double_buffer_ctrl2_reg.regValue);

    ppoverlay_uzudtg_countrol_reg.regValue = IoReg_Read32(PPOVERLAY_UZUDTG_COUNTROL_reg);
    ppoverlay_uzudtg_countrol_reg.uzudtg_mode_revised = 1;
    IoReg_Write32(PPOVERLAY_UZUDTG_COUNTROL_reg, ppoverlay_uzudtg_countrol_reg.regValue);
    up(&VBE_LowDelay_Semaphore);
    printk(KERN_EMERG "[disable_uzu_dtg_remove_multiple] uzudtg_mode_revised == 1\n");
}

extern unsigned char ScalerCheckOrbitFinish(void);

void fwif_color_set_WB_Pattern_IRE(unsigned char ucType, unsigned char ucIRE)
{
    //ppoverlay_memcdtg_control3_RBUS ppoverlay_memcdtg_control3_reg;
    static unsigned int vo_gatting_pre;
    unsigned int timeout_count = 0xfffff;
    ppoverlay_double_buffer_ctrl2_RBUS ppoverlay_double_buffer_ctrl2_reg;
    unsigned char ucY = 0, ucCr = 0, ucCb = 0;
    unsigned char b422Format = 0;
    unsigned int timeoutcount_orbit_wb = 10;
    short vY[5] =   {235,   235,    81, 145,    41};
    short vCb[5] =  {128,   128,    90, 54, 240};
    short vCr[5] =  {128,   128,    240,    34, 110};
    short patternIre[23] = {0, 5, 10, 15, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 150, 160, 170, 180, 190, 200};   //IRE*2 IRE={0,2.5,5,7.5,10,15,20,25,30,35,40,45,50,55,60,65,70,75,80,85,90,95,100}

    ppoverlay_memc_mux_ctrl_RBUS memc_mux_ctrl_reg;
    extern void Scaler_wait_for_frc2fs_hw_lock_done(unsigned char display);
    memc_mux_ctrl_reg.regValue = rtd_inl(PPOVERLAY_MEMC_MUX_CTRL_reg);

    down(&Orbit_Semaphore);

    if(ucIRE>22)
        ucIRE = 22;
    if(ucType>4)
        ucType = 4;

    ucY = ((patternIre[ucIRE] * (vY[ucType]-16))/2 + 50) / 100 + 16;
    ucCb = ((patternIre[ucIRE] * (vCb[ucType]-128))/2 + 50) / 100 + 128;
    ucCr = ((patternIre[ucIRE] * (vCr[ucType]-128))/2 + 50) / 100 + 128;

    while (timeoutcount_orbit_wb-- && !ScalerCheckOrbitFinish())
	{
		msleep(10);
	}
	if(timeoutcount_orbit_wb == 0)
		rtd_pr_vpq_notice("[WB]Orbit timeout error!!!\n");

    if (ucType) {
        /*WB enable*/
        TV006_WB_Pattern_En = 1;
        fwif_color_set_osd_Outer(1);
        drvif_color_set_WB_pattern_RGB(ucCr, ucY, ucCb);
        drvif_color_set_WB_pattern_setup();
        //when no signal, enable MEMC out bg
        Scaler_MEMC_Booting_NoSignal_Check_OutputBG(_DISABLE);
        printk(KERN_EMERG "[pinyen]%s ,%d\n",__FUNCTION__,__LINE__);
		Scaler_MEMC_output_force_bg_enable(1,__func__,__LINE__);


        //disable gatting first
        if(VODMA_VODMA_CLKGEN_get_en_fifo_full_gate(rtd_inl(VODMA_VODMA_CLKGEN_reg))){
            vo_gatting_pre = VODMA_VODMA_CLKGEN_get_en_fifo_full_gate(rtd_inl(VODMA_VODMA_CLKGEN_reg));
            rtd_clearbits(VODMA_VODMA_CLKGEN_reg, VODMA_VODMA_CLKGEN_en_fifo_full_gate_mask);
        }

        disable_uzu_dtg_remove_multiple(1);//disable uzudtg remove/multipe function to bypass memc
        /*MEMC bypass on*/
#ifndef CONFIG_MEMC_NOTSUPPORT
        {
       
            rtd_setbits(SOFTWARE1_SOFTWARE1_00_reg, _BIT9);

            Scaler_MEMC_Bypass_On(1);
            printk(KERN_EMERG "[pinyen] %s,%d\n",__FUNCTION__,__LINE__);
        }
#endif
        //double buffer enable
        ppoverlay_double_buffer_ctrl2_reg.regValue = rtd_inl(PPOVERLAY_Double_Buffer_CTRL2_reg);
        ppoverlay_double_buffer_ctrl2_reg.uzudtgreg_dbuf_en = 1;
        ppoverlay_double_buffer_ctrl2_reg.memcdtgreg_dbuf_en = 1;
        rtd_outl(PPOVERLAY_Double_Buffer_CTRL2_reg, ppoverlay_double_buffer_ctrl2_reg.regValue);

        //set memc_mux golden vs
        memc_mux_ctrl_reg.regValue = rtd_inl(PPOVERLAY_MEMC_MUX_CTRL_reg);
        memc_mux_ctrl_reg.memcdtg_golden_vs=1;
        rtd_outl(PPOVERLAY_MEMC_MUX_CTRL_reg, memc_mux_ctrl_reg.regValue);

        //double buffer apply
        ppoverlay_double_buffer_ctrl2_reg.regValue = rtd_inl(PPOVERLAY_Double_Buffer_CTRL2_reg);
        ppoverlay_double_buffer_ctrl2_reg.uzudtgreg_dbuf_set = 1;
        ppoverlay_double_buffer_ctrl2_reg.memc_dtgreg_dbuf_set = 1;
        rtd_outl(PPOVERLAY_Double_Buffer_CTRL2_reg, ppoverlay_double_buffer_ctrl2_reg.regValue);

        while(timeout_count && (ppoverlay_double_buffer_ctrl2_reg.uzudtgreg_dbuf_set || ppoverlay_double_buffer_ctrl2_reg.memc_dtgreg_dbuf_set)){
            timeout_count--;
            ppoverlay_double_buffer_ctrl2_reg.regValue = rtd_inl(PPOVERLAY_Double_Buffer_CTRL2_reg);
        }
        if(timeout_count == 0)
            printk(KERN_EMERG "[%s] wait dtg db timeout!!! %d\n",__FUNCTION__,timeout_count);

        Scaler_MEMC_output_force_bg_enable(0,__func__,__LINE__);

        printk(KERN_EMERG "[pinyen]%s ,%d\n",__FUNCTION__,__LINE__);
    } else if(TV006_WB_Pattern_En){
		Scaler_MEMC_output_force_bg_enable(1,__func__,__LINE__);
        /*exit WB*/
        disable_uzu_dtg_remove_multiple(0);//enable uzudtg remove/multipe function
        
#ifndef CONFIG_MEMC_NOTSUPPORT
        /*MEMC bypass off*/
    //  if (platform == PLATFORM_KXLP)  // 60 hz,120hz no need bypass memc
        {
       
            rtd_clearbits(SOFTWARE1_SOFTWARE1_00_reg, _BIT9);

            Scaler_MEMC_Bypass_On(0);
        }
#endif
        //double buffer enable
        ppoverlay_double_buffer_ctrl2_reg.regValue = rtd_inl(PPOVERLAY_Double_Buffer_CTRL2_reg);
        ppoverlay_double_buffer_ctrl2_reg.uzudtgreg_dbuf_en = 1;
        rtd_outl(PPOVERLAY_Double_Buffer_CTRL2_reg, ppoverlay_double_buffer_ctrl2_reg.regValue);

        //double buffer apply
        ppoverlay_double_buffer_ctrl2_reg.regValue = rtd_inl(PPOVERLAY_Double_Buffer_CTRL2_reg);
        ppoverlay_double_buffer_ctrl2_reg.uzudtgreg_dbuf_set = 1;
        rtd_outl(PPOVERLAY_Double_Buffer_CTRL2_reg, ppoverlay_double_buffer_ctrl2_reg.regValue);

        while(timeout_count && ppoverlay_double_buffer_ctrl2_reg.uzudtgreg_dbuf_set){
            timeout_count--;
            ppoverlay_double_buffer_ctrl2_reg.regValue = rtd_inl(PPOVERLAY_Double_Buffer_CTRL2_reg);
        }
        if(timeout_count == 0)
            printk(KERN_EMERG "[%s] wait dtg db timeout!!! %d\n",__FUNCTION__,timeout_count);

        if(Scaler_DispGetInputInfo(SLR_INPUT_FRAMESYNC)){
            fwif_color_safe_od_enable(0);
            drvif_scaler_set_display_mode(DISPLAY_MODE_FRAME_SYNC);
            fwif_color_safe_od_enable(1);
        }
        else{
#ifdef SMOOTH_TOGGLE_DATAFRCFS_TEST
            if ((vbe_disp_get_adaptivestream_fs_mode() == 1) &&
                (Get_DISPLAY_PANEL_TYPE() != P_VBY1_TO_HDMI) &&
                (Get_DISPLAY_PANEL_TYPE() != P_VBY1_TO_LVDS_TO_HDMI)) {
                //drvif_scaler_set_display_mode(DISPLAY_MODE_FRAME_SYNC);
                if(drvif_scaler_get_display_mode() != DISPLAY_MODE_FRAME_SYNC){
                    printk(KERN_EMERG "[%s][line:%d] adaptive stream timing fs.\n", __FUNCTION__, __LINE__);
                    fwif_color_safe_od_enable(0);
                    drvif_scaler_set_display_mode(DISPLAY_MODE_FRAME_SYNC);
                    Scaler_Set_Display_Timing_Mode(DISPLAY_MODE_FRAME_SYNC);
                    fwif_color_safe_od_enable(1);
                }
                modestate_set_fll_running_flag(_DISABLE);
            }
            else{
                if((Get_DisplayMode_Src(SLR_MAIN_DISPLAY) == VSC_INPUTSRC_HDMI) && (vbe_disp_get_VRR_timingMode_flag() || vbe_disp_get_freesync_mode_flag())){
                    modestate_set_fll_running_flag(_DISABLE);
                    vbe_disp_set_VRR_fractional_framerate_mode();
                    fwif_color_safe_od_enable(0);
                    drvif_scaler_set_display_mode(DISPLAY_MODE_FRAME_SYNC);
                    Scaler_Set_Display_Timing_Mode(DISPLAY_MODE_FRAME_SYNC);
                    fwif_color_safe_od_enable(1);
                    scaler_set_VRR_pwm_frequency_update_in_isr(TRUE);

                }
                else {
                    modestate_set_fll_running_flag(_ENABLE);
                    Scaler_Set_Display_Timing_Mode(DISPLAY_MODE_NEW_FLL_MODE);
                }
            }
#else
                modestate_set_fll_running_flag(_ENABLE);
                Scaler_Set_Display_Timing_Mode(DISPLAY_MODE_NEW_FLL_MODE);
#endif

            if(Scaler_InputSrcGetType(SLR_MAIN_DISPLAY) == _SRC_TV){
                if(drvif_module_vdc_read_Clamping_path() && drvif_module_vdc_read_scan_flag()){
                    printk(KERN_EMERG "### ATV Channel Scan !!! ###\n");
                    modestate_set_fll_running_flag(FALSE);
                }
            }
        }
        //reset vo gatting
        if(vo_gatting_pre){
            //Eric@20190919 wait a lowest-common-multiple time to make sure HW process frc2fs done
            Scaler_wait_for_frc2fs_hw_lock_done(SLR_MAIN_DISPLAY);
            //rtd_setbits(VODMA_VODMA_CLKGEN_reg, VODMA_VODMA_CLKGEN_en_fifo_full_gate_mask);
            scaler_set_full_gatting_rpc(true);
        }

        b422Format = Scaler_DispGetStatus(_MAIN_DISPLAY, SLR_DISP_422CAP);

        fwif_color_set_osd_Outer(1);
        if (Scaler_DispGetInputInfo(SLR_INPUT_FRAMESYNC)) {
            drvif_color_set_WB_pattern_off(0, b422Format);
        } else if(dvrif_memory_compression_get_enable(SLR_MAIN_DISPLAY) == TRUE){
            drvif_color_set_WB_pattern_off(0, 0);
        }else{
            drvif_color_set_WB_pattern_off(0, b422Format);
        }
        //when no signal, disable MEMC out bg
        Scaler_MEMC_Booting_NoSignal_Check_OutputBG(_ENABLE);
        msleep(240);
	  Scaler_MEMC_output_force_bg_enable(0,__func__,__LINE__);

        printk(KERN_EMERG "[pinyen]%s ,%d\n",__FUNCTION__,__LINE__);

        TV006_WB_Pattern_En = 0;
    }

    up(&Orbit_Semaphore);
}


/*=== ABOUT Histogram for HAL_DC === .....(start)*/
unsigned char fwif_color_get_HistoData_Countbins(UINT8 nBinNum, UINT32 *uCountBins)
{
	if (fwif_get_Y_Total_Hist_Cnt_distribution(1, TV006_VPQ_chrm_bin, uCountBins) == FALSE) {
		return FALSE;
	} else {
		if (nBinNum > TV006_VPQ_chrm_bin) {
			VIPprintf(" HistoBins not match! only %d", COLOR_HISTOGRAM_LEVEL);
		} else if ((nBinNum < TV006_VPQ_chrm_bin)) {
			return FALSE;
		}
		return TRUE;
	}
}

unsigned char fwif_color_get_HistoData_chrmbins(UINT8 nBinNum, UINT32 *uchrmbins)
{
	_clues *smartPic_clue = NULL;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}

	if (nBinNum !=  COLOR_AutoSat_HISTOGRAM_LEVEL) {
		VIPprintf(" Sat HistoBins not match");
		return FALSE;
	} else {
		fwif_color_ChangeUINT32Endian_Copy(&smartPic_clue->Sat_Main_His[0], COLOR_AutoSat_HISTOGRAM_LEVEL, uchrmbins, 0);
		/*uchrmbins = &(smartPic_clue->Sat_Main_His);*/
	}

	return TRUE;

}

unsigned char fwif_color_get_HistoData_huebins(UINT8 nBinNum, UINT32 *uhuebins)
{
	_clues *smartPic_clue = NULL;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}

	if (nBinNum !=  COLOR_HUE_HISTOGRAM_LEVEL) {
		VIPprintf(" Sat HueBins not match");
		return FALSE;
	} else {
		fwif_color_ChangeUINT32Endian_Copy(&smartPic_clue->Hue_Main_His[0], COLOR_HUE_HISTOGRAM_LEVEL, uhuebins, 0);
		/*uhuebins = smartPic_clue->Hue_Main_His;*/
	}

	return TRUE;
}

unsigned char fwif_color_get_HistoData_APL(UINT32 *uAPL)
{
	_clues *smartPic_clue = NULL;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}

	fwif_color_ChangeUINT32Endian_Copy(&(smartPic_clue->Hist_Y_APL_Exact), 1, (unsigned int*)uAPL, 0);

	/**uAPL = smartPic_clue->Hist_Y_Mean_Value;*/

	return TRUE;
}

unsigned char fwif_color_get_HistoData_Min(signed int *uMin)
{
	_clues *smartPic_clue = NULL;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}

	fwif_color_ChangeINT32Endian_Copy((int*)&(smartPic_clue->Hist_Peak_Dark_Pixel_value), 1, uMin, 0);

	/**uMin = smartPic_clue->Hist_Peak_Dark_IRE_Value;*/

	return TRUE;

}

unsigned char fwif_color_get_HistoData_Max(signed int *uMax)
{
	_clues *smartPic_clue = NULL;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}

	fwif_color_ChangeINT32Endian_Copy((int*)&(smartPic_clue->Hist_Peak_White_Pixel_value), 1, uMax, 0);

	/**uMax = smartPic_clue->Hist_Peak_White_IRE_Value;*/

	return TRUE;

}

unsigned char fwif_color_get_HistoData_PeakLow(signed int *uPeakLow)
{
	_clues *smartPic_clue = NULL;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}


	fwif_color_ChangeINT32Endian_Copy((int*)&(smartPic_clue->Hist_Peak_Dark_Pixel_value), 1, uPeakLow, 0);

	/**uPeakLow = smartPic_clue->Hist_Peak_Dark_Pixel_value;*/

	return TRUE;
}

unsigned char fwif_color_get_HistoData_PeakHigh(signed int *uPeakHigh)
{
	_clues *smartPic_clue = NULL;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}

	fwif_color_ChangeINT32Endian_Copy((int*)&(smartPic_clue->Hist_Peak_White_Pixel_value), 1, uPeakHigh, 0);

	/**uPeakHigh = smartPic_clue->Hist_Peak_White_Pixel_value;*/

	return TRUE;

}

unsigned char fwif_color_get_HistoData_skinCount(UINT32 *uskinCount)
{
	_clues *smartPic_clue = NULL;
	UINT32 Hue2 = 0, Hue3 = 0, Hue4 = 0;

	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}

	fwif_color_ChangeUINT32Endian_Copy(&(smartPic_clue->Hue_Main_His[2]), 1, &Hue2, 0);
	fwif_color_ChangeUINT32Endian_Copy(&(smartPic_clue->Hue_Main_His[3]), 1, &Hue3, 0);
	fwif_color_ChangeUINT32Endian_Copy(&(smartPic_clue->Hue_Main_His[4]), 1, &Hue4, 0);

	*uskinCount = (Hue2+Hue3+Hue4);

	return TRUE;

}

unsigned char fwif_color_get_HistoData_SatStatus(UINT32 *uSatStatus)
{
	_clues *smartPic_clue = NULL;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}

	fwif_color_ChangeUINT32Endian_Copy(&(smartPic_clue->sat_ratio_mean_value), 1, uSatStatus, 0);

	/**uSatStatus = smartPic_clue->sat_ratio_mean_value;*/

	return TRUE;

}

unsigned char fwif_color_get_HistoData_diffSum(UINT32 *udiffSum)
{
	_clues *smartPic_clue = NULL;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}

	/*fwif_color_ChangeUINT32Endian_Copy(&(smartPic_clue->Hist_diff_sum), 1, udiffSum, 0);	*/ /*=== marked by Elsie ===*/

	/**udiffSum = smartPic_clue->Hist_diff_sum;*/

	return TRUE;

}

unsigned char fwif_color_get_HistoData_motion(UINT32 *umotion)
{
	_clues *smartPic_clue = NULL;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}

	fwif_color_ChangeUINT32Endian_Copy(&(smartPic_clue->RTNR_MAD_count_Y_avg_ratio), 1, umotion, 0);

	/**umotion = smartPic_clue->RTNR_MAD_count_Y_avg_ratio;*/

	return TRUE;

}


unsigned char fwif_color_get_HistoData_texture(UINT32 *utexture)
{
#if 0 // no implement
	UINT32 TSH_Step_Hist[20];
	_clues *smartPic_clue = NULL;
	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		return FALSE;
	}

	fwif_color_ChangeUINT32Endian_Copy(&(smartPic_clue->TSH_Step_Hist[0]), 20, &TSH_Step_Hist[0], 0);


	*utexture = TSH_Step_Hist[0]+TSH_Step_Hist[1]+TSH_Step_Hist[2]+TSH_Step_Hist[3]+TSH_Step_Hist[4];
#endif
	return TRUE;

}
/*=== ABOUT Histogram for HAL_DC === .....(end)*/



/*=== ABOUT DCC for HAL_DC === .....(start)*/
int DCC_Curve_BASE[TableSeg_num_Max], DCC_Curve_G0[TableSeg_num_Max], DCC_Curve_G1[TableSeg_num_Max];
unsigned int dcc_histogram_to_write[TableSeg_num_Max];
unsigned short dcc_histogram_to_write_base[TableSeg_num_Max];

unsigned char  fwif_color_set_dcc_Curve_Write(unsigned char display, UINT8 CurveNum, signed int *sAccLUT)
{
	int i = 0;
	UINT32 	INTERP_DATA = 0;
	/*unsigned int CURVE_LUT[64];*/
	_clues *smartPic_clue = NULL;
	int Curve_data_range = 1 << DCC_Curve_DataRang_bit;
	int Curve_segment_range = 1 << DCC_Curve_Segment_bit;


	_system_setting_info *VIP_system_info_structure_table=NULL;
	VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	for (i = 0; i < (TableSeg_num_Max); i++) {
		/*for 32 DCC segment from MacArthur*/
		if (i == 0) {
			DCC_Curve_BASE[i] = (sAccLUT[0] + Curve_data_range)%Curve_data_range;
		} else {
			DCC_Curve_BASE[i] = sAccLUT[i << 1]%Curve_data_range;
		}
		DCC_Curve_G0[i] = (sAccLUT[(i << 1) + 1] - sAccLUT[i << 1])%Curve_segment_range;
		DCC_Curve_G1[i] = (sAccLUT[(i << 1)+2] - sAccLUT[(i << 1) + 1])%Curve_segment_range;
	}

	for (i = 0; i < (TableSeg_num_Max); i++) {
		/*INTERP_DATA = ((DCC_Curve_BASE[i] << 16) + (DCC_Curve_G0[i] << 8) + DCC_Curve_G1[i]);*/ /*before Mac3*/
		INTERP_DATA = ((DCC_Curve_G0[i] << 11) + DCC_Curve_G1[i]);/*Magellan2 --> 10bit to 12bit*/
		dcc_histogram_to_write[i] = INTERP_DATA;/*move to D - domain ISR to write DCC table!! Reduce Write timing miss match!!(histogram_new_dcc_write_table())*/
		dcc_histogram_to_write_base[i] = DCC_Curve_BASE[i];
		/*VIPprintf("[%d] = >%d, %d, %d\n", i, DCC_Curve_BASE[i], DCC_Curve_G0[i], DCC_Curve_G1[i]);*/
		/*VIPprintf("dcc_histogram_to_write[%d] = %x\n", i, dcc_histogram_to_write[i]);*/
	}

	/*drvif_color_dcc_Curve_init(display);*/
	if (VIP_system_info_structure_table->HDR_flag == 1) {

		drvif_color_dcc_Curve_init(SLR_SUB_DISPLAY);

	} else {

		fwif_color_set_dcc_OnOff(0, DCC_ON_APPLY_AP_CURVE);
		smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);
		if (smartPic_clue == NULL) {
			VIPprintf("smartPic_clue NULL!!!");
			return FALSE;
		}
	}

	return TRUE;
	/*return drvif_color_dcc_Curve_Write(display, TableSeg_num_Max, &(dcc_histogram_to_write[0]));*/
}
void fwif_color_inv_gamma_init()
{
	drvif_color_inv_gamma_init();
}

unsigned char fwif_color_get_FreshContrastBypassLUT(unsigned char Curve_Seg, signed int *pDCBypassLUT)
{
	_clues *smartPic_clue = NULL;

	if (Curve_Seg !=  DCC_Curve_Node_MAX) {
		VIPprintf("Curve Segment not match!!");
		return FALSE;
	}

	smartPic_clue = (_clues *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_SMARTPIC_CLUS);

	if (smartPic_clue == NULL) {
		VIPprintf("smartPic_clue NULL!!!");
		return FALSE;
	}

	fwif_color_ChangeINT32Endian_Copy(&((smartPic_clue->Adapt_DCC_Info.S_RPC_DCC_LAYER_Array.ByPass_Curve)[0]), DCC_Curve_Node_MAX, pDCBypassLUT, 0);

	return TRUE;

}
/*=== ABOUT DCC for HAL_DC === .....(end)*/

void fwif_color_set_LDSetLUT(UINT8 lutTableIndex)
{
	/*	lutTableIndex = 0 -> off*/
	/*	lutTableIndex = 1 -> SDR_Low*/
	/*	lutTableIndex = 2 -> SDR_Mid*/
	/*	lutTableIndex = 3 -> SDR_Hiigh*/
	/*	lutTableIndex = 4 -> HDR_Low*/
	/*	lutTableIndex = 5 -> HDR_Mid*/
	/*	lutTableIndex = 6 -> HDR_Hiigh*/

	rtd_pr_vpq_debug("lutTableIndex = %d\n", lutTableIndex);

	if (lutTableIndex >= LD_Table_NUM)
		lutTableIndex = 1; /* parameter protection*/


	fwif_color_set_LD_Backlight_Decision(0, lutTableIndex);
	fwif_color_set_LD_Spatial_Filter(0, lutTableIndex);
	fwif_color_set_LD_Temporal_Filter(0, lutTableIndex);
	fwif_color_set_LD_Spatial_Remap(0, lutTableIndex);
	//fwif_color_set_LD_Data_Compensation(0, lutTableIndex);
	fwif_color_set_LD_Data_Compensation_NewMode_2DTable(0, lutTableIndex);

}

bool fwif_color_set_LED_Initialize(HAL_LED_PANEL_INFO_T panelInfo)
{
	bool pass = 0;
	unsigned short dispWidth = 3840;
	unsigned short dispHeight = 2160;

	/*rtd_pr_vpq_debug("ic=%d, bl_type=%d, bar_type=%d\n",panelInfo.hal_icType,panelInfo.hal_bl_type,panelInfo.hal_bar_type);*/

	if (panelInfo.hal_icType == 1) {
		if (panelInfo.hal_bl_type == HAL_BL_EDGE_LED) {
			blu_ld_global_ctrl0_RBUS blu_ld_global_ctrl0;
			blu_ld_global_ctrl1_RBUS blu_ld_global_ctrl1;
			blu_ld_global_ctrl2_RBUS blu_ld_global_ctrl2;
			blu_ld_global_ctrl3_RBUS blu_ld_global_ctrl3;
            blu_ld_backlight_ctrl2_RBUS blu_ld_backlight_ctrl2;
			blu_ld_inter_hctrl1_RBUS blu_ld_inter_hctrl1;/* for ld_hfactor*/
			blu_ld_inter_vctrl1_RBUS blu_ld_inter_vctrl1;/* for ld_vfactor*/

			pass = 1;

			blu_ld_global_ctrl0.regValue = IoReg_Read32(BLU_LD_Global_Ctrl0_reg);
			blu_ld_global_ctrl1.regValue = IoReg_Read32(BLU_LD_Global_Ctrl1_reg);
			blu_ld_global_ctrl2.regValue = IoReg_Read32(BLU_LD_Global_Ctrl2_reg);
			blu_ld_global_ctrl3.regValue = IoReg_Read32(BLU_LD_Global_Ctrl3_reg);
			blu_ld_backlight_ctrl2.regValue = IoReg_Read32(BLU_LD_Backlight_Ctrl2_reg);
            
			blu_ld_inter_hctrl1.regValue = IoReg_Read32(BLU_LD_Inter_HCtrl1_reg);
			blu_ld_inter_vctrl1.regValue = IoReg_Read32(BLU_LD_Inter_VCtrl1_reg);

			blu_ld_global_ctrl2.ld_blk_type = 1;

			if (panelInfo.hal_bar_type == HAL_LED_BAR_6)
				blu_ld_global_ctrl2.ld_blk_hnum = 5;/*LD_Global_Ctrl_Table[5];*/
			else if (panelInfo.hal_bar_type == HAL_LED_BAR_12)
				blu_ld_global_ctrl2.ld_blk_hnum = 11;
			else if (panelInfo.hal_bar_type == HAL_LED_BAR_16)
				blu_ld_global_ctrl2.ld_blk_hnum = 15;
			else if (panelInfo.hal_bar_type == HAL_LED_BAR_20)
				blu_ld_global_ctrl2.ld_blk_hnum = 19;
			else if (panelInfo.hal_bar_type == HAL_LED_BAR_240)  /*edge not support*/
				pass = 0;
			else
				pass = 0;

			blu_ld_global_ctrl2.ld_blk_vnum = 0;	/*	one - sided edge*/ /*LD_Global_Ctrl_Table[6];*/
			blu_ld_global_ctrl3.ld_blk_hsize = dispWidth/(blu_ld_global_ctrl2.ld_blk_hnum + 1);/*LD_Global_Ctrl_Table[13];*/
			blu_ld_global_ctrl3.ld_blk_vsize = dispHeight/(blu_ld_global_ctrl2.ld_blk_vnum + 1);/*LD_Global_Ctrl_Table[14];*/
			blu_ld_backlight_ctrl2.ld_blu_spitotal = 2 * (blu_ld_global_ctrl2.ld_blk_hnum + 1) - 1;
			blu_ld_inter_hctrl1.ld_hfactor = 1048576*(blu_ld_inter_hctrl1.ld_tab_hsize+1)*(blu_ld_global_ctrl2.ld_blk_hnum+1)/dispWidth;
			blu_ld_inter_vctrl1.ld_vfactor = 1048576*(blu_ld_inter_vctrl1.ld_tab_vsize)/dispHeight;


			IoReg_Write32(BLU_LD_Global_Ctrl0_reg, blu_ld_global_ctrl0.regValue);
			IoReg_Write32(BLU_LD_Global_Ctrl1_reg, blu_ld_global_ctrl1.regValue);
			IoReg_Write32(BLU_LD_Global_Ctrl2_reg, blu_ld_global_ctrl2.regValue);
			IoReg_Write32(BLU_LD_Global_Ctrl3_reg, blu_ld_global_ctrl3.regValue);
			IoReg_Write32(BLU_LD_Backlight_Ctrl2_reg, blu_ld_backlight_ctrl2.regValue);
			IoReg_Write32(BLU_LD_Inter_HCtrl1_reg, blu_ld_inter_hctrl1.regValue);
			IoReg_Write32(BLU_LD_Inter_VCtrl1_reg, blu_ld_inter_vctrl1.regValue);

		} else if (panelInfo.hal_bl_type == HAL_BL_DIRECT_L || panelInfo.hal_bl_type == HAL_BL_DIRECT_M) {

			blu_ld_global_ctrl0_RBUS blu_ld_global_ctrl0;
			blu_ld_global_ctrl1_RBUS blu_ld_global_ctrl1;
			blu_ld_global_ctrl2_RBUS blu_ld_global_ctrl2;
			blu_ld_global_ctrl3_RBUS blu_ld_global_ctrl3;
            blu_ld_backlight_ctrl2_RBUS blu_ld_backlight_ctrl2;
			blu_ld_inter_hctrl1_RBUS blu_ld_inter_hctrl1;/* for ld_hfactor*/
			blu_ld_inter_vctrl1_RBUS blu_ld_inter_vctrl1;/* for ld_vfactor*/

			pass = 1;

			blu_ld_global_ctrl0.regValue = IoReg_Read32(BLU_LD_Global_Ctrl0_reg);
			blu_ld_global_ctrl1.regValue = IoReg_Read32(BLU_LD_Global_Ctrl1_reg);
			blu_ld_global_ctrl2.regValue = IoReg_Read32(BLU_LD_Global_Ctrl2_reg);
			blu_ld_global_ctrl3.regValue = IoReg_Read32(BLU_LD_Global_Ctrl3_reg);
			blu_ld_backlight_ctrl2.regValue = IoReg_Read32(BLU_LD_Backlight_Ctrl2_reg);
			blu_ld_inter_hctrl1.regValue = IoReg_Read32(BLU_LD_Inter_HCtrl1_reg);
			blu_ld_inter_vctrl1.regValue = IoReg_Read32(BLU_LD_Inter_VCtrl1_reg);

			blu_ld_global_ctrl2.ld_blk_type = 0;

			#ifdef CONFIG_CUSTOMER_TV043
			if (panelInfo.hal_bar_type == HAL_LED_DIRECT_96_6x16) { /*LD_Global_Ctrl_Table[5];*/
				blu_ld_global_ctrl2.ld_blk_hnum = 15;
				blu_ld_global_ctrl2.ld_blk_vnum = 5;
			} else if (panelInfo.hal_bar_type == HAL_LED_DIRECT_120_6x20){
				blu_ld_global_ctrl2.ld_blk_hnum = 19;
				blu_ld_global_ctrl2.ld_blk_vnum = 5;
			} else if (panelInfo.hal_bar_type == HAL_LED_DIRECT_100_10x10){
				blu_ld_global_ctrl2.ld_blk_hnum = 9;
				blu_ld_global_ctrl2.ld_blk_vnum = 9;
			} else if (panelInfo.hal_bar_type == HAL_LED_DIRECT_120_10x12)	{
				blu_ld_global_ctrl2.ld_blk_hnum = 11;
				blu_ld_global_ctrl2.ld_blk_vnum = 9;
			} else if (panelInfo.hal_bar_type == HAL_LED_DIRECT_120_12x10)	{
				blu_ld_global_ctrl2.ld_blk_hnum = 9;
				blu_ld_global_ctrl2.ld_blk_vnum = 11;
			} else if (panelInfo.hal_bar_type == HAL_LED_DIRECT_160_8x20)  {
				blu_ld_global_ctrl2.ld_blk_hnum = 19;
				blu_ld_global_ctrl2.ld_blk_vnum = 7;
			} else
				pass = 0;
			#else
			blu_ld_global_ctrl2.ld_blk_hnum = 3;
			blu_ld_global_ctrl2.ld_blk_vnum = 7;
			#endif

			blu_ld_global_ctrl3.ld_blk_hsize = dispWidth/(blu_ld_global_ctrl2.ld_blk_hnum + 1);/*LD_Global_Ctrl_Table[13];*/
			blu_ld_global_ctrl3.ld_blk_vsize = dispHeight/(blu_ld_global_ctrl2.ld_blk_vnum + 1);/*LD_Global_Ctrl_Table[14];*/
			blu_ld_backlight_ctrl2.ld_blu_spitotal = (blu_ld_global_ctrl2.ld_blk_hnum + 1) * (blu_ld_global_ctrl2.ld_blk_vnum + 1) - 1;
			blu_ld_inter_hctrl1.ld_hfactor = 1048576*(blu_ld_inter_hctrl1.ld_tab_hsize+1)*(blu_ld_global_ctrl2.ld_blk_hnum+1)/dispWidth;
			blu_ld_inter_vctrl1.ld_vfactor = 1048576*(blu_ld_inter_vctrl1.ld_tab_vsize+1)*(blu_ld_global_ctrl2.ld_blk_vnum+1)/dispHeight;

			IoReg_Write32(BLU_LD_Global_Ctrl0_reg, blu_ld_global_ctrl0.regValue);
			IoReg_Write32(BLU_LD_Global_Ctrl1_reg, blu_ld_global_ctrl1.regValue);
			IoReg_Write32(BLU_LD_Global_Ctrl2_reg, blu_ld_global_ctrl2.regValue);
			IoReg_Write32(BLU_LD_Global_Ctrl3_reg, blu_ld_global_ctrl3.regValue);
			IoReg_Write32(BLU_LD_Backlight_Ctrl2_reg, blu_ld_backlight_ctrl2.regValue);
			IoReg_Write32(BLU_LD_Inter_HCtrl1_reg, blu_ld_inter_hctrl1.regValue);
			IoReg_Write32(BLU_LD_Inter_VCtrl1_reg, blu_ld_inter_vctrl1.regValue);

		} else {

			rtd_pr_vpq_emerg("fwif_color_set_LED_Initialize , panelInfo.hal_bl_type=%d,\n", panelInfo.hal_bl_type);
		}
	}
	if (!pass)
		drvif_HAL_VPQ_LED_LDEnable(0);
	return pass;
}





unsigned char LD_CMD;
void fwif_color_set_LD_CtrlSPI_init(HAL_LED_PANEL_INFO_T panelInfo)
{
	int i;
	unsigned char ucld_blk_hnum, ucld_blk_vnum = 0;

	blu_ld_global_ctrl2_RBUS blu_ld_global_ctrl2;

	ldspi_ld_ctrl_RBUS ld_ctrl;
	ldspi_out_data_ctrl_RBUS out_data_ctrl;
	//ldspi_timing_ctrl_RBUS timing_ctrl;
	//ldspi_send_delay_RBUS send_delay;
	//ldspi_data_unit_delay_RBUS data_unit_delay;
	//ldspi_v_sync_duty_RBUS v_sync_duty;
	//ldspi_data_h_time_RBUS data_h_time;
	//ldspi_cs_hold_time_RBUS cs_hold_time;

	ldspi_outindex_addr_ctrl_RBUS ldspi_outindex_addr_ctrl;
	ldspi_outindex_rwport_RBUS ldspi_outindex_rwport;
	ldspi_data_addr_ctrl_RBUS ldspi_data_addr_ctrl;
	ldspi_data_rwport_RBUS ldspi_data_rwport;

	if (panelInfo.hal_icType == 1) { /*internal IC LD*/

		blu_ld_global_ctrl2.regValue = IoReg_Read32(BLU_LD_Global_Ctrl2_reg);

		ucld_blk_hnum = blu_ld_global_ctrl2.ld_blk_hnum;
		ucld_blk_vnum = blu_ld_global_ctrl2.ld_blk_vnum;


		ld_ctrl.regValue = IoReg_Read32(LDSPI_LD_CTRL_reg);
		out_data_ctrl.regValue = IoReg_Read32(LDSPI_Out_data_CTRL_reg);


		ld_ctrl.start_enable = 0;/*Ld_spi disable*/
		IoReg_Write32(LDSPI_LD_CTRL_reg, ld_ctrl.regValue);

		if (panelInfo.hal_bl_type == HAL_BL_EDGE_LED) {
			ld_ctrl.ld_mode = 1;
			ld_ctrl.ld_spi_en = 1;
			ld_ctrl.separate_block = 0;

			out_data_ctrl.data_endian = 1;
			out_data_ctrl.output_units = ucld_blk_hnum+2;/*0x49;*/
			out_data_ctrl.output_data_format = 0;


			IoReg_Write32(LDSPI_LD_CTRL_reg, ld_ctrl.regValue);
			IoReg_Write32(LDSPI_Out_data_CTRL_reg, out_data_ctrl.regValue);

			/* set index sram*/
			ldspi_outindex_addr_ctrl.regValue = IoReg_Read32(LDSPI_Outindex_Addr_CTRL_reg);
			ldspi_outindex_addr_ctrl.outindex_rw_pointer_set = 0x0;
			IoReg_Write32(LDSPI_Outindex_Addr_CTRL_reg, ldspi_outindex_addr_ctrl.regValue);
			ldspi_outindex_rwport.outindex_rw_data_port = 0x7e; /*ID*/
			IoReg_Write32(LDSPI_Outindex_Rwport_reg, ldspi_outindex_rwport.regValue);
			ldspi_outindex_rwport.outindex_rw_data_port = 0x7f; /*Cmd*/
			IoReg_Write32(LDSPI_Outindex_Rwport_reg, ldspi_outindex_rwport.regValue);

			if (ucld_blk_vnum == 0) /*1-sided*/
				for (i = 0; i <= 2*ucld_blk_hnum; i = i + 2) {
					ldspi_outindex_rwport.outindex_rw_data_port = i;
					IoReg_Write32(LDSPI_Outindex_Rwport_reg, ldspi_outindex_rwport.regValue);
				}
			else /*2-sided*/
				for (i = 0; i <= 2*ucld_blk_hnum+1; i++) {
					ldspi_outindex_rwport.outindex_rw_data_port = i;
					IoReg_Write32(LDSPI_Outindex_Rwport_reg, ldspi_outindex_rwport.regValue);
				}

			/* set data sram for cmd and id*/
			ldspi_data_addr_ctrl.regValue = IoReg_Read32(LDSPI_Data_Addr_CTRL_reg);
			ldspi_data_addr_ctrl.data_rw_pointer_set = 0x7e;
			IoReg_Write32(LDSPI_Data_Addr_CTRL_reg, ldspi_data_addr_ctrl.regValue); /*Modify data in data SRAM for cmd and id*/
			ldspi_data_rwport.data_rw_data_port = 0xaa;
			IoReg_Write32(LDSPI_Data_Rwport_reg, ldspi_data_rwport.regValue); /*ID*/

			/*SPI cmd init value, it is also for the ADJ LD off SPI cmd value*/
			ldspi_data_rwport.data_rw_data_port = 0x01;
			IoReg_Write32(LDSPI_Data_Rwport_reg, ldspi_data_rwport.regValue); /*Cmd*/
			LD_CMD = 0x01;

			/* Init data in data SRAM*/
			ldspi_data_addr_ctrl.data_rw_pointer_set = 0x0;
			IoReg_Write32(LDSPI_Data_Addr_CTRL_reg, ldspi_data_addr_ctrl.regValue); /*Modify data in data SRAM for cmd and id*/
			ldspi_data_rwport.data_rw_data_port = 0xff;
			for (i = 0; i < 64; i++) {		/*in Mac3 data sram size is 64 + header size = 128, clear data part.*/

				IoReg_Write32(LDSPI_Data_Rwport_reg, ldspi_data_rwport.regValue);
			}

			/*Init Black(0) data in data SRAM*/
			ldspi_data_addr_ctrl.data_rw_pointer_set = 0x90;
			IoReg_Write32(LDSPI_Data_Addr_CTRL_reg, ldspi_data_addr_ctrl.regValue);
			ldspi_outindex_rwport.outindex_rw_data_port = 0x0;
			IoReg_Write32(LDSPI_Data_Rwport_reg, ldspi_outindex_rwport.regValue);


		} else if (panelInfo.hal_bl_type == HAL_BL_DIRECT_L || panelInfo.hal_bl_type == HAL_BL_DIRECT_M) {
			ld_ctrl.ld_mode = 1;
			ld_ctrl.ld_spi_en = 1;
			ld_ctrl.separate_block = 0;

			out_data_ctrl.data_endian = 1;
			out_data_ctrl.output_units = (ucld_blk_hnum+1)*(ucld_blk_vnum+1)-1 + 5;/*h*v-1+cmd+ID+3 tailer*/
			out_data_ctrl.output_data_format = 0;


			IoReg_Write32(LDSPI_LD_CTRL_reg, ld_ctrl.regValue);
			IoReg_Write32(LDSPI_Out_data_CTRL_reg, out_data_ctrl.regValue);

			/* set index sram*/
			ldspi_outindex_addr_ctrl.regValue = IoReg_Read32(LDSPI_Outindex_Addr_CTRL_reg);
			ldspi_outindex_addr_ctrl.outindex_rw_pointer_set = 0x0;
			IoReg_Write32(LDSPI_Outindex_Addr_CTRL_reg, ldspi_outindex_addr_ctrl.regValue);
			ldspi_outindex_rwport.outindex_rw_data_port = 0x7e; /*ID*/
			IoReg_Write32(LDSPI_Outindex_Rwport_reg, ldspi_outindex_rwport.regValue);
			ldspi_outindex_rwport.outindex_rw_data_port = 0x7f; /*Cmd*/
			IoReg_Write32(LDSPI_Outindex_Rwport_reg, ldspi_outindex_rwport.regValue);
			ldspi_outindex_rwport.outindex_rw_data_port = 0x80; /*Cmd LED-1*/
			IoReg_Write32(LDSPI_Outindex_Rwport_reg, ldspi_outindex_rwport.regValue);
			ldspi_outindex_rwport.outindex_rw_data_port = 0x81; /*Cmd LED-2*/
			IoReg_Write32(LDSPI_Outindex_Rwport_reg, ldspi_outindex_rwport.regValue);
			ldspi_outindex_rwport.outindex_rw_data_port = 0x82; /*Cmd LED-3*/
			IoReg_Write32(LDSPI_Outindex_Rwport_reg, ldspi_outindex_rwport.regValue);

			/*direct type data*/
			for (i = 0; i < (ucld_blk_hnum+1)*(ucld_blk_vnum+1); i++) {
				ldspi_outindex_rwport.outindex_rw_data_port = i;
				IoReg_Write32(LDSPI_Outindex_Rwport_reg, ldspi_outindex_rwport.regValue);
			}



			/* set data sram for cmd and id*/
			ldspi_data_addr_ctrl.regValue = IoReg_Read32(LDSPI_Data_Addr_CTRL_reg);
			ldspi_data_addr_ctrl.data_rw_pointer_set = 0x7e;
			IoReg_Write32(LDSPI_Data_Addr_CTRL_reg, ldspi_data_addr_ctrl.regValue); /*Modify data in data SRAM for cmd and id*/
			ldspi_data_rwport.data_rw_data_port = 0xaa;
			IoReg_Write32(LDSPI_Data_Rwport_reg, ldspi_data_rwport.regValue); /*ID*/

			/*SPI cmd init value, it is also for the ADJ LD off SPI cmd value*/
			ldspi_data_rwport.data_rw_data_port = 0x01;
			IoReg_Write32(LDSPI_Data_Rwport_reg, ldspi_data_rwport.regValue); /*Cmd-0*/
			LD_CMD = 0x01;
			ldspi_data_rwport.data_rw_data_port = 0x00;
			IoReg_Write32(LDSPI_Data_Rwport_reg, ldspi_data_rwport.regValue); /*Cmd LED-1*/
			ldspi_data_rwport.data_rw_data_port = 0x64;
			IoReg_Write32(LDSPI_Data_Rwport_reg, ldspi_data_rwport.regValue); /*Cmd LED-2*/
			ldspi_data_rwport.data_rw_data_port = 0xff;
			IoReg_Write32(LDSPI_Data_Rwport_reg, ldspi_data_rwport.regValue); /*Cmd LED-3*/


			/* Init data in data SRAM*/
			ldspi_data_addr_ctrl.data_rw_pointer_set = 0x0;
			IoReg_Write32(LDSPI_Data_Addr_CTRL_reg, ldspi_data_addr_ctrl.regValue); /*Modify data in data SRAM for cmd and id*/
			ldspi_data_rwport.data_rw_data_port = 0xff;
			for (i = 0; i < (ucld_blk_hnum+1)*(ucld_blk_vnum+1); i++) {		/*in Mac3 data sram size is 64 + header size = 128, clear data part.*/

				IoReg_Write32(LDSPI_Data_Rwport_reg, ldspi_data_rwport.regValue);
			}


			/*Init Black(0) data in data SRAM*/
			ldspi_data_addr_ctrl.data_rw_pointer_set = 0x90;
			IoReg_Write32(LDSPI_Data_Addr_CTRL_reg, ldspi_data_addr_ctrl.regValue);
			ldspi_outindex_rwport.outindex_rw_data_port = 0x0;
			IoReg_Write32(LDSPI_Data_Rwport_reg, ldspi_outindex_rwport.regValue);




		}else {

			rtd_pr_vpq_emerg("fwif_color_set_LD_CtrlSPI_init , panelInfo.hal_bl_type=%d,\n", panelInfo.hal_bl_type);
		}
		ld_ctrl.send_follow_vsync = 1; /*Send_follow_Vsync*/
		ld_ctrl.start_enable = 1;/*Ld_spi enable*/
		IoReg_Write32(LDSPI_LD_CTRL_reg, ld_ctrl.regValue);
	}
}

void fwif_color_vpq_pic_init()
{
	if (vpq_project_id == 0x00060000 && vpqex_project_id == 0x00060000) {
#if 0	/*rock_rau 20150922 vpq_project_id 0x00060000 NR set use fwif_color_SetDNR_tv006 function*/
		_system_setting_info *VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

		if (VIP_system_info_structure_table->Input_src_Type == _SRC_TV)
			fwif_color_RHAL_SetDNR(4);
		else
			fwif_color_RHAL_SetDNR(2);
#endif

		fwif_color_SetDNR_tv006(fwif_color_GetDNR_tv006());
		fwif_color_Set_MPEGNR_tv006(fwif_color_MPEGDNR_tv006());
	} else if(vpq_project_id == 0x00060000 && vpqex_project_id == 0x00100000){
	          if(Scaler_DispGetInputInfoByDisp(SLR_MAIN_DISPLAY, SLR_INPUT_STATE) != _MODE_STATE_ACTIVE)
		   Scaler_SetPictureMode_tv010(fwif_color_get_picture_mode(Scaler_GetUserInputSrc(SLR_MAIN_DISPLAY)));
	}else{
		//printk(KERN_EMERG "fwif_color_vpq_pic_init\n");
		//SetCurPictureMode(PICTURE_MODE_VIVID);
		//Scaler_SetPictureMode(PICTURE_MODE_VIVID);
		Scaler_RefreshPictureMode();
	}
	#ifdef ENABLE_DE_CONTOUR_I2R
	IoReg_Mask32(VGIP_VGIP_VBISLI_reg, ~_BIT20,_BIT20);
	IoReg_Mask32(DMA_VGIP_DMA_VGIP_CTRL_reg,0,0);
	#endif
	#ifdef CONFIG_CUSTOMER_TV002
	{
	extern unsigned short g_TV002_SNR_WEIGHT_Cur;
	extern unsigned short g_TV002_SHA_GAIN_Cur;
	extern unsigned short g_TV002_SHA_GAIN_BY_Y_Cur;
	g_TV002_SNR_WEIGHT_Cur = g_TV002_SHA_GAIN_Cur = g_TV002_SHA_GAIN_BY_Y_Cur = 128;
	}
	#endif
}

void fwif_color_inv_gamma_control_front(unsigned char display)
{
	drvif_color_inv_gamma_control_front(display);
}

void fwif_color_inv_gamma_control_back(unsigned char display, unsigned char ucWriteEnable)
{
	drvif_color_inv_gamma_control_back(display, ucWriteEnable);
}

void fwif_color_Inv_Gamma_Curve_Write(unsigned int *Gamma_Encode, VIP_GAMMA_CHANNEL_RGB RGB_chanel_idx)
{
	drvif_color_Inv_Gamma_Curve_Write(Gamma_Encode, RGB_chanel_idx);
}

void fwif_color_set_Inv_gamma_encode(void)
{
	fwif_color_Inv_Gamma_Curve_Write(t_inv_GAMMA, GAMMA_CHANNEL_R);	/*R*/
	fwif_color_Inv_Gamma_Curve_Write(t_inv_GAMMA, GAMMA_CHANNEL_G);	/*G*/
	fwif_color_Inv_Gamma_Curve_Write(t_inv_GAMMA, GAMMA_CHANNEL_B);	/*B*/
}


UINT16 demo_inv_gamma[Bin_Num_Gamma + 1] = {0};
void fwif_color_set_Inv_gamma_DEMO_TV006(void)
{
	//set inv gamma
	//down(&VPQ_Semaphore);
	fwif_color_inv_gamma_control_front(SLR_MAIN_DISPLAY);
	fwif_color_gamma_pre_encode_TV006_HDR_demo(demo_inv_gamma, Power22InvGamma, TV006DEMO_InvGamma);
	fwif_color_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B, demo_inv_gamma, demo_inv_gamma, demo_inv_gamma);
	fwif_color_set_inv_gamma_encode_tv006();
	drvif_color_inv_gamma_control_back_TV006_demo();
	//up(&VPQ_Semaphore);


	//set gamma
	//main no change
	//sub disable
	drvif_color_gamma_enable(SLR_SUB_DISPLAY, 0, 0);
}

void fwif_color_reset_invGamma_tv006(unsigned char value)
{
	fwif_color_inv_gamma_control_front(SLR_MAIN_DISPLAY);
	fwif_color_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B, Power22InvGamma, Power22InvGamma, Power22InvGamma);
	fwif_color_set_inv_gamma_encode_tv006();
	fwif_color_inv_gamma_control_back(SLR_MAIN_DISPLAY, 1);
	drvif_color_inv_gamma_init();
}

void fwif_color_out_gamma_control_front(void)
{
	drvif_color_out_gamma_control_front();
}

void fwif_color_out_gamma_control_back(void)
{
	drvif_color_out_gamma_control_back();
}

void fwif_color_out_gamma_control_enable(unsigned char enable)
{
	drvif_color_out_gamma_control_enable(enable);
}

void fwif_color_Out_Gamma_Curve_Write(unsigned int *Gamma_Encode, VIP_GAMMA_CHANNEL_RGB RGB_chanel_idx)
{
	drvif_color_Out_Gamma_Curve_Write(Gamma_Encode, RGB_chanel_idx);
}

unsigned char fwif_color_set_xvYCC_sRGB_Curve(unsigned char src_idx, unsigned char display, unsigned char Mode)
{
#if 0
	/*static signed int sRGB_grid[9][Bin_Num_sRGB+1];*/
	int i = 0, j = 0;
	VIPprintf("set_xvYCC_sRGB_Curve\n");
	for (j = 0; j < (Bin_Num_sRGB+1); j++) {
		for (i = 0; i < 9; i++) {
			sRGB_grid[i][j] = (gVip_Table->xvYcc_sRGB_Curve[i][j]);
		}
	}
	switch (Mode) {
	case _ENABLE:
		drvif_sRGB_SetGrid(display, sRGB_grid);
		return 1;
		break;
	case _DISABLE:
		drvif_color_sRGB_ByPass();
		return 0;
		break;
	default:
		drvif_color_sRGB_ByPass();
		return 0;
		break;
	}
#endif
	return 0;
}

void fwif_color_set_xvYCC_flag()
{
	SLR_VOINFO *pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());
	HDMI_COLORIMETRY_T HDMI_COLORIMETRY_MODE = drvif_Hdmi_GetColorimetry();

	/* set xvYcc Status in system infomation*/
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	if ((pVOInfo->xvYCC == 1) || (HDMI_COLORIMETRY_MODE == HDMI_COLORIMETRY_XYYCC601) || (HDMI_COLORIMETRY_MODE == HDMI_COLORIMETRY_XYYCC709)) {
		VIP_system_info_structure_table->xvYcc_auto_mode_flag = _ENABLE;
	} else {
		VIP_system_info_structure_table->xvYcc_auto_mode_flag = _DISABLE;
	}


}

void fwif_color_xvYcc_colorspaceyuv2rgbtransfer(unsigned char display, unsigned char nSrcTyp, unsigned char xvYcc_en_flag)
{
	drvif_color_xvYcc_colorspaceyuv2rgbtransfer(display, xvYcc_en_flag);
}

#if 1
void fwif_color_gamma_remmping_for_xvYcc(unsigned char src_idx, UINT16 *GOut_R, UINT16 *GOut_G, UINT16 *GOut_B)
{
	/* Get xvYcc auto mode Status in system infomation	and set xvYcc_flag*/
	SLR_PICTURE_MODE_DATA *pData = (SLR_PICTURE_MODE_DATA *)fwif_color_get_cur_picture_mode_data(src_idx);
	UINT16 i;
	int temp_gamma = 0;
	UINT32 out_low_index = 0, out_high_index = 0;
	UINT32 w = 0, /*z = 0,*/ out_cen = 0, temp_low = 0, temp_high = 0, temp_out = 0;
/*	int max = pow(2, bit);*/

	if (pData == NULL)
		return;

	/*VIPprintf("10 bit value -> %d, %d\n", (pow(2, 10)), (1 << 10));*/

	for (i = 0; i <= Bin_Num_Gamma; i++) {
		temp_gamma = t_gamma_curve_22[i];
		out_cen = (UINT32)temp_gamma;

		if (temp_gamma == 0)
			out_low_index  = ((temp_gamma << 10))>>12;
		else
			out_low_index  = ((temp_gamma << 10)-2048)>>12;

		out_high_index = ((temp_gamma << 10)+2048)>>12;

		/*VIPprintf("[%d], %lf, %d, %d\n", i, out_cen, out_low_index, out_high_index);*/

		w = (((out_cen*1024)/4096)-(UINT32)out_low_index);
		/*w = 1.0/2.0;*/
		if (i%50 == 0) {
			VIPprintf("w = %d, %d  %d \n", w, ((out_cen*1023)/4096), out_low_index);
		}
		temp_low = (UINT32)GOut_R[out_low_index];
		temp_high = (UINT32)GOut_R[out_high_index];
		temp_out  = ((1-w)*temp_low + w*temp_high);
		GOut_R[i] = (UINT16)temp_out;

		if (i%50 == 0) {
			VIPprintf("R:[%d] %d, %d\n", i, temp_out, GOut_R[i]);
		}

		temp_low = (UINT32)GOut_G[out_low_index];
		temp_high = (UINT32)GOut_G[out_high_index];
		temp_out  = ((1-w)*temp_low + w*temp_high);
		GOut_G[i] = (UINT16)temp_out;

		if (i%50 == 0) {
			VIPprintf("G:[%d]%d, %d\n", i, temp_out, GOut_G[i]);
		}

		temp_low = (UINT32)GOut_B[out_low_index];
		temp_high = (UINT32)GOut_B[out_high_index];
		temp_out  = ((1-w)*temp_low + w*temp_high);
		GOut_B[i] = (UINT16)temp_out;

		if (i%50 == 0) {
			VIPprintf("B:[%d]%d, %d\n", i, temp_out, GOut_B[i]);
		}
		/*w =  ((out_cen << 18))>>12-(((out_cen << 10)-2048)>>12)<< 8;*/
		/*VIPprintf("[%d] %d, %d, %d\n", i, GOut_R[i], GOut_G[i], GOut_B[i]);*/
	}
}
#else
void fwif_color_gamma_remmping_for_xvYcc(unsigned char src_idx, UINT16 *GOut_R, UINT16 *GOut_G, UINT16 *GOut_B)
{
	/* Get xvYcc auto mode Status in system infomation	and set xvYcc_flag*/
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	SLR_PICTURE_MODE_DATA *pData = (SLR_PICTURE_MODE_DATA *)fwif_color_get_cur_picture_mode_data(src_idx);
	if (pData == NULL)
		return;

	if (((pData->xvYcc_Mode) == SLR_xvYcc_OFF) || (((pData->xvYcc_Mode) == SLR_xvYcc_Auto) && (VIP_system_info_structure_table->xvYcc_auto_mode_flag == 0))) {
		VIPprintf("xvYcc off!!");
		return;
	}

	UINT16 i;
	int temp_gamma = 0;
	UINT32 out_low_index = 0, out_high_index = 0;
	FLOAT32 w = 0, z = 0, out_cen = 0, temp_low = 0, temp_high = 0, temp_out = 0;
/*	int max = pow(2, bit);*/

	/*VIPprintf("10 bit value -> %d, %d\n", (pow(2, 10)), (1 << 10));*/

	for (i = 0; i <= Bin_Num_Gamma; i++) {
		temp_gamma = t_gamma_curve_22[i];
		out_cen = (FLOAT32)temp_gamma;

		if (temp_gamma == 0)
			out_low_index  = ((temp_gamma << 10))>>12;
		else
			out_low_index  = ((temp_gamma << 10)-2048)>>12;

		out_high_index = ((temp_gamma << 10)+2048)>>12;

		/*VIPprintf("[%d], %lf, %d, %d\n", i, out_cen, out_low_index, out_high_index);*/

		w = (((out_cen*1024)/4096)-(FLOAT32)out_low_index);
		/*w = 1.0/2.0;*/
		if (i%50 == 0) {
			VIPprintf("w = %lf, %lf  %d \n", w, ((out_cen*1023)/4096), out_low_index);
		}
		temp_low = (FLOAT32)GOut_R[out_low_index];
		temp_high = (FLOAT32)GOut_R[out_high_index];
		temp_out  = ((1-w)*temp_low + w*temp_high)+0.5;
		GOut_R[i] = (UINT16)temp_out;

		if (i%50 == 0) {
			VIPprintf("R:[%d] %lf, %d\n", i, temp_out, GOut_R[i]);
		}

		temp_low = (FLOAT32)GOut_G[out_low_index];
		temp_high = (FLOAT32)GOut_G[out_high_index];
		temp_out  = ((1-w)*temp_low + w*temp_high)+0.5;
		GOut_G[i] = (UINT16)temp_out;

		if (i%50 == 0) {
			VIPprintf("G:[%d]%lf, %d\n", i, temp_out, GOut_G[i]);
		}

		temp_low = (FLOAT32)GOut_B[out_low_index];
		temp_high = (FLOAT32)GOut_B[out_high_index];
		temp_out  = ((1-w)*temp_low + w*temp_high)+0.5;
		GOut_B[i] = (UINT16)temp_out;

		if (i%50 == 0) {
			VIPprintf("B:[%d]%lf, %d\n", i, temp_out, GOut_B[i]);
		}
		/*w =  ((out_cen << 18))>>12-(((out_cen << 10)-2048)>>12)<< 8;*/
		/*VIPprintf("[%d] %d, %d, %d\n", i, GOut_R[i], GOut_G[i], GOut_B[i]);*/
	}

}
#endif

unsigned char fwif_color_set_xvYCC(unsigned char src_idx, unsigned char display, unsigned char Mode)
{
	/* Get xvYcc auto mode Status in system infomation	and set xvYcc_flag*/
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	switch (Mode) {
	case SLR_xvYcc_ON:
		fwif_color_set_xvYCC_sRGB_Curve(src_idx, display, _ENABLE);/*1.set xvYcc sRGB*/
		/*fwif_color_xvYcc_colorspaceyuv2rgbtransfer(display, src_idx, _ENABLE);*/ /*2.modify YUB2RGB matrix*/
		VIP_system_info_structure_table->xvYcc_flag = _ENABLE;/* 3. set xvYcc system info. status for color temp.setting*/
		/*Scaler_SetColorTemp((SLR_COLORTEMP_LEVEL)scaler_get_color_temp_level_type(src_idx));*/ /*4.set color temp*/
		break;
	case SLR_xvYcc_Auto:
		if (VIP_system_info_structure_table->xvYcc_auto_mode_flag == 1) {
			fwif_color_set_xvYCC_sRGB_Curve(src_idx, display, _ENABLE);/*1.set xvYcc sRGB*/
			/*fwif_color_xvYcc_colorspaceyuv2rgbtransfer(display, src_idx, _ENABLE);*/ /*2.modify YUB2RGB matrix*/
			VIP_system_info_structure_table->xvYcc_flag = _ENABLE;/* 3. set xvYcc system info. status for color temp.setting*/
			/*Scaler_SetColorTemp((SLR_COLORTEMP_LEVEL)scaler_get_color_temp_level_type(src_idx));*/ /*4.set color temp*/
		} else {
			fwif_color_set_xvYCC_sRGB_Curve(src_idx, display, _DISABLE); /*1.set xvYcc sRGB*/
			/*fwif_color_xvYcc_colorspaceyuv2rgbtransfer(display, src_idx, _DISABLE);*/ /*2.modify YUB2RGB matrix*/
			VIP_system_info_structure_table->xvYcc_flag = _DISABLE;/* 3. set xvYcc system info. status for color temp.setting*/
			/*Scaler_SetColorTemp((SLR_COLORTEMP_LEVEL)scaler_get_color_temp_level_type(src_idx));*/ /*4.set color temp*/
		}
		break;
	case SLR_xvYcc_OFF:
	default:
		fwif_color_set_xvYCC_sRGB_Curve(src_idx, display, _DISABLE);/*1.set xvYcc sRGB*/
		/*fwif_color_xvYcc_colorspaceyuv2rgbtransfer(display,  src_idx, _DISABLE);*/ /*2.modify YUB2RGB matrix*/
		VIP_system_info_structure_table->xvYcc_flag = _DISABLE;/* 3. set xvYcc system info. status for color temp.setting*/
		/*Scaler_SetColorTemp((SLR_COLORTEMP_LEVEL)scaler_get_color_temp_level_type(src_idx));*/ /*4.set Org. gamma*/
		break;
	}

	return 1;
}

void fwif_color_setrgbcolortemp_contrast(unsigned short Red, unsigned short Green, unsigned short Blue)
{
	drvif_color_setrgbcolortemp_contrast(Red, Green, Blue);
}


void fwif_color_setrgbcolortemp_bright(unsigned short Red, unsigned short Green, unsigned short Blue)
{
	drvif_color_setrgbcolortemp_bright(Red, Green, Blue);
}

void fwif_color_setrgbcolortemp_en(unsigned char enable)
{
	drvif_color_setrgbcolortemp_en(enable);
}

/*====  NNSR fwif_ function Start====*/
void fwif_color_PQ_SR_MODE_init(void)
{
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	if (VIP_RPC_system_info_structure_table == NULL){
		rtd_pr_vpq_emerg("\n  NNSR PQ_SR_Mode :SR_Mode_Disable \n" );
		return;
	}

	if (drvif_color_get_HW_MEX_STATUS(MEX_SRNN) == 1) {
		VIP_RPC_system_info_structure_table->PQ_SR_Mode = SR_MODE_NNSR;
		drvif_srnn_clk_enable(ON);

	} else if (drvif_color_get_HW_MEX_STATUS(MEX_SRS) == 1) {
		VIP_RPC_system_info_structure_table->PQ_SR_Mode = SR_MODE_SSRS;

	} else {
		VIP_RPC_system_info_structure_table->PQ_SR_Mode = SR_Mode_Disable;

	}

	rtd_pr_vpq_emerg(" NNSR PQ_SR_Mode :%d \n", VIP_RPC_system_info_structure_table->PQ_SR_Mode);

}
void fwif_color_Set_PQ_SR_MODE(unsigned char sr_mode) //for rtice used
{
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	if (VIP_RPC_system_info_structure_table == NULL) return;

        VIP_RPC_system_info_structure_table->PQ_SR_Mode = sr_mode;
        rtd_pr_vpq_emerg(" NNSR PQ_SR_Mode =%d \n",sr_mode );

}

unsigned char fwif_color_Get_PQ_SR_MODE(void)
{
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

        if (VIP_RPC_system_info_structure_table == NULL){

                return 0;
        }
        else
        {
                return VIP_RPC_system_info_structure_table->PQ_SR_Mode;
        }

}

void fwif_color_Set_NN_SRCtrl(unsigned char srnn_ctrl_idx ) //for rtice used
{
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();



	if (VIP_RPC_system_info_structure_table == NULL){
                rtd_pr_vpq_emerg("NNSR fwif_color_Set_NN_SRCtrl fail  \n" );
                return;
	}else if(VIP_RPC_system_info_structure_table->PQ_SR_Mode  !=SR_MODE_NNSR){

                rtd_pr_vpq_emerg("NNSR not support NNSR fwif_color_Set_NN_SRCtrl fail  \n" );

       }
      else {
			if(srnn_ctrl_idx >=SRNN_Ctrl_Table_MAX){
			        srnn_ctrl_idx = 0;
			        rtd_pr_vpq_emerg("NNSR ctrl table idx over_range, use index 0 \n");

			}
			rtd_pr_vpq_emerg("NNSR ctrl table default index : %d \n",srnn_ctrl_idx);

			if (pVipTable == NULL) {
				//VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
				rtd_pr_vpq_emerg("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
				return;
			}
             

			drvif_srnn_bbbsr_table((DRV_srnn_table *)&pVipTable->VIP_SRNN_Table[srnn_ctrl_idx]);

			rtd_pr_vpq_emerg("NNSR ctrl table set done and table idx:%d \n",srnn_ctrl_idx);

         }

}



extern unsigned short srnn_model_para_mode0[SRNN_Weight_Num_mode0];
extern unsigned short srnn_model_para_mode1[SRNN_Weight_Num_mode1];
extern unsigned short srnn_model_para_mode2[SRNN_Weight_Num_mode2];
//extern unsigned short srnn_model_para_mode0_r1[19336];
//extern unsigned short srnn_model_para_mode4[SRNN_Weight_Layers][SRNN_Weight_Num_mode4];

//extern unsigned short srnn_model_para_mode0_1[SRNN_Weight_Layers][SRNN_Weight_Num_mode0];
//extern unsigned short srnn_model_para_mode0_2[SRNN_Weight_Layers][SRNN_Weight_Num_mode0];
//extern unsigned short srnn_model_para_mode0_3[SRNN_Weight_Layers][SRNN_Weight_Num_mode0];

extern unsigned short srnn_model_para_mode1_1[SRNN_Weight_Layers][SRNN_Weight_Num_mode1];
extern unsigned short srnn_model_para_mode1_2[SRNN_Weight_Layers][SRNN_Weight_Num_mode1];
extern unsigned short srnn_model_para_mode1_3[SRNN_Weight_Layers][SRNN_Weight_Num_mode1];

extern unsigned short srnn_model_para_mode2_1[SRNN_Weight_Layers][SRNN_Weight_Num_mode2];
extern unsigned short srnn_model_para_mode2_2[SRNN_Weight_Layers][SRNN_Weight_Num_mode2];
extern unsigned short srnn_model_para_mode2_3[SRNN_Weight_Layers][SRNN_Weight_Num_mode2];

extern unsigned short srnn_model_para_mode0_test[SRNN_Weight_Num_mode0];
extern unsigned short srnn_model_para_mode1_test[SRNN_Weight_Num_mode1];
extern unsigned short srnn_model_para_mode2_test[SRNN_Weight_Num_mode2];

extern unsigned short srnn_model_para_mode_480p[SRNN_Weight_Layers][SRNN_Weight_Num_mode1];
extern unsigned short srnn_model_para_mode_720p[SRNN_Weight_Layers][SRNN_Weight_Num_mode1];

#ifdef SQM_OFFSET_TBL
void fwif_color_Set_NN_SR_Weights_Blend_SQM_offsetTBL(unsigned char nnsr_mode, unsigned char weight_blend_idx) 
{
	SLR_VIP_TABLE *gVip_Table;
	DRV_SRNN_WEIGHT_Table Srnn_Blending_Weight_tbl ;
    DRV_SRNN_WEIGHT_Table Ori_Srnn_Blending_Weight_tbl;
	unsigned char blending_ctrl[5]={0};

    gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();

    if (gVip_Table == NULL) {
		rtd_pr_vpq_emerg("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return ;
	}   
    
    Ori_Srnn_Blending_Weight_tbl = gVip_Table->Srnn_Blending_Weight[weight_blend_idx];
    switch (nnsr_mode){
		case 0:				
			blending_ctrl[0] = 0;
			blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode0.LTI_ratio;
			blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode0.MNR_ratio;
			blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode0.Text_Enhance_ratio;
			blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode0.De_noise_ratio;		
			memcpy(pout_array,&srnn_model_para_mode0[0], SRNN_Weight_Num_mode0*sizeof(unsigned short));
		break;
		
		case 1:
          if(gVip_Table->SQM_calMpde[SQM_calMpde_index][0]==1){                    
                Srnn_Blending_Weight_tbl.Mode1.LTI_ratio    = Ori_Srnn_Blending_Weight_tbl.Mode1.LTI_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].LTI_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode1.MNR_ratio    = Ori_Srnn_Blending_Weight_tbl.Mode1.MNR_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].MNR_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode1.Text_Enhance_ratio   = Ori_Srnn_Blending_Weight_tbl.Mode1.Text_Enhance_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].Text_Enhance_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode1.De_noise_ratio       = Ori_Srnn_Blending_Weight_tbl.Mode1.De_noise_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].De_noise_ratio/1000;
            }else{
                Srnn_Blending_Weight_tbl.Mode1.LTI_ratio = Ori_Srnn_Blending_Weight_tbl.Mode1.LTI_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].LTI_ratio;
                Srnn_Blending_Weight_tbl.Mode1.MNR_ratio = Ori_Srnn_Blending_Weight_tbl.Mode1.MNR_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].MNR_ratio;
                Srnn_Blending_Weight_tbl.Mode1.Text_Enhance_ratio = Ori_Srnn_Blending_Weight_tbl.Mode1.Text_Enhance_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].Text_Enhance_ratio;
                Srnn_Blending_Weight_tbl.Mode1.De_noise_ratio = Ori_Srnn_Blending_Weight_tbl.Mode1.De_noise_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].De_noise_ratio;
            }

            if(Srnn_Blending_Weight_tbl.Mode1.LTI_ratio <=0)Srnn_Blending_Weight_tbl.Mode1.LTI_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode1.MNR_ratio <=0)Srnn_Blending_Weight_tbl.Mode1.MNR_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode1.Text_Enhance_ratio <=0)Srnn_Blending_Weight_tbl.Mode1.Text_Enhance_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode1.De_noise_ratio <=0)Srnn_Blending_Weight_tbl.Mode1.De_noise_ratio=0;

            if(Srnn_Blending_Weight_tbl.Mode1.LTI_ratio >=16)Srnn_Blending_Weight_tbl.Mode1.LTI_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode1.MNR_ratio >=16)Srnn_Blending_Weight_tbl.Mode1.MNR_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode1.Text_Enhance_ratio >=16)Srnn_Blending_Weight_tbl.Mode1.Text_Enhance_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode1.De_noise_ratio >=16)Srnn_Blending_Weight_tbl.Mode1.De_noise_ratio=16;
            
            blending_ctrl[0] = 1;
			blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode1.LTI_ratio;
			blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode1.MNR_ratio;
			blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode1.Text_Enhance_ratio;
			blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode1.De_noise_ratio;
 			fwif_color_srnn_weight_blend_4_axis(nnsr_mode, Srnn_Blending_Weight_tbl,SRNN_Weight_Num_mode1, 4, (unsigned short*)srnn_model_para_mode1_2, pout_array);	
		break;
		case 2:
            if(gVip_Table->SQM_calMpde[SQM_calMpde_index][0]==1){                    
                Srnn_Blending_Weight_tbl.Mode2.LTI_ratio    = Ori_Srnn_Blending_Weight_tbl.Mode2.LTI_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].LTI_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode2.MNR_ratio    = Ori_Srnn_Blending_Weight_tbl.Mode2.MNR_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].MNR_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode2.Text_Enhance_ratio   = Ori_Srnn_Blending_Weight_tbl.Mode2.Text_Enhance_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].Text_Enhance_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode2.De_noise_ratio       = Ori_Srnn_Blending_Weight_tbl.Mode2.De_noise_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].De_noise_ratio/1000;
            }else{
                Srnn_Blending_Weight_tbl.Mode2.LTI_ratio = Ori_Srnn_Blending_Weight_tbl.Mode2.LTI_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].LTI_ratio;
                Srnn_Blending_Weight_tbl.Mode2.MNR_ratio = Ori_Srnn_Blending_Weight_tbl.Mode2.MNR_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].MNR_ratio;
                Srnn_Blending_Weight_tbl.Mode2.Text_Enhance_ratio = Ori_Srnn_Blending_Weight_tbl.Mode2.Text_Enhance_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].Text_Enhance_ratio;
                Srnn_Blending_Weight_tbl.Mode2.De_noise_ratio = Ori_Srnn_Blending_Weight_tbl.Mode2.De_noise_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].De_noise_ratio;
            }
            
            if(Srnn_Blending_Weight_tbl.Mode2.LTI_ratio <=0)Srnn_Blending_Weight_tbl.Mode2.LTI_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode2.MNR_ratio <=0)Srnn_Blending_Weight_tbl.Mode2.MNR_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode2.Text_Enhance_ratio <=0)Srnn_Blending_Weight_tbl.Mode2.Text_Enhance_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode2.De_noise_ratio <=0)Srnn_Blending_Weight_tbl.Mode2.De_noise_ratio=0;

            if(Srnn_Blending_Weight_tbl.Mode2.LTI_ratio >=16)Srnn_Blending_Weight_tbl.Mode2.LTI_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode2.MNR_ratio >=16)Srnn_Blending_Weight_tbl.Mode2.MNR_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode2.Text_Enhance_ratio >=16)Srnn_Blending_Weight_tbl.Mode2.Text_Enhance_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode2.De_noise_ratio >=16)Srnn_Blending_Weight_tbl.Mode2.De_noise_ratio=16;
         
			blending_ctrl[0] = 0;
			blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode2.LTI_ratio;
			blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode2.MNR_ratio;
			blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode2.Text_Enhance_ratio;
			blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode2.De_noise_ratio;	
 			fwif_color_srnn_weight_blend_4_axis(nnsr_mode, Srnn_Blending_Weight_tbl,SRNN_Weight_Num_mode2, 4, (unsigned short*)srnn_model_para_mode2_1, pout_array);               
		break;

		case 4:/*480p x4*/
            if(gVip_Table->SQM_calMpde[SQM_calMpde_index][0]==1){                    
                Srnn_Blending_Weight_tbl.Mode4.LTI_ratio    = Ori_Srnn_Blending_Weight_tbl.Mode4.LTI_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].LTI_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode4.MNR_ratio    = Ori_Srnn_Blending_Weight_tbl.Mode4.MNR_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].MNR_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode4.Text_Enhance_ratio   = Ori_Srnn_Blending_Weight_tbl.Mode4.Text_Enhance_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].Text_Enhance_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode4.De_noise_ratio       = Ori_Srnn_Blending_Weight_tbl.Mode4.De_noise_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].De_noise_ratio/1000;
            }else{
                Srnn_Blending_Weight_tbl.Mode4.LTI_ratio = Ori_Srnn_Blending_Weight_tbl.Mode4.LTI_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].LTI_ratio;
                Srnn_Blending_Weight_tbl.Mode4.MNR_ratio = Ori_Srnn_Blending_Weight_tbl.Mode4.MNR_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].MNR_ratio;
                Srnn_Blending_Weight_tbl.Mode4.Text_Enhance_ratio = Ori_Srnn_Blending_Weight_tbl.Mode4.Text_Enhance_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].Text_Enhance_ratio;
                Srnn_Blending_Weight_tbl.Mode4.De_noise_ratio = Ori_Srnn_Blending_Weight_tbl.Mode4.De_noise_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].De_noise_ratio;
            }
            
            if(Srnn_Blending_Weight_tbl.Mode4.LTI_ratio <=0)Srnn_Blending_Weight_tbl.Mode4.LTI_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode4.MNR_ratio <=0)Srnn_Blending_Weight_tbl.Mode4.MNR_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode4.Text_Enhance_ratio <=0)Srnn_Blending_Weight_tbl.Mode4.Text_Enhance_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode4.De_noise_ratio <=0)Srnn_Blending_Weight_tbl.Mode4.De_noise_ratio=0;

            if(Srnn_Blending_Weight_tbl.Mode4.LTI_ratio >=16)Srnn_Blending_Weight_tbl.Mode4.LTI_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode4.MNR_ratio >=16)Srnn_Blending_Weight_tbl.Mode4.MNR_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode4.Text_Enhance_ratio >=16)Srnn_Blending_Weight_tbl.Mode4.Text_Enhance_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode4.De_noise_ratio >=16)Srnn_Blending_Weight_tbl.Mode4.De_noise_ratio=16;
          
			blending_ctrl[0] = 0;
			blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode4.LTI_ratio;
			blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode4.MNR_ratio;
			blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode4.Text_Enhance_ratio;
			blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode4.De_noise_ratio;				
            fwif_color_srnn_weight_blend_4_axis(nnsr_mode, Srnn_Blending_Weight_tbl,SRNN_Weight_Num_mode1, 4, (unsigned short*)srnn_model_para_mode_480p, pout_array);
        break;
		
		case 5:/*720p x4*/
           if(gVip_Table->SQM_calMpde[SQM_calMpde_index][0]==1){                    
                Srnn_Blending_Weight_tbl.Mode5.LTI_ratio    = Ori_Srnn_Blending_Weight_tbl.Mode5.LTI_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].LTI_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode5.MNR_ratio    = Ori_Srnn_Blending_Weight_tbl.Mode5.MNR_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].MNR_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode5.Text_Enhance_ratio   = Ori_Srnn_Blending_Weight_tbl.Mode5.Text_Enhance_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].Text_Enhance_ratio/1000;
                Srnn_Blending_Weight_tbl.Mode5.De_noise_ratio       = Ori_Srnn_Blending_Weight_tbl.Mode5.De_noise_ratio * gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].De_noise_ratio/1000;
            }else{
                Srnn_Blending_Weight_tbl.Mode5.LTI_ratio = Ori_Srnn_Blending_Weight_tbl.Mode5.LTI_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].LTI_ratio;
                Srnn_Blending_Weight_tbl.Mode5.MNR_ratio = Ori_Srnn_Blending_Weight_tbl.Mode5.MNR_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].MNR_ratio;
                Srnn_Blending_Weight_tbl.Mode5.Text_Enhance_ratio = Ori_Srnn_Blending_Weight_tbl.Mode5.Text_Enhance_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].Text_Enhance_ratio;
                Srnn_Blending_Weight_tbl.Mode5.De_noise_ratio = Ori_Srnn_Blending_Weight_tbl.Mode5.De_noise_ratio + gVip_Table->Srnn_Weight_SQM_offset_TBL[weight_blend_idx][ai_resolution].De_noise_ratio;
            }
            
            if(Srnn_Blending_Weight_tbl.Mode5.LTI_ratio <=0)Srnn_Blending_Weight_tbl.Mode5.LTI_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode5.MNR_ratio <=0)Srnn_Blending_Weight_tbl.Mode5.MNR_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode5.Text_Enhance_ratio <=0)Srnn_Blending_Weight_tbl.Mode5.Text_Enhance_ratio=0;
            if(Srnn_Blending_Weight_tbl.Mode5.De_noise_ratio <=0)Srnn_Blending_Weight_tbl.Mode5.De_noise_ratio=0;

            if(Srnn_Blending_Weight_tbl.Mode5.LTI_ratio >=16)Srnn_Blending_Weight_tbl.Mode5.LTI_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode5.MNR_ratio >=16)Srnn_Blending_Weight_tbl.Mode5.MNR_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode5.Text_Enhance_ratio >=16)Srnn_Blending_Weight_tbl.Mode5.Text_Enhance_ratio=16;
            if(Srnn_Blending_Weight_tbl.Mode5.De_noise_ratio >=16)Srnn_Blending_Weight_tbl.Mode5.De_noise_ratio=16;
          
			blending_ctrl[0] = 0;
			blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode5.LTI_ratio;
			blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode5.MNR_ratio;
			blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode5.Text_Enhance_ratio;
			blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode5.De_noise_ratio;					
            fwif_color_srnn_weight_blend_4_axis(nnsr_mode, Srnn_Blending_Weight_tbl,SRNN_Weight_Num_mode1, 4, (unsigned short*)srnn_model_para_mode_720p, pout_array);
        break;
		default:
			blending_ctrl[0] = 0;
			blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode0.LTI_ratio;
			blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode0.MNR_ratio;
			blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode0.Text_Enhance_ratio;
			blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode0.De_noise_ratio;
            fwif_color_srnn_weight_blend_4_axis(nnsr_mode, Srnn_Blending_Weight_tbl,SRNN_Weight_Num_mode0, 4, (unsigned short*)srnn_model_para_mode0, pout_array);
			rtd_pr_vpq_emerg(" NNSR nnsr_mode is unavailable, set the default nnsr_mode: mode2");
		break;
		
	}

    /*Save for rtice*/	
	memcpy(weight_blending_ctrl, blending_ctrl, 5);
}
#endif

char fwif_color_Set_NN_SR_Weights_Blend(unsigned char nnsr_mode, unsigned char weight_blend_idx) 
{
	char ret = 0;
	//SLR_VIP_TABLE *gVIP_Table;
	DRV_SRNN_WEIGHT_Table Srnn_Blending_Weight_tbl ;
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	unsigned char blending_ctrl[5]={0};
    
	if(VIP_RPC_system_info_structure_table == NULL){
        rtd_pr_vpq_emerg(" NNSR fwif_color_Set_NN_SRCtrl fail  \n" );
        return -1;
	}else if(VIP_RPC_system_info_structure_table->PQ_SR_Mode  !=SR_MODE_NNSR){
        rtd_pr_vpq_emerg(" NNSR not support NNSR fwif_color_Set_NN_SRCtrl fail  \n" );
    }else{
		if(weight_blend_idx >=SRNN_Weight_Table_MAX){
	        weight_blend_idx = 0;
	        rtd_pr_vpq_emerg(" NNSR weight table idx over_range, use index 0 \n");
		}
		//gVIP_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
		if (gVip_Table == NULL) {
			rtd_pr_vpq_emerg("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
			return -1;
		}             			
	    Srnn_Blending_Weight_tbl = gVip_Table->Srnn_Blending_Weight[weight_blend_idx];
        #ifdef SQM_OFFSET_TBL
        if(aipq_mode.sqm_mode==0){
        #endif
            switch (nnsr_mode){
    			case 0:				
    				//fwif_color_srnn_weight_blend_4_axis(nnsr_mode, Srnn_Blending_Weight_tbl,SRNN_Weight_Num_mode0, 4, (unsigned short*)srnn_model_para_mode0, pout_array);
    				blending_ctrl[0] = 0;
    				blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode0.LTI_ratio;
    				blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode0.MNR_ratio;
    				blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode0.Text_Enhance_ratio;
    				blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode0.De_noise_ratio;		
    				memcpy(pout_array,&srnn_model_para_mode0[0], SRNN_Weight_Num_mode0*sizeof(unsigned short));
    			break;
    			
    			case 1:
    				fwif_color_srnn_weight_blend_4_axis(nnsr_mode, Srnn_Blending_Weight_tbl,SRNN_Weight_Num_mode1, 4, (unsigned short*)srnn_model_para_mode1_2, pout_array);
    				blending_ctrl[0] = 1;
    				blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode1.LTI_ratio;
    				blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode1.MNR_ratio;
    				blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode1.Text_Enhance_ratio;
    				blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode1.De_noise_ratio;
    				
    			break;
    			case 2:
    				fwif_color_srnn_weight_blend_4_axis(nnsr_mode, Srnn_Blending_Weight_tbl,SRNN_Weight_Num_mode2, 4, (unsigned short*)srnn_model_para_mode2_1, pout_array);
    				blending_ctrl[0] = 0;
    				blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode2.LTI_ratio;
    				blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode2.MNR_ratio;
    				blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode2.Text_Enhance_ratio;
    				blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode2.De_noise_ratio;					
    			break;

    			case 4:/*480p x4*/
    				fwif_color_srnn_weight_blend_4_axis(nnsr_mode, Srnn_Blending_Weight_tbl,SRNN_Weight_Num_mode1, 4, (unsigned short*)srnn_model_para_mode_480p, pout_array);
    				blending_ctrl[0] = 0;
    				blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode4.LTI_ratio;
    				blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode4.MNR_ratio;
    				blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode4.Text_Enhance_ratio;
    				blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode4.De_noise_ratio;				
    			break;
    			
    			case 5:/*720p x4*/
    				fwif_color_srnn_weight_blend_4_axis(nnsr_mode, Srnn_Blending_Weight_tbl,SRNN_Weight_Num_mode1, 4, (unsigned short*)srnn_model_para_mode_720p, pout_array);
    				blending_ctrl[0] = 0;
    				blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode5.LTI_ratio;
    				blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode5.MNR_ratio;
    				blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode5.Text_Enhance_ratio;
    				blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode5.De_noise_ratio;					
    			break;
    			default:
    				fwif_color_srnn_weight_blend_4_axis(nnsr_mode, Srnn_Blending_Weight_tbl,SRNN_Weight_Num_mode0, 4, (unsigned short*)srnn_model_para_mode0, pout_array);
    				blending_ctrl[0] = 0;
    				blending_ctrl[1] = Srnn_Blending_Weight_tbl.Mode0.LTI_ratio;
    				blending_ctrl[2] = Srnn_Blending_Weight_tbl.Mode0.MNR_ratio;
    				blending_ctrl[3] = Srnn_Blending_Weight_tbl.Mode0.Text_Enhance_ratio;
    				blending_ctrl[4] = Srnn_Blending_Weight_tbl.Mode0.De_noise_ratio;					
    				rtd_pr_vpq_emerg(" NNSR nnsr_mode is unavailable, set the default nnsr_mode: mode2");
    			break;			
    		}

			/*Save for rtice*/	
			memcpy(weight_blending_ctrl, blending_ctrl, 5);
                
            #ifdef SQM_OFFSET_TBL
            }	else{
                rtd_pr_vpq_emerg(" NNSR nnsr_mode SQM=on: apply offset table\n");
                fwif_color_Set_NN_SR_Weights_Blend_SQM_offsetTBL(nnsr_mode,weight_blend_idx);
            }
            #endif
			//for debug use write table without blending 
			#if 0
			if(nnsr_mode==0)
				fwif_color_Set_NNSR_model_By_DMA(nnsr_mode, pout_array);
			else if(nnsr_mode==1)
				fwif_color_Set_NNSR_model_By_DMA(nnsr_mode, pout_array); 
			else if(nnsr_mode==2)
				fwif_color_Set_NNSR_model_By_DMA(nnsr_mode, pout_array);
			#endif

			ret = fwif_color_set_NNSR_model_TBL(nnsr_mode, pout_array);
        }
	return ret;
}

unsigned short srnn_model_para_mode1_tmp[SRNN_Weight_Layers*SRNN_Weight_Num_mode1]={0};
unsigned short srnn_model_para_mode2_tmp[SRNN_Weight_Layers*SRNN_Weight_Num_mode2]={0};
unsigned short srnn_model_para_480p_tmp[SRNN_Weight_Layers*SRNN_Weight_Num_mode1]={0};
unsigned short srnn_model_para_720p_tmp[SRNN_Weight_Layers*SRNN_Weight_Num_mode1]={0};
#if 1
void fwif_color_Set_NN_SR_Weights_Blend_for_rtice(unsigned char nnsr_mode, unsigned char *blending_ctrl) 
{

	unsigned short *pout_array = NULL;
	//unsigned short *srnn_model_para_mode1_tmp = NULL;
	//unsigned short *srnn_model_para_mode2_tmp = NULL;
	//srnn_wdsr_ctrl_RBUS srnn_wdsr_ctrl_reg;
	
	//srnn_wdsr_ctrl_reg.regValue = IoReg_Read32(SRNN_WDSR_CTRL_reg);
	//srnn_wdsr_ctrl_reg.conv_bias_load_time = 0;
	//IoReg_Write32(SRNN_WDSR_CTRL_reg,srnn_wdsr_ctrl_reg.regValue);

	rtd_pr_vpq_emerg(" NNSR mode:%d table selection table%d", nnsr_mode,blending_ctrl[0]);
	if(nnsr_mode ==1){
		//srnn_model_para_mode1_tmp = vmalloc(SRNN_Weight_Layers*SRNN_Weight_Num_mode1*sizeof(unsigned short));
		if (0/*srnn_model_para_mode1_tmp == NULL*/) {
			rtd_pr_vpq_emerg(" NNSR srnn_model_para_mode1_tmp=NULL\n");
		} 
		else {
			if(blending_ctrl[0]==0)
				memcpy(srnn_model_para_mode1_tmp, &srnn_model_para_mode1_1[0][0], SRNN_Weight_Layers*SRNN_Weight_Num_mode1*sizeof(unsigned short));
			else if(blending_ctrl[0]==1)
				memcpy(srnn_model_para_mode1_tmp, &srnn_model_para_mode1_2[0][0], SRNN_Weight_Layers*SRNN_Weight_Num_mode1*sizeof(unsigned short)); 
			else if(blending_ctrl[0]==2)
				memcpy(srnn_model_para_mode1_tmp, &srnn_model_para_mode1_3[0][0], SRNN_Weight_Layers*SRNN_Weight_Num_mode1*sizeof(unsigned short)); 
		}
	}else if(nnsr_mode==2){
		//srnn_model_para_mode2_tmp = vmalloc(SRNN_Weight_Layers*SRNN_Weight_Num_mode2*sizeof(unsigned short));
		if (0/*srnn_model_para_mode2_tmp == NULL*/) {
			rtd_pr_vpq_emerg(" NNSR srnn_model_para_mode2_tmp=NULL\n");
		} 
		else {
			if(blending_ctrl[0]==0)
				memcpy(srnn_model_para_mode2_tmp, &srnn_model_para_mode2_1[0][0], SRNN_Weight_Layers*SRNN_Weight_Num_mode2*sizeof(unsigned short));
			else if(blending_ctrl[0]==1)
				memcpy(srnn_model_para_mode2_tmp, &srnn_model_para_mode2_2[0][0], SRNN_Weight_Layers*SRNN_Weight_Num_mode2*sizeof(unsigned short)); 
			else if(blending_ctrl[0]==2)
				memcpy(srnn_model_para_mode2_tmp, &srnn_model_para_mode2_3[0][0], SRNN_Weight_Layers*SRNN_Weight_Num_mode2*sizeof(unsigned short)); 
		}
	}else if(nnsr_mode==4){
		if (0/*srnn_model_para_mode2_tmp == NULL*/) {
			rtd_pr_vpq_emerg(" NNSR srnn_model_para_mode4_tmp=NULL\n");
		} 
		else {
			if(blending_ctrl[0]==0)
				memcpy(srnn_model_para_480p_tmp, &srnn_model_para_mode_480p[0][0], SRNN_Weight_Layers*SRNN_Weight_Num_mode1*sizeof(unsigned short));
		}
	}else if(nnsr_mode==5){
		if (0/*srnn_model_para_mode2_tmp == NULL*/) {
			rtd_pr_vpq_emerg(" NNSR srnn_model_para_mode5_tmp=NULL\n");
		} 
		else {
			if(blending_ctrl[0]==0)
				memcpy(srnn_model_para_720p_tmp, &srnn_model_para_mode_720p[0][0], SRNN_Weight_Layers*SRNN_Weight_Num_mode1*sizeof(unsigned short));
		}
	}
	//rtd_pr_vpq_emerg(" CY par_0:%d, para_1:%d, para_7379:%d",srnn_model_para_mode2_tmp[0][0],srnn_model_para_mode2_tmp[0][1],srnn_model_para_mode2_tmp[0][7379] );

			
	switch (nnsr_mode){
		case 0:	
			pout_array =  vip_malloc(SRNN_Weight_Num_mode0*sizeof(unsigned short));
			memcpy(pout_array,&srnn_model_para_mode0[0], SRNN_Weight_Num_mode0*sizeof(unsigned short));
			//pout_array = vip_malloc(SRNN_Weight_Num_mode0*sizeof(unsigned short));
			//if (pout_array == NULL || srnn_model_para_mode2_tmp==NULL)
			//	rtd_pr_vpq_emerg(" NNSR pout_array 2 =NULL or srnn_model_para_mode2_tmp=NULL\n");
			//else
			//	fwif_color_srnn_weight_blend_4_axis_for_rtice(nnsr_mode, blending_ctrl,SRNN_Weight_Num_mode2, 4,srnn_model_para_mode2_tmp, pout_array);
		break;

		case 1:
			pout_array = vip_malloc(SRNN_Weight_Num_mode1*sizeof(unsigned short));
			if (pout_array == NULL/*|| srnn_model_para_mode1_tmp==NULL*/)
				rtd_pr_vpq_emerg(" NNSR pout_array 1 =NULL\n");
			else
				fwif_color_srnn_weight_blend_4_axis_for_rtice(nnsr_mode, blending_ctrl,SRNN_Weight_Num_mode1, 4, (unsigned short*)srnn_model_para_mode1_tmp, pout_array);
		break;

		case 2:
			pout_array = vip_malloc(SRNN_Weight_Num_mode2*sizeof(unsigned short));
			if (pout_array == NULL/* || srnn_model_para_mode2_tmp==NULL*/)
				rtd_pr_vpq_emerg(" NNSR pout_array 2 =NULL or srnn_model_para_mode2_tmp=NULL\n");
			else			
				fwif_color_srnn_weight_blend_4_axis_for_rtice(nnsr_mode, blending_ctrl,SRNN_Weight_Num_mode2, 4, srnn_model_para_mode2_tmp, pout_array);
		break;		

		case 4:
			pout_array = vip_malloc(SRNN_Weight_Num_mode1*sizeof(unsigned short));
			if (pout_array == NULL/* || srnn_model_para_mode2_tmp==NULL*/)
				rtd_pr_vpq_emerg(" NNSR pout_array 480p =NULL or srnn_model_para_mode_480p_tmp=NULL\n");
			else			
				fwif_color_srnn_weight_blend_4_axis_for_rtice(nnsr_mode, blending_ctrl,SRNN_Weight_Num_mode1, 4, srnn_model_para_480p_tmp, pout_array);
		break;	

		case 5:
			pout_array = vip_malloc(SRNN_Weight_Num_mode1*sizeof(unsigned short));
			if (pout_array == NULL/* || srnn_model_para_mode2_tmp==NULL*/)
				rtd_pr_vpq_emerg(" NNSR pout_array 720p =NULL or srnn_model_para_mode_720p_tmp=NULL\n");
			else			
				fwif_color_srnn_weight_blend_4_axis_for_rtice(nnsr_mode, blending_ctrl,SRNN_Weight_Num_mode1, 4, srnn_model_para_720p_tmp, pout_array);
		break;	

		default:
			pout_array = vip_malloc(SRNN_Weight_Num_mode2*sizeof(unsigned short));
			if (pout_array == NULL)
				rtd_pr_vpq_emerg(" NNSR pout_array default =NULL\n");
			else			
				fwif_color_srnn_weight_blend_4_axis_for_rtice(nnsr_mode, blending_ctrl,SRNN_Weight_Num_mode2, 4, (unsigned short*)srnn_model_para_mode2, pout_array);
			rtd_pr_vpq_emerg(" NNSR nnsr_mode is unavailable, set the default nnsr_mode: mode2 from rtice");
		break;
		
	}
	if(pout_array!=NULL){
		fwif_color_set_NNSR_model_TBL(nnsr_mode, pout_array); 
		vip_free(pout_array);
	}else{
		rtd_pr_vpq_emerg(" NNSR Write table from qrtice, but pout_array memory allocate failed\n");
	}
#if 0
	if(srnn_model_para_mode2_tmp!=NULL){
		vfree(srnn_model_para_mode2_tmp);
	}else{
		rtd_pr_vpq_emerg(" NNSR Write table from qrtice, srnn_model_para_mode2_tmp but srnn_model_para_%d_tmp memory allocate failed\n",nnsr_mode);
	} 

	if(srnn_model_para_mode1_tmp!=NULL){
		vfree(srnn_model_para_mode1_tmp);
	}else{
		rtd_pr_vpq_emerg(" NNSR Write table from qrtice, srnn_model_para_mode1_tmp but srnn_model_para_%d_tmp memory allocate failed\n",nnsr_mode);
	}
#endif
}
#endif
void fwif_color_Set_NNSR_model_By_DMA(unsigned char nnsr_mode, unsigned short *pArray){
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif

	switch(nnsr_mode){

                case 0:/*2k2x 19044*2*/
		             addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_SRNN_MODE6);
                		addr = drvif_memory_get_data_align(addr, (1 << 12));
                		size = drvif_memory_get_data_align(VIP_DMAto3DTABLE_SRNN_MODE6_SIZE, (1 << 12));	
		   break;				
                case 1:/*2k4x 19920*2*/
		   case 4:
		   case 5:
                         addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_SRNN_MODE7);
                	      addr = drvif_memory_get_data_align(addr, (1 << 12));
                	      size = drvif_memory_get_data_align(VIP_DMAto3DTABLE_SRNN_MODE7_SIZE, (1 << 12));
		   break;			
                case 2:/*4k2x 5052*2*/
                        addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_SRNN_MODE2);
                	addr = drvif_memory_get_data_align(addr, (1 << 12));
                	size = drvif_memory_get_data_align(VIP_DMAto3DTABLE_SRNN_MODE2_SIZE, (1 << 12));

                break;
                case 3:
			rtd_pr_vpq_info(" nnsr_mode=%d ,no need to load NNSR table \n",nnsr_mode);
                break;
                /*case 4:
				addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_SRNN_MODE7);
				addr = drvif_memory_get_data_align(addr, (1 << 12));
				size = drvif_memory_get_data_align(DMAto3DTABLE_SRNN_MODE7, (1 << 12));
                break;
                case 5:
				addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_SRNN_MODE7);
				addr = drvif_memory_get_data_align(addr, (1 << 12));
				size = drvif_memory_get_data_align(DMAto3DTABLE_SRNN_MODE7, (1 << 12));
                break;	*/			
                default: 
                        rtd_pr_vpq_info(" nnsr_mode=%d ,no need to load NNSR table \n",nnsr_mode);

                break;
#if 0
                case 5:
                        addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_SRNN_MODE5);
                	addr = drvif_memory_get_data_align(addr, (1 << 12));
                	size = drvif_memory_get_data_align(VIP_DMAto3DTABLE_SRNN_MODE5_SIZE, (1 << 12));
                break;
                case 6:
                        addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_SRNN_MODE6);
                	addr = drvif_memory_get_data_align(addr, (1 << 12));
                	size = drvif_memory_get_data_align(VIP_DMAto3DTABLE_SRNN_MODE6_SIZE, (1 << 12));
                break;
                case 7:
                        addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_SRNN_MODE7);
                	addr = drvif_memory_get_data_align(addr, (1 << 12));
                	size = drvif_memory_get_data_align(VIP_DMAto3DTABLE_SRNN_MODE7_SIZE, (1 << 12));
                break;
#endif	

	}

	if (addr == 0) {
		rtd_pr_vpq_emerg("NNSR fwif_color_Set_NNSR_model_By_DMA, addr = NULL\n");
		return;
	}

        if(nnsr_mode !=3){
        	pVir_addr = dvr_remap_uncached_memory(addr, size, __builtin_return_address(0));

        	size_aligned = size;
        	addr_aligned = addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
        	va_temp = (unsigned long)pVir_addr;
#else
        	va_temp = (unsigned int)pVir_addr;
#endif
        	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
        	size_aligned = dvr_size_alignment(size);
        	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
        	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
        	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
        	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

        	rtd_pr_vpq_info("NNSR fwif_color_Set_NNSR_model_By_DMA, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
        		addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);

        	drvif_Wait_UZUDTG_start(10, -200);
        	drvif_color_Set_NNSR_model_By_DMA(nnsr_mode, pArray, addr_aligned, (unsigned int*) pVir_addr_aligned);
        	dvr_unmap_memory((void *)pVir_addr, size);
        }
        
	return;

}

void fwif_color_srnn_weight_blend_4_axis(unsigned char ai_sr_mode,DRV_SRNN_WEIGHT_Table SRNN_WEIGHT_Table,int para_num, int scale, unsigned short *pin_array, unsigned short *pout_array ){

	//merlin7
	int w1_alpha, w2_alpha, w3_alpha, w4_alpha;
	int k;
	unsigned short net_interp1_1,net_interp1_2,net_interp1_3,net_interp1_4,net_interp1_5,net_interp1_6,net_interp1_7,net_interp1_8;
	unsigned short net_interp2_1,net_interp2_2,net_interp2_3,net_interp2_4,net_interp3_1,net_interp3_2;
	int int_bits=0,  fra_bits=9;	

	switch (ai_sr_mode){
		case 0:
			w1_alpha = SRNN_WEIGHT_Table.Mode0.LTI_ratio;
			w2_alpha = SRNN_WEIGHT_Table.Mode0.MNR_ratio;
			w3_alpha = SRNN_WEIGHT_Table.Mode0.Text_Enhance_ratio;
			w4_alpha = SRNN_WEIGHT_Table.Mode0.De_noise_ratio;
		break;	
		case 1:
			w1_alpha = SRNN_WEIGHT_Table.Mode1.LTI_ratio;
			w2_alpha = SRNN_WEIGHT_Table.Mode1.MNR_ratio;
			w3_alpha = SRNN_WEIGHT_Table.Mode1.Text_Enhance_ratio;
			w4_alpha = SRNN_WEIGHT_Table.Mode1.De_noise_ratio;
		break;		
		case 2:
			w1_alpha = SRNN_WEIGHT_Table.Mode2.LTI_ratio;
			w2_alpha = SRNN_WEIGHT_Table.Mode2.MNR_ratio;
			w3_alpha = SRNN_WEIGHT_Table.Mode2.Text_Enhance_ratio;
			w4_alpha = SRNN_WEIGHT_Table.Mode2.De_noise_ratio;
		break;
		case 4:
			w1_alpha = SRNN_WEIGHT_Table.Mode4.LTI_ratio;
			w2_alpha = SRNN_WEIGHT_Table.Mode4.MNR_ratio;
			w3_alpha = SRNN_WEIGHT_Table.Mode4.Text_Enhance_ratio;
			w4_alpha = SRNN_WEIGHT_Table.Mode4.De_noise_ratio;
		break;		
		case 5:
			w1_alpha = SRNN_WEIGHT_Table.Mode5.LTI_ratio;
			w2_alpha = SRNN_WEIGHT_Table.Mode5.MNR_ratio;
			w3_alpha = SRNN_WEIGHT_Table.Mode5.Text_Enhance_ratio;
			w4_alpha = SRNN_WEIGHT_Table.Mode5.De_noise_ratio;
		break;		
		default:
			//default mode: mode2
			w1_alpha = SRNN_WEIGHT_Table.Mode2.LTI_ratio;
			w2_alpha = SRNN_WEIGHT_Table.Mode2.MNR_ratio;
			w3_alpha = SRNN_WEIGHT_Table.Mode2.Text_Enhance_ratio;
			w4_alpha = SRNN_WEIGHT_Table.Mode2.De_noise_ratio;
		break;

	}

	rtd_pr_vpq_info("NNSR weight blending ratio LTI:%d,  MNR:%d,  Text:%d,  Denoise:%d\n",w1_alpha,w2_alpha,w3_alpha,w4_alpha);

	
	for(k=0;k<para_num;k++){
		
		net_interp1_1 = drvif_srnn_weight_blend_output_scaler(*(pin_array+0*para_num+k), *(pin_array+8*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_2 = drvif_srnn_weight_blend_output_scaler(*(pin_array+1*para_num+k), *(pin_array+9*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_3 = drvif_srnn_weight_blend_output_scaler(*(pin_array+2*para_num+k), *(pin_array+10*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_4 = drvif_srnn_weight_blend_output_scaler(*(pin_array+3*para_num+k), *(pin_array+11*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_5 = drvif_srnn_weight_blend_output_scaler(*(pin_array+4*para_num+k), *(pin_array+12*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_6 = drvif_srnn_weight_blend_output_scaler(*(pin_array+5*para_num+k), *(pin_array+13*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_7 = drvif_srnn_weight_blend_output_scaler(*(pin_array+6*para_num+k), *(pin_array+14*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_8 = drvif_srnn_weight_blend_output_scaler(*(pin_array+7*para_num+k), *(pin_array+15*para_num+k), w1_alpha,scale , int_bits, fra_bits);

		net_interp2_1 = drvif_srnn_weight_blend_output_scaler(net_interp1_1, net_interp1_5, w2_alpha,scale , int_bits, fra_bits);
		net_interp2_2 = drvif_srnn_weight_blend_output_scaler(net_interp1_2, net_interp1_6, w2_alpha,scale , int_bits, fra_bits);
		net_interp2_3 = drvif_srnn_weight_blend_output_scaler(net_interp1_3, net_interp1_7, w2_alpha,scale , int_bits, fra_bits);
		net_interp2_4 = drvif_srnn_weight_blend_output_scaler(net_interp1_4, net_interp1_8, w2_alpha,scale , int_bits, fra_bits);

		net_interp3_1 = drvif_srnn_weight_blend_output_scaler(net_interp2_1, net_interp2_3, w3_alpha,scale , int_bits, fra_bits);
		net_interp3_2 = drvif_srnn_weight_blend_output_scaler(net_interp2_2, net_interp2_4, w3_alpha,scale , int_bits, fra_bits);

		pout_array[k] = drvif_srnn_weight_blend_output_scaler(net_interp3_1, net_interp3_2, w4_alpha,scale , int_bits, fra_bits);

		
		/*
		net_interp1_1 = (1 - w1_alpha) * pin_array[1][k] + w1_alpha * pin_array[9][k];                               
		net_interp1_2 = (1 - w1_alpha) * pin_array[2][k] + w1_alpha * pin_array[10][k];                              
		net_interp1_3 = (1 - w1_alpha) * pin_array[3][k] + w1_alpha * pin_array[11][k];                              
		net_interp1_4 = (1 - w1_alpha) * pin_array[4][k] + w1_alpha * pin_array[12][k];                              
		net_interp1_5 = (1 - w1_alpha) * pin_array[5][k] + w1_alpha * pin_array[13][k];                             
		net_interp1_6 = (1 - w1_alpha) * pin_array[6][k] + w1_alpha * pin_array[14][k];                              
		net_interp1_7 = (1 - w1_alpha) * pin_array[7][k] + w1_alpha * pin_array[15][k];                             
		net_interp1_8 = (1 - w1_alpha) * pin_array[8][k] + w1_alpha * pin_array[16][k];                              
		                                                                                                 
		net_interp2_1 = (1 - w2_alpha) * net_interp1_1 + w2_alpha * net_interp1_5;               
		net_interp2_2 = (1 - w2_alpha) * net_interp1_2 + w2_alpha * net_interp1_6;               
		net_interp2_3 = (1 - w2_alpha) * net_interp1_3 + w2_alpha * net_interp1_7;               
		net_interp2_4 = (1 - w2_alpha) * net_interp1_4 + w2_alpha * net_interp1_8;               
		                                                                                                 
		net_interp3_1 = (1 - w3_alpha) * net_interp2_1 + w3_alpha * net_interp2_3;               
		net_interp3_2 = (1 - w3_alpha) * net_interp2_2 + w3_alpha * net_interp2_4;              
		                                                                                                 
		pout_array[k] = (1 - w4_alpha) * net_interp3_1 + w4_alpha * net_interp3_2;
		*/

	}
}

void fwif_color_srnn_weight_blend_4_axis_for_rtice(unsigned char ai_sr_mode,unsigned char *blending_ctrl, int para_num, int scale, unsigned short *pin_array, unsigned short *pout_array ){

	
	int w1_alpha, w2_alpha, w3_alpha, w4_alpha;
	int k;
	unsigned short net_interp1_1,net_interp1_2,net_interp1_3,net_interp1_4,net_interp1_5,net_interp1_6,net_interp1_7,net_interp1_8;
	unsigned short net_interp2_1,net_interp2_2,net_interp2_3,net_interp2_4,net_interp3_1,net_interp3_2;
	int int_bits=0,  fra_bits=9;	

	/*Save for rtice*/	
	memcpy(weight_blending_ctrl, blending_ctrl, 5);

	switch (ai_sr_mode){
		case 0:
			w1_alpha = blending_ctrl[1];
			w2_alpha = blending_ctrl[2];
			w3_alpha = blending_ctrl[3];
			w4_alpha = blending_ctrl[4];
		break;
		case 1:
		case 4:
		case 5:
			w1_alpha = blending_ctrl[1];
			w2_alpha = blending_ctrl[2];
			w3_alpha = blending_ctrl[3];
			w4_alpha = blending_ctrl[4];
		break;
		case 2:
			w1_alpha = blending_ctrl[1];
			w2_alpha = blending_ctrl[2];
			w3_alpha = blending_ctrl[3];
			w4_alpha = blending_ctrl[4];
		break;
		default:
			//default mode: mode2
			w1_alpha = blending_ctrl[1];
			w2_alpha = blending_ctrl[2];
			w3_alpha = blending_ctrl[3];
			w4_alpha = blending_ctrl[4];
		break;

	}



	
	for(k=0;k<para_num;k++){
		
		net_interp1_1 = drvif_srnn_weight_blend_output_scaler(*(pin_array+0*para_num+k), *(pin_array+8*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_2 = drvif_srnn_weight_blend_output_scaler(*(pin_array+1*para_num+k), *(pin_array+9*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_3 = drvif_srnn_weight_blend_output_scaler(*(pin_array+2*para_num+k), *(pin_array+10*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_4 = drvif_srnn_weight_blend_output_scaler(*(pin_array+3*para_num+k), *(pin_array+11*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_5 = drvif_srnn_weight_blend_output_scaler(*(pin_array+4*para_num+k), *(pin_array+12*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_6 = drvif_srnn_weight_blend_output_scaler(*(pin_array+5*para_num+k), *(pin_array+13*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_7 = drvif_srnn_weight_blend_output_scaler(*(pin_array+6*para_num+k), *(pin_array+14*para_num+k), w1_alpha,scale , int_bits, fra_bits);
		net_interp1_8 = drvif_srnn_weight_blend_output_scaler(*(pin_array+7*para_num+k), *(pin_array+15*para_num+k), w1_alpha,scale , int_bits, fra_bits);

		net_interp2_1 = drvif_srnn_weight_blend_output_scaler(net_interp1_1, net_interp1_5, w2_alpha,scale , int_bits, fra_bits);
		net_interp2_2 = drvif_srnn_weight_blend_output_scaler(net_interp1_2, net_interp1_6, w2_alpha,scale , int_bits, fra_bits);
		net_interp2_3 = drvif_srnn_weight_blend_output_scaler(net_interp1_3, net_interp1_7, w2_alpha,scale , int_bits, fra_bits);
		net_interp2_4 = drvif_srnn_weight_blend_output_scaler(net_interp1_4, net_interp1_8, w2_alpha,scale , int_bits, fra_bits);

		net_interp3_1 = drvif_srnn_weight_blend_output_scaler(net_interp2_1, net_interp2_3, w3_alpha,scale , int_bits, fra_bits);
		net_interp3_2 = drvif_srnn_weight_blend_output_scaler(net_interp2_2, net_interp2_4, w3_alpha,scale , int_bits, fra_bits);

		pout_array[k] = drvif_srnn_weight_blend_output_scaler(net_interp3_1, net_interp3_2, w4_alpha,scale , int_bits, fra_bits);

		
		/*
		net_interp1_1 = (1 - w1_alpha) * pin_array[1][k] + w1_alpha * pin_array[9][k];                               
		net_interp1_2 = (1 - w1_alpha) * pin_array[2][k] + w1_alpha * pin_array[10][k];                              
		net_interp1_3 = (1 - w1_alpha) * pin_array[3][k] + w1_alpha * pin_array[11][k];                              
		net_interp1_4 = (1 - w1_alpha) * pin_array[4][k] + w1_alpha * pin_array[12][k];                              
		net_interp1_5 = (1 - w1_alpha) * pin_array[5][k] + w1_alpha * pin_array[13][k];                             
		net_interp1_6 = (1 - w1_alpha) * pin_array[6][k] + w1_alpha * pin_array[14][k];                              
		net_interp1_7 = (1 - w1_alpha) * pin_array[7][k] + w1_alpha * pin_array[15][k];                             
		net_interp1_8 = (1 - w1_alpha) * pin_array[8][k] + w1_alpha * pin_array[16][k];                              
		                                                                                                 
		net_interp2_1 = (1 - w2_alpha) * net_interp1_1 + w2_alpha * net_interp1_5;               
		net_interp2_2 = (1 - w2_alpha) * net_interp1_2 + w2_alpha * net_interp1_6;               
		net_interp2_3 = (1 - w2_alpha) * net_interp1_3 + w2_alpha * net_interp1_7;               
		net_interp2_4 = (1 - w2_alpha) * net_interp1_4 + w2_alpha * net_interp1_8;               
		                                                                                                 
		net_interp3_1 = (1 - w3_alpha) * net_interp2_1 + w3_alpha * net_interp2_3;               
		net_interp3_2 = (1 - w3_alpha) * net_interp2_2 + w3_alpha * net_interp2_4;              
		                                                                                                 
		pout_array[k] = (1 - w4_alpha) * net_interp3_1 + w4_alpha * net_interp3_2;
		*/

	}
}

void fwif_color_srnn_m_disp_en_ctrl(unsigned char en){
	ppoverlay_main_display_control_rsv_RBUS ppoverlay_main_display_control_rsv__reg;
	
	ppoverlay_main_display_control_rsv__reg.regValue= IoReg_Read32(PPOVERLAY_Main_Display_Control_RSV_reg);
	ppoverlay_main_display_control_rsv__reg.m_disp_en = en;
	
	if(en==1){ 
		rtd_pr_vpq_info("NNSR m_disp_en enable\n");
		IoReg_Write32(PPOVERLAY_Main_Display_Control_RSV_reg, ppoverlay_main_display_control_rsv__reg.regValue);
	}
	else if (en==0){
		rtd_pr_vpq_info("NNSR m_disp_en disable\n");
		IoReg_Write32(PPOVERLAY_Main_Display_Control_RSV_reg, ppoverlay_main_display_control_rsv__reg.regValue);
	}

	
	
}
extern struct semaphore VPQ_NNSR_Model_TBL_Semaphore;
char fwif_color_set_NNSR_model_TBL(unsigned char nnsr_mode, unsigned short *pArray)
{
	char ret = 0;
	unsigned char check_times = 0, check_times_max = 30;

	down(&VPQ_NNSR_Model_TBL_Semaphore);
	do {
		drvif_NNSR_Err_Reset();
		drvif_NNSR_Table_Done_Reset(0);
		check_times++;
	} while(((drvif_NNSR_DMA_Err_Check(0) != 0) || (drvif_Get_NNSR_DMA_Table_Done(0, 0) != 0)) && (check_times<check_times_max));

	if (check_times >= check_times_max) {
		rtd_pr_vpq_emerg("NNSR_DMA, can't reset DM2 DMA Err status, check times = %d,\n", check_times);
		drvif_NNSR_DMA_Err_Check(1);
		drvif_Get_NNSR_DMA_Table_Done(0, 1);
		ret = -1;
	} else {
		fwif_color_Set_NNSR_model_By_DMA(nnsr_mode, pArray); 
		if (drvif_NNSR_Wait_for_DMA_Apply_Done() < 0) {
			rtd_pr_vpq_emerg("NNSR_DMA, DMA wait not finish.\n");
			drvif_srnn_bbbsr_enable_set(0);
			ret = -1;
		} else {
			if ((drvif_NNSR_DMA_Err_Check(1) != 0) || (drvif_Get_NNSR_DMA_Table_Done(0, 1) != 1)) {
				drvif_srnn_bbbsr_enable_set(0);
				ret = -1;
				rtd_pr_vpq_emerg("NNSR_DMA, error status ~= 0. or table done != 1.\n");
			} else {
				ret = 0;
				rtd_pr_vpq_info("NNSR_DMA, write done\n");
			}
		}
	}

	up(&VPQ_NNSR_Model_TBL_Semaphore);
	
	return ret;
}

#ifdef SQM_OFFSET_TBL
void fwif_color_set_MBPK_applySQMoffset_table(unsigned char MBPK_idx)
{
    SLR_VIP_TABLE *gVip_Table;

     
	color_mb_peaking_mb_peaking_hor_gain_RBUS			color_mb_peaking_mb_peaking_hor_gain;
	color_mb_peaking_mb_peaking_hor_bound_RBUS		color_mb_peaking_mb_peaking_hor_bound;
	color_mb_peaking_mb_peaking_hor_gain_2_RBUS		color_mb_peaking_mb_peaking_hor_gain_2;
	color_mb_peaking_mb_peaking_ver_gain_RBUS			color_mb_peaking_mb_peaking_ver_gain;
	color_mb_peaking_mb_peaking_ver_bound_RBUS		color_mb_peaking_mb_peaking_ver_bound;
	color_mb_peaking_mb_peaking_ver_gain_2_RBUS		color_mb_peaking_mb_peaking_ver_gain_2;
	color_mb_peaking_mb_snr_coring_RBUS color_mb_peaking_mb_snr_coring;
	color_mb_peaking_mb_wei_coring1_RBUS color_mb_peaking_mb_wei_coring1;
	color_mb_peaking_mb_wei_coring2_RBUS color_mb_peaking_mb_wei_coring2;
	color_mb_peaking_mb_double_buffer_ctrl_RBUS		color_mb_peaking_mb_double_buffer_ctrl;

	color_mb_peaking_mb_peaking_hor_gain.regValue = IoReg_Read32(COLOR_MB_PEAKING_MB_PEAKING_Hor_GAIN_reg);
	color_mb_peaking_mb_peaking_hor_bound.regValue = IoReg_Read32(COLOR_MB_PEAKING_MB_PEAKING_Hor_BOUND_reg);
	color_mb_peaking_mb_peaking_hor_gain_2.regValue = IoReg_Read32(COLOR_MB_PEAKING_MB_PEAKING_Hor_GAIN_2_reg);
	color_mb_peaking_mb_peaking_ver_gain.regValue = IoReg_Read32(COLOR_MB_PEAKING_MB_PEAKING_Ver_GAIN_reg);
	color_mb_peaking_mb_peaking_ver_bound.regValue = IoReg_Read32(COLOR_MB_PEAKING_MB_PEAKING_Ver_BOUND_reg);
	color_mb_peaking_mb_peaking_ver_gain_2.regValue = IoReg_Read32(COLOR_MB_PEAKING_MB_PEAKING_Ver_GAIN_2_reg);
	color_mb_peaking_mb_snr_coring.regValue = IoReg_Read32(COLOR_MB_PEAKING_MB_SNR_CORING_reg);
	color_mb_peaking_mb_wei_coring1.regValue = IoReg_Read32(COLOR_MB_PEAKING_MB_WEI_CORING1_reg);
	color_mb_peaking_mb_wei_coring2.regValue = IoReg_Read32(COLOR_MB_PEAKING_MB_WEI_CORING2_reg);

	//Enable doublue buffer
	color_mb_peaking_mb_double_buffer_ctrl.regValue = IoReg_Read32(COLOR_MB_PEAKING_MB_Double_Buffer_CTRL_reg);
	color_mb_peaking_mb_double_buffer_ctrl.mb_db_en =1;
	IoReg_Write32(COLOR_MB_PEAKING_MB_Double_Buffer_CTRL_reg, color_mb_peaking_mb_double_buffer_ctrl.regValue);

    gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();

    if (gVip_Table == NULL) {
		rtd_pr_vpq_emerg("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}  
    
	//ROW2 VIP_MBPK_H_Table
	if(gVip_Table->SQM_calMpde[SQM_calMpde_index][2]==1){
    	color_mb_peaking_mb_peaking_hor_gain.mb_gain_neg = MBPK_TBL_forSQM[0]*(gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Neg)/1000;
    	color_mb_peaking_mb_peaking_hor_gain.mb_gain_pos = MBPK_TBL_forSQM[1]*(gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Pos)/1000;
    	color_mb_peaking_mb_peaking_hor_bound.mb_hv_neg =  MBPK_TBL_forSQM[2]*(gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_HV_Neg)/1000;
    	color_mb_peaking_mb_peaking_hor_bound.mb_hv_pos =  MBPK_TBL_forSQM[3]*(gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_HV_Pos)/1000; 
    	color_mb_peaking_mb_peaking_hor_gain_2.mb_d2_shift_bit =  MBPK_TBL_forSQM[4]*(gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_D2_shift_bit)/1000;
    	color_mb_peaking_mb_peaking_hor_gain_2.mb_gain_neg2 =     MBPK_TBL_forSQM[5]*(gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Neg2)/1000;
    	color_mb_peaking_mb_peaking_hor_gain_2.mb_gain_pos2 =     MBPK_TBL_forSQM[6]*(gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Pos2)/1000;
    	color_mb_peaking_mb_peaking_hor_gain_2.mb_lv =            MBPK_TBL_forSQM[7]*(gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_LV)/1000;
    	color_mb_peaking_mb_peaking_hor_gain_2.mb_lv2 =           MBPK_TBL_forSQM[8]*(gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_LV2)/1000;
	 }else{
    	color_mb_peaking_mb_peaking_hor_gain.mb_gain_neg = MBPK_TBL_forSQM[0] + gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Neg;
    	color_mb_peaking_mb_peaking_hor_gain.mb_gain_pos = MBPK_TBL_forSQM[1] + gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Pos; 
    	color_mb_peaking_mb_peaking_hor_bound.mb_hv_neg =  MBPK_TBL_forSQM[2] + gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_HV_Neg;
    	color_mb_peaking_mb_peaking_hor_bound.mb_hv_pos =  MBPK_TBL_forSQM[3] + gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_HV_Pos;
    	color_mb_peaking_mb_peaking_hor_gain_2.mb_d2_shift_bit =  MBPK_TBL_forSQM[4] + gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_D2_shift_bit;
    	color_mb_peaking_mb_peaking_hor_gain_2.mb_gain_neg2 =     MBPK_TBL_forSQM[5] + gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Neg2;
    	color_mb_peaking_mb_peaking_hor_gain_2.mb_gain_pos2 =     MBPK_TBL_forSQM[6] + gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Pos2;
    	color_mb_peaking_mb_peaking_hor_gain_2.mb_lv =            MBPK_TBL_forSQM[7] + gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_LV;
    	color_mb_peaking_mb_peaking_hor_gain_2.mb_lv2 =           MBPK_TBL_forSQM[8] + gVip_Table->MBPK_H_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_LV2;
     }


	//ROW4 VIP_MBPK_V_Table
	if(gVip_Table->SQM_calMpde[SQM_calMpde_index][3]==1){
    	color_mb_peaking_mb_peaking_ver_gain.mb_gain_neg_v = MBPK_TBL_forSQM[9] *(gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Neg_V)/1000;   
    	color_mb_peaking_mb_peaking_ver_gain.mb_gain_pos_v = MBPK_TBL_forSQM[10]*(gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Pos_V)/1000;   
    	color_mb_peaking_mb_peaking_ver_bound.mb_hv_neg_v =  MBPK_TBL_forSQM[11]*(gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_HV_Neg_V)/1000;   
    	color_mb_peaking_mb_peaking_ver_bound.mb_hv_pos_v =  MBPK_TBL_forSQM[12]*(gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_HV_Pos_V)/1000;    
    	color_mb_peaking_mb_peaking_ver_gain_2.mb_d2_shift_bit_v =MBPK_TBL_forSQM[13]*(gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_D2_shift_bit_V)/1000; 
    	color_mb_peaking_mb_peaking_ver_gain_2.mb_gain_neg2_v =   MBPK_TBL_forSQM[14]*(gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Neg2_V)/1000;  
    	color_mb_peaking_mb_peaking_ver_gain_2.mb_gain_pos2_v =   MBPK_TBL_forSQM[15]*(gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Pos2_V)/1000;  
    	color_mb_peaking_mb_peaking_ver_gain_2.mb_lv2_v =         MBPK_TBL_forSQM[16]*(gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_LV_V)/1000;  
    	color_mb_peaking_mb_peaking_ver_gain_2.mb_lv_v =          MBPK_TBL_forSQM[17]*(gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_LV2_V)/1000;  
    }else{
    	color_mb_peaking_mb_peaking_ver_gain.mb_gain_neg_v = MBPK_TBL_forSQM[9] + gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Neg_V;  
    	color_mb_peaking_mb_peaking_ver_gain.mb_gain_pos_v = MBPK_TBL_forSQM[10] + gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Pos_V;   
    	color_mb_peaking_mb_peaking_ver_bound.mb_hv_neg_v =  MBPK_TBL_forSQM[11] + gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_HV_Neg_V;   
    	color_mb_peaking_mb_peaking_ver_bound.mb_hv_pos_v =  MBPK_TBL_forSQM[12] + gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_HV_Pos_V;    
    	color_mb_peaking_mb_peaking_ver_gain_2.mb_d2_shift_bit_v =MBPK_TBL_forSQM[13] + gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_D2_shift_bit_V; 
    	color_mb_peaking_mb_peaking_ver_gain_2.mb_gain_neg2_v =   MBPK_TBL_forSQM[14] + gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Neg2_V; 
    	color_mb_peaking_mb_peaking_ver_gain_2.mb_gain_pos2_v =   MBPK_TBL_forSQM[15] + gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_Gain_Pos2_V; 
    	color_mb_peaking_mb_peaking_ver_gain_2.mb_lv2_v =         MBPK_TBL_forSQM[16] + gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_LV_V; 
    	color_mb_peaking_mb_peaking_ver_gain_2.mb_lv_v =          MBPK_TBL_forSQM[17] + gVip_Table->MBPK_V_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_LV2_V;

    }

	//Row11 VIP_MBPK_WEI_coring
	if(gVip_Table->SQM_calMpde[SQM_calMpde_index][4]==1){
    	color_mb_peaking_mb_snr_coring.mb_wei_coring0 =   MBPK_TBL_forSQM[18]*(gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring0)/1000;
    	color_mb_peaking_mb_wei_coring1.mb_wei_coring1 =  MBPK_TBL_forSQM[19]*(gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring1)/1000;
    	color_mb_peaking_mb_wei_coring1.mb_wei_coring2 =  MBPK_TBL_forSQM[20]*(gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring2)/1000;
    	color_mb_peaking_mb_wei_coring1.mb_wei_coring3 =  MBPK_TBL_forSQM[21]*(gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring3)/1000;
    	color_mb_peaking_mb_wei_coring1.mb_wei_coring4 =  MBPK_TBL_forSQM[22]*(gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring4)/1000;
    	color_mb_peaking_mb_wei_coring2.mb_wei_coring5 =  MBPK_TBL_forSQM[23]*(gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring5)/1000;
    	color_mb_peaking_mb_wei_coring2.mb_wei_coring6 =  MBPK_TBL_forSQM[24]*(gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring6)/1000;
    	color_mb_peaking_mb_wei_coring2.mb_wei_coring7 =  MBPK_TBL_forSQM[25]*(gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring7)/1000;
    	color_mb_peaking_mb_wei_coring2.mb_wei_coring8 =  MBPK_TBL_forSQM[26]*(gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring8)/1000;
    }else{
    	color_mb_peaking_mb_snr_coring.mb_wei_coring0 =   MBPK_TBL_forSQM[18] + gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring0;
    	color_mb_peaking_mb_wei_coring1.mb_wei_coring1 =  MBPK_TBL_forSQM[19] + gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring1;
    	color_mb_peaking_mb_wei_coring1.mb_wei_coring2 =  MBPK_TBL_forSQM[20] + gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring2;
    	color_mb_peaking_mb_wei_coring1.mb_wei_coring3 =  MBPK_TBL_forSQM[21] + gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring3;
    	color_mb_peaking_mb_wei_coring1.mb_wei_coring4 =  MBPK_TBL_forSQM[22] + gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring4;
    	color_mb_peaking_mb_wei_coring2.mb_wei_coring5 =  MBPK_TBL_forSQM[23] + gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring5;
    	color_mb_peaking_mb_wei_coring2.mb_wei_coring6 =  MBPK_TBL_forSQM[24] + gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring6;
    	color_mb_peaking_mb_wei_coring2.mb_wei_coring7 =  MBPK_TBL_forSQM[25] + gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring7;
    	color_mb_peaking_mb_wei_coring2.mb_wei_coring8 =  MBPK_TBL_forSQM[26] + gVip_Table->MBPK_WEI_SQM_offset_TBL[MBPK_idx][ai_resolution].MB_WEI_coring8;
    }
    
	IoReg_Write32(COLOR_MB_PEAKING_MB_PEAKING_Hor_GAIN_reg, color_mb_peaking_mb_peaking_hor_gain.regValue);
	IoReg_Write32(COLOR_MB_PEAKING_MB_PEAKING_Hor_BOUND_reg, color_mb_peaking_mb_peaking_hor_bound.regValue);
	IoReg_Write32(COLOR_MB_PEAKING_MB_PEAKING_Hor_GAIN_2_reg, color_mb_peaking_mb_peaking_hor_gain_2.regValue);
	IoReg_Write32(COLOR_MB_PEAKING_MB_PEAKING_Ver_GAIN_reg, color_mb_peaking_mb_peaking_ver_gain.regValue);
	IoReg_Write32(COLOR_MB_PEAKING_MB_PEAKING_Ver_BOUND_reg, color_mb_peaking_mb_peaking_ver_bound.regValue);
	IoReg_Write32(COLOR_MB_PEAKING_MB_PEAKING_Ver_GAIN_2_reg, color_mb_peaking_mb_peaking_ver_gain_2.regValue);
	IoReg_Write32(COLOR_MB_PEAKING_MB_SNR_CORING_reg, color_mb_peaking_mb_snr_coring.regValue);
	IoReg_Write32(COLOR_MB_PEAKING_MB_WEI_CORING1_reg, color_mb_peaking_mb_wei_coring1.regValue);
	IoReg_Write32(COLOR_MB_PEAKING_MB_WEI_CORING2_reg, color_mb_peaking_mb_wei_coring2.regValue);

	//Enable doublue buffer
	color_mb_peaking_mb_double_buffer_ctrl.regValue = IoReg_Read32(COLOR_MB_PEAKING_MB_Double_Buffer_CTRL_reg);
	color_mb_peaking_mb_double_buffer_ctrl.mb_db_en =1;
	color_mb_peaking_mb_double_buffer_ctrl.mb_db_apply =1;
	IoReg_Write32(COLOR_MB_PEAKING_MB_Double_Buffer_CTRL_reg, color_mb_peaking_mb_double_buffer_ctrl.regValue);
}

void fwif_color_set_MFLTI_applySQMoffset_table(unsigned char MFLTI_idx)
{
    SLR_VIP_TABLE *gVip_Table;
    static DRV_TwoStepSU_Mflti MFLTI_tbl;
     
    gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();

    if (gVip_Table == NULL) {
		rtd_pr_vpq_emerg("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}  
    
	MFLTI_tbl.mflti_en= MFLTI_TBL_forSQM[0];
 	MFLTI_tbl.blend_en=  MFLTI_TBL_forSQM[1];
   
	if(gVip_Table->SQM_calMpde[SQM_calMpde_index][1]==1){
    	MFLTI_tbl.blend_gain   =  MFLTI_TBL_forSQM[2]*(gVip_Table->MFLTI_SQM_offset_TBL[MFLTI_idx][ai_resolution].blend_gain)/1000;
    	MFLTI_tbl.blend_offset =  MFLTI_TBL_forSQM[3]*(gVip_Table->MFLTI_SQM_offset_TBL[MFLTI_idx][ai_resolution].blend_offset)/1000; 
    	MFLTI_tbl.h_range      =  MFLTI_TBL_forSQM[4]*(gVip_Table->MFLTI_SQM_offset_TBL[MFLTI_idx][ai_resolution].h_range)/1000;
	 }else{
    	MFLTI_tbl.blend_gain    =  MFLTI_TBL_forSQM[2] + gVip_Table->MFLTI_SQM_offset_TBL[MFLTI_idx][ai_resolution].blend_gain;
    	MFLTI_tbl.blend_offset  =  MFLTI_TBL_forSQM[3] + gVip_Table->MFLTI_SQM_offset_TBL[MFLTI_idx][ai_resolution].blend_offset;
    	MFLTI_tbl.h_range       =  MFLTI_TBL_forSQM[4] + gVip_Table->MFLTI_SQM_offset_TBL[MFLTI_idx][ai_resolution].h_range;
     }

    rtd_pr_vpq_emerg("sqm,%d,%d,%d\n",MFLTI_TBL_forSQM[2],MFLTI_TBL_forSQM[3],MFLTI_TBL_forSQM[4]);
    rtd_pr_vpq_emerg("sqm,%d,%d,%d\n",gVip_Table->MFLTI_SQM_offset_TBL[MFLTI_idx][ai_resolution].blend_gain,gVip_Table->MFLTI_SQM_offset_TBL[MFLTI_idx][ai_resolution].blend_offset,gVip_Table->MFLTI_SQM_offset_TBL[MFLTI_idx][ai_resolution].h_range);
    rtd_pr_vpq_emerg("sqm,blend_gain(%d),blend_offset(%d),h_range(%d)\n",MFLTI_tbl.blend_gain,MFLTI_tbl.blend_offset,MFLTI_tbl.h_range);
 
    if(MFLTI_tbl.blend_gain<=0)MFLTI_tbl.blend_gain=0;
    if(MFLTI_tbl.blend_gain>=31)MFLTI_tbl.blend_gain=31;
    if(MFLTI_tbl.blend_offset<=-32)MFLTI_tbl.blend_gain=-32;
    if(MFLTI_tbl.blend_offset>=31)MFLTI_tbl.blend_gain=31;
    if(MFLTI_tbl.h_range<=0)MFLTI_tbl.blend_gain=0;
    if(MFLTI_tbl.h_range>=4)MFLTI_tbl.blend_gain=3;   
    
	drvif_color_twostep_scaleup_mflti(&MFLTI_tbl);
}

void fwif_color_set_2DPK_applySQMoffset_table(unsigned char value)
{
	static DRV_Sharpness_Table sharp;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	if (value >= Sharp_table_num)
		value = 0;

	sharp.TwoD_Peak_AdaptCtrl.Peaking_Enable = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Peaking_Enable;
    sharp.TwoD_Peak_AdaptCtrl.Edge_Mode = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Edge_Mode;
	sharp.TwoD_Peak_AdaptCtrl.Sobel_Mode = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Sobel_Mode;
	sharp.TwoD_Peak_AdaptCtrl.Sobel_Upbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Sobel_Upbnd;
	sharp.TwoD_Peak_AdaptCtrl.Sobel_Stepbit = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Sobel_Stepbit;
	sharp.TwoD_Peak_AdaptCtrl.Zdiff_Upbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Zdiff_Upbnd;
	sharp.TwoD_Peak_AdaptCtrl.Zdiff_Stepbit = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Zdiff_Stepbit;
	sharp.TwoD_Peak_AdaptCtrl.Zigsftbit_Reg = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Zigsftbit_Reg;
	sharp.TwoD_Peak_AdaptCtrl.Tex_En = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Tex_En;
	sharp.TwoD_Peak_AdaptCtrl.Tex_Upbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Tex_Upbnd;
	sharp.TwoD_Peak_AdaptCtrl.Tex_Stepbit = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Tex_Stepbit;
	sharp.TwoD_Peak_AdaptCtrl.Actsftbit_Reg = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Actsftbit_Reg;
	sharp.TwoD_Peak_AdaptCtrl.Hpf_Vpf_Maxmin_En = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Hpf_Vpf_Maxmin_En;/*magellan2*/
	sharp.TwoD_Peak_AdaptCtrl.Src_Sel = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Src_Sel;/*magellan2*/
	sharp.TwoD_Peak_AdaptCtrl.Sobel_h= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.sobelrange_h;//merlin
	sharp.TwoD_Peak_AdaptCtrl.Sobel_v= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.sobelrange_v;//merlin
	sharp.TwoD_Peak_AdaptCtrl.Acts_offset= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.acts_offset;//merlin
	sharp.TwoD_Peak_AdaptCtrl.Edgextrange_v= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.edgextrange_v;//merlin
	sharp.TwoD_Peak_AdaptCtrl._5x5_h= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl._5x5_h;//merlin3
	sharp.TwoD_Peak_AdaptCtrl._5x5_v= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl._5x5_v;//merlin3
	sharp.TwoD_Peak_AdaptCtrl.Tex_Exclude_Smooth= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Tex_Exclude_Smooth;//merlin3
	sharp.TwoD_Peak_AdaptCtrl.Sobel_hspace= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Sobel_hspace;//merlin3
	sharp.TwoD_Peak_AdaptCtrl.Sobel_vspace= gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Sobel_vspace;//merlin3
	sharp.Edge_Shp.Edg_D2_Shift_Bit = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_set.Edg_D2_Shift_Bit;
	sharp.Edge_Shp.G_Neg2 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_set.G_Neg2;
	sharp.Edge_Shp.G_Pos2 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_set.G_Pos2;
	sharp.Edge_Shp.LV2 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_set.LV2;
	sharp.Texture_Shp.Edg_D2_Shift_Bit = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_set.Edg_D2_Shift_Bit;
	sharp.Texture_Shp.G_Neg2 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_set.G_Neg2;
	sharp.Texture_Shp.G_Pos2 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_set.G_Pos2;
	sharp.Texture_Shp.LV2 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_set.LV2;
	sharp.Vertical.C0 = gVip_Table->Ddomain_SHPTable[value].Vertical.C0;
	sharp.Vertical.C1 = gVip_Table->Ddomain_SHPTable[value].Vertical.C1;
	sharp.Vertical.C2 = gVip_Table->Ddomain_SHPTable[value].Vertical.C2;
	sharp.Vertical.C3 = gVip_Table->Ddomain_SHPTable[value].Vertical.C3;
	sharp.Vertical.C4 = gVip_Table->Ddomain_SHPTable[value].Vertical.C4;
	sharp.Vertical.Vext_Reg = gVip_Table->Ddomain_SHPTable[value].Vertical.Vext_Reg;
	sharp.Vertical.Vemf_En = gVip_Table->Ddomain_SHPTable[value].Vertical.Vemf_En;
	sharp.Vertical.en_tex = gVip_Table->Ddomain_SHPTable[value].Vertical.en_tex;
	sharp.Vertical.en_edg = gVip_Table->Ddomain_SHPTable[value].Vertical.en_edg;
	sharp.Vertical.V_Tex_en = gVip_Table->Ddomain_SHPTable[value].Vertical.V_Tex_en;
	sharp.Vertical.V_Dering_En = gVip_Table->Ddomain_SHPTable[value].Vertical.V_Dering_En;
	sharp.Vertical.G_Neg2 = gVip_Table->Ddomain_SHPTable[value].Vertical.G_Neg2;
	sharp.Vertical.G_Pos2 = gVip_Table->Ddomain_SHPTable[value].Vertical.G_Pos2;
	sharp.Vertical.LV2 = gVip_Table->Ddomain_SHPTable[value].Vertical.LV2;
	sharp.Vertical.enable_edge= gVip_Table->Ddomain_SHPTable[value].Vertical_edg.enable;//merlin
	sharp.Vertical.LV2_edge= gVip_Table->Ddomain_SHPTable[value].Vertical_edg.LV2;//merlin
	sharp.Vertical.G_Pos2_edge= gVip_Table->Ddomain_SHPTable[value].Vertical_edg.G_Pos2;//merlin
	sharp.Vertical.G_Neg2_edge= gVip_Table->Ddomain_SHPTable[value].Vertical_edg.G_Neg2;//merlin
	sharp.Edge_EMF_Table.EMF_En = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.EMF_En;
	sharp.Edge_EMF_Table.EMF_Shift = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.EMF_Shift;
	sharp.Edge_EMF_Table.Seg_0_Gain = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_0_Gain;
	sharp.Edge_EMF_Table.Seg_1_Gain = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_1_Gain;
	sharp.Edge_EMF_Table.Seg_2_Gain = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_2_Gain;
	sharp.Edge_EMF_Table.Seg_0_Offset = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_0_Offset;
	sharp.Edge_EMF_Table.Seg_1_Offset = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_1_Offset;
	sharp.Edge_EMF_Table.Seg_2_Offset = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_2_Offset;
	sharp.Edge_EMF_Table.emf_fixextent_neg = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.emf_fixextent_neg;
	sharp.Edge_EMF_Table.emf_fixextent_pos = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.emf_fixextent_pos;
	sharp.Edge_EMF_Table.Seg_0_x = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_0_x;
	sharp.Edge_EMF_Table.Seg_1_x = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Seg_1_x;
	sharp.Edge_EMF_Table.Blend_wt = gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.Blend_wt;
	sharp.Edge_EMF_Table.v5= gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.v5;
	sharp.Edge_EMF_Table.h11= gVip_Table->Ddomain_SHPTable[value].Edge_EMF_Table.h11;
	sharp.Text_EMF_Table.EMF_En = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.EMF_En;
	sharp.Text_EMF_Table.EMF_Shift = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.EMF_Shift;
	sharp.Text_EMF_Table.Seg_0_Gain = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_0_Gain;
	sharp.Text_EMF_Table.Seg_1_Gain = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_1_Gain;
	sharp.Text_EMF_Table.Seg_2_Gain = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_2_Gain;
	sharp.Text_EMF_Table.Seg_0_Offset = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_0_Offset;
	sharp.Text_EMF_Table.Seg_1_Offset = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_1_Offset;
	sharp.Text_EMF_Table.Seg_2_Offset = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_2_Offset;
	sharp.Text_EMF_Table.emf_fixextent_neg = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.emf_fixextent_neg;
	sharp.Text_EMF_Table.emf_fixextent_pos = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.emf_fixextent_pos;
	sharp.Text_EMF_Table.tex_share_v_enable = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.tex_share_v_enable;
	sharp.Text_EMF_Table.tex_share_v_blend_wt = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.tex_share_v_blend_wt;
	sharp.Text_EMF_Table.Seg_0_x = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_0_x;
	sharp.Text_EMF_Table.Seg_1_x = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Seg_1_x;
	sharp.Text_EMF_Table.Blend_wt = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.Blend_wt;
	sharp.Text_EMF_Table.v5 = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.v5;
	sharp.Text_EMF_Table.h11 = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.h11;
	sharp.Text_EMF_Table.EMF_texgain = gVip_Table->Ddomain_SHPTable[value].Texture_EMF_Table.EMF_texgain;
	sharp.MK3_Table.Tex_Filter_Sel = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl.Tex_Filter_Sel;
	sharp.MK3_Table.Edge_Filter_Sel = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.Edge_Filter_Sel;
	sharp.TwoD_Peak_AdaptCtrl.PkDlti_comsign = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.PkDlti_comsign;
	sharp.TwoD_Peak_AdaptCtrl.zdiffl_en = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.zdiffl_en;
	sharp.TwoD_Peak_AdaptCtrl.zdiffl_lowbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.zdiffl_lowbnd;
	sharp.TwoD_Peak_AdaptCtrl.zdiffl_stepbit = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.zdiffl_stepbit;
	sharp.TwoD_Peak_AdaptCtrl.edge_mono_en = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edge_mono_en;
	sharp.TwoD_Peak_AdaptCtrl.edge_mono_stepbit = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edge_mono_stepbit;
	sharp.TwoD_Peak_AdaptCtrl.edge_mono_stepbiu = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edge_mono_stepbiu;
	sharp.TwoD_Peak_AdaptCtrl.edge_mono_upbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edge_mono_upbnd;
	sharp.TwoD_Peak_AdaptCtrl.edge_mono_lowbnd = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.edge_mono_lowbnd;
	sharp.MK3_Table.Lpf2d_C0 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C0;
	sharp.MK3_Table.Lpf2d_C1 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C1;
	sharp.MK3_Table.Lpf2d_C2 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C2;
	sharp.MK3_Table.Lpf2d_C3 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C3;
	sharp.MK3_Table.Lpf2d_C4 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C4;
	sharp.MK3_Table.Lpf2d_C5 = gVip_Table->Ddomain_SHPTable[value].Mk3_Lpf.C5;
	sharp.MK3_Table.Lpf_Weit_0 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_0;
	sharp.MK3_Table.Lpf_Weit_1 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_1;
	sharp.MK3_Table.Lpf_Weit_2 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_2;
	sharp.MK3_Table.Lpf_Weit_3 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_3;
	sharp.MK3_Table.Lpf_Weit_4 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_4;
	sharp.MK3_Table.Lpf_Weit_5 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_5;
	sharp.MK3_Table.Lpf_Weit_6 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weit_6;
	sharp.MK3_Table.Lpf_Step_1 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_1;
	sharp.MK3_Table.Lpf_Step_2 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_2;
	sharp.MK3_Table.Lpf_Step_3 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_3;
	sharp.MK3_Table.Lpf_Step_4 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_4;
	sharp.MK3_Table.Lpf_Step_5 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_5;
	sharp.MK3_Table.Lpf_Step_6 = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Step_6;
	sharp.MK3_Table.Lpf_Weigh_En = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.Weigh_En;
	sharp.MK3_Table.lpf_weigh_tex_en = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.lpf_weigh_tex_en;
	sharp.MK3_Table.lpf_weigh_edg_en = gVip_Table->Ddomain_SHPTable[value].Max_Min_Lpf.lpf_weigh_edg_en;
	sharp.TwoD_edg.en_edg = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.en_edg;
	sharp.TwoD_edg.C0 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C0;
	sharp.TwoD_edg.C1 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C1;
	sharp.TwoD_edg.C2 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C2;
	sharp.TwoD_edg.C3 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C3;
	sharp.TwoD_edg.C4 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C4;
	sharp.TwoD_edg.C5 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C5;
	sharp.TwoD_edg.C6 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C6;
	sharp.TwoD_edg.C7 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C7;
	sharp.TwoD_edg.C8 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C8;
	sharp.TwoD_edg.C9 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C9;
	sharp.TwoD_edg.C10 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef1.C10;
	sharp.TwoD_edg.C0H1 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef2.C0;
	sharp.TwoD_edg.C0H2 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef3.C0;
	sharp.TwoD_edg.C0H3 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef4.C0;
	sharp.TwoD_edg.C0H4 = gVip_Table->Ddomain_SHPTable[value].Edge_Shp_coef5.C0;
	sharp.TwoD_tex.en_tex = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.en_tex;
	sharp.TwoD_tex.C0 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C0;
	sharp.TwoD_tex.C1 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C1;
	sharp.TwoD_tex.C2 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C2;
	sharp.TwoD_tex.C3 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C3;
	sharp.TwoD_tex.C4 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C4;
	sharp.TwoD_tex.C5 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C5;
	sharp.TwoD_tex.C6 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C6;
	sharp.TwoD_tex.C7 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C7;
	sharp.TwoD_tex.C8 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C8;
	sharp.TwoD_tex.C9 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C9;
	sharp.TwoD_tex.C10 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef1.C10;
	sharp.TwoD_tex.C0H1 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef2.C0;
	sharp.TwoD_tex.C0H2 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef3.C0;
	sharp.TwoD_tex.C0H3 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef4.C0;
	sharp.TwoD_tex.C0H4 = gVip_Table->Ddomain_SHPTable[value].Texture_Shp_coef5.C0;
	sharp.MK3_Table.EdgeCoring_En = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Coring_En;
	sharp.MK3_Table.EdgeCoring_Gain_En = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Gain_En;
	sharp.MK3_Table.EdgeCoring_DeltaEdge_Ulevel = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.DeltaEdge_Ulevel;
	sharp.MK3_Table.EdgeCoring_Clip = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Coring_Clip;
	sharp.MK3_Table.EdgeCoring_Gain_Bound = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Gain_Bound;
	sharp.MK3_Table.EdgeCoring_Ser_Range = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Ser_Range;
	sharp.MK3_Table.EdgeCoring_Bigedge_Ratio = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Bigedge_Ratio;
	sharp.MK3_Table.EdgeCoring_Smalledge_Ratio = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Smalledge_Ratio;
	sharp.MK3_Table.EdgeCoring_Deltaedge_Ratio = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Deltaedge_Ratio;
	sharp.MK3_Table.EdgeCoring_Smalledge_Ulevel = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Smalledge_Ulevel;
	sharp.MK3_Table.Edge_Text_blend_en = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.Edg_Tex_Blending_Lpf_En;
	sharp.MK3_Table.Edge_Text_blend_filter = gVip_Table->Ddomain_SHPTable[value].TwoD_Peak_AdaptCtrl2.Edg_Tex_Blending_Lpf_Filter;
	sharp.MK3_Table.Edge_Delta_Ext_Range = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.Edge_Delta_Ext_Range;/*magellan2*/
	sharp.MK3_Table.h_lvd_range = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.h_lvd_range;
	sharp.MK3_Table.h_lvd_gaim = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.h_lvd_gaim;
	sharp.MK3_Table.h_lvd_gain = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.h_lvd_gain;
	sharp.MK3_Table.v_lvd_range = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.v_lvd_range;
	sharp.MK3_Table.v_lvd_gaim = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.v_lvd_gaim;
	sharp.MK3_Table.v_lvd_gain = gVip_Table->Ddomain_SHPTable[value].Edge_Coring.v_lvd_gain;
	sharp.MK3_Table.LinearY_LB = gVip_Table->Ddomain_SHPTable[value].Y_Remap.LinearY_LB;
	sharp.MK3_Table.LinearY_UB = gVip_Table->Ddomain_SHPTable[value].Y_Remap.LinearY_UB;
	sharp.MK3_Table.LinearY_LM = gVip_Table->Ddomain_SHPTable[value].Y_Remap.LinearY_LM;
	sharp.MK3_Table.LinearY_UM = gVip_Table->Ddomain_SHPTable[value].Y_Remap.LinearY_UM;
	sharp.MK3_Table.Slope_gain_en = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.Slope_gain_en;
	sharp.MK3_Table.dir = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.dir;
	sharp.MK3_Table.flat_method = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_method;
	sharp.MK3_Table.Gain_boundPos = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.Gain_boundPos;
	sharp.MK3_Table.Gain_boundNeg = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.Gain_boundNeg;
	sharp.MK3_Table.Gain_extendPos = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.Gain_externdPos;
	sharp.MK3_Table.Gain_extendNeg = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.Gain_externdNeg;
	sharp.MK3_Table.flat_enable = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_enable;
	sharp.MK3_Table.flat_offset = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_offset;
	sharp.MK3_Table.flat_gain = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_gain;
	sharp.MK3_Table.Slope_gain_v_en = gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.v_slope_gain_en;//merlin
	sharp.MK3_Table.dir_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.dir_v;//merlin
	sharp.MK3_Table.Gain_boundPos_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.gain_boundpos_v;//merlin
	sharp.MK3_Table.Gain_boundNeg_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.gain_boundneg_v;//merlin
	sharp.MK3_Table.Gain_extendPos_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.gain_extendpos_v;//merlin
	sharp.MK3_Table.Gain_extendNeg_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.gain_extendneg_v;//merlin
	sharp.MK3_Table.flat_v_enable= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_v_enable;//merlin2
	sharp.MK3_Table.flat_offset_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_offset_v;//merlin2
	sharp.MK3_Table.flat_gain_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_gain_v;//merlin2
	sharp.MK3_Table.lowbound= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.lowbound;//merlin3
	sharp.MK3_Table.lowbound_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.lowbound_v;//merlin3
	sharp.MK3_Table.use_ramp= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.use_ramp;// 2020
	sharp.MK3_Table.extend2= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.extend2;//merlin3//juwen, delete
	sharp.MK3_Table.flat_range_h= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_range_h;//merlin3
	sharp.MK3_Table.flat_range_v= gVip_Table->Ddomain_SHPTable[value].Slope_gain_mask.flat_range_v;//merlin3
	/*magellan2 start*/
	sharp.Vertical.C3 = gVip_Table->Ddomain_SHPTable[value].Vertical.C3;
	sharp.Vertical.C4 = gVip_Table->Ddomain_SHPTable[value].Vertical.C4;
	sharp.After_Filter.C0 = gVip_Table->Ddomain_SHPTable[value].After_Filter.C0;
	sharp.After_Filter.C1 = gVip_Table->Ddomain_SHPTable[value].After_Filter.C1;
	sharp.After_Filter.C2 = gVip_Table->Ddomain_SHPTable[value].After_Filter.C2;
	sharp.After_Filter.C3 = gVip_Table->Ddomain_SHPTable[value].After_Filter.C3;
	sharp.After_Filter.C4 = gVip_Table->Ddomain_SHPTable[value].After_Filter.C4;
	sharp.After_Filter.HPF_Gain = gVip_Table->Ddomain_SHPTable[value].After_Filter.HPF_Gain;
	sharp.After_Filter.Mode = gVip_Table->Ddomain_SHPTable[value].After_Filter.Mode;
	sharp.After_Filter.Enable = gVip_Table->Ddomain_SHPTable[value].After_Filter.Enable;
	sharp.After_Filter.Rgblimit_pos= gVip_Table->Ddomain_SHPTable[value].After_Filter.Rgblimit_pos;
	sharp.After_Filter.Rgblimit_neg= gVip_Table->Ddomain_SHPTable[value].After_Filter.Rgblimit_neg;
	sharp.SR_H9.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_H9.en_tex;
	sharp.SR_H9.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_H9.en_edg;
	sharp.SR_H9.C0 = gVip_Table->Ddomain_SHPTable[value].SR_H9.C0;
	sharp.SR_H9.C1 = gVip_Table->Ddomain_SHPTable[value].SR_H9.C1;
	sharp.SR_H9.C2 = gVip_Table->Ddomain_SHPTable[value].SR_H9.C2;
	sharp.SR_H9.C3 = gVip_Table->Ddomain_SHPTable[value].SR_H9.C3;
	sharp.SR_H9.C4 = gVip_Table->Ddomain_SHPTable[value].SR_H9.C4;
	sharp.SR_H13.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_H13.en_tex;
	sharp.SR_H13.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_H13.en_edg;
	sharp.SR_H13.C0 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C0;
	sharp.SR_H13.C1 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C1;
	sharp.SR_H13.C2 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C2;
	sharp.SR_H13.C3 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C3;
	sharp.SR_H13.C4 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C4;
	sharp.SR_H13.C5 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C5;
	sharp.SR_H13.C6 = gVip_Table->Ddomain_SHPTable[value].SR_H13.C6;
	sharp.SR_H21.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_H21.en_tex;
	sharp.SR_H21.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_H21.en_edg;
	sharp.SR_H21.C0 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C0;
	sharp.SR_H21.C1 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C1;
	sharp.SR_H21.C2 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C2;
	sharp.SR_H21.C3 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C3;
	sharp.SR_H21.C4 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C4;
	sharp.SR_H21.C5 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C5;
	sharp.SR_H21.C6 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C6;
	sharp.SR_H21.C7 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C7;
	sharp.SR_H21.C8 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C8;
	sharp.SR_H21.C9 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C9;
	sharp.SR_H21.C10 = gVip_Table->Ddomain_SHPTable[value].SR_H21.C10;
	sharp.SR_V9_1.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.en_tex;
	sharp.SR_V9_1.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.en_edg;
	sharp.SR_V9_1.C0 = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.C0;
	sharp.SR_V9_1.C1 = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.C1;
	sharp.SR_V9_1.C2 = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.C2;
	sharp.SR_V9_1.C3 = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.C3;
	sharp.SR_V9_1.C4 = gVip_Table->Ddomain_SHPTable[value].SR_V9_1.C4;
	sharp.SR_V9_2.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.en_tex;
	sharp.SR_V9_2.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.en_edg;
	sharp.SR_V9_2.C0 = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.C0;
	sharp.SR_V9_2.C1 = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.C1;
	sharp.SR_V9_2.C2 = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.C2;
	sharp.SR_V9_2.C3 = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.C3;
	sharp.SR_V9_2.C4 = gVip_Table->Ddomain_SHPTable[value].SR_V9_2.C4;
	sharp.SR_V9_3.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.en_tex;
	sharp.SR_V9_3.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.en_edg;
	sharp.SR_V9_3.C0 = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.C0;
	sharp.SR_V9_3.C1 = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.C1;
	sharp.SR_V9_3.C2 = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.C2;
	sharp.SR_V9_3.C3 = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.C3;
	sharp.SR_V9_3.C4 = gVip_Table->Ddomain_SHPTable[value].SR_V9_3.C4;
	sharp.SR_Ring_H11.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.en_tex;
	sharp.SR_Ring_H11.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.en_edg;
	sharp.SR_Ring_H11.C0 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C0;
	sharp.SR_Ring_H11.C1 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C1;
	sharp.SR_Ring_H11.C2 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C2;
	sharp.SR_Ring_H11.C3 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C3;
	sharp.SR_Ring_H11.C4 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C4;
	sharp.SR_Ring_H11.C5 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C5;
	sharp.SR_Ring_H11.C0H0 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C0H0;
	sharp.SR_Ring_H11.C0H1 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C0H1;
	sharp.SR_Ring_H11.C0H2 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C0H2;
	sharp.SR_Ring_H11.C0H3 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_H11.C0H3;
	sharp.SR_Ring_V9.en_tex = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.en_tex;
	sharp.SR_Ring_V9.en_edg = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.en_edg;
	sharp.SR_Ring_V9.C0 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C0;
	sharp.SR_Ring_V9.C1 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C1;
	sharp.SR_Ring_V9.C2 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C2;
	sharp.SR_Ring_V9.C3 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C3;
	sharp.SR_Ring_V9.C4 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C4;
	sharp.SR_Ring_V9.C0H0 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C0H0;
	sharp.SR_Ring_V9.C0H1 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C0H1;
	sharp.SR_Ring_V9.C0H2 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C0H2;
	sharp.SR_Ring_V9.C0H3 = gVip_Table->Ddomain_SHPTable[value].SR_Ring_V9.C0H3;
	/*magellan2 end*/
	sharp.Sub_Gain_Modify.sub_index_en = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.sub_index_en;
	sharp.Sub_Gain_Modify.EDG.Gain_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.EDG_Gain_Pos;
	sharp.Sub_Gain_Modify.EDG.Gain_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.EDG_Gain_Neg;
	sharp.Sub_Gain_Modify.EDG.HV_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.EDG_HV_Pos;
	sharp.Sub_Gain_Modify.EDG.HV_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.EDG_HV_Neg;
	sharp.Sub_Gain_Modify.EDG.LV = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.EDG_LV;
	sharp.Sub_Gain_Modify.TEX.Gain_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.TEX_Gain_Pos;
	sharp.Sub_Gain_Modify.TEX.Gain_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.TEX_Gain_Neg;
	sharp.Sub_Gain_Modify.TEX.HV_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.TEX_HV_Pos;
	sharp.Sub_Gain_Modify.TEX.HV_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.TEX_HV_Neg;
	sharp.Sub_Gain_Modify.TEX.LV = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.TEX_LV;
	sharp.Sub_Gain_Modify.V.Gain_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_Gain_Pos;
	sharp.Sub_Gain_Modify.V.Gain_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_Gain_Neg;
	sharp.Sub_Gain_Modify.V.HV_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_HV_Pos;
	sharp.Sub_Gain_Modify.V.HV_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_HV_Neg;
	sharp.Sub_Gain_Modify.V.LV = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_LV;
	sharp.Sub_Gain_Modify.V_EDG.Gain_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_EDG_Gain_Pos;
	sharp.Sub_Gain_Modify.V_EDG.Gain_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_EDG_Gain_Neg;
	sharp.Sub_Gain_Modify.V_EDG.HV_Pos = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_EDG_HV_Pos;
	sharp.Sub_Gain_Modify.V_EDG.HV_Neg = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_EDG_HV_Neg;
	sharp.Sub_Gain_Modify.V_EDG.LV = gVip_Table->Ddomain_SHPTable[value].Sub_Gain_Modify.V_EDG_LV;
	sharp.Edge_SM.dirsm_rangh = gVip_Table->Ddomain_SHPTable[value].Edge_SM.dirsm_rangh;//merlin
	sharp.Edge_SM.dirsm_rangv= gVip_Table->Ddomain_SHPTable[value].Edge_SM.dirsm_rangv;//merlin
	sharp.Edge_SM.meandiff_rangeh= gVip_Table->Ddomain_SHPTable[value].Edge_SM.meandiff_rangeh;//merlin
	sharp.Edge_SM.meandiff_rangev= gVip_Table->Ddomain_SHPTable[value].Edge_SM.meandiff_rangev;//merlin
	sharp.Edge_SM.meandiff_shiftbit= gVip_Table->Ddomain_SHPTable[value].Edge_SM.meandiff_shiftbit;//merlin
	sharp.Edge_SM.meandiff_step= gVip_Table->Ddomain_SHPTable[value].Edge_SM.meandiff_step;//merlin
	sharp.Edge_SM.meandiff_lowbd= gVip_Table->Ddomain_SHPTable[value].Edge_SM.meandiff_lowbd;//merlin
	sharp.Edge_SM.edge_method_sel= gVip_Table->Ddomain_SHPTable[value].Edge_SM.edge_method_sel;//merlin
	sharp.Edge_SM.edgeindex_step= gVip_Table->Ddomain_SHPTable[value].Edge_SM.edgeindex_step;//merlin
	sharp.Edge_SM.edgeindex_lowbd= gVip_Table->Ddomain_SHPTable[value].Edge_SM.edgeindex_lowbd;//merlin
	sharp.SEGPK_ISE.ise_en = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_en;
	sharp.SEGPK_ISE.ise_step = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_step;
	sharp.SEGPK_ISE.ise_scale = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_scale;
	sharp.SEGPK_ISE.ise_ub = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_ub;
	sharp.SEGPK_ISE.ise_h_st = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_h_st;
	sharp.SEGPK_ISE.ise_h_end = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_h_end;
	sharp.SEGPK_ISE.ise_v_st = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_v_st;
	sharp.SEGPK_ISE.ise_v_end = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_v_end;
	sharp.SEGPK_ISE.ise_mul_max = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_mul_max;
	sharp.SEGPK_ISE.ise_mul_min = gVip_Table->Ddomain_SHPTable[value].SEGPK_ISE.ise_mul_min;
	sharp.Texture_Flat_Shp.en_tex= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef1.en_tex;
	sharp.Texture_Flat_Shp.C0= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef1.C0;
	sharp.Texture_Flat_Shp.C1= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef1.C1;
	sharp.Texture_Flat_Shp.C2= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef1.C2;
	sharp.Texture_Flat_Shp.C3= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef1.C3;
	sharp.Texture_Flat_Shp.C0H1= gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef2.C0;
	sharp.Texture_Flat_Shp.C0H2 = gVip_Table->Ddomain_SHPTable[value].Texture_Flat_Shp_coef3.C0;

    if(gVip_Table->SQM_calMpde[SQM_calMpde_index][5]==1){        
	sharp.TwoD_Peak_AdaptCtrl.Edgextrange   = TWODPK_TBL_forSQM[0] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].twoD_Peak_AdaptCtrl_Edgextrange)/1000;
	sharp.TwoD_Peak_AdaptCtrl.Small_thl     = TWODPK_TBL_forSQM[1] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].twoD_Peak_AdaptCtrl_small_th1)/1000;
	sharp.TwoD_Peak_AdaptCtrl.edg_dlti      = TWODPK_TBL_forSQM[2] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].twoD_Peak_AdaptCtrl2_edg_dlti)/1000;
	sharp.TwoD_Peak_AdaptCtrl.edg_dlti_tex  = TWODPK_TBL_forSQM[3] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].twoD_Peak_AdaptCtrl2_edg_dlti_tex)/1000;

    sharp.MK3_Table.MaxMin_Gain_0 =TWODPK_TBL_forSQM[4] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_0)/1000;
	sharp.MK3_Table.MaxMin_Gain_1 =TWODPK_TBL_forSQM[5] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_1)/1000;
	sharp.MK3_Table.MaxMin_Gain_2 =TWODPK_TBL_forSQM[6] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_2)/1000;
	sharp.MK3_Table.MaxMin_Gain_3 =TWODPK_TBL_forSQM[7] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_3)/1000;
	sharp.MK3_Table.MaxMin_Gain_4 =TWODPK_TBL_forSQM[8] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_4)/1000;
	sharp.MK3_Table.MaxMin_Gain_5 =TWODPK_TBL_forSQM[9] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_5)/1000;
	sharp.MK3_Table.MaxMin_Gain_6 =TWODPK_TBL_forSQM[10]*( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_6)/1000;
	sharp.MK3_Table.MaxMin_Step_1 =TWODPK_TBL_forSQM[11]*( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_1)/1000;
	sharp.MK3_Table.MaxMin_Step_2 =TWODPK_TBL_forSQM[12]*( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_2)/1000;
	sharp.MK3_Table.MaxMin_Step_3 =TWODPK_TBL_forSQM[13]*( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_3)/1000;
	sharp.MK3_Table.MaxMin_Step_4 =TWODPK_TBL_forSQM[14]*( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_4)/1000;
	sharp.MK3_Table.MaxMin_Step_5 =TWODPK_TBL_forSQM[15]*( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_5)/1000;
	sharp.MK3_Table.MaxMin_Step_6 =TWODPK_TBL_forSQM[16]*( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_6)/1000;


	sharp.MK3_Table.Gain_By_Y_Gain_0 =TWODPK_TBL_forSQM[21] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_0)/1000;
	sharp.MK3_Table.Gain_By_Y_Gain_1 =TWODPK_TBL_forSQM[22] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_1)/1000;
	sharp.MK3_Table.Gain_By_Y_Gain_2 =TWODPK_TBL_forSQM[23] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_2)/1000;
	sharp.MK3_Table.Gain_By_Y_Gain_3 =TWODPK_TBL_forSQM[24] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_3)/1000;
	sharp.MK3_Table.Gain_By_Y_Gain_4 =TWODPK_TBL_forSQM[25] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_4)/1000;
	sharp.MK3_Table.Gain_By_Y_Gain_5 =TWODPK_TBL_forSQM[26] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_5)/1000;
	sharp.MK3_Table.Gain_By_Y_Gain_6 =TWODPK_TBL_forSQM[27] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_6)/1000;
	sharp.MK3_Table.Gain_By_Y_Step_1 =TWODPK_TBL_forSQM[28] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_1)/1000;
	sharp.MK3_Table.Gain_By_Y_Step_2 =TWODPK_TBL_forSQM[29] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_2)/1000;
	sharp.MK3_Table.Gain_By_Y_Step_3 =TWODPK_TBL_forSQM[30] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_3)/1000;
	sharp.MK3_Table.Gain_By_Y_Step_4 =TWODPK_TBL_forSQM[31] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_4)/1000;
	sharp.MK3_Table.Gain_By_Y_Step_5 =TWODPK_TBL_forSQM[32] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_5)/1000;
	sharp.MK3_Table.Gain_By_Y_Step_6 =TWODPK_TBL_forSQM[33] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_6)/1000;

    sharp.Edge_Pos_Curve.G0 =TWODPK_TBL_forSQM[43] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G0)/1000;
	sharp.Edge_Pos_Curve.G1 =TWODPK_TBL_forSQM[44] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G1)/1000;
	sharp.Edge_Pos_Curve.G2 =TWODPK_TBL_forSQM[45] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G2)/1000;
	sharp.Edge_Pos_Curve.G3 =TWODPK_TBL_forSQM[46] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G3)/1000;
	sharp.Edge_Pos_Curve.G4 =TWODPK_TBL_forSQM[47] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G4)/1000;
	sharp.Edge_Pos_Curve.G5 =TWODPK_TBL_forSQM[48] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G5)/1000;
	sharp.Edge_Pos_Curve.G6 =TWODPK_TBL_forSQM[49] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G6)/1000;
	sharp.Edge_Pos_Curve.G7 =TWODPK_TBL_forSQM[50] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G7)/1000;
	sharp.Edge_Pos_Curve.G8 =TWODPK_TBL_forSQM[51] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G8)/1000;
	sharp.Edge_Pos_Curve.G9 =TWODPK_TBL_forSQM[52] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G9)/1000;
	sharp.Edge_Pos_Curve.G10 =TWODPK_TBL_forSQM[53] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G10)/1000;
	sharp.Edge_Pos_Curve.G11 =TWODPK_TBL_forSQM[54] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G11)/1000;
	sharp.Edge_Pos_Curve.G12 =TWODPK_TBL_forSQM[55] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G12)/1000;
	sharp.Edge_Pos_Curve.G13 =TWODPK_TBL_forSQM[56] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G13)/1000;
	sharp.Edge_Pos_Curve.G14 =TWODPK_TBL_forSQM[57] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G14)/1000;

	sharp.Edge_Pos_Curve.S1 =TWODPK_TBL_forSQM[58] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S1)/1000;
	sharp.Edge_Pos_Curve.S2 =TWODPK_TBL_forSQM[59] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S2)/1000;
	sharp.Edge_Pos_Curve.S3 =TWODPK_TBL_forSQM[60] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S3)/1000;
	sharp.Edge_Pos_Curve.S4 =TWODPK_TBL_forSQM[61] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S4)/1000;
	sharp.Edge_Pos_Curve.S5 =TWODPK_TBL_forSQM[62] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S5)/1000;
	sharp.Edge_Pos_Curve.S6 =TWODPK_TBL_forSQM[63] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S6)/1000;
	sharp.Edge_Pos_Curve.S7 =TWODPK_TBL_forSQM[64] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S7)/1000;
	sharp.Edge_Pos_Curve.S8 =TWODPK_TBL_forSQM[65] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S8)/1000;
	sharp.Edge_Pos_Curve.S9 =TWODPK_TBL_forSQM[66] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S9)/1000;
	sharp.Edge_Pos_Curve.S10 =TWODPK_TBL_forSQM[67] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S10)/1000;
	sharp.Edge_Pos_Curve.S11 =TWODPK_TBL_forSQM[68] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S11)/1000;
	sharp.Edge_Pos_Curve.S12 =TWODPK_TBL_forSQM[69] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S12)/1000;
	sharp.Edge_Pos_Curve.S13 =TWODPK_TBL_forSQM[70] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S13)/1000;
	sharp.Edge_Pos_Curve.S14 =TWODPK_TBL_forSQM[71] *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S14)/1000;    

    sharp.Edge_Neg_Curve.G0 =TWODPK_TBL_forSQM[72]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G0)/1000;
	sharp.Edge_Neg_Curve.G1 =TWODPK_TBL_forSQM[73]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G1)/1000;
	sharp.Edge_Neg_Curve.G2 =TWODPK_TBL_forSQM[74]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G2)/1000;
	sharp.Edge_Neg_Curve.G3 =TWODPK_TBL_forSQM[75]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G3)/1000;
	sharp.Edge_Neg_Curve.G4 =TWODPK_TBL_forSQM[76]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G4)/1000;
	sharp.Edge_Neg_Curve.G5 =TWODPK_TBL_forSQM[77]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G5)/1000;
	sharp.Edge_Neg_Curve.G6 =TWODPK_TBL_forSQM[78]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G6)/1000;
	sharp.Edge_Neg_Curve.G7 =TWODPK_TBL_forSQM[79]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G7)/1000;
	sharp.Edge_Neg_Curve.G8 =TWODPK_TBL_forSQM[80]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G8)/1000;
	sharp.Edge_Neg_Curve.G9 =TWODPK_TBL_forSQM[81]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G9)/1000;
	sharp.Edge_Neg_Curve.G10 =TWODPK_TBL_forSQM[82]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G10)/1000;
	sharp.Edge_Neg_Curve.G11 =TWODPK_TBL_forSQM[83]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G11)/1000;
	sharp.Edge_Neg_Curve.G12 =TWODPK_TBL_forSQM[84]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G12)/1000;
	sharp.Edge_Neg_Curve.G13 =TWODPK_TBL_forSQM[85]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G13)/1000;
	sharp.Edge_Neg_Curve.G14 =TWODPK_TBL_forSQM[86]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G14)/1000;

	sharp.Edge_Neg_Curve.S1 =TWODPK_TBL_forSQM[87]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S1)/1000;
	sharp.Edge_Neg_Curve.S2 =TWODPK_TBL_forSQM[88]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S2)/1000;
	sharp.Edge_Neg_Curve.S3 =TWODPK_TBL_forSQM[89]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S3)/1000;
	sharp.Edge_Neg_Curve.S4 =TWODPK_TBL_forSQM[90]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S4)/1000;
	sharp.Edge_Neg_Curve.S5 =TWODPK_TBL_forSQM[91]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S5)/1000;
	sharp.Edge_Neg_Curve.S6 =TWODPK_TBL_forSQM[92]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S6)/1000;
	sharp.Edge_Neg_Curve.S7 =TWODPK_TBL_forSQM[93]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S7)/1000;
	sharp.Edge_Neg_Curve.S8 =TWODPK_TBL_forSQM[94]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S8)/1000;
	sharp.Edge_Neg_Curve.S9 =TWODPK_TBL_forSQM[95]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S9)/1000;
	sharp.Edge_Neg_Curve.S10 =TWODPK_TBL_forSQM[96]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S10)/1000;
	sharp.Edge_Neg_Curve.S11 =TWODPK_TBL_forSQM[97]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S11)/1000;
	sharp.Edge_Neg_Curve.S12 =TWODPK_TBL_forSQM[98]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S12)/1000;
	sharp.Edge_Neg_Curve.S13 =TWODPK_TBL_forSQM[99]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S13)/1000;
	sharp.Edge_Neg_Curve.S14 =TWODPK_TBL_forSQM[100]  *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S14)/1000;

    sharp.Tex_Pos_Curve.G0 =TWODPK_TBL_forSQM[102] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G0)/1000;
	sharp.Tex_Pos_Curve.G1 =TWODPK_TBL_forSQM[103] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G1)/1000;
	sharp.Tex_Pos_Curve.G2 =TWODPK_TBL_forSQM[104] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G2)/1000;
	sharp.Tex_Pos_Curve.G3 =TWODPK_TBL_forSQM[105] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G3)/1000;
	sharp.Tex_Pos_Curve.G4 =TWODPK_TBL_forSQM[106] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G4)/1000;
	sharp.Tex_Pos_Curve.G5 =TWODPK_TBL_forSQM[107] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G5)/1000;
	sharp.Tex_Pos_Curve.G6 =TWODPK_TBL_forSQM[108] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G6)/1000;
	sharp.Tex_Pos_Curve.G7 =TWODPK_TBL_forSQM[109] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G7)/1000;
	sharp.Tex_Pos_Curve.G8 =TWODPK_TBL_forSQM[110] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G8)/1000;
	sharp.Tex_Pos_Curve.G9 =TWODPK_TBL_forSQM[111] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G9)/1000;
	sharp.Tex_Pos_Curve.G10 =TWODPK_TBL_forSQM[112] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G10)/1000;
	sharp.Tex_Pos_Curve.G11 =TWODPK_TBL_forSQM[113] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G11)/1000;
	sharp.Tex_Pos_Curve.G12 =TWODPK_TBL_forSQM[114] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G12)/1000;
	sharp.Tex_Pos_Curve.G13 =TWODPK_TBL_forSQM[115] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G13)/1000;
	sharp.Tex_Pos_Curve.G14 =TWODPK_TBL_forSQM[116] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G14)/1000;

	sharp.Tex_Pos_Curve.S1 =TWODPK_TBL_forSQM[117] * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S1)/1000;
	sharp.Tex_Pos_Curve.S2 =TWODPK_TBL_forSQM[118] * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S2)/1000;
	sharp.Tex_Pos_Curve.S3 =TWODPK_TBL_forSQM[119] * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S3)/1000;
	sharp.Tex_Pos_Curve.S4 =TWODPK_TBL_forSQM[120] * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S4)/1000;
	sharp.Tex_Pos_Curve.S5 =TWODPK_TBL_forSQM[121] * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S5)/1000;
	sharp.Tex_Pos_Curve.S6 =TWODPK_TBL_forSQM[122] * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S6)/1000;
	sharp.Tex_Pos_Curve.S7 =TWODPK_TBL_forSQM[123] * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S7)/1000;
	sharp.Tex_Pos_Curve.S8 =TWODPK_TBL_forSQM[124] * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S8)/1000;
	sharp.Tex_Pos_Curve.S9 =TWODPK_TBL_forSQM[125] * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S9)/1000;
	sharp.Tex_Pos_Curve.S10 =TWODPK_TBL_forSQM[126] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S10)/1000;
	sharp.Tex_Pos_Curve.S11 =TWODPK_TBL_forSQM[127] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S11)/1000;
	sharp.Tex_Pos_Curve.S12 =TWODPK_TBL_forSQM[128] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S12)/1000;
	sharp.Tex_Pos_Curve.S13 =TWODPK_TBL_forSQM[129] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S13)/1000;
	sharp.Tex_Pos_Curve.S14 =TWODPK_TBL_forSQM[130] * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S14)/1000;

    sharp.Tex_Neg_Curve.G0 =TWODPK_TBL_forSQM[131]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G0)/1000;
	sharp.Tex_Neg_Curve.G1 =TWODPK_TBL_forSQM[132]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G1)/1000;
	sharp.Tex_Neg_Curve.G2 =TWODPK_TBL_forSQM[133]   *(gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G2)/1000;
	sharp.Tex_Neg_Curve.G3 =TWODPK_TBL_forSQM[134]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G3)/1000;
	sharp.Tex_Neg_Curve.G4 =TWODPK_TBL_forSQM[135]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G4)/1000;
	sharp.Tex_Neg_Curve.G5 =TWODPK_TBL_forSQM[136]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G5)/1000;
	sharp.Tex_Neg_Curve.G6 =TWODPK_TBL_forSQM[137]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G6)/1000;
	sharp.Tex_Neg_Curve.G7 =TWODPK_TBL_forSQM[138]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G7)/1000;
	sharp.Tex_Neg_Curve.G8 =TWODPK_TBL_forSQM[139]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G8)/1000;
	sharp.Tex_Neg_Curve.G9 =TWODPK_TBL_forSQM[140]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G9)/1000;
	sharp.Tex_Neg_Curve.G10 =TWODPK_TBL_forSQM[141]   *(  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G10)/1000;
	sharp.Tex_Neg_Curve.G11 =TWODPK_TBL_forSQM[142]   *(  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G11)/1000;
	sharp.Tex_Neg_Curve.G12 =TWODPK_TBL_forSQM[143]   *(  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G12)/1000;
	sharp.Tex_Neg_Curve.G13 =TWODPK_TBL_forSQM[144]   *(  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G13)/1000;
	sharp.Tex_Neg_Curve.G14 =TWODPK_TBL_forSQM[145]   *(  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G14)/1000;

	sharp.Tex_Neg_Curve.S1 =TWODPK_TBL_forSQM[146]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S1)/1000;
	sharp.Tex_Neg_Curve.S2 =TWODPK_TBL_forSQM[147]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S2)/1000;
	sharp.Tex_Neg_Curve.S3 =TWODPK_TBL_forSQM[148]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S3)/1000;
	sharp.Tex_Neg_Curve.S4 =TWODPK_TBL_forSQM[149]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S4)/1000;
	sharp.Tex_Neg_Curve.S5 =TWODPK_TBL_forSQM[150]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S5)/1000;
	sharp.Tex_Neg_Curve.S6 =TWODPK_TBL_forSQM[151]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S6)/1000;
	sharp.Tex_Neg_Curve.S7 =TWODPK_TBL_forSQM[152]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S7)/1000;
	sharp.Tex_Neg_Curve.S8 =TWODPK_TBL_forSQM[153]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S8)/1000;
	sharp.Tex_Neg_Curve.S9 =TWODPK_TBL_forSQM[154]   *( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S9)/1000;
	sharp.Tex_Neg_Curve.S10 = TWODPK_TBL_forSQM[155]   *(  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S10)/1000;
	sharp.Tex_Neg_Curve.S11 = TWODPK_TBL_forSQM[156]   *(  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S11)/1000;
	sharp.Tex_Neg_Curve.S12 = TWODPK_TBL_forSQM[157]   *(  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S12)/1000;
	sharp.Tex_Neg_Curve.S13 = TWODPK_TBL_forSQM[158]   *(  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S13)/1000;
	sharp.Tex_Neg_Curve.S14 = TWODPK_TBL_forSQM[169]   *(  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S14)/1000;

    sharp.V_Pos_Curve.G0 =TWODPK_TBL_forSQM[170]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G0)/1000;
	sharp.V_Pos_Curve.G1 =TWODPK_TBL_forSQM[171]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G1)/1000;
	sharp.V_Pos_Curve.G2 =TWODPK_TBL_forSQM[172]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G2)/1000;
	sharp.V_Pos_Curve.G3 =TWODPK_TBL_forSQM[173]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G3)/1000;
	sharp.V_Pos_Curve.G4 =TWODPK_TBL_forSQM[174]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G4)/1000;
	sharp.V_Pos_Curve.G5 =TWODPK_TBL_forSQM[175]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G5)/1000;
	sharp.V_Pos_Curve.G6 =TWODPK_TBL_forSQM[176]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G6)/1000;
	sharp.V_Pos_Curve.G7 =TWODPK_TBL_forSQM[177]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G7)/1000;
	sharp.V_Pos_Curve.G8 =TWODPK_TBL_forSQM[178]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G8)/1000;
	sharp.V_Pos_Curve.G9 =TWODPK_TBL_forSQM[179]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G9)/1000;
	sharp.V_Pos_Curve.G10 =TWODPK_TBL_forSQM[180]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G10)/1000;
	sharp.V_Pos_Curve.G11 =TWODPK_TBL_forSQM[181]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G11)/1000;
	sharp.V_Pos_Curve.G12 =TWODPK_TBL_forSQM[182]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G12)/1000;
	sharp.V_Pos_Curve.G13 =TWODPK_TBL_forSQM[183]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G13)/1000;
	sharp.V_Pos_Curve.G14 =TWODPK_TBL_forSQM[184]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G14)/1000;

	sharp.V_Pos_Curve.S1 =TWODPK_TBL_forSQM[185]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S1)/1000;
	sharp.V_Pos_Curve.S2 =TWODPK_TBL_forSQM[186]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S2)/1000;
	sharp.V_Pos_Curve.S3 =TWODPK_TBL_forSQM[187]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S3)/1000;
	sharp.V_Pos_Curve.S4 =TWODPK_TBL_forSQM[188]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S4)/1000;
	sharp.V_Pos_Curve.S5 =TWODPK_TBL_forSQM[189]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S5)/1000;
	sharp.V_Pos_Curve.S6 =TWODPK_TBL_forSQM[190]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S6)/1000;
	sharp.V_Pos_Curve.S7 =TWODPK_TBL_forSQM[191]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S7)/1000;
	sharp.V_Pos_Curve.S8 =TWODPK_TBL_forSQM[192]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S8)/1000;
	sharp.V_Pos_Curve.S9 =TWODPK_TBL_forSQM[193]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S9)/1000;
	sharp.V_Pos_Curve.S10 =TWODPK_TBL_forSQM[194]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S10)/1000;
	sharp.V_Pos_Curve.S11 =TWODPK_TBL_forSQM[195]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S11)/1000;
	sharp.V_Pos_Curve.S12 =TWODPK_TBL_forSQM[196]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S12)/1000;
	sharp.V_Pos_Curve.S13 =TWODPK_TBL_forSQM[197]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S13)/1000;
	sharp.V_Pos_Curve.S14 =TWODPK_TBL_forSQM[198]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S14)/1000;

    sharp.V_Neg_Curve.G0 =TWODPK_TBL_forSQM[200]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G0)/1000;
	sharp.V_Neg_Curve.G1 =TWODPK_TBL_forSQM[201]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G1)/1000;
	sharp.V_Neg_Curve.G2 =TWODPK_TBL_forSQM[202]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G2)/1000;
	sharp.V_Neg_Curve.G3 =TWODPK_TBL_forSQM[203]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G3)/1000;
	sharp.V_Neg_Curve.G4 =TWODPK_TBL_forSQM[204]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G4)/1000;
	sharp.V_Neg_Curve.G5 =TWODPK_TBL_forSQM[205]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G5)/1000;
	sharp.V_Neg_Curve.G6 =TWODPK_TBL_forSQM[206]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G6)/1000;
	sharp.V_Neg_Curve.G7 =TWODPK_TBL_forSQM[207]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G7)/1000;
	sharp.V_Neg_Curve.G8 =TWODPK_TBL_forSQM[208]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G8)/1000;
	sharp.V_Neg_Curve.G9 =TWODPK_TBL_forSQM[209]   * (  gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G9)/1000;
	sharp.V_Neg_Curve.G10 =TWODPK_TBL_forSQM[210]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G10)/1000;
	sharp.V_Neg_Curve.G11 =TWODPK_TBL_forSQM[211]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G11)/1000;
	sharp.V_Neg_Curve.G12 =TWODPK_TBL_forSQM[212]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G12)/1000;
	sharp.V_Neg_Curve.G13 =TWODPK_TBL_forSQM[213]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G13)/1000;
	sharp.V_Neg_Curve.G14 =TWODPK_TBL_forSQM[214]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G14)/1000;

	sharp.V_Neg_Curve.S1 = TWODPK_TBL_forSQM[215]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S1)/1000;
	sharp.V_Neg_Curve.S2 = TWODPK_TBL_forSQM[216]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S2)/1000;
	sharp.V_Neg_Curve.S3 = TWODPK_TBL_forSQM[217]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S3)/1000;
	sharp.V_Neg_Curve.S4 = TWODPK_TBL_forSQM[218]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S4)/1000;
	sharp.V_Neg_Curve.S5 = TWODPK_TBL_forSQM[219]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S5)/1000;
	sharp.V_Neg_Curve.S6 = TWODPK_TBL_forSQM[220]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S6)/1000;
	sharp.V_Neg_Curve.S7 = TWODPK_TBL_forSQM[221]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S7)/1000;
	sharp.V_Neg_Curve.S8 = TWODPK_TBL_forSQM[222]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S8)/1000;
	sharp.V_Neg_Curve.S9 = TWODPK_TBL_forSQM[223]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S9)/1000;
	sharp.V_Neg_Curve.S10 = TWODPK_TBL_forSQM[224]   * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S10)/1000;
	sharp.V_Neg_Curve.S11 = TWODPK_TBL_forSQM[225]   * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S11)/1000;
	sharp.V_Neg_Curve.S12 = TWODPK_TBL_forSQM[226]   * (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S12)/1000;
	sharp.V_Neg_Curve.S13 = TWODPK_TBL_forSQM[227]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S13)/1000;
	sharp.V_Neg_Curve.S14 = TWODPK_TBL_forSQM[228]   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S14)/1000;

    sharp.SR_Control.Period         =TWODPK_TBL_forSQM[230];//   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].SR_Control.Period)/1000;
	sharp.SR_Control.Gain           =TWODPK_TBL_forSQM[231]* (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].SR_Control_Gain)/1000;
	sharp.SR_Control.Offset         =TWODPK_TBL_forSQM[232]* (gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].SR_Control_Offset)/1000;
	sharp.SR_Control.Ring_Gen_Gain  =TWODPK_TBL_forSQM[233];//   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].SR_Control.Ring_Gen_Gain)/1000;
	sharp.SR_Control.Ring_Gen       =TWODPK_TBL_forSQM[234];//   * ( gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].SR_Control.Ring_Gen)/1000;

    }else{        
	sharp.TwoD_Peak_AdaptCtrl.Edgextrange   = TWODPK_TBL_forSQM[0]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].twoD_Peak_AdaptCtrl_Edgextrange;
	sharp.TwoD_Peak_AdaptCtrl.Small_thl     = TWODPK_TBL_forSQM[1]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].twoD_Peak_AdaptCtrl_small_th1;
	sharp.TwoD_Peak_AdaptCtrl.edg_dlti      = TWODPK_TBL_forSQM[2]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].twoD_Peak_AdaptCtrl2_edg_dlti;
	sharp.TwoD_Peak_AdaptCtrl.edg_dlti_tex  = TWODPK_TBL_forSQM[3]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].twoD_Peak_AdaptCtrl2_edg_dlti_tex;

    sharp.MK3_Table.MaxMin_Gain_0 =TWODPK_TBL_forSQM[4]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_0;
	sharp.MK3_Table.MaxMin_Gain_1 =TWODPK_TBL_forSQM[5]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_1;
	sharp.MK3_Table.MaxMin_Gain_2 =TWODPK_TBL_forSQM[6]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_2;
	sharp.MK3_Table.MaxMin_Gain_3 =TWODPK_TBL_forSQM[7]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_3;
	sharp.MK3_Table.MaxMin_Gain_4 =TWODPK_TBL_forSQM[8]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_4;
	sharp.MK3_Table.MaxMin_Gain_5 =TWODPK_TBL_forSQM[9]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_5;
	sharp.MK3_Table.MaxMin_Gain_6 =TWODPK_TBL_forSQM[10]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Gain_6;
	sharp.MK3_Table.MaxMin_Step_1 =TWODPK_TBL_forSQM[11]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_1;
	sharp.MK3_Table.MaxMin_Step_2 =TWODPK_TBL_forSQM[12]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_2;
	sharp.MK3_Table.MaxMin_Step_3 =TWODPK_TBL_forSQM[13]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_3;
	sharp.MK3_Table.MaxMin_Step_4 =TWODPK_TBL_forSQM[14]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_4;
	sharp.MK3_Table.MaxMin_Step_5 =TWODPK_TBL_forSQM[15]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_5;
	sharp.MK3_Table.MaxMin_Step_6 =TWODPK_TBL_forSQM[16]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Max_Min_Gain.Step_6;


	sharp.MK3_Table.Gain_By_Y_Gain_0 =TWODPK_TBL_forSQM[21]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_0;
	sharp.MK3_Table.Gain_By_Y_Gain_1 =TWODPK_TBL_forSQM[22]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_1;
	sharp.MK3_Table.Gain_By_Y_Gain_2 =TWODPK_TBL_forSQM[23]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_2;
	sharp.MK3_Table.Gain_By_Y_Gain_3 =TWODPK_TBL_forSQM[24]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_3;
	sharp.MK3_Table.Gain_By_Y_Gain_4 =TWODPK_TBL_forSQM[25]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_4;
	sharp.MK3_Table.Gain_By_Y_Gain_5 =TWODPK_TBL_forSQM[26]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_5;
	sharp.MK3_Table.Gain_By_Y_Gain_6 =TWODPK_TBL_forSQM[27]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Gain_6;
	sharp.MK3_Table.Gain_By_Y_Step_1 =TWODPK_TBL_forSQM[28]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_1;
	sharp.MK3_Table.Gain_By_Y_Step_2 =TWODPK_TBL_forSQM[29]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_2;
	sharp.MK3_Table.Gain_By_Y_Step_3 =TWODPK_TBL_forSQM[30]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_3;
	sharp.MK3_Table.Gain_By_Y_Step_4 =TWODPK_TBL_forSQM[31]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_4;
	sharp.MK3_Table.Gain_By_Y_Step_5 =TWODPK_TBL_forSQM[32]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_5;
	sharp.MK3_Table.Gain_By_Y_Step_6 =TWODPK_TBL_forSQM[33]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Gain_By_Y.Step_6;

    sharp.Edge_Pos_Curve.G0 =TWODPK_TBL_forSQM[43]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G0;
	sharp.Edge_Pos_Curve.G1 =TWODPK_TBL_forSQM[44]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G1;
	sharp.Edge_Pos_Curve.G2 =TWODPK_TBL_forSQM[45]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G2;
	sharp.Edge_Pos_Curve.G3 =TWODPK_TBL_forSQM[46]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G3;
	sharp.Edge_Pos_Curve.G4 =TWODPK_TBL_forSQM[47]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G4;
	sharp.Edge_Pos_Curve.G5 =TWODPK_TBL_forSQM[48]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G5;
	sharp.Edge_Pos_Curve.G6 =TWODPK_TBL_forSQM[49]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G6;
	sharp.Edge_Pos_Curve.G7 =TWODPK_TBL_forSQM[50]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G7;
	sharp.Edge_Pos_Curve.G8 =TWODPK_TBL_forSQM[51]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G8;
	sharp.Edge_Pos_Curve.G9 =TWODPK_TBL_forSQM[52]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G9;
	sharp.Edge_Pos_Curve.G10 =TWODPK_TBL_forSQM[53]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G10;
	sharp.Edge_Pos_Curve.G11 =TWODPK_TBL_forSQM[54]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G11;
	sharp.Edge_Pos_Curve.G12 =TWODPK_TBL_forSQM[55]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G12;
	sharp.Edge_Pos_Curve.G13 =TWODPK_TBL_forSQM[56]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G13;
	sharp.Edge_Pos_Curve.G14 =TWODPK_TBL_forSQM[57]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.G14;

	sharp.Edge_Pos_Curve.S1 =TWODPK_TBL_forSQM[58]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S1;
	sharp.Edge_Pos_Curve.S2 =TWODPK_TBL_forSQM[59]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S2;
	sharp.Edge_Pos_Curve.S3 =TWODPK_TBL_forSQM[60]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S3;
	sharp.Edge_Pos_Curve.S4 =TWODPK_TBL_forSQM[61]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S4;
	sharp.Edge_Pos_Curve.S5 =TWODPK_TBL_forSQM[62]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S5;
	sharp.Edge_Pos_Curve.S6 =TWODPK_TBL_forSQM[63]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S6;
	sharp.Edge_Pos_Curve.S7 =TWODPK_TBL_forSQM[64]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S7;
	sharp.Edge_Pos_Curve.S8 =TWODPK_TBL_forSQM[65]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S8;
	sharp.Edge_Pos_Curve.S9 =TWODPK_TBL_forSQM[66]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S9;
	sharp.Edge_Pos_Curve.S10 =TWODPK_TBL_forSQM[67]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S10;
	sharp.Edge_Pos_Curve.S11 =TWODPK_TBL_forSQM[68]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S11;
	sharp.Edge_Pos_Curve.S12 =TWODPK_TBL_forSQM[69]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S12;
	sharp.Edge_Pos_Curve.S13 =TWODPK_TBL_forSQM[70]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S13;
	sharp.Edge_Pos_Curve.S14 =TWODPK_TBL_forSQM[71]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Pos_Curve.S14;    

    sharp.Edge_Neg_Curve.G0 =TWODPK_TBL_forSQM[72]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G0;
	sharp.Edge_Neg_Curve.G1 =TWODPK_TBL_forSQM[73]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G1;
	sharp.Edge_Neg_Curve.G2 =TWODPK_TBL_forSQM[74]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G2;
	sharp.Edge_Neg_Curve.G3 =TWODPK_TBL_forSQM[75]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G3;
	sharp.Edge_Neg_Curve.G4 =TWODPK_TBL_forSQM[76]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G4;
	sharp.Edge_Neg_Curve.G5 =TWODPK_TBL_forSQM[77]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G5;
	sharp.Edge_Neg_Curve.G6 =TWODPK_TBL_forSQM[78]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G6;
	sharp.Edge_Neg_Curve.G7 =TWODPK_TBL_forSQM[79]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G7;
	sharp.Edge_Neg_Curve.G8 =TWODPK_TBL_forSQM[80]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G8;
	sharp.Edge_Neg_Curve.G9 =TWODPK_TBL_forSQM[81]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G9;
	sharp.Edge_Neg_Curve.G10 =TWODPK_TBL_forSQM[82]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G10;
	sharp.Edge_Neg_Curve.G11 =TWODPK_TBL_forSQM[83]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G11;
	sharp.Edge_Neg_Curve.G12 =TWODPK_TBL_forSQM[84]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G12;
	sharp.Edge_Neg_Curve.G13 =TWODPK_TBL_forSQM[85]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G13;
	sharp.Edge_Neg_Curve.G14 =TWODPK_TBL_forSQM[86]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.G14;

	sharp.Edge_Neg_Curve.S1 =TWODPK_TBL_forSQM[87]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S1;
	sharp.Edge_Neg_Curve.S2 =TWODPK_TBL_forSQM[88]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S2;
	sharp.Edge_Neg_Curve.S3 =TWODPK_TBL_forSQM[89]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S3;
	sharp.Edge_Neg_Curve.S4 =TWODPK_TBL_forSQM[90]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S4;
	sharp.Edge_Neg_Curve.S5 =TWODPK_TBL_forSQM[91]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S5;
	sharp.Edge_Neg_Curve.S6 =TWODPK_TBL_forSQM[92]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S6;
	sharp.Edge_Neg_Curve.S7 =TWODPK_TBL_forSQM[93]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S7;
	sharp.Edge_Neg_Curve.S8 =TWODPK_TBL_forSQM[94]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S8;
	sharp.Edge_Neg_Curve.S9 =TWODPK_TBL_forSQM[95]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S9;
	sharp.Edge_Neg_Curve.S10 =TWODPK_TBL_forSQM[96]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S10;
	sharp.Edge_Neg_Curve.S11 =TWODPK_TBL_forSQM[97]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S11;
	sharp.Edge_Neg_Curve.S12 =TWODPK_TBL_forSQM[98]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S12;
	sharp.Edge_Neg_Curve.S13 =TWODPK_TBL_forSQM[99]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S13;
	sharp.Edge_Neg_Curve.S14 =TWODPK_TBL_forSQM[100] +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Edge_Neg_Curve.S14;

    sharp.Tex_Pos_Curve.G0 =TWODPK_TBL_forSQM[102]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G0;
	sharp.Tex_Pos_Curve.G1 =TWODPK_TBL_forSQM[103]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G1;
	sharp.Tex_Pos_Curve.G2 =TWODPK_TBL_forSQM[104]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G2;
	sharp.Tex_Pos_Curve.G3 =TWODPK_TBL_forSQM[105]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G3;
	sharp.Tex_Pos_Curve.G4 =TWODPK_TBL_forSQM[106]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G4;
	sharp.Tex_Pos_Curve.G5 =TWODPK_TBL_forSQM[107]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G5;
	sharp.Tex_Pos_Curve.G6 =TWODPK_TBL_forSQM[108]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G6;
	sharp.Tex_Pos_Curve.G7 =TWODPK_TBL_forSQM[109]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G7;
	sharp.Tex_Pos_Curve.G8 =TWODPK_TBL_forSQM[110]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G8;
	sharp.Tex_Pos_Curve.G9 =TWODPK_TBL_forSQM[111]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G9;
	sharp.Tex_Pos_Curve.G10 =TWODPK_TBL_forSQM[112]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G10;
	sharp.Tex_Pos_Curve.G11 =TWODPK_TBL_forSQM[113]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G11;
	sharp.Tex_Pos_Curve.G12 =TWODPK_TBL_forSQM[114]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G12;
	sharp.Tex_Pos_Curve.G13 =TWODPK_TBL_forSQM[115]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G13;
	sharp.Tex_Pos_Curve.G14 =TWODPK_TBL_forSQM[116]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.G14;

	sharp.Tex_Pos_Curve.S1 =TWODPK_TBL_forSQM[117] +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S1;
	sharp.Tex_Pos_Curve.S2 =TWODPK_TBL_forSQM[118] +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S2;
	sharp.Tex_Pos_Curve.S3 =TWODPK_TBL_forSQM[119] +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S3;
	sharp.Tex_Pos_Curve.S4 =TWODPK_TBL_forSQM[120] +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S4;
	sharp.Tex_Pos_Curve.S5 =TWODPK_TBL_forSQM[121] +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S5;
	sharp.Tex_Pos_Curve.S6 =TWODPK_TBL_forSQM[122] +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S6;
	sharp.Tex_Pos_Curve.S7 =TWODPK_TBL_forSQM[123] +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S7;
	sharp.Tex_Pos_Curve.S8 =TWODPK_TBL_forSQM[124] +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S8;
	sharp.Tex_Pos_Curve.S9 =TWODPK_TBL_forSQM[125] +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S9;
	sharp.Tex_Pos_Curve.S10 =TWODPK_TBL_forSQM[126]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S10;
	sharp.Tex_Pos_Curve.S11 =TWODPK_TBL_forSQM[127]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S11;
	sharp.Tex_Pos_Curve.S12 =TWODPK_TBL_forSQM[128]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S12;
	sharp.Tex_Pos_Curve.S13 =TWODPK_TBL_forSQM[129]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S13;
	sharp.Tex_Pos_Curve.S14 =TWODPK_TBL_forSQM[130]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Pos_Curve.S14;

    sharp.Tex_Neg_Curve.G0 =TWODPK_TBL_forSQM[131]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G0;
	sharp.Tex_Neg_Curve.G1 =TWODPK_TBL_forSQM[132]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G1;
	sharp.Tex_Neg_Curve.G2 =TWODPK_TBL_forSQM[133]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G2;
	sharp.Tex_Neg_Curve.G3 =TWODPK_TBL_forSQM[134]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G3;
	sharp.Tex_Neg_Curve.G4 =TWODPK_TBL_forSQM[135]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G4;
	sharp.Tex_Neg_Curve.G5 =TWODPK_TBL_forSQM[136]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G5;
	sharp.Tex_Neg_Curve.G6 =TWODPK_TBL_forSQM[137]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G6;
	sharp.Tex_Neg_Curve.G7 =TWODPK_TBL_forSQM[138]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G7;
	sharp.Tex_Neg_Curve.G8 =TWODPK_TBL_forSQM[139]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G8;
	sharp.Tex_Neg_Curve.G9 =TWODPK_TBL_forSQM[140]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G9;
	sharp.Tex_Neg_Curve.G10 =TWODPK_TBL_forSQM[141]  + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G10;
	sharp.Tex_Neg_Curve.G11 =TWODPK_TBL_forSQM[142]  + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G11;
	sharp.Tex_Neg_Curve.G12 =TWODPK_TBL_forSQM[143]  + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G12;
	sharp.Tex_Neg_Curve.G13 =TWODPK_TBL_forSQM[144]  + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G13;
	sharp.Tex_Neg_Curve.G14 =TWODPK_TBL_forSQM[145]  + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.G14;

	sharp.Tex_Neg_Curve.S1 =TWODPK_TBL_forSQM[146]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S1;
	sharp.Tex_Neg_Curve.S2 =TWODPK_TBL_forSQM[147]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S2;
	sharp.Tex_Neg_Curve.S3 =TWODPK_TBL_forSQM[148]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S3;
	sharp.Tex_Neg_Curve.S4 =TWODPK_TBL_forSQM[149]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S4;
	sharp.Tex_Neg_Curve.S5 =TWODPK_TBL_forSQM[150]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S5;
	sharp.Tex_Neg_Curve.S6 =TWODPK_TBL_forSQM[151]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S6;
	sharp.Tex_Neg_Curve.S7 =TWODPK_TBL_forSQM[152]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S7;
	sharp.Tex_Neg_Curve.S8 =TWODPK_TBL_forSQM[153]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S8;
	sharp.Tex_Neg_Curve.S9 =TWODPK_TBL_forSQM[154]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S9;
	sharp.Tex_Neg_Curve.S10 = TWODPK_TBL_forSQM[155]  + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S10;
	sharp.Tex_Neg_Curve.S11 = TWODPK_TBL_forSQM[156]  + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S11;
	sharp.Tex_Neg_Curve.S12 = TWODPK_TBL_forSQM[157]  + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S12;
	sharp.Tex_Neg_Curve.S13 = TWODPK_TBL_forSQM[158]  + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S13;
	sharp.Tex_Neg_Curve.S14 = TWODPK_TBL_forSQM[169]  + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].Tex_Neg_Curve.S14;

    sharp.V_Pos_Curve.G0 =TWODPK_TBL_forSQM[170]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G0;
	sharp.V_Pos_Curve.G1 =TWODPK_TBL_forSQM[171]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G1;
	sharp.V_Pos_Curve.G2 =TWODPK_TBL_forSQM[172]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G2;
	sharp.V_Pos_Curve.G3 =TWODPK_TBL_forSQM[173]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G3;
	sharp.V_Pos_Curve.G4 =TWODPK_TBL_forSQM[174]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G4;
	sharp.V_Pos_Curve.G5 =TWODPK_TBL_forSQM[175]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G5;
	sharp.V_Pos_Curve.G6 =TWODPK_TBL_forSQM[176]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G6;
	sharp.V_Pos_Curve.G7 =TWODPK_TBL_forSQM[177]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G7;
	sharp.V_Pos_Curve.G8 =TWODPK_TBL_forSQM[178]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G8;
	sharp.V_Pos_Curve.G9 =TWODPK_TBL_forSQM[179]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G9;
	sharp.V_Pos_Curve.G10 =TWODPK_TBL_forSQM[180]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G10;
	sharp.V_Pos_Curve.G11 =TWODPK_TBL_forSQM[181]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G11;
	sharp.V_Pos_Curve.G12 =TWODPK_TBL_forSQM[182]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G12;
	sharp.V_Pos_Curve.G13 =TWODPK_TBL_forSQM[183]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G13;
	sharp.V_Pos_Curve.G14 =TWODPK_TBL_forSQM[184]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.G14;

	sharp.V_Pos_Curve.S1 =TWODPK_TBL_forSQM[185]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S1;
	sharp.V_Pos_Curve.S2 =TWODPK_TBL_forSQM[186]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S2;
	sharp.V_Pos_Curve.S3 =TWODPK_TBL_forSQM[187]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S3;
	sharp.V_Pos_Curve.S4 =TWODPK_TBL_forSQM[188]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S4;
	sharp.V_Pos_Curve.S5 =TWODPK_TBL_forSQM[189]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S5;
	sharp.V_Pos_Curve.S6 =TWODPK_TBL_forSQM[190]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S6;
	sharp.V_Pos_Curve.S7 =TWODPK_TBL_forSQM[191]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S7;
	sharp.V_Pos_Curve.S8 =TWODPK_TBL_forSQM[192]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S8;
	sharp.V_Pos_Curve.S9 =TWODPK_TBL_forSQM[193]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S9;
	sharp.V_Pos_Curve.S10 =TWODPK_TBL_forSQM[194]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S10;
	sharp.V_Pos_Curve.S11 =TWODPK_TBL_forSQM[195]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S11;
	sharp.V_Pos_Curve.S12 =TWODPK_TBL_forSQM[196]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S12;
	sharp.V_Pos_Curve.S13 =TWODPK_TBL_forSQM[197]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S13;
	sharp.V_Pos_Curve.S14 =TWODPK_TBL_forSQM[198]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Pos_Curve.S14;

    sharp.V_Neg_Curve.G0 =TWODPK_TBL_forSQM[200]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G0;
	sharp.V_Neg_Curve.G1 =TWODPK_TBL_forSQM[201]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G1;
	sharp.V_Neg_Curve.G2 =TWODPK_TBL_forSQM[202]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G2;
	sharp.V_Neg_Curve.G3 =TWODPK_TBL_forSQM[203]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G3;
	sharp.V_Neg_Curve.G4 =TWODPK_TBL_forSQM[204]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G4;
	sharp.V_Neg_Curve.G5 =TWODPK_TBL_forSQM[205]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G5;
	sharp.V_Neg_Curve.G6 =TWODPK_TBL_forSQM[206]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G6;
	sharp.V_Neg_Curve.G7 =TWODPK_TBL_forSQM[207]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G7;
	sharp.V_Neg_Curve.G8 =TWODPK_TBL_forSQM[208]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G8;
	sharp.V_Neg_Curve.G9 =TWODPK_TBL_forSQM[209]   + gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G9;
	sharp.V_Neg_Curve.G10 =TWODPK_TBL_forSQM[210]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G10;
	sharp.V_Neg_Curve.G11 =TWODPK_TBL_forSQM[211]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G11;
	sharp.V_Neg_Curve.G12 =TWODPK_TBL_forSQM[212]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G12;
	sharp.V_Neg_Curve.G13 =TWODPK_TBL_forSQM[213]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G13;
	sharp.V_Neg_Curve.G14 =TWODPK_TBL_forSQM[214]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.G14;

	sharp.V_Neg_Curve.S1 = TWODPK_TBL_forSQM[215]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S1;
	sharp.V_Neg_Curve.S2 = TWODPK_TBL_forSQM[216]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S2;
	sharp.V_Neg_Curve.S3 = TWODPK_TBL_forSQM[217]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S3;
	sharp.V_Neg_Curve.S4 = TWODPK_TBL_forSQM[218]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S4;
	sharp.V_Neg_Curve.S5 = TWODPK_TBL_forSQM[219]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S5;
	sharp.V_Neg_Curve.S6 = TWODPK_TBL_forSQM[220]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S6;
	sharp.V_Neg_Curve.S7 = TWODPK_TBL_forSQM[221]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S7;
	sharp.V_Neg_Curve.S8 = TWODPK_TBL_forSQM[222]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S8;
	sharp.V_Neg_Curve.S9 = TWODPK_TBL_forSQM[223]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S9;
	sharp.V_Neg_Curve.S10 = TWODPK_TBL_forSQM[224]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S10;
	sharp.V_Neg_Curve.S11 = TWODPK_TBL_forSQM[225]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S11;
	sharp.V_Neg_Curve.S12 = TWODPK_TBL_forSQM[226]  +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S12;
	sharp.V_Neg_Curve.S13 = TWODPK_TBL_forSQM[227]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S13;
	sharp.V_Neg_Curve.S14 = TWODPK_TBL_forSQM[228]   +gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].V_Neg_Curve.S14;

    sharp.SR_Control.Period         =TWODPK_TBL_forSQM[230];
	sharp.SR_Control.Gain           =TWODPK_TBL_forSQM[231]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].SR_Control_Gain;
	sharp.SR_Control.Offset         =TWODPK_TBL_forSQM[232]+gVip_Table->twoD_Peaking_SQM_offset_TBL[value][ai_resolution].SR_Control_Offset;
	sharp.SR_Control.Ring_Gen_Gain  =TWODPK_TBL_forSQM[233];
	sharp.SR_Control.Ring_Gen       =TWODPK_TBL_forSQM[234];

    }
    
    //enabel-----------------------------------------------------
	sharp.MK3_Table.MaxMin_Gain_En      =TWODPK_TBL_forSQM[17];
	sharp.MK3_Table.max_min_gain_tex_en =TWODPK_TBL_forSQM[18];
	sharp.MK3_Table.max_min_gain_edg_en =TWODPK_TBL_forSQM[19];
	sharp.MK3_Table.max_min_gain_v_en   =TWODPK_TBL_forSQM[20];    
	sharp.MK3_Table.Gain_By_Y_En        = TWODPK_TBL_forSQM[34];
	sharp.MK3_Table.gain_by_y_tex_en    = TWODPK_TBL_forSQM[35];
	sharp.MK3_Table.gain_by_y_edg_en    = TWODPK_TBL_forSQM[36];
	sharp.MK3_Table.gain_by_y_v_en      = TWODPK_TBL_forSQM[37];
	sharp.MK3_Table.lv_by_y_enable      = TWODPK_TBL_forSQM[38];
	sharp.MK3_Table.lv_by_y_tex_enable  = TWODPK_TBL_forSQM[39];
	sharp.MK3_Table.lv_by_y_edg_enable  = TWODPK_TBL_forSQM[40];
	sharp.MK3_Table.lv_by_y_v_enable    = TWODPK_TBL_forSQM[41];
	sharp.MK3_Table.lv_by_y_v_edg_enable= TWODPK_TBL_forSQM[42];
    sharp.Edge_Neg_Curve.enable         = TWODPK_TBL_forSQM[101];    
    sharp.Tex_Neg_Curve.enable          = TWODPK_TBL_forSQM[209];
    sharp.V_Pos_Curve.edg_curve_bypass  = TWODPK_TBL_forSQM[199];
    sharp.V_Neg_Curve.enable            = TWODPK_TBL_forSQM[229]; 
    sharp.SR_Control.sr_detail_tex_en   = TWODPK_TBL_forSQM[235];
    sharp.SR_Control.sr_detail_edg_en   = TWODPK_TBL_forSQM[236];
    sharp.SR_Control.sr_detail_v_tex_en = TWODPK_TBL_forSQM[237];
    sharp.SR_Control.sr_detail_v_edg_en = TWODPK_TBL_forSQM[238];
    
    //---------------------------------------------------------------

    
	memcpy(&(sharp.Ramp_H),&(gVip_Table->Ddomain_SHPTable[value].Ramp_H),sizeof(VIP_SEGPK_RAMP));
	memcpy(&(sharp.Ramp_V),&(gVip_Table->Ddomain_SHPTable[value].Ramp_V),sizeof(VIP_SEGPK_RAMP));
	memcpy(&(sharp.SR_X),&(gVip_Table->Ddomain_SHPTable[value].SR_X),sizeof(VIP_SR_H21));

	drvif_color_Set_Sharpness_Table((DRV_Sharpness_Table *)&sharp);
}

#endif

char fwif_color_NNSR_model_TBL_update_VPQTSK(void)
{
	unsigned int t_now_90k=0, t_diff_90k=0, t_ready_cnt_90k=0, t_update_90=0;
	//unsigned char ret_val;
 	SIZE InSize;
	SIZE OutSize;
	int nnsr_mode = 0xFFFFFFFF;
	unsigned char weight_blend_idx = 0xff;
   	#ifdef SQM_OFFSET_TBL
    unsigned char MBPK_idx = 0xff;
    unsigned char MFLTI_idx = 0xff;
    unsigned char TWODPK_idx = 0xff;
    #endif
 
	unsigned char source=0;	
	char DMA_ok;
	_RPC_system_setting_info *VIP_RPC_sysInfo = NULL;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (gVip_Table == NULL) {
		rtd_pr_vpq_emerg("NNSR_DMA, ~get vipTable Error return \n");
		return 0;
	}

	VIP_RPC_sysInfo = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	if(VIP_RPC_sysInfo == NULL){
		rtd_pr_vpq_emerg("[%s:%d] Warning here!! RPC_system_info=NULL! \n",__FILE__, __LINE__);
		return -1;
	}

	t_ready_cnt_90k = 90 * 42 * 5;		// 5 frames
	t_update_90  = Scaler_ChangeUINT32Endian(VIP_RPC_sysInfo->ScalingUp_Ctrl.SMT_90k);
	t_now_90k = drvif_Get_90k_Lo_clk();
	if (t_now_90k > t_update_90)
		t_diff_90k = t_now_90k - t_update_90;
	else
		t_diff_90k = t_now_90k;

	InSize.nWidth = Scaler_ChangeUINT16Endian(VIP_RPC_sysInfo->ScalingUp_Ctrl.input_w);
	InSize.nLength = Scaler_ChangeUINT16Endian(VIP_RPC_sysInfo->ScalingUp_Ctrl.input_h);
	OutSize.nWidth = Scaler_ChangeUINT16Endian(VIP_RPC_sysInfo->ScalingUp_Ctrl.output_w);
	OutSize.nLength = Scaler_ChangeUINT16Endian(VIP_RPC_sysInfo->ScalingUp_Ctrl.output_h);

	if ((updateSQM_flag==1)||((VIP_RPC_sysInfo->ScalingUp_Ctrl.NNSR_DMA_need_update_flag != 0) && (t_diff_90k > t_ready_cnt_90k))) {
		if ((updateSQM_flag==1)||(VIP_RPC_sysInfo->ScalingUp_Ctrl.NNSR_DMA_need_update_flag == 1)) {
			VIP_RPC_sysInfo->ScalingUp_Ctrl.NNSR_DMA_need_update_flag = 0;
            updateSQM_flag=0;
			// update NNSR mode tbl
			rtd_pr_vpq_emerg("@@@@updateSQM_flag @@@@@@\n");
			nnsr_mode = drvif_color_ultrazoom_sel_nnsr_mode(&InSize, &OutSize);

			source = fwif_vip_source_check(3, NOT_BY_DISPLAY);/* get vip source by input src and timing*/
			if (source >= VIP_QUALITY_SOURCE_NUM)
				source = 0;	
			weight_blend_idx = gVip_Table->VIP_QUALITY_Extend3_Coef[source][VIP_QUALITY_FUNCTION_SRNN_Blending];

			DMA_ok = fwif_color_Set_NN_SR_Weights_Blend(nnsr_mode, weight_blend_idx);
			if(/*vpq_v4l2_ai_nnsr_get_En()==1 &&*/ DMA_ok == 0 && VIP_RPC_sysInfo->ScalingUp_Ctrl.NNSR_DMA_need_update_flag == 0){
				drvif_srnn_bbbsr_enable_set(1);	// enable blending
			} else {
				drvif_srnn_bbbsr_enable_set(0);
			}

            #ifdef SQM_OFFSET_TBL
            MBPK_idx    = gVip_Table->VIP_QUALITY_Extend3_Coef[source][VIP_QUALITY_FUNCTION_MB_Peaking];
            MFLTI_idx   = gVip_Table->VIP_QUALITY_Extend2_Coef[source][VIP_QUALITY_FUNCTION_TwoStep_SU_Table];
            TWODPK_idx  = gVip_Table->VIP_QUALITY_Extend3_Coef[source][VIP_QUALITY_FUNCTION_SharpTable];
            
            if(aipq_mode.sqm_mode!=0){
                fwif_color_set_MBPK_applySQMoffset_table(MBPK_idx);
                fwif_color_set_MFLTI_applySQMoffset_table(MFLTI_idx);
                fwif_color_set_2DPK_applySQMoffset_table(TWODPK_idx);
            }
            #endif
            
			rtd_pr_vpq_info("NNSR_DMA, t_update_90=%x, t_now_90k=%x, InSize=%d,%d, OutSize=%d,%d, nnsr_mode=%d, wInd=%d, src=%d,V4l2 NNSR En =%d, update_flag=%d,\n", 
				t_update_90, t_now_90k, InSize.nWidth, InSize.nLength, OutSize.nWidth, OutSize.nLength, nnsr_mode, weight_blend_idx, source,vpq_v4l2_ai_nnsr_get_En(), VIP_RPC_sysInfo->ScalingUp_Ctrl.NNSR_DMA_need_update_flag);	
		} else if (VIP_RPC_sysInfo->ScalingUp_Ctrl.NNSR_DMA_need_update_flag == 2) {
			VIP_RPC_sysInfo->ScalingUp_Ctrl.NNSR_DMA_need_update_flag = 0;
			drvif_srnn_clk_enable(0);
			rtd_pr_vpq_info("NNSR_DMA, clock off, t_update_90=%x, t_now_90k=%x, InSize=%d,%d, OutSize=%d,%d, nnsr_mode=%d, wInd=%d, src=%d,V4l2 NNSR En =%d, update_flag=%d,\n", 
				t_update_90, t_now_90k, InSize.nWidth, InSize.nLength, OutSize.nWidth, OutSize.nLength, nnsr_mode, weight_blend_idx, source,vpq_v4l2_ai_nnsr_get_En(), VIP_RPC_sysInfo->ScalingUp_Ctrl.NNSR_DMA_need_update_flag);	
			
		}
		
	}

	return 0;
}
unsigned int t_update_90k = 0;
extern int drvif_srnn_get_ai_sr_mode(void);
char fwif_color_NNSR_change_blending_ratio(void){
	unsigned int t_now_90k=0, t_diff_90k=0, t_ready_cnt_90k=0, t_update_90=0;
	int update_frame = 10;// 5 frames
	unsigned char nnsr_mode = drvif_srnn_get_ai_sr_mode();
	_RPC_system_setting_info *VIP_RPC_sysInfo = NULL;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();

	if (gVip_Table == NULL) {
		rtd_pr_vpq_emerg("NNSR_DMA, ~get vipTable Error return \n");
		return 0;
	}

	VIP_RPC_sysInfo = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	if(VIP_RPC_sysInfo == NULL){
		rtd_pr_vpq_emerg("[%s:%d] Warning here!! RPC_system_info=NULL! \n",__FILE__, __LINE__);
		return -1;
	}

	t_ready_cnt_90k = 90 * 42 * update_frame;		
	t_update_90  = t_update_90k;
	t_now_90k = drvif_Get_90k_Lo_clk();
	

	t_diff_90k = t_now_90k - t_update_90;
	


	rtd_pr_vpq_info("NNSR clock t_update_90:%d,  t_now_90k:%d, t_diff_90k:%d\n",t_update_90, t_now_90k,  t_diff_90k);

	rtd_pr_vpq_info("NNSR weight_blending_ctrl[3]:%d\n",weight_blending_ctrl[3]);


	if(blending_ratio_ctrl[2]==0){
		if (t_diff_90k > t_ready_cnt_90k){	
			t_update_90k = drvif_Get_90k_Lo_clk();
			//weight_blending_ctrl[3] = clamp_nnsr(weight_blending_ctrl[3], 16, 0);
			if(weight_blending_ctrl[3]<16){
				weight_blending_ctrl[3] = weight_blending_ctrl[3]+1;
				fwif_color_Set_NN_SR_Weights_Blend_for_rtice(nnsr_mode, weight_blending_ctrl);
			}else{
				goto blend_end;
			}
		
			
			rtd_pr_vpq_info("NNSR  increase textureboost:%d \n",weight_blending_ctrl[3]);
			}
		
	}else if(blending_ratio_ctrl[2]==1){
		if (t_diff_90k > t_ready_cnt_90k){
			t_update_90k= drvif_Get_90k_Lo_clk();
			//weight_blending_ctrl[3] = clamp_nnsr(weight_blending_ctrl[3], 16, 0);
			if(weight_blending_ctrl[3]>0){
				weight_blending_ctrl[3] = weight_blending_ctrl[3]-1;
				fwif_color_Set_NN_SR_Weights_Blend_for_rtice(nnsr_mode, weight_blending_ctrl);
			}else{
				goto blend_end;
			}
		
			
			rtd_pr_vpq_info("NNSR  decrease textureboost:%d \n",weight_blending_ctrl[3]);
			}
	}
	blend_end:
	rtd_pr_vpq_info("NNSR weight_blending_ctrl[3] keep as:%d \n",weight_blending_ctrl[3]);	
	
	return 1;
	
}

/*====  NNSR fwif_ function End====*/


#ifdef CONFIG_RTK_KDRV_GSR/*k6 GSR*/
void fwif_color_GSR_init(void)
{
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	if (VIP_RPC_system_info_structure_table == NULL) return;
	VIP_RPC_system_info_structure_table->GSR_color_temp[GSR_color_temp_run_in_vcpu_ISR] = 0;
}

void fwif_color_GSR_setrgbbrightness(unsigned short* APL, unsigned int HSize, unsigned int VSize)
{
#ifdef GSR_FUNCTION_ENABLE
		extern unsigned int pstParams[23] ;
		extern struct v4l2_ext_vpq_color_temp v4l2_color_temp;

		// The setting size information
		lc_lc_global_ctrl2_RBUS blu_lc_global_ctrl2;
		color_d_vc_global_ctrl_RBUS color_d_vc_global_ctrl;
		unsigned int HBlks = 0, VBlks = 0;

		// Parameters
		unsigned short maxGain = 0;
		unsigned short rgbGain = 0;
		unsigned short r_temp = 0, g_temp = 0, b_temp= 0;
		unsigned short r_offset_temp = 0, g_offset_temp = 0, b_offset_temp= 0;

		static unsigned int skip_cnt=0;

		unsigned int x = 0, y = 0;

		// interpolation parameters
		int HPhase = 0, VPhase = 0; // 2^12 factor + 2^8 bledning
		int HPos = 0, VPos = 0;
		int HBldCoef = 0, VBldCoef = 0;
		int APLBlkH1 = 0, APLBlkH2 = 0, APLBlkV1 = 0, APLBlkV2 = 0;
		int APLBlk1 = 0, APLBlk2 = 0, APLBlk3 = 0, APLBlk4 = 0;
		int HBldVal1 = 0, HBldVal2 = 0;

		color_d_vc_global_ctrl.regValue = IoReg_Read32(COLOR_D_VC_Global_CTRL_reg);
		blu_lc_global_ctrl2.regValue = IoReg_Read32(LC_LC_Global_Ctrl2_reg);
		HBlks = blu_lc_global_ctrl2.lc_blk_hnum+1;
		VBlks = blu_lc_global_ctrl2.lc_blk_vnum+1;

		HPhase = 1048576*HBlks/60;
		VPhase = 1048576*VBlks/60;

		if (strcmp(webos_strToolOption.eBackLight, "oled") == 0)
		{
			_RPC_system_setting_info *VIP_RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
			if (VIP_RPC_system_info_structure_table == NULL) return;

			drvif_color_get_LC_APL_GSR(LC_APL, 2040);

			// interpoaltion to 60x34 dimension
			for(y=0; y<34; y++)
			{
				for(x=0; x<60; x++)
				{
					HPos = x*HPhase + (128<<12);
					VPos = y*VPhase + (128<<12);

					HBldCoef = (HPos>>12) & 0xff;
					VBldCoef = (VPos>>12) & 0xff;

					APLBlkH1 = CLIP(0, HBlks-1, (HPos>>20)-1 );
					APLBlkH2 = CLIP(0, HBlks-1, (HPos>>20)	 );
					APLBlkV1 = CLIP(0, VBlks-1, (VPos>>20)-1 );
					APLBlkV2 = CLIP(0, VBlks-1, (VPos>>20)	 );

					APLBlk1 = LC_APL[APLBlkV1*HBlks+APLBlkH1];
					APLBlk2 = LC_APL[APLBlkV1*HBlks+APLBlkH2];
					APLBlk3 = LC_APL[APLBlkV2*HBlks+APLBlkH1];
					APLBlk4 = LC_APL[APLBlkV2*HBlks+APLBlkH2];

					HBldVal1 = HBldCoef*APLBlk2 + (256-HBldCoef)*APLBlk1; // topLeft and topRight
					HBldVal2 = HBldCoef*APLBlk4 + (256-HBldCoef)*APLBlk3; // botLeft and botRight
					pApl[y][x] = ((HBldVal2*VBldCoef + (256-VBldCoef)*HBldVal1) >> 16) >> 3; // final result and only reserve 8bits precision

				}
			}

			maxGain = 2048;
#ifdef SUPPORT_GSR_SET_STATUS_FROM_V4L2
			if (V4L2_GSR_EN_Flag == 1)
				rgbGain = fwif_color_get_LG_GSR_GetAdaptiveRgbGain(&(pstParams[0]), pApl,  maxGain);
			else
				rgbGain = maxGain;
#else
			rgbGain = fwif_color_get_LG_GSR_GetAdaptiveRgbGain(&(pstParams[0]), pApl,  maxGain);
#endif
			if (rgbGain > maxGain)	// .ko is not insert yet.
				rgbGain = maxGain;
			else if(color_d_vc_global_ctrl.m_lc_comp_en != 1)
							rgbGain = maxGain;

			r_temp = v4l2_color_temp.rgb_gain[0]>=192?(320+v4l2_color_temp.rgb_gain[0]):(256+(v4l2_color_temp.rgb_gain[0]<<8)/192);
			g_temp = v4l2_color_temp.rgb_gain[1]>=192?(320+v4l2_color_temp.rgb_gain[1]):(256+(v4l2_color_temp.rgb_gain[1]<<8)/192);
			b_temp = v4l2_color_temp.rgb_gain[2]>=192?(320+v4l2_color_temp.rgb_gain[2]):(256+(v4l2_color_temp.rgb_gain[2]<<8)/192);

			r_temp = (r_temp*rgbGain/2048)<<2; //for rgb gain
			g_temp = (g_temp*rgbGain/2048)<<2;
			b_temp = (b_temp*rgbGain/2048)<<2;

					r_offset_temp =((v4l2_color_temp.rgb_offset[0]+448)<<2)-2048; //for rgb offset
					g_offset_temp =((v4l2_color_temp.rgb_offset[1]+448)<<2)-2048;
					b_offset_temp =((v4l2_color_temp.rgb_offset[2]+448)<<2)-2048;

			if(vbe_disp_get_Orbit_State()==1)
			{
				skip_cnt++;
				if(skip_cnt >=100)
				{
					vbe_disp_set_Orbit_State(0);
					skip_cnt=0;
					VIP_RPC_system_info_structure_table->GSR_color_temp[GSR_color_temp_run_in_vcpu_ISR] = Scaler_ChangeUINT16Endian((unsigned short)0);
				}
			}
			else
			{
			#if 0	/* direct set */
				fwif_color_setrgbcolortemp_contrast(r_temp, g_temp, b_temp);
				fwif_color_setrgbcolortemp_bright(r_offset_temp,g_offset_temp, b_offset_temp);
			#else	/* set in vcpu isr */
				VIP_RPC_system_info_structure_table->GSR_color_temp[R_gain] = Scaler_ChangeUINT16Endian((unsigned short)r_temp);
				VIP_RPC_system_info_structure_table->GSR_color_temp[G_gain] = Scaler_ChangeUINT16Endian((unsigned short)g_temp);
				VIP_RPC_system_info_structure_table->GSR_color_temp[B_gain] = Scaler_ChangeUINT16Endian((unsigned short)b_temp);

				VIP_RPC_system_info_structure_table->GSR_color_temp[R_offset] = Scaler_ChangeUINT16Endian((unsigned short)r_offset_temp);
				VIP_RPC_system_info_structure_table->GSR_color_temp[G_offset] = Scaler_ChangeUINT16Endian((unsigned short)g_offset_temp);
				VIP_RPC_system_info_structure_table->GSR_color_temp[B_offset] = Scaler_ChangeUINT16Endian((unsigned short)b_offset_temp);

				VIP_RPC_system_info_structure_table->GSR_color_temp[GSR_color_temp_run_in_vcpu_ISR] = Scaler_ChangeUINT16Endian((unsigned short)1);
			#endif
			}
		}
#endif
}
#endif


#if 0 // 20170524 jimmy, D-decontour removed in Merlin3
/*Elsie 20150310 de-countour middleware*/
void fwif_color_set_de_contour(unsigned char src_idx, unsigned char level)
{
	extern DRV_De_CT_1D DeCT_1D[DeCT_1D_Level_MAX];
	DRV_De_CT_1D data;

	/* Table Protection*/
	if (level >= DeCT_1D_Level_MAX)
		level = 0;

	/*EN*/
	data.DeContour_ctrl.DeCT_en = DeCT_1D[level].DeContour_ctrl.DeCT_en;

	/*LPF tap Set*/
	data.DeContour_tap.K0 = DeCT_1D[level].DeContour_tap.K0;
	data.DeContour_tap.K1 = DeCT_1D[level].DeContour_tap.K1;
	data.DeContour_tap.K2 = DeCT_1D[level].DeContour_tap.K2;
	data.DeContour_tap.K3 = DeCT_1D[level].DeContour_tap.K3;
	data.DeContour_tap.K4 = DeCT_1D[level].DeContour_tap.K4;
	data.DeContour_tap.K5 = DeCT_1D[level].DeContour_tap.K5;
	data.DeContour_tap.LP_SHIFT = DeCT_1D[level].DeContour_tap.LP_SHIFT;

	/*De-contour Criteria & Weight*/
	data.DeContour_set.W1 = DeCT_1D[level].DeContour_set.W1;
	data.DeContour_set.W2 = DeCT_1D[level].DeContour_set.W2;
	data.DeContour_set.W1W2 = DeCT_1D[level].DeContour_set.W1W2;
	data.DeContour_set.MIN_GAP_W3 = DeCT_1D[level].DeContour_set.MIN_GAP_W3;
	data.DeContour_set.GAP_W3 = DeCT_1D[level].DeContour_set.GAP_W3;
	data.DeContour_set.SMOOTH_GAP_W = DeCT_1D[level].DeContour_set.SMOOTH_GAP_W;
	data.DeContour_set.ALL_CHANNEL_W = DeCT_1D[level].DeContour_set.ALL_CHANNEL_W;

	drvif_color_set_de_contour((DRV_De_CT_1D *)(&data));
}
#endif

void fwif_color_set_color_mapping(unsigned char src_idx, unsigned char table)
{
	extern DRV_Color_Mapping gCMTable[Color_Mapping_MAX];
	unsigned display;
	display = Scaler_DispGetInputInfo(SLR_INPUT_DISPLAY);


	if (table >= Color_Mapping_MAX)
		table = 0;
	drvif_color_set_Color_Mapping(display,(DRV_Color_Mapping *)(&(gCMTable[table])));
}
unsigned int crc32(const void *buf, unsigned int size)
{
	static unsigned int crc32_tab[] = {
		0x00000000, 0x77073096, 0xee0e612c, 0x990951ba, 0x076dc419, 0x706af48f,
		0xe963a535, 0x9e6495a3, 0x0edb8832, 0x79dcb8a4, 0xe0d5e91e, 0x97d2d988,
		0x09b64c2b, 0x7eb17cbd, 0xe7b82d07, 0x90bf1d91, 0x1db71064, 0x6ab020f2,
		0xf3b97148, 0x84be41de, 0x1adad47d, 0x6ddde4eb, 0xf4d4b551, 0x83d385c7,
		0x136c9856, 0x646ba8c0, 0xfd62f97a, 0x8a65c9ec, 0x14015c4f, 0x63066cd9,
		0xfa0f3d63, 0x8d080df5, 0x3b6e20c8, 0x4c69105e, 0xd56041e4, 0xa2677172,
		0x3c03e4d1, 0x4b04d447, 0xd20d85fd, 0xa50ab56b, 0x35b5a8fa, 0x42b2986c,
		0xdbbbc9d6, 0xacbcf940, 0x32d86ce3, 0x45df5c75, 0xdcd60dcf, 0xabd13d59,
		0x26d930ac, 0x51de003a, 0xc8d75180, 0xbfd06116, 0x21b4f4b5, 0x56b3c423,
		0xcfba9599, 0xb8bda50f, 0x2802b89e, 0x5f058808, 0xc60cd9b2, 0xb10be924,
		0x2f6f7c87, 0x58684c11, 0xc1611dab, 0xb6662d3d, 0x76dc4190, 0x01db7106,
		0x98d220bc, 0xefd5102a, 0x71b18589, 0x06b6b51f, 0x9fbfe4a5, 0xe8b8d433,
		0x7807c9a2, 0x0f00f934, 0x9609a88e, 0xe10e9818, 0x7f6a0dbb, 0x086d3d2d,
		0x91646c97, 0xe6635c01, 0x6b6b51f4, 0x1c6c6162, 0x856530d8, 0xf262004e,
		0x6c0695ed, 0x1b01a57b, 0x8208f4c1, 0xf50fc457, 0x65b0d9c6, 0x12b7e950,
		0x8bbeb8ea, 0xfcb9887c, 0x62dd1ddf, 0x15da2d49, 0x8cd37cf3, 0xfbd44c65,
		0x4db26158, 0x3ab551ce, 0xa3bc0074, 0xd4bb30e2, 0x4adfa541, 0x3dd895d7,
		0xa4d1c46d, 0xd3d6f4fb, 0x4369e96a, 0x346ed9fc, 0xad678846, 0xda60b8d0,
		0x44042d73, 0x33031de5, 0xaa0a4c5f, 0xdd0d7cc9, 0x5005713c, 0x270241aa,
		0xbe0b1010, 0xc90c2086, 0x5768b525, 0x206f85b3, 0xb966d409, 0xce61e49f,
		0x5edef90e, 0x29d9c998, 0xb0d09822, 0xc7d7a8b4, 0x59b33d17, 0x2eb40d81,
		0xb7bd5c3b, 0xc0ba6cad, 0xedb88320, 0x9abfb3b6, 0x03b6e20c, 0x74b1d29a,
		0xead54739, 0x9dd277af, 0x04db2615, 0x73dc1683, 0xe3630b12, 0x94643b84,
		0x0d6d6a3e, 0x7a6a5aa8, 0xe40ecf0b, 0x9309ff9d, 0x0a00ae27, 0x7d079eb1,
		0xf00f9344, 0x8708a3d2, 0x1e01f268, 0x6906c2fe, 0xf762575d, 0x806567cb,
		0x196c3671, 0x6e6b06e7, 0xfed41b76, 0x89d32be0, 0x10da7a5a, 0x67dd4acc,
		0xf9b9df6f, 0x8ebeeff9, 0x17b7be43, 0x60b08ed5, 0xd6d6a3e8, 0xa1d1937e,
		0x38d8c2c4, 0x4fdff252, 0xd1bb67f1, 0xa6bc5767, 0x3fb506dd, 0x48b2364b,
		0xd80d2bda, 0xaf0a1b4c, 0x36034af6, 0x41047a60, 0xdf60efc3, 0xa867df55,
		0x316e8eef, 0x4669be79, 0xcb61b38c, 0xbc66831a, 0x256fd2a0, 0x5268e236,
		0xcc0c7795, 0xbb0b4703, 0x220216b9, 0x5505262f, 0xc5ba3bbe, 0xb2bd0b28,
		0x2bb45a92, 0x5cb36a04, 0xc2d7ffa7, 0xb5d0cf31, 0x2cd99e8b, 0x5bdeae1d,
		0x9b64c2b0, 0xec63f226, 0x756aa39c, 0x026d930a, 0x9c0906a9, 0xeb0e363f,
		0x72076785, 0x05005713, 0x95bf4a82, 0xe2b87a14, 0x7bb12bae, 0x0cb61b38,
		0x92d28e9b, 0xe5d5be0d, 0x7cdcefb7, 0x0bdbdf21, 0x86d3d2d4, 0xf1d4e242,
		0x68ddb3f8, 0x1fda836e, 0x81be16cd, 0xf6b9265b, 0x6fb077e1, 0x18b74777,
		0x88085ae6, 0xff0f6a70, 0x66063bca, 0x11010b5c, 0x8f659eff, 0xf862ae69,
		0x616bffd3, 0x166ccf45, 0xa00ae278, 0xd70dd2ee, 0x4e048354, 0x3903b3c2,
		0xa7672661, 0xd06016f7, 0x4969474d, 0x3e6e77db, 0xaed16a4a, 0xd9d65adc,
		0x40df0b66, 0x37d83bf0, 0xa9bcae53, 0xdebb9ec5, 0x47b2cf7f, 0x30b5ffe9,
		0xbdbdf21c, 0xcabac28a, 0x53b39330, 0x24b4a3a6, 0xbad03605, 0xcdd70693,
		0x54de5729, 0x23d967bf, 0xb3667a2e, 0xc4614ab8, 0x5d681b02, 0x2a6f2b94,
		0xb40bbe37, 0xc30c8ea1, 0x5a05df1b, 0x2d02ef8d
	};
	const unsigned char *p;
	unsigned int crc = 0xFFFFFFFF;

	p = (const unsigned char *)buf;
	crc = crc ^ ~0U;

	while (size--)
		crc = crc32_tab[(crc ^ *p++) & 0xFF] ^ (crc >> 8);

	return crc ^ ~0U;
}
/* === checksum ========== */
unsigned int checksum(const void *buf, unsigned int size)
{
	const unsigned char *p;
	unsigned int sum = 0;
	unsigned char tmp;
	p = (const unsigned char *)buf;


	while (size--)
	{
		tmp = *p++;
		if( tmp== 0)  tmp = 1;
		sum += tmp;
	}
	return sum;
}

void fwif_color_check_VIPTable_crc(VIP_table_crc_value* crc_value, SLR_VIP_TABLE * vip_table)
{
	SLR_VIP_TABLE *g_Share_Memory_VIP_TABLE_Struct;
	g_Share_Memory_VIP_TABLE_Struct = vip_table;

	crc_value->VIP_QUALITY_Coef = checksum(&g_Share_Memory_VIP_TABLE_Struct->VIP_QUALITY_Coef,
		sizeof(unsigned char)*VIP_QUALITY_SOURCE_NUM*VIP_QUALITY_Coef_MAX);
	crc_value->VIP_QUALITY_Extend_Coef = checksum(&g_Share_Memory_VIP_TABLE_Struct->VIP_QUALITY_Extend_Coef,
		sizeof(unsigned char)*VIP_QUALITY_SOURCE_NUM*VIP_QUALITY_Extend_Coef_MAX);
	crc_value->VIP_QUALITY_Extend2_Coef = checksum(&g_Share_Memory_VIP_TABLE_Struct->VIP_QUALITY_Extend2_Coef,
		sizeof(unsigned char)*VIP_QUALITY_SOURCE_NUM*VIP_QUALITY_Extend2_Coef_MAX);
	crc_value->VIP_QUALITY_Extend3_Coef = checksum(&g_Share_Memory_VIP_TABLE_Struct->VIP_QUALITY_Extend3_Coef,
		sizeof(unsigned char)*VIP_QUALITY_SOURCE_NUM*VIP_QUALITY_Extend3_Coef_MAX);
	crc_value->VIP_QUALITY_3Dmode_Coef = checksum(&g_Share_Memory_VIP_TABLE_Struct->VIP_QUALITY_3Dmode_Coef,
		sizeof(unsigned char)*VIP_QUALITY_3DSOURCE_NUM*VIP_QUALITY_3Dmode_Coef_MAX);
	crc_value->VIP_QUALITY_Extend4_Coef = checksum(&g_Share_Memory_VIP_TABLE_Struct->VIP_QUALITY_Extend4_Coef,
		sizeof(unsigned char)*VIP_QUALITY_SOURCE_NUM*VIP_QUALITY_Extend4_Coef_MAX);
	crc_value->SD_H_table = checksum(&g_Share_Memory_VIP_TABLE_Struct->SD_H_table,
		sizeof(unsigned char)*UZD_Idx_TBL_Max*VIP_ScalingDown_FIR_Level_Max);
	crc_value->SD_V_table = checksum(&g_Share_Memory_VIP_TABLE_Struct->SD_V_table,
		sizeof(unsigned char)*UZD_Idx_TBL_Max*VIP_ScalingDown_FIR_Level_Max);
	crc_value->DCR_TABLE = checksum(&g_Share_Memory_VIP_TABLE_Struct->DCR_TABLE,
		sizeof(unsigned char)*t_DCR_TABLE_ROW_MAX*t_DCR_TABLE_COL_MAX);
	crc_value->ICM_by_timing_picmode = checksum(&g_Share_Memory_VIP_TABLE_Struct->ICM_by_timing_picmode,
		sizeof(unsigned char)*VIP_TABLE_PICTURE_MODE_MAX*VIP_TABLE_TIMIMG_MAX);
	crc_value->D_EDGE_Smooth_Coef = checksum(&g_Share_Memory_VIP_TABLE_Struct->D_EDGE_Smooth_Coef,
		sizeof(DRV_DEdgeSmooth_Coef)*t_D_EDGE_Smooth_Coef_MAX);
	crc_value->Auto_Function_Array1 = checksum(&g_Share_Memory_VIP_TABLE_Struct->Auto_Function_Array1,
		sizeof(unsigned char)*Auto_Function_Array_MAX);
	crc_value->Auto_Function_Array2 = checksum(&g_Share_Memory_VIP_TABLE_Struct->Auto_Function_Array2,
		sizeof(unsigned char)*Auto_Function_Array_MAX);
	crc_value->Auto_Function_Array3 = checksum(&g_Share_Memory_VIP_TABLE_Struct->Auto_Function_Array3,
		sizeof(unsigned char)*Auto_Function_Array_MAX);
	crc_value->Auto_Function_Array4 = checksum(&g_Share_Memory_VIP_TABLE_Struct->Auto_Function_Array4,
		sizeof(unsigned char)*Auto_Function_Array_MAX);
	crc_value->Auto_Function_Array5 = checksum(&g_Share_Memory_VIP_TABLE_Struct->Auto_Function_Array5,
		sizeof(unsigned char)*Auto_Function_Array_MAX);
	crc_value->DrvSetting_Skip_Flag = checksum(&g_Share_Memory_VIP_TABLE_Struct->DrvSetting_Skip_Flag,
		sizeof(unsigned char)*DrvSetting_Skip_Flag_item_Max);
	crc_value->VD_ConBriHueSat = checksum(&g_Share_Memory_VIP_TABLE_Struct->VD_ConBriHueSat,
		sizeof(VIP_VD_ConBriHueSat)*t_VD_ConBriHueSat_MAX);
	crc_value->Idomain_MBPKTable = checksum(&g_Share_Memory_VIP_TABLE_Struct->Idomain_MBPKTable, sizeof(VIP_MBPK_Table)*MBPK_table_num);
	crc_value->Tone_Mapping_LUT_R = checksum(&g_Share_Memory_VIP_TABLE_Struct->Tone_Mapping_LUT_R, sizeof(unsigned short)*Tone_Mapping_Table_MAX*Tone_Mapping_size);
	crc_value->ODtable_Coeff = checksum(&g_Share_Memory_VIP_TABLE_Struct->ODtable_Coeff,
		sizeof(unsigned int)*t_ODtable_Coeff_ROW_MAX*t_ODtable_Coeff_COL_MAX);
	crc_value->CDS_ini = checksum(&g_Share_Memory_VIP_TABLE_Struct->CDS_ini, sizeof(VIP_CDS_Table)*Sharp_table_num);
	crc_value->I_EDGE_Smooth_Coef = checksum(&g_Share_Memory_VIP_TABLE_Struct->I_EDGE_Smooth_Coef,
		sizeof(DRV_IEdgeSmooth_Coef)*t_I_EDGE_Smooth_Coef_MAX);
	crc_value->YUV2RGB_CSMatrix_Table = checksum(&g_Share_Memory_VIP_TABLE_Struct->YUV2RGB_CSMatrix_Table,
		sizeof(VIP_YUV2RGB_CSMatrix_Table)*YUV2RGB_TBL_Num);
	crc_value->tICM_ini = checksum(&g_Share_Memory_VIP_TABLE_Struct->tICM_ini,
		sizeof(unsigned short)*VIP_ICM_TBL_X*VIP_ICM_TBL_Y*VIP_ICM_TBL_Z);
	crc_value->tICM_H_7axis = checksum(&g_Share_Memory_VIP_TABLE_Struct->tICM_H_7axis, sizeof(ICM_H_7axis_table)*VIP_ICM_TBL_X);
	crc_value->tGAMMA = checksum(&g_Share_Memory_VIP_TABLE_Struct->tGAMMA, sizeof(VIP_Gamma)*t_GAMMA_MAX);
	crc_value->DCC_Control_Structure = checksum(&g_Share_Memory_VIP_TABLE_Struct->DCC_Control_Structure, sizeof(VIP_DCC_Control_Structure));
	crc_value->Ddomain_SHPTable = checksum(&g_Share_Memory_VIP_TABLE_Struct->Ddomain_SHPTable,
		sizeof(VIP_Sharpness_Table)*Sharp_table_num);
	crc_value->Manual_NR_Table = checksum(&g_Share_Memory_VIP_TABLE_Struct->Manual_NR_Table,
		sizeof(DRV_NR_Item)*PQA_TABLE_MAX*DRV_NR_Level_MAX);
	crc_value->PQA_Table = checksum(&g_Share_Memory_VIP_TABLE_Struct->PQA_Table,
		sizeof(unsigned int)*PQA_TABLE_MAX*PQA_MODE_MAX*PQA_ITEM_MAX*PQA_LEVEL_MAX);
	crc_value->PQA_Input_Table = checksum(&g_Share_Memory_VIP_TABLE_Struct->PQA_Input_Table,
		sizeof(unsigned int)*PQA_I_TABLE_MAX*PQA_I_ITEM_MAX*PQA_I_LEVEL_MAX);
	crc_value->checkSum = checksum(crc_value, sizeof(VIP_table_crc_value)-sizeof(unsigned int));
}
/*==========================*/

void fwif_VIP_set_Project_ID(VIP_Customer_Project_ID_ENUM Project_ID)
{
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table=NULL;
	VIP_RPC_system_info_structure_table = (_RPC_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	if(VIP_RPC_system_info_structure_table == NULL){
		VIPprintf("[%s:%d] Warning here!! RPC_system_info=NULL! \n",__FILE__, __LINE__);
		return;
	}

	if (VIP_RPC_system_info_structure_table->PQ_demo_flag){
		VIP_RPC_system_info_structure_table->Project_ID = VIP_Project_ID_TV006;
	}else{
		VIP_RPC_system_info_structure_table->Project_ID = Project_ID;
	}

}

unsigned char fwif_VIP_get_Project_ID(void)
{
	_RPC_system_setting_info *VIP_RPC_system_info_structure_table=NULL;
	VIP_RPC_system_info_structure_table = (_RPC_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	if (VIP_RPC_system_info_structure_table != NULL)
		return VIP_RPC_system_info_structure_table->Project_ID;
	else
		return VIP_Project_ID_TV001;
}

#if 0	//===marked by Elsie===
void fwif_color_set_DCC_ICM_DataPath_Swap(unsigned char mode)
{
	drvif_color_set_DCC_ICM_DataPath_Swap(mode);
}

void fwif_color_set_FW_On_Off_HMCNR(unsigned char En)
{
	drvif_color_set_FW_On_Off_HMCNR(En);
}
#endif

unsigned char fwif_color_set_pq_demo_flag_rpc(unsigned char flag)
{
	_RPC_system_setting_info *RPC_system_info_structure_table = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	if (NULL == RPC_system_info_structure_table)
		return 0;

	RPC_system_info_structure_table->PQ_demo_flag = flag;

	return 1;
}

static DEMO_CALLBACK_FUNC m_cbFunc_demo_func = NULL;
static DEMO_CALLBACK_FUNC m_cbFunc_overscan_func = NULL;
void fwif_color_reg_demo_callback(DEMO_CALLBACK_ID id, DEMO_CALLBACK_FUNC cbFunc)
{
	switch (id)
	{
	case DEMO_CALLBACKID_ON_OFF_SWITCH:
		m_cbFunc_demo_func = cbFunc;
	break;
	case DEMO_CALLBACKID_OVERSCAN:
		m_cbFunc_overscan_func = cbFunc;
	break;
	default:
		;
	}
}

DEMO_CALLBACK_FUNC fwif_color_get_demo_callback(DEMO_CALLBACK_ID id)
{
	switch (id)
	{
	case DEMO_CALLBACKID_ON_OFF_SWITCH:
		return m_cbFunc_demo_func;
	break;
	case DEMO_CALLBACKID_OVERSCAN:
		return m_cbFunc_overscan_func;
	break;
	default:
		return NULL;
		;
	}
}

char fwif_color_set_bt2020_Handler(unsigned char display, unsigned char Enable_Flag, unsigned char bt2020_Mode)
{
	unsigned char InvGamma_TBL_Sel;//, CM_TBL_Select;
	unsigned short *invGammaTBL;
	DRV_VIP_YUV2RGB_CSMatrix drv_vipCSMatrix_t;

	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

#ifdef CONFIG_ARM64
	memcpy_fromio(&drv_vipCSMatrix_t, &(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix), sizeof(DRV_VIP_YUV2RGB_CSMatrix));
#else
	memcpy(&drv_vipCSMatrix_t, &(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix), sizeof(DRV_VIP_YUV2RGB_CSMatrix));
#endif
	fwif_color_ChangeUINT32Endian((unsigned int *) &(drv_vipCSMatrix_t.RGB_Offset), 3, 0);
	fwif_color_ChangeUINT16Endian(&(drv_vipCSMatrix_t.COEF_By_Y.K11[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(drv_vipCSMatrix_t.COEF_By_Y.K12[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(drv_vipCSMatrix_t.COEF_By_Y.K13[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(drv_vipCSMatrix_t.COEF_By_Y.K22[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(drv_vipCSMatrix_t.COEF_By_Y.K23[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(drv_vipCSMatrix_t.COEF_By_Y.K32[0]), VIP_YUV2RGB_Y_Seg_Max, 0);
	fwif_color_ChangeUINT16Endian(&(drv_vipCSMatrix_t.COEF_By_Y.K33[0]), VIP_YUV2RGB_Y_Seg_Max, 0);

	if (display == SLR_MAIN_DISPLAY) {
		if (Enable_Flag == 1) {
			VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag = Enable_Flag;
			VIP_system_info_structure_table->BT2020_CTRL.Mode = bt2020_Mode;
		} else {
			VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag = 0;
			VIP_system_info_structure_table->BT2020_CTRL.Mode = BT2020_MODE_Max;
		}
	} else {
		VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag_Sub = 0;
		VIP_system_info_structure_table->BT2020_CTRL.Mode_Sub = BT2020_MODE_Max;
		VIPprintf("No Sub for bt 2020, return\n");
		return -1;
#if 0
		if (Enable_Flag == 1) {
			VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag_Sub = Enable_Flag;
			VIP_system_info_structure_table->BT2020_CTRL.Mode_Sub = bt2020_Mode;
			if (bt2020_Mode == BT2020_MODE_Non_Constant)
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode_Sub = YUV2RGB_INPUT_2020_NonConstantY;
			else
				VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode_Sub = YUV2RGB_INPUT_2020_ConstantY;
		} else {
			VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag_Sub = 0;
			VIP_system_info_structure_table->BT2020_CTRL.Mode_Sub = BT2020_MODE_Max;
			VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.Input_Data_Mode_Sub = YUV2RGB_INPUT_MODE_UNKNOW;/*determine by "Scaler_SetDataFormatHandler()"*/
		}
#endif
	}

	if (bt2020_Mode == BT2020_MODE_Constant && Enable_Flag == 1) {
		InvGamma_TBL_Sel = 1;
		invGammaTBL = &Power22InvGamma[0];
		//CM_TBL_Select = 1;
		drv_vipCSMatrix_t.CTRL_ITEM.Bt2020_En_TBL1 = 1;
		drv_vipCSMatrix_t.CTRL_ITEM.CoefByY_En = 0;	/* refference to spec*/
		drv_vipCSMatrix_t.CTRL_ITEM.UVOffset_En = 0;	/* refference to spec*/
	} else {
		InvGamma_TBL_Sel = 0;
		invGammaTBL = &LinearInvGamma[0];
		//CM_TBL_Select = 0;
		drv_vipCSMatrix_t.CTRL_ITEM.Bt2020_En_TBL1 = 0;
	}

	/*record to sh mem*/
	/*memcpy(&(VIP_system_info_structure_table->using_YUV2RGB_Matrix_Info.YUV2RGB_CSMatrix), &drv_vipCSMatrix_t, sizeof(DRV_VIP_YUV2RGB_CSMatrix));*/

	/* set RGB2YUV*/
	Scaler_SetDataFormatHandler();
	/* set Inv Gamma*/
	fwif_color_set_InvGamma(display, InvGamma_TBL_Sel, invGammaTBL, invGammaTBL, invGammaTBL);
	/* set Color Mapping Matrix*/
	//fwif_color_set_color_mapping(0, CM_TBL_Select);/*juwen, Merlin3, remove color map*/
	/* set YUV2RGB*/
	fwif_color_setCon_Bri_Color_Tint_inYUV2RGB_from_OSD_Gain(0, display, VIP_system_info_structure_table);
	/* set Bt2020 Constant mode enable */
	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_YUV2RGB_Base_Ctrl, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_CoefByY_ctrl, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	drvif_color_setYUV2RGB_CSMatrix(&drv_vipCSMatrix_t, VIP_CSMatrix_UVOffset_ctrl, VIP_YUV2RGB_Y_Seg_0, SLR_MAIN_DISPLAY, VIP_Table_Select_1);
	return 0;
}

char fwif_color_set_InvGamma(unsigned char display, unsigned char tblSelect, unsigned short *invGamma_R, unsigned short *invGamma_G,  unsigned short *invGamma_B)
{
	/*unsigned int final_invGAMMA_R[Bin_Num_Gamma / 2], final_invGAMMA_G[Bin_Num_Gamma / 2], final_invGAMMA_B[Bin_Num_Gamma / 2];*/
	if (display != SLR_MAIN_DISPLAY) {
		VIPprintf("No Sub for Inv Gamma, return\n");
		return -1;
	}

	fwif_color_inv_gamma_control_front(display);
	fwif_color_gamma_encode(final_invGAMMA_R, final_invGAMMA_G, final_invGAMMA_B, invGamma_R, invGamma_G, invGamma_B);
	fwif_color_Set_Inv_Gamma_Encode(final_invGAMMA_R, final_invGAMMA_G, final_invGAMMA_B);
	fwif_color_inv_gamma_control_back(display, 1);
	return 0;
}

void fwif_OneKey_HDR_HLG_Decide_HDR(unsigned char mode)
{
	unsigned char dolby_mode, /*hdmi_in_mux,*/ en_422to444_1, VGIP_SWAP, en_tc_422to444_1;
	unsigned char display;

	en_tc_422to444_1 = 0;
	display = Scaler_DispGetInputInfo(SLR_INPUT_DISPLAY);

	if ((mode == HAL_VPQ_HDR_MODE_HDR10 || mode == HAL_VPQ_HDR_MODE_HLG)) {
		if(Get_DisplayMode_Src(SLR_MAIN_DISPLAY) == VSC_INPUTSRC_VDEC) {
			if(drvif_HDR_get_VO_Decompress_Status(display))
			{//Playback HDR10 mode and compress mode
				dolby_mode = 1;//3;
				//hdmi_in_mux = 1;
				//dolby_ratio = 0;//k5l hw remove it
			}
			else
			{//Playback HDR10 mode and no compress mode
				dolby_mode = 1;
				//hdmi_in_mux = 1;
				//dolby_ratio = 0;//k5l hw remove it
			}
			en_422to444_1 = 0;
			VGIP_SWAP = 1;
		} else {
			dolby_mode = 0;
			//hdmi_in_mux = 0;
			//dolby_ratio = 0;//k5l hw remove it
			en_422to444_1 = 1;	/* en_422to444_1 should be 1 in VDEC SDR, but need  to check in HDMI*/
			VGIP_SWAP = 0;
		}
	} else {
			dolby_mode = 0;
			//hdmi_in_mux = 0;
			//dolby_ratio = 0;//k5l hw remove it
			en_422to444_1 = 1;	/* en_422to444_1 should be 1 in VDEC SDR, but need  to check in HDMI*/
			VGIP_SWAP = 0;
	}

	drvif_DM_HDR_Vtop_set(dolby_mode, en_422to444_1, en_tc_422to444_1);
	drvif_color_HDR10_DM_setting();
	fwif_color_set_HDR10_runmode(SLR_MAIN_DISPLAY);
	drvif_color_set_HDR_RGB_swap(VGIP_SWAP);

}

unsigned int OETF_Prog_Idx_th_TBL[7] = {0};
char fwif_color_set_DM2_OETF_Set_Prog_Index(unsigned char tbl_sel)
{
	extern VIP_HDR_OETF_Prog_Idx_TBL VIP_HDR_OETF_Prog_Idx_tbl[OETF_prog_idx_tbl_num];
	VIP_HDR_OETF_Prog_Idx_TBL Prog_Idx_TBL = {{0}, {0}};

	unsigned char i, i_step;
	unsigned short i_num;
	unsigned int temp = 0;

	if (tbl_sel >= OETF_prog_idx_tbl_num) {
		rtd_pr_vpq_emerg("fwif_color_set_DM2_OETF_Set_Prog_Index error, tbl_sel=%d,\n", tbl_sel);
		tbl_sel = 0;
	}

	memcpy(&Prog_Idx_TBL, &VIP_HDR_OETF_Prog_Idx_tbl[tbl_sel], sizeof(VIP_HDR_OETF_Prog_Idx_TBL));

	for(i=0;i<7;i++) {
		if (i==0)
			i_num = Prog_Idx_TBL.oetf_grid_num_th[0];
		else
			i_num = Prog_Idx_TBL.oetf_grid_num_th[i] - Prog_Idx_TBL.oetf_grid_num_th[i-1];
		i_step = Prog_Idx_TBL.oetf_step[i];

		temp = temp + (1<<i_step) * i_num;
		OETF_Prog_Idx_th_TBL[i] = temp;
	}

	drvif_DM2_OETF_Set_Prog_Index(&Prog_Idx_TBL);
	drvif_DM2_OETF_Set_Prog_Index_th(&OETF_Prog_Idx_th_TBL[0]);
	return 0;
}

void fwif_color_set_DM_HDR_3dLUT(unsigned char enable, unsigned int *pArray)
{
	fwif_color_DM_HDR_3dLUT_Encode(pArray, DM_HDR_3D_DRV_LUT);
	drvif_DM_HDR_3dLUT(enable, DM_HDR_3D_DRV_LUT);
}

UINT16 pre_hdr_3dlut[HDR_24x24x24_size*3] = {0};
UINT8 fwif_HDR_compare_3DLUT(void *p, VIP_HDR10_CSC3_TABLE_Mode mode)
{
	PQ_HDR_3dLUT_16_PARAM *pParam = (PQ_HDR_3dLUT_16_PARAM *)p;
	extern unsigned char g_HDR3DLUTForceWrite;
	UINT16 i;

	unsigned int HDR3DLUT_ZIZE;

	if (mode == OLD_17x17x17)
		HDR3DLUT_ZIZE = VIP_DM_HDR_3D_LUT_UI_TBL_SIZE;
	else if (mode == NEW_24x24x24)
		HDR3DLUT_ZIZE = HDR_24x24x24_size*3;
	if (g_HDR3DLUTForceWrite)
	{
		for(i = 0; i < HDR3DLUT_ZIZE; i++)
		{
			pre_hdr_3dlut[i] = pParam->a3dLUT_16_pArray[i];
		}
		return 1;
	}
	else
	{
		UINT8 diff = 0;
		i = 0;
		while (i < HDR3DLUT_ZIZE)
		{
			if (pre_hdr_3dlut[i] != pParam->a3dLUT_16_pArray[i])
			{
				diff = 1;
				break;
			}
			i++;
		}

		if (diff)
		{
			for(i = 0; i < HDR3DLUT_ZIZE; i++)
			{
				pre_hdr_3dlut[i] = pParam->a3dLUT_16_pArray[i];
			}
			return 1;
		}
		else {
			return 0;
		}
	}


}

UINT16 pre_hdr1_2_3dlut[HDR_24x24x24_size*3] = {0};
UINT8 fwif_HDR1_2_compare_3DLUT(void *p, VIP_HDR10_CSC3_TABLE_Mode mode)
{
	PQ_HDR_3dLUT_16_PARAM *pParam = (PQ_HDR_3dLUT_16_PARAM *)p;
	unsigned char g_HDR3DLUTForceWrite = 1;
	UINT16 i;

	unsigned int HDR3DLUT_ZIZE;

	if (mode == OLD_17x17x17)
		HDR3DLUT_ZIZE = VIP_DM_HDR_3D_LUT_UI_TBL_SIZE;
	else if (mode == NEW_24x24x24)
		HDR3DLUT_ZIZE = HDR_24x24x24_size*3;
	if (g_HDR3DLUTForceWrite)
	{
		for(i = 0; i < HDR3DLUT_ZIZE; i++)
		{
			pre_hdr1_2_3dlut[i] = pParam->a3dLUT_16_pArray[i];
		}
		return 1;
	}
	else
	{
		UINT8 diff = 0;
		i = 0;
		while (i < HDR3DLUT_ZIZE)
		{
			if (pre_hdr1_2_3dlut[i] != pParam->a3dLUT_16_pArray[i])
			{
				diff = 1;
				break;
			}
			i++;
		}

		if (diff)
		{
			for(i = 0; i < HDR3DLUT_ZIZE; i++)
			{
				pre_hdr1_2_3dlut[i] = pParam->a3dLUT_16_pArray[i];
			}
			return 1;
		}
		else {
			return 0;
		}
	}


}


extern struct semaphore VPQ_DM_DMA_TBL_Semaphore;
void fwif_HDR_RGB2OPT(unsigned char enable, unsigned int *pArray)
{
	down(&VPQ_DM_DMA_TBL_Semaphore);
	drvif_HDR_RGB2OPT(enable, pArray);
	up(&VPQ_DM_DMA_TBL_Semaphore);

}

void fwif_HDR1_2_RGB2OPT(unsigned char enable, unsigned int *pArray)
{
	drvif_HDR1_2_RGB2OPT(enable, pArray);
}

void fwif_DM2_GAMMA_Enable(unsigned char En)
{
	drvif_DM2_GAMMA_Enable(En);
}

void fwif_DM2_HDR1_2_GAMMA_Enable(unsigned char En)
{
	drvif_DM2_HDR1_2_GAMMA_Enable(En);
}

char fwif_color_set_DM_HDR_3dLUT_16(void *p)
{
	PQ_HDR_3dLUT_16_PARAM *pParam = (PQ_HDR_3dLUT_16_PARAM *)p;
	unsigned char enable = pParam->c3dLUT_16_enable;
	unsigned short *pArray = pParam->a3dLUT_16_pArray;

	extern UINT8 game_process;
	if (game_process)
	{
		game_process = 0;
		msleep_interruptible(50);	//for game bug, delay 1 frame
	}

	#ifdef CONFIG_I2RND_B05_ENABLE
	drvif_DM_HDR_3dLUT_16_i2run(enable, pArray);
	#else
	drvif_DM_HDR_3dLUT_16(enable, pArray);
	#endif
	return 1;
}

void fwif_color_get_Read_DM_HDR_3dLUT(unsigned char *enable, unsigned int *pArray)
{
	drvif_Read_DM_HDR_3dLUT(enable, DM_HDR_3D_DRV_LUT);
	fwif_color_DM_HDR_3dLUT_Decode(DM_HDR_3D_DRV_LUT, pArray);
}

char fwif_color_DM_HDR_3dLUT_Encode(unsigned int* p_inArray, unsigned int *p_outArray)
{
	unsigned short i, ii, jj;

	ii = 0;
	jj = 0;

	for (i = 0; i < VIP_DM_HDR_3D_LUT_SIZE; i++) {
		p_outArray[ii] = (p_inArray[jj] << 16) + (p_inArray[jj+1]);
		ii++;
		jj += 2;
		p_outArray[ii] = p_inArray[jj];
		ii++;
		jj++;
	}
	return 0;

}

char fwif_color_DM_HDR_3dLUT_Decode(unsigned int* p_inArray, unsigned int *p_outArray)
{
	unsigned short i, ii, jj;

	ii = 0;
	jj = 0;

	for (i = 0; i < VIP_DM_HDR_3D_LUT_SIZE; i++) {
		p_outArray[ii] = p_inArray[jj] >> 16;
		ii++;
		p_outArray[ii] = p_inArray[jj] & 0xFFFF;
		ii++;
		jj++;
		p_outArray[ii] = p_inArray[jj] & 0xFFFF;;
		ii ++;
		jj ++;
	}
	return 0;
}

void fwif_color_set_D_3dLUT(unsigned char LUT_Ctrl, unsigned int *pArray)
{
	fwif_color_D_3dLUT_Encode(pArray, D_3D_DRV_LUT);
	drvif_color_D_3dLUT(LUT_Ctrl, D_3D_DRV_LUT);
}

void fwif_color_get_Read_D_3dLUT(unsigned char *LUT_Ctrl, unsigned int *pArray)
{
	drvif_color_Read_D_3dLUT(LUT_Ctrl, D_3D_DRV_LUT);
	fwif_color_D_3dLUT_Decode(D_3D_DRV_LUT, pArray);
}

char fwif_color_D_3dLUT_Encode(unsigned int* p_inArray, unsigned int *p_outArray)
{
	unsigned short i, ii, jj;

	ii = 0;
	jj = 0;

	for (i = 0; i < VIP_D_3D_LUT_SIZE; i++) {
		p_outArray[ii] = (p_inArray[jj] << 16) + (p_inArray[jj+1]);
		ii++;
		jj += 2;
		p_outArray[ii] = p_inArray[jj];
		ii++;
		jj++;
	}
	return 0;

}

char fwif_color_D_3dLUT_Decode(unsigned int* p_inArray, unsigned int *p_outArray)
{
	unsigned short i, ii, jj;

	ii = 0;
	jj = 0;

	for (i = 0; i < VIP_D_3D_LUT_SIZE; i++) {
		p_outArray[ii] = p_inArray[jj] >> 16;
		ii++;
		p_outArray[ii] = p_inArray[jj] & 0xFFFF;
		ii++;
		jj++;
		p_outArray[ii] = p_inArray[jj] & 0xFFFF;;
		ii ++;
		jj ++;
	}
	return 0;
}

char fwif_color_D_3dLUT_Encode_16(unsigned short* p_inArray, unsigned int *p_outArray)
{
	unsigned short i, ii, jj;

	ii = 0;
	jj = 0;

	for (i = 0; i < VIP_D_3D_LUT_SIZE; i++) {
		p_outArray[ii] = (p_inArray[jj] << 16) + (p_inArray[jj+1]);
		ii++;
		jj += 2;
		p_outArray[ii] = p_inArray[jj];
		ii++;
		jj++;
	}
	return 0;

}

void fwif_color_set_osd_Outer(unsigned char enable)
{
	Osd_Outer_En = enable;
}

char fwif_color_get_osd_Outer(void)
{
	return Osd_Outer_En;

}

void fwif_color_VIP_get_VO_Info(unsigned char input_src_type)
{
	SLR_VOINFO* pVOInfo = NULL;
	_system_setting_info *VIP_system_info_structure_table=NULL;
	VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());

	if( input_src_type == _SRC_VO || (input_src_type == _SRC_HDMI))
	{
		//  usb
		//    transfer_characteristics    gamma&OETF  curve
		if(pVOInfo->transfer_characteristics == 16) {
			VIP_system_info_structure_table->HDR_CTRL.EOTF_Mode = ITU_SMPTE2084;
		} else if(pVOInfo->transfer_characteristics == 18) {
			VIP_system_info_structure_table->HDR_CTRL.EOTF_Mode = ITU_ARIB_STD_B67;
		} else {

			VIP_system_info_structure_table->HDR_CTRL.EOTF_Mode = ITU_BT1886;
		}
        //    colour_primaries    source's RGBW xy value   depend on RGBW panel  how to use 3x3 or 3D LUT
		if( pVOInfo->colour_primaries == 9 ) {
			VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag = 1;
			VIP_system_info_structure_table->BT2020_CTRL.Mode = BT2020_MODE_Non_Constant;  // default
		} else {
			VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag = 0;
			VIP_system_info_structure_table->BT2020_CTRL.Mode = BT2020_MODE_Max;
		}
		//    matrix_coefficiets    RGB2YUV
		if(pVOInfo->matrix_coefficiets == 9) {
			VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag = 1;
			VIP_system_info_structure_table->BT2020_CTRL.Mode = BT2020_MODE_Non_Constant;
		}
		else if (pVOInfo->matrix_coefficiets == 10) {
			VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag = 1;
			VIP_system_info_structure_table->BT2020_CTRL.Mode = BT2020_MODE_Constant;
		}

		if (pVOInfo->colour_primaries == 1) {
			g_bHDR_is601 = false;
		} else if (pVOInfo->colour_primaries == 6 || pVOInfo->colour_primaries == 7) {
			g_bHDR_is601 = true;
		} else if (pVOInfo->colour_primaries == 9) {
			g_bHDR_is601 = false;
		} else {
			if (VIP_system_info_structure_table->Timing >= _MODE_720P50) {
				g_bHDR_is601 = false;
			} else {
				g_bHDR_is601 = true;
			}
		}
	} else {
		VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag = 0;
		VIP_system_info_structure_table->BT2020_CTRL.Mode = BT2020_MODE_Max;
		VIP_system_info_structure_table->HDR_CTRL.EOTF_Mode = HDR_MODE_Max;
	}
	rtd_pr_vpq_info("get VO info, input_src_type=%d,video_full_range_flag=%d,transfer_characteristics=%d,colour_primaries=%d,matrix_coef=%d,EOTF_Mode=%d,bt2020_Enable=%d,BT2020.Mode=%d\n",
		input_src_type,pVOInfo->video_full_range_flag,pVOInfo->transfer_characteristics,pVOInfo->colour_primaries,pVOInfo->matrix_coefficiets,
		VIP_system_info_structure_table->HDR_CTRL.EOTF_Mode, VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag, VIP_system_info_structure_table->BT2020_CTRL.Mode);
}

void fwif_color_VIP_get_DRM_Info(unsigned char input_src_type)
{
	_system_setting_info *VIP_system_info_structure_table=NULL;
	vfe_hdmi_drm_t drm_info;
	HDMI_AVI_T pAviInfo = {0};
	unsigned char isBt2020_HDMI = 0;

	VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/* get drm info*/
	vfe_hdmi_drv_get_drm_info(&drm_info);
	/* get AVI info frame*/
	/*int vfe_hdmi_drv_get_port_avi_info(vfe_hdmi_avi_t *info_frame)
	unsigned char drvif_Hdmi_GetAviInfoFrame(HDMI_AVI_T *pAviInfo)*/ //pAviInfo size = 16 bytes
	drvif_Hdmi_GetAviInfoFrame((HDMI_AVI_T *) (&pAviInfo)); //pAviInfo size = 16 bytes

	if ((pAviInfo.EC == 5 || pAviInfo.EC == 6) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED))
		isBt2020_HDMI = 1;
	else
		isBt2020_HDMI = 0;

	if(input_src_type == _SRC_HDMI)
	{
		if (drm_info.len !=0 && ((drm_info.eEOTFtype == 1 /*Traditional Gamma - HDR Lumi range*/) || (drm_info.eEOTFtype == 2 /*ST2048*/))) {
			VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag = 1;
			VIP_system_info_structure_table->BT2020_CTRL.Mode = BT2020_MODE_Non_Constant;
			VIP_system_info_structure_table->HDR_CTRL.EOTF_Mode = ITU_SMPTE2084;
		} else if(drm_info.len !=0 && drm_info.eEOTFtype == 3 /*Future EOTF HLG??*/ && (isBt2020_HDMI == 1)) {
			VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag = 1;
			VIP_system_info_structure_table->BT2020_CTRL.Mode = BT2020_MODE_Non_Constant;
			VIP_system_info_structure_table->HDR_CTRL.EOTF_Mode = ITU_ARIB_STD_B67;
		} else {
		VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag = 0;
		VIP_system_info_structure_table->BT2020_CTRL.Mode = BT2020_MODE_Max;
		VIP_system_info_structure_table->HDR_CTRL.EOTF_Mode = HDR_MODE_Max;
		}

		if (((pAviInfo.EC == 0 || pAviInfo.EC == 2 || pAviInfo.EC == 3) && (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED))) {
			g_bHDR_is601 = true;
		} else if (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_SMPTE170) {
			g_bHDR_is601 = true;
		} else if ((pAviInfo.EC == 1 && pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_EXTENDED) || (pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_ITU709)) {
			g_bHDR_is601 = false;
		} else {
			if (VIP_system_info_structure_table->Timing >= _MODE_720P50 || isBt2020_HDMI) {
				g_bHDR_is601 = false;
			} else {
				g_bHDR_is601 = true;
			}
		}

	} else {
		VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag = 0;
		VIP_system_info_structure_table->BT2020_CTRL.Mode = BT2020_MODE_Max;
		VIP_system_info_structure_table->HDR_CTRL.EOTF_Mode = HDR_MODE_Max;
	}
	rtd_pr_vpq_info("get DRM info, input_src_type=%d,drm.len=%d,drm.eEOTFtype=%d,EOTF_Mode=%d,bt2020_Enable=%d,BT2020.Mode=%d\n",
		input_src_type,drm_info.len,drm_info.eEOTFtype,
		VIP_system_info_structure_table->HDR_CTRL.EOTF_Mode, VIP_system_info_structure_table->BT2020_CTRL.Enable_Flag, VIP_system_info_structure_table->BT2020_CTRL.Mode);
}

//static unsigned char set_PQ_Bypass_ISR = 0;
char fwif_color_PQ_ByPass_Handler(unsigned char table_idx, unsigned char isSet_Flag, _RPC_system_setting_info *VIP_RPC_system_info_structure_table, unsigned char Force_byPass)
{
	unsigned char tbl_idx, i;
	//VIP_PQ_ByPass_Struct *pPQ_ByPass_Struct;
	VIP_PQ_ByPass_Struct pPQ_ByPass_Struct;
	unsigned char isIMode_Flag = 0;

	if (isSet_Flag == 1){

		if (table_idx >= VIP_PQ_ByPass_TBL_Max)
			table_idx = 0;

		//VIP_system_info_structure_table->PQ_Setting_Info.PQ_ByPass_Ctrl.table_idx = table_idx;
		VIP_RPC_system_info_structure_table->PQ_ByPass_Ctrl.table_idx = table_idx;
		tbl_idx = table_idx;

		//pPQ_ByPass_Struct = &(PQ_ByPass_Struct[tbl_idx]);
		memcpy((unsigned char*)&pPQ_ByPass_Struct, (unsigned char*)&(PQ_ByPass_Struct[tbl_idx]), sizeof(VIP_PQ_ByPass_Struct));

		isIMode_Flag = Scaler_DispGetStatus(SLR_MAIN_DISPLAY, SLR_DISP_INTERLACE);
		if (isIMode_Flag == 1) {
			;
			pPQ_ByPass_Struct.VIP_PQ_ByPass_TBL[PQ_ByPass_I_DI_IP_Enable] = 0;
			pPQ_ByPass_Struct.VIP_PQ_ByPass_TBL[PQ_ByPass_I_DI] = 0;
		}

		if ((Scaler_DispGetInputInfoByDisp(SLR_MAIN_DISPLAY, SLR_INPUT_STATE) == _MODE_STATE_ACTIVE) && (Check_AP_Set_Enable_ForceBG(SLR_MAIN_DISPLAY) == FALSE)) {
			;	/* use ISR to set bypass driver*/
		} else {
			for (i=0; i<VIP_PQ_ByPass_ITEMS_Max; i++) {
				if (pPQ_ByPass_Struct.VIP_PQ_ByPass_TBL[i] == 1  || Force_byPass == 1)
					drvif_color_set_PQ_ByPass(i, isIMode_Flag);
			}
		}
	}

	 rtd_pr_vpq_info("PQ_ByPass_Handler, table_idx=%d, sys_table_idx=%d, isSet_Flag=%d, Force_byPass=%d, isIMode_Flag=%d\n",
			table_idx, VIP_RPC_system_info_structure_table->PQ_ByPass_Ctrl.table_idx, isSet_Flag, Force_byPass, isIMode_Flag);

	return VIP_RPC_system_info_structure_table->PQ_ByPass_Ctrl.table_idx;
}
#if 0
unsigned char fwif_color_Get_PQ_ByPass_ISR_Flag(void)
{
	return set_PQ_Bypass_ISR;
}

unsigned char fwif_color_Set_PQ_ByPass_ISR_Flag(unsigned char Flag)
{
	set_PQ_Bypass_ISR = Flag;
	return 0;
}
#endif
unsigned char fwif_color_set_FILM_FW_ShareMemory(void)
{
	int ret;

	g_Share_Memory_FILM_FW = ((FILM_FW_ShareMem *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_FW_FILM));
	if (NULL == g_Share_Memory_FILM_FW)
		return 0;

#ifdef CONFIG_ARM64
	memset_io(g_Share_Memory_FILM_FW, 0, sizeof(FILM_FW_ShareMem));
#else
	memset(g_Share_Memory_FILM_FW, 0, sizeof(FILM_FW_ShareMem));
#endif
	g_Share_Memory_FILM_FW->version = 1;
	g_Share_Memory_FILM_FW->smooth_toggle_film = 0xff;		//default disable smoothtoggle film setting
	ret = Scaler_SendRPC(SCALERIOC_VIP_FW_FILM, 0, 0);
	if (0 !=  ret) {
		VIPprintf("ret = %d, update fwif_color_set_FILM_FW_ShareMemory to driver fail !!!\n", ret);
	}

	return !ret;
}

void fwif_color_WaitFor_DEN_STOP_UZUDTG(void)
{
	UINT32 timeoutcnt = 0x032500;
	UINT32 denEnd;
	ppoverlay_new_meas2_linecnt_real_RBUS new_meas2_linecnt_real_reg;
	ppoverlay_dv_den_start_end_RBUS dv_den_start_end_reg;
	dv_den_start_end_reg.regValue = IoReg_Read32(PPOVERLAY_DV_DEN_Start_End_reg);
	denEnd = dv_den_start_end_reg.dv_den_end;
	do {
	                new_meas2_linecnt_real_reg.regValue = IoReg_Read32(PPOVERLAY_new_meas2_linecnt_real_reg);
	                if(new_meas2_linecnt_real_reg.uzudtg_dly_line_cnt_rt > denEnd) {
	                        return;
	                }
	} while(timeoutcnt-- != 0);

	if(timeoutcnt == 0){
	        VIPprintf("\n%s ERROR not wait the correct line \n", __FUNCTION__);
}
}

void fwif_color_WaitFor_SYNC_START_UZUDTG(void)
{
	UINT32 timeoutcnt = 0x032500;
	UINT32 SyncStartDelay, denStart;
	ppoverlay_new_meas2_linecnt_real_RBUS new_meas2_linecnt_real_reg;
	ppoverlay_dv_den_start_end_RBUS dv_den_start_end_reg;
	dv_den_start_end_reg.regValue = IoReg_Read32(PPOVERLAY_DV_DEN_Start_End_reg);
	if (dv_den_start_end_reg.dv_den_sta < 30) {
		fwif_color_WaitFor_DEN_STOP_UZUDTG();
		return;
	}

	SyncStartDelay = dv_den_start_end_reg.dv_den_sta-30;
	denStart = dv_den_start_end_reg.dv_den_sta-10;
	do {
			new_meas2_linecnt_real_reg.regValue = IoReg_Read32(PPOVERLAY_new_meas2_linecnt_real_reg);
	        if(new_meas2_linecnt_real_reg.uzudtg_dly_line_cnt_rt < denStart && new_meas2_linecnt_real_reg.uzudtg_dly_line_cnt_rt > SyncStartDelay)
				return;
	} while(timeoutcnt-- != 0);

	if(timeoutcnt == 0){
	        VIPprintf("\n%s ERROR not wait the correct line \n", __FUNCTION__);
	}
}

void fwif_color_WaitFor_DEN_STOP_MEMCDTG(void)
{
	UINT32 timeoutcnt = 0x032500;
	UINT32 denEnd;
	ppoverlay_new_meas1_linecnt_real_RBUS new_meas1_linecnt_real_reg;
	ppoverlay_memc_mux_ctrl_RBUS ppoverlay_memc_mux_ctrl_reg;
	ppoverlay_memcdtg_dv_den_start_end_RBUS memcdtg_dv_den_start_end;

	ppoverlay_memc_mux_ctrl_reg.regValue = IoReg_Read32(PPOVERLAY_MEMC_MUX_CTRL_reg);
	if (ppoverlay_memc_mux_ctrl_reg.memc_outmux_sel == 0) {
		fwif_color_WaitFor_DEN_STOP_UZUDTG();
		return;
	}

	memcdtg_dv_den_start_end.regValue = IoReg_Read32(PPOVERLAY_memcdtg_DV_DEN_Start_End_reg);
	denEnd = memcdtg_dv_den_start_end.memcdtg_dv_den_end;
	do {
                new_meas1_linecnt_real_reg.regValue = IoReg_Read32(PPOVERLAY_new_meas1_linecnt_real_reg);
                if(new_meas1_linecnt_real_reg.memcdtg_line_cnt_rt > denEnd) {
                        return;
                }
	} while(timeoutcnt-- != 0);

	if(timeoutcnt == 0){
	        VIPprintf("\n%s ERROR not wait the correct line \n", __FUNCTION__);
	}
}

void fwif_color_WaitFor_SYNC_START_MEMCDTG(void)
{
	UINT32 timeoutcnt = 0x032500;
	UINT32 SyncStartDelay, denStart;
	ppoverlay_new_meas1_linecnt_real_RBUS new_meas1_linecnt_real_reg;
	ppoverlay_memc_mux_ctrl_RBUS ppoverlay_memc_mux_ctrl_reg;
	ppoverlay_memcdtg_dv_den_start_end_RBUS memcdtg_dv_den_start_end;

	ppoverlay_memc_mux_ctrl_reg.regValue = IoReg_Read32(PPOVERLAY_MEMC_MUX_CTRL_reg);
	if (ppoverlay_memc_mux_ctrl_reg.memc_outmux_sel == 0) {
		fwif_color_WaitFor_DEN_STOP_UZUDTG();
		return;
	}

	memcdtg_dv_den_start_end.regValue = IoReg_Read32(PPOVERLAY_memcdtg_DV_DEN_Start_End_reg);
	if (memcdtg_dv_den_start_end.memcdtg_dv_den_sta < 30) {
		fwif_color_WaitFor_DEN_STOP_MEMCDTG();
		return;
	}

	SyncStartDelay = memcdtg_dv_den_start_end.memcdtg_dv_den_sta-30;
	denStart = memcdtg_dv_den_start_end.memcdtg_dv_den_sta-10;
	do {
		new_meas1_linecnt_real_reg.regValue = IoReg_Read32(PPOVERLAY_new_meas1_linecnt_real_reg);
	        if(new_meas1_linecnt_real_reg.memcdtg_line_cnt_rt < denStart && new_meas1_linecnt_real_reg.memcdtg_line_cnt_rt > SyncStartDelay)
				return;
	} while(timeoutcnt-- != 0);

	if(timeoutcnt == 0){
	        VIPprintf("\n%s ERROR not wait the correct line \n", __FUNCTION__);
	}
}


void fwif_color_pattern_mute(unsigned char  bflag)
{
	if(((IoReg_Read32(CON_BRI_DM_COLOR_RGB_CTRL_reg)&_BIT1)>>1) != bflag) {
		if(bflag == FALSE){
			msleep(50);
			fwif_color_WaitFor_DEN_STOP_UZUDTG();
			IoReg_Write32(CON_BRI_DM_CONTRAST_A_reg, 0x20080200);
			IoReg_ClearBits(CON_BRI_DM_COLOR_RGB_CTRL_reg, _BIT1);
		}else {
			if(Scaler_DispGetInputInfoByDisp(SLR_MAIN_DISPLAY, SLR_INPUT_STATE) == _MODE_STATE_ACTIVE){
				fwif_color_WaitFor_DEN_STOP_UZUDTG();
				IoReg_Write32(CON_BRI_DM_CONTRAST_A_reg, 0x00000000);
				IoReg_SetBits(CON_BRI_DM_COLOR_RGB_CTRL_reg, _BIT1);
			}
		}
	}
}
extern struct semaphore VPQ_DeXC_MEM_Semaphore;
unsigned char  fwif_color_Set_I_De_XC(unsigned char value)
{
	VIP_I_De_XC_TBL byPass = {0};
	VIP_I_De_XC_TBL *ptr;
	unsigned char mem_ready;
	unsigned char ret;
	_RPC_system_setting_info *RPC_VIP_system_info_structure_table = NULL;

	down(&VPQ_DeXC_MEM_Semaphore);
	RPC_VIP_system_info_structure_table = (_RPC_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	if(RPC_VIP_system_info_structure_table != NULL){
		RPC_VIP_system_info_structure_table->I_De_XC_CTRL.table_select = value;
	}

	mem_ready = drv_memory_Get_I_De_XC_Mem_Ready_Flag(0);	/* need to check mem index, if i2run is on*/

	if (value >= I_De_XC_TBL_Max || mem_ready == 0|| (fwif_color_get_force_I_De_XC_En()== 1))
		ptr = &byPass;
	else
		ptr = &I_De_XC_TBL[value];

	ret = drvif_color_Set_I_De_XC(ptr);
	up(&VPQ_DeXC_MEM_Semaphore);

	return ret;

}
unsigned char  fwif_color_set_force_I_De_XC_Disable(unsigned char value)
{
	unsigned char ret;
	unsigned char mem_ready;

	down(&VPQ_DeXC_MEM_Semaphore);
	g_force_DeXC_disable = value;

	mem_ready = drv_memory_Get_I_De_XC_Mem_Ready_Flag(0);

	if (mem_ready == 1){
		if(g_force_DeXC_disable ==1)
			ret = drvif_color_Set_I_De_XC_En(0);
		else
			ret = drvif_color_Set_I_De_XC_En(1);
	}
	else
		ret = drvif_color_Set_I_De_XC_En(0);

	rtd_pr_vpq_info("Force_DEXC, value=%d, mem_ready=%d, ret=%d,\n", value, mem_ready, ret);

	up(&VPQ_DeXC_MEM_Semaphore);
        return ret;
}
unsigned char  fwif_color_get_force_I_De_XC_En(void)
{
        return g_force_DeXC_disable;

}
unsigned char  fwif_color_Set_I_De_Contour(unsigned char value)
{
	VIP_I_De_Contour_TBL byPass = {0};
	VIP_I_De_Contour_TBL *ptr;
	//_system_setting_info *VIP_system_info_structure_table = NULL;
	//VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	//VIP_system_info_structure_table->PQ_Setting_Info.I_De_Contour_CTRL.table_select = value;

	if (value >= I_De_Contour_TBL_Max)
		ptr = &byPass;
	else
		ptr = &I_De_Contour_TBL[value];

	return drvif_color_Set_I_De_Contour(ptr);

}

unsigned char fwif_color_Set_Block_DeContour(unsigned char value)
{
	VIP_Block_DeContour_TBL byPass = {{0}};
	VIP_Block_DeContour_TBL *ptr;
	//_system_setting_info *VIP_system_info_structure_table = NULL;
	unsigned char ret;
	//VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	//VIP_system_info_structure_table->PQ_Setting_Info.I_De_Contour_CTRL.table_select = value;

	if (value >= I_De_Contour_TBL_Max)
	{
		ptr = &byPass;
		ret = false;
	}
	else
	{
		ptr = &Block_DeContour_TBL[value];
		ret = true;
	}

	drvif_color_Set_Block_DeContour_Ctrl( &(ptr->BDecont_Ctrl) );
	drvif_color_Set_Block_DeContour_Temporal( &(ptr->BDecont_Temporal) );
	drvif_color_Set_Block_DeContour_Interpolation( &(ptr->BDecont_Interpolation) );
	drvif_color_Set_Block_DeContour_Alpha( &(ptr->BDecont_Alpha) );
	drvif_color_Set_Block_DeContour_Dither( &(ptr->BDecont_Dither) );
	drvif_color_Set_Block_DeContour_Profile_Diff( &(ptr->BDecont_Profile_Diff) );
	drvif_color_Set_Block_DeContour_Clamp( &(ptr->BDecont_Clamp) ); // mk2
	drvif_color_Set_Block_DeContour_PQ_Mask( &(ptr->BDecont_Semantic_Alpha) ); // mk2
	return ret;

}

unsigned char fwif_color_Set_Block_DeContour_Size()
{
	unsigned short image_width, image_height;
	unsigned short blk_Hsize, blk_Vsize;
	DRV_Block_DeContour_Region_Num_Size block_decont_region_num_size;

	_system_setting_info *VIP_system_info_structure_table=NULL;

	VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	if(VIP_system_info_structure_table == NULL){
		VIPprintf("[%s:%d] Warning here!! RPC_system_info=NULL! \n",__FILE__, __LINE__);
		return false;
	}

	image_width = VIP_system_info_structure_table->I_Width;
	image_height = VIP_system_info_structure_table->I_Height;

	if (Scaler_DispGetStatus(SLR_MAIN_DISPLAY, SLR_DISP_INTERLACE) == 1)
		image_height *= 2;

	// block num decision by width & height
	// HW constraint: blk_Hnum <= 103, blk_Vnum <= 54
	if( image_width <= 20*103 && image_height <= 20*54 )
	{
		blk_Hsize = 20;
		blk_Vsize = 20;
	}
	else if( image_width <= 40*103 && image_height <= 40*54 )
	{
		blk_Hsize = 40;
		blk_Vsize = 40;
	}
	else
	{
		blk_Hsize = 80;
		blk_Vsize = 80;
	}

	// calculate other parameters
	block_decont_region_num_size.bdecont_blk_hsize = blk_Hsize;
	block_decont_region_num_size.bdecont_blk_vsize = blk_Vsize;

	block_decont_region_num_size.bdecont_blk_hnum = (image_width + blk_Hsize - 1) / blk_Hsize; // ceil( width / blk_Hsize )
	block_decont_region_num_size.bdecont_blk_vnum = (image_height + blk_Vsize - 1) / blk_Vsize; // ceil( height / blk_Vsize )
	block_decont_region_num_size.bdecont_blk_vsize_remainder = image_height % blk_Vsize;

	block_decont_region_num_size.bdecont_hfactor = 1048576 * 5 / blk_Hsize;
	block_decont_region_num_size.bdecont_vfactor = 1048576 * 5 / blk_Vsize;

	drvif_color_Set_Block_DeContour_Region_Num_Size( &block_decont_region_num_size );

	return true;

}

//====================20161027 START=======================================================
//juwen, 0627, TC
#if 0 /* juwen, move to "tc_hdr", elieli */
void fwif_color_set_TC_Enable(unsigned char src_idx, bool enable)
{
	drvif_color_set_TC_Enable(enable);
}

void fwif_color_set_TC_certification_Enable(unsigned char src_idx, bool certification_enable, bool certification_bitout)
{
	drvif_color_set_TC_certification_Enable(certification_enable, certification_bitout);
}

//----------compile-0628-------------
void fwif_color_set_TC_Range_Adaptation(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_TCHDR_RangeAdaption data;
	extern DRV_TCHDR_Table TCHDR_Table[5];

	data.tchdr_footroom_int= TCHDR_Table[TableIdx].TCHDR_RangeAdaption.tchdr_footroom_int;
	data.tchdr_l_headroom_int= TCHDR_Table[TableIdx].TCHDR_RangeAdaption.tchdr_l_headroom_int;
	data.tchdr_c_headroom_int= TCHDR_Table[TableIdx].TCHDR_RangeAdaption.tchdr_c_headroom_int;
	data.tchdr_inv_y_limited_range_ratio_int= TCHDR_Table[TableIdx].TCHDR_RangeAdaption.tchdr_inv_y_limited_range_ratio_int;
	data.tchdr_inv_chroma_limited_range_ratio_int= TCHDR_Table[TableIdx].TCHDR_RangeAdaption.tchdr_inv_chroma_limited_range_ratio_int;

	drvif_color_set_TC_Range_Adaptation( (DRV_TCHDR_RangeAdaption*) &data);
}

void fwif_color_set_TC_L_Compute(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_TCHDR_l_compute data;
	extern DRV_TCHDR_Table TCHDR_Table[5];

	data.tchdr_alpha_a= TCHDR_Table[TableIdx].TCHDR_l_compute.tchdr_alpha_a;
	data.tchdr_alpha_b= TCHDR_Table[TableIdx].TCHDR_l_compute.tchdr_alpha_b;

	drvif_color_set_TC_L_Compute( (DRV_TCHDR_l_compute*) &data);
}


void fwif_color_set_TC_T_Compute(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_TCHDR_T_compute data;
	extern DRV_TCHDR_Table TCHDR_Table[5];


	data.tchdr_oct0= TCHDR_Table[TableIdx].TCHDR_T_compute.tchdr_oct0;
	data.tchdr_oct1= TCHDR_Table[TableIdx].TCHDR_T_compute.tchdr_oct1;
	data.tchdr_oct2= TCHDR_Table[TableIdx].TCHDR_T_compute.tchdr_oct2;

	drvif_color_set_TC_T_Compute( (DRV_TCHDR_T_compute*) &data);
}

void fwif_color_set_TC_M_Compute(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_TCHDR_M_compute data;
	extern DRV_TCHDR_Table TCHDR_Table[5];


	data.tchdr_oct3= TCHDR_Table[TableIdx].TCHDR_M_compute.tchdr_oct3;
	data.tchdr_oct4= TCHDR_Table[TableIdx].TCHDR_M_compute.tchdr_oct4;
	data.tchdr_oct5= TCHDR_Table[TableIdx].TCHDR_M_compute.tchdr_oct5;
	data.tchdr_oct6= TCHDR_Table[TableIdx].TCHDR_M_compute.tchdr_oct6;

	drvif_color_set_TC_M_Compute( (DRV_TCHDR_M_compute*) &data);
}

void fwif_color_set_TC_Write_C_LUT(unsigned char src_idx,unsigned char C_lut_idx)
{
	extern DRV_TCHDR_COEF_C_lut TCHDR_COEF_C_LUT_TBL;

	unsigned short *c_lut_coef_ptr = &(TCHDR_COEF_C_LUT_TBL.TCHDR_COEF_C_Lut[C_lut_idx][0]);
	drvif_color_set_TC_Write_C_LUT(c_lut_coef_ptr);
}


void fwif_color_set_TC_Read_C_LUT(unsigned short *c_lut_coef_read_ptr)
{
	//if (IoReg_Read32(0xb802e4f4) & 0x1)
		drvif_color_set_TC_Read_C_LUT(TCHDR_COEF_C_LUT_TBL_ReadReg);
	//if (IoReg_Read32(0xb802e4f4) & 0x2)
		decode_TC_Read_LUTs_regValue(TCHDR_COEF_C_LUT_TBL_ReadReg, c_lut_coef_read_ptr);//(input, output)

}

void fwif_color_set_TC_Write_I_LUT(unsigned char src_idx,unsigned char I_lut_idx)
{

	extern DRV_TCHDR_COEF_I_lut TCHDR_COEF_I_LUT_TBL;

	unsigned short *i_lut_coef_ptr = &(TCHDR_COEF_I_LUT_TBL.TCHDR_COEF_I_Lut[I_lut_idx][0]);
	drvif_color_set_TC_Write_I_LUT(i_lut_coef_ptr);
}

void fwif_color_set_TC_Read_I_LUT(unsigned short *i_lut_coef_read_ptr)
{

	drvif_color_set_TC_Read_I_LUT(TCHDR_COEF_I_LUT_TBL_ReadReg);
	decode_TC_Read_LUTs_regValue(TCHDR_COEF_I_LUT_TBL_ReadReg, i_lut_coef_read_ptr);//(input, output)

}

void fwif_color_set_TC_Write_S_LUT(unsigned char src_idx,unsigned char S_lut_idx)
{
	extern DRV_TCHDR_COEF_S_lut TCHDR_COEF_S_LUT_TBL;

	unsigned short *s_lut_coef_ptr = &(TCHDR_COEF_S_LUT_TBL.TCHDR_COEF_S_Lut[S_lut_idx][0]);
	drvif_color_set_TC_Write_S_LUT(s_lut_coef_ptr);
}

void fwif_color_set_TC_Read_S_LUT(unsigned short *s_lut_coef_read_ptr)
{

	drvif_color_set_TC_Read_S_LUT(TCHDR_COEF_S_LUT_TBL_ReadReg);
	decode_TC_Read_LUTs_regValue(TCHDR_COEF_S_LUT_TBL_ReadReg, s_lut_coef_read_ptr);//(input, output)

}



void fwif_color_set_TC_Write_P_LUT(unsigned char src_idx,unsigned char P_lut_idx)
{
	extern DRV_TCHDR_COEF_P_lut TCHDR_COEF_P_LUT_TBL;

	unsigned short *p_lut_coef_ptr = &(TCHDR_COEF_P_LUT_TBL.TCHDR_COEF_P_Lut[P_lut_idx][0]);
	drvif_color_set_TC_Write_P_LUT(p_lut_coef_ptr);
}

void fwif_color_set_TC_Read_P_LUT(unsigned short *p_lut_coef_read_ptr)
{

	drvif_color_set_TC_Read_P_LUT(TCHDR_COEF_P_LUT_TBL_ReadReg);
	decode_TC_Read_LUTs_regValue(TCHDR_COEF_P_LUT_TBL_ReadReg, p_lut_coef_read_ptr);//(input, output)

}


void fwif_color_set_TC_D_LUT_Step_Threshold(unsigned char src_idx, unsigned char TableIdx)
{

	DRV_TCHDR_D_lut_step_thl data;
	extern DRV_TCHDR_Table TCHDR_Table[5];


	data.tchdr_dlut_step0= TCHDR_Table[TableIdx].TCHDR_D_lut_step_thl.tchdr_dlut_step0;
	data.tchdr_dlut_step1= TCHDR_Table[TableIdx].TCHDR_D_lut_step_thl.tchdr_dlut_step1;
	data.tchdr_dlut_step2= TCHDR_Table[TableIdx].TCHDR_D_lut_step_thl.tchdr_dlut_step2;
	data.tchdr_dlut_step3= TCHDR_Table[TableIdx].TCHDR_D_lut_step_thl.tchdr_dlut_step3;

	data.tchdr_dlut_threshold0= TCHDR_Table[TableIdx].TCHDR_D_lut_step_thl.tchdr_dlut_threshold0;
	data.tchdr_dlut_threshold1= TCHDR_Table[TableIdx].TCHDR_D_lut_step_thl.tchdr_dlut_threshold1;
	data.tchdr_dlut_threshold2= TCHDR_Table[TableIdx].TCHDR_D_lut_step_thl.tchdr_dlut_threshold2;

	drvif_color_set_TC_D_LUT_Step_Threshold( (DRV_TCHDR_D_lut_step_thl*) &data);
}


/*
NOTE : juwen, 0628
In C model : R/G/B use the same D_LUT table <=> set D_lut_Red_idx = D_lut_Green_idx =D_lut_Blue_idx

However, in the following API we can let R/G/B use different D_LUT table.
*/
void fwif_color_set_TC_Write_D_LUT(unsigned char src_idx,unsigned char D_lut_Red_idx,unsigned char D_lut_Geen_idx,unsigned char D_lut_Blue_idx)
{
	extern DRV_TCHDR_COEF_D_lut TCHDR_COEF_D_LUT_TBL;

	unsigned short *d_lut_Red_coef_ptr = &(TCHDR_COEF_D_LUT_TBL.TCHDR_COEF_D_Lut[D_lut_Red_idx][0]);
	unsigned short *d_lut_Green_coef_ptr = &(TCHDR_COEF_D_LUT_TBL.TCHDR_COEF_D_Lut[D_lut_Geen_idx][0]);
	unsigned short *d_lut_Blue_coef_ptr = &(TCHDR_COEF_D_LUT_TBL.TCHDR_COEF_D_Lut[D_lut_Blue_idx][0]);
	drvif_color_set_TC_Write_D_LUT(d_lut_Red_coef_ptr, d_lut_Green_coef_ptr, d_lut_Blue_coef_ptr);
}

/*
NOTE : juwen, 20160629
In C model : R/G/B use the same D_LUT table <=> set D_lut_Red_idx = D_lut_Green_idx =D_lut_Blue_idx

However, in the following API we read R/G/B D_LUT table separate.
*/
void fwif_color_set_TC_Read_D_LUT(unsigned short *d_lut_red_coef_read_ptr,unsigned short *d_lut_green_coef_read_ptr,unsigned short *d_lut_blue_coef_read_ptr)
{
	drvif_color_set_TC_Read_D_LUT(TCHDR_COEF_D_LUT_RED_TBL_ReadReg, TCHDR_COEF_D_LUT_GREEN_TBL_ReadReg, TCHDR_COEF_D_LUT_BLUE_TBL_ReadReg);
	decode_TC_Read_LUTs_regValue(TCHDR_COEF_D_LUT_RED_TBL_ReadReg, d_lut_red_coef_read_ptr);//(input, output)
	decode_TC_Read_LUTs_regValue(TCHDR_COEF_D_LUT_GREEN_TBL_ReadReg, d_lut_green_coef_read_ptr);//(input, output)
	decode_TC_Read_LUTs_regValue(TCHDR_COEF_D_LUT_BLUE_TBL_ReadReg, d_lut_blue_coef_read_ptr);//(input, output)
}
#else
char fwif_color_rtice_set_TC_Write_P_LUT(unsigned char src_idx, unsigned short *p_lut_coef_ptr)
{
	if (drvif_Wait_VGIP_start(1, 50, 0x032500) < 0)
		return -1;

	if (drvif_color_set_TC_Write_P_LUT(p_lut_coef_ptr) < 0)
		return -2;

	return 0;
}

char fwif_color_rtice_set_TC_Read_P_LUT(unsigned short *p_lut_coef_read_ptr)
{
	if (drvif_Wait_VGIP_start(1, 50, 0x032500) < 0)
		return -1;

	if (drvif_color_set_TC_Read_P_LUT(TCHDR_COEF_P_LUT_TBL_ReadReg) < 0)
		return -2;

	decode_TC_Read_LUTs_regValue(TCHDR_COEF_P_LUT_TBL_ReadReg, p_lut_coef_read_ptr);//(input, output)

	return 0;

}

	unsigned short C_LUT[65];
	unsigned short P_LUT[65];
	unsigned short D_LUT[65];
	unsigned short D_LUT_THRESHOLD[3];
	unsigned short D_LUT_STEP[4];


#if 0//juwen, tc v140
void fwif_color_ScalerVIP_set_TC_v130_metadata2reg_frameSync(int display_OETF, int display_Brightness, int proc_mode, int width, int height, int yuv_range, _RPC_system_setting_info *RPC_sys_info)
{
	unsigned short muA, muB;
	SL_HDR1_metadata sl_hdr1_metadata;
	//unsigned short INV_C_LUT[65];
	//int display_EOTF;

	// UV2 SRGB matrix
	signed short *OCT;
	signed short OCT_709_SDR2MDR[7]  = { 32, 70, 175, 403, -48, -120, 475 };
	signed short OCT_2020_SDR2MDR[7] = { 33, 58, 203, 377, -42, -146, 482 };
	signed short OCT_709_HDR2MDR[7]  = {  0,  0,   0, 202, -24, -60, 238 };
	signed short OCT_2020_HDR2MDR[7] = {  0,  0,   0, 189, -21, -73, 241 };

      // RGB2YUV matrix (fixed)
      int RGBtoYUV_709[9] = { 186, 627, 63, -103, -346, 448, 448, -407, -41 };
      int RGBtoYUV_2020[9] = { 230, 595, 52, -125, -323, 448, 448, -412, -36 };
      int *RGBtoYUV;
	int i;
	DRV_TC_HDR_CTRL* TC_HDR_CTRL = drvif_fwif_color_Get_TC_CTRL();
	static unsigned int PRINT_CNT = 0;
	//unsigned char iii;
	unsigned int printf_Flag;
	unsigned int print_delay;

	if (1/*sys_info->Debug_Buff_8[0] == 1*/) {
#if 1
		/* change endain in SCPU, SCPU is faster than VCPU */
		sl_hdr1_metadata.specVersion 								=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.specVersion, 1) 					;
		sl_hdr1_metadata.payloadMode 								=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.payloadMode, 1) 					;
		sl_hdr1_metadata.hdrPicColourSpace							=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.hdrPicColourSpace, 1)			;
		sl_hdr1_metadata.hdrMasterDisplayColourSpace				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.hdrMasterDisplayColourSpace, 1)	;
		sl_hdr1_metadata.hdrMasterDisplayMaxLuminance 				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.hdrMasterDisplayMaxLuminance, 1) ;
		sl_hdr1_metadata.hdrMasterDisplayMinLuminance				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.hdrMasterDisplayMinLuminance, 1)	;
		sl_hdr1_metadata.sdrPicColourSpace 							=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.sdrPicColourSpace, 1) 			;
		sl_hdr1_metadata.sdrMasterDisplayColourSpace 				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.sdrMasterDisplayColourSpace, 1) 	;
		sl_hdr1_metadata.u.variables.tmInputSignalBlackLevelOffset	=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.tmInputSignalBlackLevelOffset, 1);
		sl_hdr1_metadata.u.variables.tmInputSignalWhiteLevelOffset	=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.tmInputSignalWhiteLevelOffset, 1);
		sl_hdr1_metadata.u.variables.shadowGain						=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.shadowGain, 1)					;
		sl_hdr1_metadata.u.variables.highlightGain 					=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.highlightGain, 1) 				;
		sl_hdr1_metadata.u.variables.midToneWidthAdjFactor 			=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.midToneWidthAdjFactor, 1) 		;
		sl_hdr1_metadata.u.variables.tmOutputFineTuningNumVal 		=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.tmOutputFineTuningNumVal, 1) 	;
		sl_hdr1_metadata.u.variables.saturationGainNumVal			=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainNumVal, 1)			;

		if (sl_hdr1_metadata.payloadMode == 0) {
			sl_hdr1_metadata.u.variables.saturationGainX[0]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[0], 1)			;
			sl_hdr1_metadata.u.variables.saturationGainY[0]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[0], 1)			;
			sl_hdr1_metadata.u.variables.saturationGainX[1]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[1], 1)			;
			sl_hdr1_metadata.u.variables.saturationGainY[1]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[1], 1)			;
			sl_hdr1_metadata.u.variables.saturationGainX[2]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[2], 1)			;
			sl_hdr1_metadata.u.variables.saturationGainY[2]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[2], 1)			;
			sl_hdr1_metadata.u.variables.saturationGainX[3]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[3], 1)			;
			sl_hdr1_metadata.u.variables.saturationGainY[3]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[3], 1)			;
			sl_hdr1_metadata.u.variables.saturationGainX[4]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[4], 1)			;
			sl_hdr1_metadata.u.variables.saturationGainY[4]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[4], 1)			;
			sl_hdr1_metadata.u.variables.saturationGainX[5]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[5], 1)			;
			sl_hdr1_metadata.u.variables.saturationGainY[5]				=		fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[5], 1)		;
		} else /*if (sl_hdr1_metadata.payloadMode == 1)*/ {
			for (i=0;i<33;i++) {
				sl_hdr1_metadata.u.tables.luminanceMappingX[i] = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.tables.luminanceMappingX[i], 1);
				sl_hdr1_metadata.u.tables.luminanceMappingY[i] = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.tables.luminanceMappingY[i], 1);
			}
		}
#endif
	;
	}else{
		sl_hdr1_metadata.specVersion = 0;
		sl_hdr1_metadata.payloadMode = 0;
		sl_hdr1_metadata.hdrPicColourSpace = 0;
		sl_hdr1_metadata.hdrMasterDisplayColourSpace = 0;
		sl_hdr1_metadata.hdrMasterDisplayMaxLuminance = 1000;
		sl_hdr1_metadata.hdrMasterDisplayMinLuminance = 0;
		sl_hdr1_metadata.sdrPicColourSpace = 0;
		sl_hdr1_metadata.sdrMasterDisplayColourSpace = 0;
		sl_hdr1_metadata.u.variables.tmInputSignalBlackLevelOffset = 101;
		sl_hdr1_metadata.u.variables.tmInputSignalWhiteLevelOffset = 3;
		sl_hdr1_metadata.u.variables.shadowGain = 88;
		sl_hdr1_metadata.u.variables.highlightGain = 157;
		sl_hdr1_metadata.u.variables.midToneWidthAdjFactor = 0;
		sl_hdr1_metadata.u.variables.tmOutputFineTuningNumVal = 0;
		sl_hdr1_metadata.u.variables.saturationGainNumVal = 6;
		sl_hdr1_metadata.u.variables.saturationGainX[0] = 0;
		sl_hdr1_metadata.u.variables.saturationGainY[0] = 64;
		sl_hdr1_metadata.u.variables.saturationGainX[1] = 5;
		sl_hdr1_metadata.u.variables.saturationGainY[1] = 64;
		sl_hdr1_metadata.u.variables.saturationGainX[2] = 245;
		sl_hdr1_metadata.u.variables.saturationGainY[2] = 64;
		sl_hdr1_metadata.u.variables.saturationGainX[3] = 249;
		sl_hdr1_metadata.u.variables.saturationGainY[3] = 64;
		sl_hdr1_metadata.u.variables.saturationGainX[4] = 253;
		sl_hdr1_metadata.u.variables.saturationGainY[4] = 64;
		sl_hdr1_metadata.u.variables.saturationGainX[5] = 255;
		sl_hdr1_metadata.u.variables.saturationGainY[5] = 64;
	}


	// Compute muA and muB
	drvif_fwif_color_set_TC_v130_Compute_muA_muB(&sl_hdr1_metadata, &muA, &muB);

	// Compute C_LUT
      drvif_fwif_color_set_TC_v130_Compute_C_LUT( proc_mode, &sl_hdr1_metadata, display_Brightness, C_LUT);

	  // Compute P_LUT
	drvif_fwif_color_set_TC_v130_Compute_P_LUT( proc_mode, &sl_hdr1_metadata, display_Brightness, P_LUT);

	// Fill D_LUT
      drvif_fwif_color_set_TC_v130_Fill_D_LUT(proc_mode, display_OETF, display_Brightness, D_LUT, D_LUT_THRESHOLD, D_LUT_STEP);

	// OCT matrix pointer
        if (sl_hdr1_metadata.hdrPicColourSpace == 0) // rec709
        {
            OCT = (proc_mode == SDR2MDR) ? OCT_709_SDR2MDR : OCT_709_HDR2MDR;
            RGBtoYUV = RGBtoYUV_709;//juwen, note, use after D LUT. transe DLUT output RGB -> YUV
        }
        else // rec2020
        {
            OCT = (proc_mode == SDR2MDR) ? OCT_2020_SDR2MDR : OCT_2020_HDR2MDR;
            RGBtoYUV = RGBtoYUV_2020;//juwen, note, use after D LUT. transe DLUT output RGB -> YUV
        }



	drvif_fwif_color_set_TC_v130_HW_setting_call_Each_Frame(&muA, &muB, OCT,C_LUT, P_LUT, D_LUT, D_LUT_THRESHOLD, D_LUT_STEP, yuv_range,RGBtoYUV);


#if 1	/* for debug*/
	printf_Flag = TC_HDR_CTRL->TC_Debug_Log;
	print_delay = TC_HDR_CTRL->TC_Debug_Delay;
	//juwen, 0315
	if((printf_Flag&_BIT0)!=0) {
		if(PRINT_CNT%print_delay==0) {
			rtd_pr_vpq_info("juwen,fwif_color_ScalerVIP_set_TC_v130_metadata2reg_frameSync\n\n");
			printk("\n");
			printk("%d           specVersion\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.specVersion ,1));
			printk("%d           payloadMode\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.payloadMode ,1));
			printk("%d           hdrPicColourSpace\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.hdrPicColourSpace ,1));
			printk("%d           hdrMasterDisplayColourSpace\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.hdrMasterDisplayColourSpace ,1));
			printk("%d           hdrMasterDisplayMaxLuminance\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.hdrMasterDisplayMaxLuminance ,1));
			printk("%d           hdrMasterDisplayMinLuminance\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.hdrMasterDisplayMinLuminance ,1));
			printk("%d           sdrPicColourSpace\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.sdrPicColourSpace ,1));
			printk("%d           sdrMasterDisplayColourSpace\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.sdrMasterDisplayColourSpace ,1));
			printk("%d           tmInputSignalBlackLevelOffset\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.tmInputSignalBlackLevelOffset ,1));
			printk("%d           tmInputSignalWhiteLevelOffset\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.tmInputSignalWhiteLevelOffset ,1));
			printk("%d           shadowGain\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.shadowGain ,1));
			printk("%d           highlightGain\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.highlightGain ,1));
			printk("%d           midToneWidthAdjFactor\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.midToneWidthAdjFactor ,1));
			printk("%d           tmOutputFineTuningNumVal\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.tmOutputFineTuningNumVal ,1));
			printk("%d           saturationGainNumVal\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainNumVal, 1));
			printk("%d           saturationGainX[0]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[0] ,1));
			printk("%d           saturationGainY[0]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[0] ,1));
			printk("%d           saturationGainX[1]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[1] ,1));
			printk("%d           saturationGainY[1]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[1] ,1));
			printk("%d           saturationGainX[2]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[2] ,1));
			printk("%d           saturationGainY[2]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[2] ,1));
			printk("%d           saturationGainX[3]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[3] ,1));
			printk("%d           saturationGainY[3]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[3] ,1));
			printk("%d           saturationGainX[4]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[4] ,1));
			printk("%d           saturationGainY[4]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[4] ,1));
			printk("%d           saturationGainX[5]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainX[5] ,1));
			printk("%d           saturationGainY[5]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata.variables.saturationGainY[5] ,1));
			printk("\n");

		}
	}
	PRINT_CNT++;
#endif


}
#endif

#if 0
unsigned short C_LUT[65];
unsigned short P_LUT[65];
unsigned short D_LUT[65];
unsigned short D_LUT_THRESHOLD[3];
unsigned short D_LUT_STEP[4];
#endif

#if 0//juwen, tc v140
void fwif_color_set_TC_v130_metadata2reg_init(int display_OETF, int display_Brightness, int proc_mode, int width, int height, int yuv_range)
{
	unsigned short muA, muB;
	SL_HDR1_metadata sl_hdr1_metadata;
	//unsigned short INV_C_LUT[65];
	// UV2 SRGB matrix
	signed short *OCT;
	signed short OCT_709_SDR2MDR[7]  = { 32, 70, 175, 403, -48, -120, 475 };
	signed short OCT_2020_SDR2MDR[7] = { 33, 58, 203, 377, -42, -146, 482 };
	signed short OCT_709_HDR2MDR[7]  = {	0,  0,	 0, 202, -24, -60, 238 };
	signed short OCT_2020_HDR2MDR[7] = {	0,  0,	 0, 189, -21, -73, 241 };

	// RGB2YUV matrix (fixed)
	int RGBtoYUV_709[9] = { 186, 627, 63, -103, -346, 448, 448, -407, -41 };
	int RGBtoYUV_2020[9] = { 230, 595, 52, -125, -323, 448, 448, -412, -36 };
	int *RGBtoYUV;

	//int display_EOTF;
		sl_hdr1_metadata.specVersion = 0;
		sl_hdr1_metadata.payloadMode = 0;
		sl_hdr1_metadata.hdrPicColourSpace = 0;
		sl_hdr1_metadata.hdrMasterDisplayColourSpace = 0;
		sl_hdr1_metadata.hdrMasterDisplayMaxLuminance = 1000;
		sl_hdr1_metadata.hdrMasterDisplayMinLuminance = 0;
		sl_hdr1_metadata.sdrPicColourSpace = 0;
		sl_hdr1_metadata.sdrMasterDisplayColourSpace = 0;
		sl_hdr1_metadata.u.variables.tmInputSignalBlackLevelOffset = 101;
		sl_hdr1_metadata.u.variables.tmInputSignalWhiteLevelOffset = 3;
		sl_hdr1_metadata.u.variables.shadowGain = 88;
		sl_hdr1_metadata.u.variables.highlightGain = 157;
		sl_hdr1_metadata.u.variables.midToneWidthAdjFactor = 0;
		sl_hdr1_metadata.u.variables.tmOutputFineTuningNumVal = 0;
		sl_hdr1_metadata.u.variables.saturationGainNumVal = 6;
		sl_hdr1_metadata.u.variables.saturationGainX[0] = 0;
		sl_hdr1_metadata.u.variables.saturationGainY[0] = 64;
		sl_hdr1_metadata.u.variables.saturationGainX[1] = 5;
		sl_hdr1_metadata.u.variables.saturationGainY[1] = 64;
		sl_hdr1_metadata.u.variables.saturationGainX[2] = 245;
		sl_hdr1_metadata.u.variables.saturationGainY[2] = 64;
		sl_hdr1_metadata.u.variables.saturationGainX[3] = 249;
		sl_hdr1_metadata.u.variables.saturationGainY[3] = 64;
		sl_hdr1_metadata.u.variables.saturationGainX[4] = 253;
		sl_hdr1_metadata.u.variables.saturationGainY[4] = 64;
		sl_hdr1_metadata.u.variables.saturationGainX[5] = 255;
		sl_hdr1_metadata.u.variables.saturationGainY[5] = 64;



	//
	// Preparation of "static" LUTs
	//

	// Compute muA and muB
	drvif_fwif_color_set_TC_v130_Compute_muA_muB(&sl_hdr1_metadata, &muA, &muB);

	// Compute C_LUT
      drvif_fwif_color_set_TC_v130_Compute_C_LUT( proc_mode, &sl_hdr1_metadata, display_Brightness, C_LUT);

	// Compute P_LUT
	drvif_fwif_color_set_TC_v130_Compute_P_LUT( proc_mode, &sl_hdr1_metadata, display_Brightness, P_LUT);

	// Fill D_LUT
      drvif_fwif_color_set_TC_v130_Fill_D_LUT(proc_mode, display_OETF, display_Brightness, D_LUT, D_LUT_THRESHOLD, D_LUT_STEP);

	// OCT matrix pointer
        if (sl_hdr1_metadata.hdrPicColourSpace == 0) // rec709
        {
            OCT = (proc_mode == SDR2MDR) ? OCT_709_SDR2MDR : OCT_709_HDR2MDR;
            RGBtoYUV = RGBtoYUV_709;//juwen, note, use after D LUT. transe DLUT output RGB -> YUV
        }
        else // rec2020
        {
            OCT = (proc_mode == SDR2MDR) ? OCT_2020_SDR2MDR : OCT_2020_HDR2MDR;
            RGBtoYUV = RGBtoYUV_2020;//juwen, note, use after D LUT. transe DLUT output RGB -> YUV
        }

	drvif_fwif_color_set_TC_v130_HW_setting_init(&muA, &muB, OCT,C_LUT, P_LUT, D_LUT, D_LUT_THRESHOLD, D_LUT_STEP,yuv_range,RGBtoYUV);

}
#endif
void fwif_color_ScalerVIP_set_TC_v140_metadata2reg_frameSync(int display_OETF, int display_Brightness, int proc_mode, int width, int height, int yuv_range, _RPC_system_setting_info *RPC_sys_info)
{
	unsigned short muA, muB;
	//SL_HDR1_metadata sl_hdr1_metadata;
	SL_HDR_metadata_140 sl_hdr_metadata = {0};
	//md tc_md;
	//sl_hdr_metadata_tables sl_hdr_metadata_tables_140;
	//sl_hdr_metadata_variables sl_hdr_metadata_variables_140;
	//unsigned short INV_C_LUT[65];
	//int display_EOTF;

	// UV2 SRGB matrix
	//signed short *OCT;
	signed short OCT[7];
	//signed short OCT_709_SDR2MDR[7]  = { 32, 70, 175, 403, -48, -120, 475 };
	//signed short OCT_2020_SDR2MDR[7] = { 33, 58, 203, 377, -42, -146, 482 };
	//signed short OCT_709_HDR2MDR[7]  = {  0,  0,   0, 202, -24, -60, 238 };
	//signed short OCT_2020_HDR2MDR[7] = {  0,  0,   0, 189, -21, -73, 241 };

    // RGB2YUV matrix (fixed)
    int RGBtoYUV_709[9] = { 186, 627, 63, -103, -346, 448, 448, -407, -41 };
    int RGBtoYUV_2020[9] = { 230, 595, 52, -125, -323, 448, 448, -412, -36 };
    int *RGBtoYUV;
	//int i;
	DRV_TC_HDR_CTRL* TC_HDR_CTRL = drvif_fwif_color_Get_TC_CTRL();
	static unsigned int PRINT_CNT = 0;
	//unsigned char iii;
	unsigned int printf_Flag;
	unsigned int print_delay;

	if (1/*sys_info->Debug_Buff_8[0] == 1*/) {//juwen, get v140 metadata from video decoder
#if 1
		sl_hdr_metadata.partID                 							= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.partID, 1);
		sl_hdr_metadata.majorSpecVersionID            					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.majorSpecVersionID, 1);
		sl_hdr_metadata.minorSpecVersionID            					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.minorSpecVersionID, 1);
		sl_hdr_metadata.payloadMode                   					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.payloadMode, 1);
		sl_hdr_metadata.hdrPicColourSpace             					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.hdrPicColourSpace, 1);
		sl_hdr_metadata.hdrDisplayColourSpace         					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.hdrDisplayColourSpace, 1);
		sl_hdr_metadata.hdrDisplayMaxLuminance        					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.hdrDisplayMaxLuminance, 1);
		sl_hdr_metadata.hdrDisplayMinLuminance        					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.hdrDisplayMinLuminance, 1);
		sl_hdr_metadata.sdrPicColourSpace             					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.sdrPicColourSpace, 1);
		sl_hdr_metadata.sdrDisplayColourSpace         					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.sdrDisplayColourSpace, 1);
		sl_hdr_metadata.sdrDisplayMaxLuminance        					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.sdrDisplayMaxLuminance, 1);
		sl_hdr_metadata.sdrDisplayMinLuminance        					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.sdrDisplayMinLuminance, 1);
		sl_hdr_metadata.matrixCoefficient[0]          					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.matrixCoefficient[0], 1);
		sl_hdr_metadata.matrixCoefficient[1]          					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.matrixCoefficient[1], 1);
		sl_hdr_metadata.matrixCoefficient[2]          					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.matrixCoefficient[2], 1);
		sl_hdr_metadata.matrixCoefficient[3]          					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.matrixCoefficient[3], 1);
		sl_hdr_metadata.chromaToLumaInjection[0]      					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.chromaToLumaInjection[0], 1);
		sl_hdr_metadata.chromaToLumaInjection[1]      					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.chromaToLumaInjection[1], 1);
		sl_hdr_metadata.kCoefficient[0]               					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.kCoefficient[0], 1);
		sl_hdr_metadata.kCoefficient[1]               					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.kCoefficient[1], 1);
		sl_hdr_metadata.kCoefficient[2]               					= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.kCoefficient[2], 1);
		sl_hdr_metadata.u.variables.tmInputSignalBlackLevelOffset		= fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmInputSignalBlackLevelOffset, 1);
		sl_hdr_metadata.u.variables.tmInputSignalWhiteLevelOffset       = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmInputSignalWhiteLevelOffset, 1);
		sl_hdr_metadata.u.variables.shadowGain                          = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.shadowGain, 1);
		sl_hdr_metadata.u.variables.highlightGain                       = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.highlightGain, 1);
		sl_hdr_metadata.u.variables.midToneWidthAdjFactor               = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.midToneWidthAdjFactor, 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningNumVal            = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningNumVal, 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningX[0]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningX[0], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningX[1]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningX[1], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningX[2]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningX[2], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningX[3]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningX[3], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningX[4]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningX[4], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningX[5]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningX[5], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningX[6]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningX[6], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningX[7]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningX[7], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningX[8]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningX[8], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningX[9]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningX[9], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningY[0]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningY[0], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningY[1]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningY[1], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningY[2]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningY[2], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningY[3]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningY[3], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningY[4]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningY[4], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningY[5]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningY[5], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningY[6]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningY[6], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningY[7]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningY[7], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningY[8]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningY[8], 1);
		sl_hdr_metadata.u.variables.tmOutputFineTuningY[9]              = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningY[9], 1);
		sl_hdr_metadata.u.variables.saturationGainNumVal                = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainNumVal, 1);
		sl_hdr_metadata.u.variables.saturationGainX[0]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[0], 1);
		sl_hdr_metadata.u.variables.saturationGainX[1]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[1], 1);
		sl_hdr_metadata.u.variables.saturationGainX[2]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[2], 1);
		sl_hdr_metadata.u.variables.saturationGainX[3]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[3], 1);
		sl_hdr_metadata.u.variables.saturationGainX[4]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[4], 1);
		sl_hdr_metadata.u.variables.saturationGainX[5]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[5], 1);
		sl_hdr_metadata.u.variables.saturationGainY[0]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[0], 1);
		sl_hdr_metadata.u.variables.saturationGainY[1]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[1], 1);
		sl_hdr_metadata.u.variables.saturationGainY[2]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[2], 1);
		sl_hdr_metadata.u.variables.saturationGainY[3]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[3], 1);
		sl_hdr_metadata.u.variables.saturationGainY[4]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[4], 1);
		sl_hdr_metadata.u.variables.saturationGainY[5]                  = fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[5], 1);
#endif
	}else{

//metadata init for v140 if do not get metadata
		          sl_hdr_metadata.partID = 1;
		          sl_hdr_metadata.payloadMode = 0;
		          if (sl_hdr_metadata.hdrPicColourSpace == 0) {
		            sl_hdr_metadata.hdrPicColourSpace = 0;
		            sl_hdr_metadata.hdrDisplayColourSpace = 0;
		            sl_hdr_metadata.matrixCoefficient[0] = 915;
		            sl_hdr_metadata.matrixCoefficient[1] = 464;
		            sl_hdr_metadata.matrixCoefficient[2] = 392;
		            sl_hdr_metadata.matrixCoefficient[3] = 987;
		            sl_hdr_metadata.chromaToLumaInjection[0] = 0;
		            sl_hdr_metadata.chromaToLumaInjection[1] = 0;
		          }
		          else {
		            sl_hdr_metadata.hdrPicColourSpace = 1;
		            sl_hdr_metadata.hdrDisplayColourSpace = 2;
		            sl_hdr_metadata.matrixCoefficient[0] = 889;
		            sl_hdr_metadata.matrixCoefficient[1] = 470;
		            sl_hdr_metadata.matrixCoefficient[2] = 366;
		            sl_hdr_metadata.matrixCoefficient[3] = 994;
		            sl_hdr_metadata.chromaToLumaInjection[0] = 0;
		            sl_hdr_metadata.chromaToLumaInjection[1] = 1638;
		          }
		          sl_hdr_metadata.hdrDisplayMaxLuminance = 1000;
		          sl_hdr_metadata.hdrDisplayMinLuminance = 0;
		          sl_hdr_metadata.sdrPicColourSpace = sl_hdr_metadata.hdrPicColourSpace;
		          //sl_hdr_metadata.sdrDisplayColourSpace = sl_hdr_metadata.sdrDisplayColourSpace; //fix coverity self assignment
		          sl_hdr_metadata.sdrDisplayMaxLuminance = 100;
		          sl_hdr_metadata.sdrDisplayMinLuminance = 0;
		          sl_hdr_metadata.kCoefficient[0] = 0;
		          sl_hdr_metadata.kCoefficient[1] = 0;
		          sl_hdr_metadata.kCoefficient[2] = 0;
		          sl_hdr_metadata.u.variables.tmInputSignalBlackLevelOffset = 0;
		          sl_hdr_metadata.u.variables.tmInputSignalWhiteLevelOffset = 0;
		          sl_hdr_metadata.u.variables.shadowGain = 115;
		          sl_hdr_metadata.u.variables.highlightGain = 255;
		          sl_hdr_metadata.u.variables.midToneWidthAdjFactor = 64;
		          sl_hdr_metadata.u.variables.tmOutputFineTuningNumVal = 0;
		          sl_hdr_metadata.u.variables.saturationGainNumVal = 1;
		          sl_hdr_metadata.u.variables.saturationGainX[0] = 0;
		          sl_hdr_metadata.u.variables.saturationGainY[0] = 118;
	}


	// Compute muA and muB
	//drvif_fwif_color_set_TC_v130_Compute_muA_muB(&sl_hdr1_metadata, &muA, &muB);
	drvif_fwif_color_set_TC_v140_Compute_Mu_OCT(&sl_hdr_metadata, display_Brightness,  &muA, &muB, OCT);

	// Compute C_LUT
     //drvif_fwif_color_set_TC_v130_Compute_C_LUT( proc_mode, &sl_hdr1_metadata, display_Brightness, C_LUT);
      drvif_fwif_color_set_TC_v140_Compute_C_LUT( &sl_hdr_metadata, display_Brightness, C_LUT);


	  // Compute P_LUT
	//drvif_fwif_color_set_TC_v130_Compute_P_LUT( proc_mode, &sl_hdr1_metadata, display_Brightness, P_LUT);
	 drvif_fwif_color_set_TC_v140_Compute_P_LUT( &sl_hdr_metadata,display_Brightness,P_LUT);

	// Fill D_LUT
      //drvif_fwif_color_set_TC_v130_Fill_D_LUT(proc_mode, display_OETF, display_Brightness, D_LUT, D_LUT_THRESHOLD, D_LUT_STEP);
      drvif_fwif_color_set_TC_v140_Compute_D_LUT(&sl_hdr_metadata, display_OETF, display_Brightness, D_LUT, D_LUT_THRESHOLD, D_LUT_STEP);

/*
	// OCT matrix pointer
        if (sl_hdr1_metadata.hdrPicColourSpace == 0) // rec709
        {
            OCT = (proc_mode == SDR2MDR) ? OCT_709_SDR2MDR : OCT_709_HDR2MDR;
            RGBtoYUV = RGBtoYUV_709;//juwen, note, use after D LUT. transe DLUT output RGB -> YUV
        }
        else // rec2020
        {
            OCT = (proc_mode == SDR2MDR) ? OCT_2020_SDR2MDR : OCT_2020_HDR2MDR;
            RGBtoYUV = RGBtoYUV_2020;//juwen, note, use after D LUT. transe DLUT output RGB -> YUV
        }
*/
        if (sl_hdr_metadata.hdrPicColourSpace == 0) // rec709
            RGBtoYUV = RGBtoYUV_709;
        else // rec2020
            RGBtoYUV = RGBtoYUV_2020;


	drvif_fwif_color_set_TC_v130_HW_setting_call_Each_Frame(&muA, &muB, OCT,C_LUT, P_LUT, D_LUT, D_LUT_THRESHOLD, D_LUT_STEP, yuv_range,RGBtoYUV);


#if 1	/* for debug*/
	printf_Flag = TC_HDR_CTRL->TC_Debug_Log;
	print_delay = TC_HDR_CTRL->TC_Debug_Delay;
	//juwen, 0315
	if((printf_Flag&_BIT1)!=0) {
		if(PRINT_CNT%print_delay==0) {
			printk("[TC MetaData]\n");
			printk("%d           partID\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.partID ,1));
			printk("%d           payloadMode\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.payloadMode ,1));
			printk("%d           hdrPicColourSpace\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.hdrPicColourSpace ,1));
			printk("%d           hdrDisplayColourSpace\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.hdrDisplayColourSpace ,1));
			printk("%d           hdrDisplayMaxLuminance\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.hdrDisplayMaxLuminance ,1));
			printk("%d           hdrDisplayMinLuminance\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.hdrDisplayMinLuminance ,1));
			printk("%d           sdrPicColourSpace\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.sdrPicColourSpace ,1));
			printk("%d           sdrDisplayColourSpace\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.sdrDisplayColourSpace ,1));
			printk("%d           tmInputSignalBlackLevelOffset\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmInputSignalBlackLevelOffset ,1));
			printk("%d           tmInputSignalWhiteLevelOffset\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmInputSignalWhiteLevelOffset ,1));
			printk("%d           shadowGain\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.shadowGain ,1));
			printk("%d           highlightGain\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.highlightGain ,1));
			printk("%d           midToneWidthAdjFactor\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.midToneWidthAdjFactor ,1));
			printk("%d           tmOutputFineTuningNumVal\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.tmOutputFineTuningNumVal ,1));
			printk("%d           saturationGainNumVal\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainNumVal, 1));
			printk("%d           saturationGainX[0]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[0] ,1));
			printk("%d           saturationGainY[0]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[0] ,1));
			printk("%d           saturationGainX[1]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[1] ,1));
			printk("%d           saturationGainY[1]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[1] ,1));
			printk("%d           saturationGainX[2]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[2] ,1));
			printk("%d           saturationGainY[2]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[2] ,1));
			printk("%d           saturationGainX[3]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[3] ,1));
			printk("%d           saturationGainY[3]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[3] ,1));
			printk("%d           saturationGainX[4]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[4] ,1));
			printk("%d           saturationGainY[4]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[4] ,1));
			printk("%d           saturationGainX[5]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainX[5] ,1));
			printk("%d           saturationGainY[5]\n", fwif_color_ChangeOneUINT32Endian(RPC_sys_info->HDR_info.tc_hdr_metadata_140.variables.saturationGainY[5] ,1));
			printk("\n");

		}
	}
	PRINT_CNT++;
#endif


}
#if 0
unsigned short C_LUT[65];
unsigned short P_LUT[65];
unsigned short D_LUT[65];
unsigned short D_LUT_THRESHOLD[3];
unsigned short D_LUT_STEP[4];
#endif

//void fwif_color_set_TC_v130_metadata2reg_init(int display_OETF, int display_Brightness, int proc_mode, int width, int height, int yuv_range)
void fwif_color_set_TC_v140_metadata2reg_init(int display_OETF, int display_Brightness, int proc_mode, int yuv_range)
{
	unsigned short muA, muB;
	//SL_HDR1_metadata sl_hdr1_metadata;
    SL_HDR_metadata_140 sl_hdr_metadata = {0};
	signed short OCT[7];

    // RGB2YUV matrix (fixed)
    int RGBtoYUV_709[9] = { 186, 627, 63, -103, -346, 448, 448, -407, -41 };
    int RGBtoYUV_2020[9] = { 230, 595, 52, -125, -323, 448, 448, -412, -36 };
    int *RGBtoYUV;

//metadata init
          sl_hdr_metadata.partID = 1;
          sl_hdr_metadata.payloadMode = 0;
          if (sl_hdr_metadata.hdrPicColourSpace == 0) {
            sl_hdr_metadata.hdrPicColourSpace = 0;
            sl_hdr_metadata.hdrDisplayColourSpace = 0;
            sl_hdr_metadata.matrixCoefficient[0] = 915;
            sl_hdr_metadata.matrixCoefficient[1] = 464;
            sl_hdr_metadata.matrixCoefficient[2] = 392;
            sl_hdr_metadata.matrixCoefficient[3] = 987;
            sl_hdr_metadata.chromaToLumaInjection[0] = 0;
            sl_hdr_metadata.chromaToLumaInjection[1] = 0;
          }
          else {
            sl_hdr_metadata.hdrPicColourSpace = 1;
            sl_hdr_metadata.hdrDisplayColourSpace = 2;
            sl_hdr_metadata.matrixCoefficient[0] = 889;
            sl_hdr_metadata.matrixCoefficient[1] = 470;
            sl_hdr_metadata.matrixCoefficient[2] = 366;
            sl_hdr_metadata.matrixCoefficient[3] = 994;
            sl_hdr_metadata.chromaToLumaInjection[0] = 0;
            sl_hdr_metadata.chromaToLumaInjection[1] = 1638;
          }
          sl_hdr_metadata.hdrDisplayMaxLuminance = 1000;
          sl_hdr_metadata.hdrDisplayMinLuminance = 0;
          sl_hdr_metadata.sdrPicColourSpace = sl_hdr_metadata.hdrPicColourSpace;
          //sl_hdr_metadata.sdrDisplayColourSpace = sl_hdr_metadata.sdrDisplayColourSpace; //fix coverity self assignment
          sl_hdr_metadata.sdrDisplayMaxLuminance = 100;
          sl_hdr_metadata.sdrDisplayMinLuminance = 0;
          sl_hdr_metadata.kCoefficient[0] = 0;
          sl_hdr_metadata.kCoefficient[1] = 0;
          sl_hdr_metadata.kCoefficient[2] = 0;
          sl_hdr_metadata.u.variables.tmInputSignalBlackLevelOffset = 0;
          sl_hdr_metadata.u.variables.tmInputSignalWhiteLevelOffset = 0;
          sl_hdr_metadata.u.variables.shadowGain = 115;
          sl_hdr_metadata.u.variables.highlightGain = 255;
          sl_hdr_metadata.u.variables.midToneWidthAdjFactor = 64;
          sl_hdr_metadata.u.variables.tmOutputFineTuningNumVal = 0;
          sl_hdr_metadata.u.variables.saturationGainNumVal = 1;
          sl_hdr_metadata.u.variables.saturationGainX[0] = 0;
          sl_hdr_metadata.u.variables.saturationGainY[0] = 118;



	//
	// Preparation of "static" LUTs
	//

	// Compute muA and muB
	//drvif_fwif_color_set_TC_v130_Compute_muA_muB(&sl_hdr1_metadata, &muA, &muB);
	drvif_fwif_color_set_TC_v140_Compute_Mu_OCT(&sl_hdr_metadata, display_Brightness,  &muA, &muB, OCT);

	// Compute C_LUT
      //drvif_fwif_color_set_TC_v130_Compute_C_LUT( proc_mode, &sl_hdr1_metadata, display_Brightness, C_LUT);
     drvif_fwif_color_set_TC_v140_Compute_C_LUT( &sl_hdr_metadata, display_Brightness, C_LUT);

	// Compute P_LUT
	//drvif_fwif_color_set_TC_v130_Compute_P_LUT( proc_mode, &sl_hdr1_metadata, display_Brightness, P_LUT);
	 drvif_fwif_color_set_TC_v140_Compute_P_LUT( &sl_hdr_metadata,display_Brightness,P_LUT);

	// Fill D_LUT
      //drvif_fwif_color_set_TC_v130_Fill_D_LUT(proc_mode, display_OETF, display_Brightness, D_LUT, D_LUT_THRESHOLD, D_LUT_STEP);
      drvif_fwif_color_set_TC_v140_Compute_D_LUT(&sl_hdr_metadata, display_OETF, display_Brightness, D_LUT, D_LUT_THRESHOLD, D_LUT_STEP);

        if (sl_hdr_metadata.hdrPicColourSpace == 0) // rec709
            RGBtoYUV = RGBtoYUV_709;
        else // rec2020
            RGBtoYUV = RGBtoYUV_2020;

	drvif_fwif_color_set_TC_v130_HW_setting_init(&muA, &muB, OCT,C_LUT, P_LUT, D_LUT, D_LUT_THRESHOLD, D_LUT_STEP,yuv_range,RGBtoYUV);

}



void* fwif_color_Get_TC_CTRL(void)
{
	DRV_TC_HDR_CTRL *p;
	p = drvif_fwif_color_Get_TC_CTRL();
	if (p == NULL)
		rtd_pr_vpq_emerg("TC CTRL struc = NULL\n");

	return (void*)p;
}

char fwif_color_ScalerVIP_TC_metadata_frameSync(void)
{
	int display_OETF, display_Brightness, proc_mode, yuv_range;
	_RPC_system_setting_info *RPC_sys_info = NULL;
	DRV_TC_HDR_CTRL *pTC_HDR_CTRL = NULL;
	unsigned int printf_Flag;
	unsigned int print_delay;
	unsigned int clk_0 = 0, clk_1 = 0;
	unsigned short v_sta = 0, v_len = 0, line_cnt_0 = 0, line_cnt_1 = 0;
	static unsigned int PRINT_CNT = 0;

	RPC_sys_info = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	pTC_HDR_CTRL = (DRV_TC_HDR_CTRL*)fwif_color_Get_TC_CTRL();
	if (RPC_sys_info == NULL || pTC_HDR_CTRL == NULL) {
		rtd_pr_vpq_emerg("TC frame sync, point = NULL, syste, info = %p, TC_HDR_CTRL = %p\n", RPC_sys_info, pTC_HDR_CTRL);

		return -1;
	}

	/* for performance measure*/
	printf_Flag = pTC_HDR_CTRL->TC_Debug_Log;
	print_delay = pTC_HDR_CTRL->TC_Debug_Delay;
	if((printf_Flag&_BIT1)!=0) {
		clk_0 = drvif_Get_90k_Lo_clk();
		drvif_Get_VGIP_Active_Info(&v_sta, &v_len, &line_cnt_0);
	}

	if (pTC_HDR_CTRL->Enable == 1) {
		display_OETF = pTC_HDR_CTRL->TC_CTRL[TC_HDR_display_OETF];
		display_Brightness = pTC_HDR_CTRL->TC_CTRL[TC_HDR_display_Brightness];
		proc_mode = pTC_HDR_CTRL->TC_CTRL[TC_HDR_display_proc_mode];
		yuv_range = pTC_HDR_CTRL->TC_CTRL[TC_HDR_display_yuv_range];
		fwif_color_ScalerVIP_set_TC_v140_metadata2reg_frameSync(display_OETF, display_Brightness, proc_mode, 0, 0, yuv_range,  RPC_sys_info);
	}

	/* for performance measure*/
	if((printf_Flag&_BIT1)!=0) {
		clk_1 = drvif_Get_90k_Lo_clk();
		drvif_Get_VGIP_Active_Info(&v_sta, &v_len, &line_cnt_1);
		if (print_delay == 0)
			print_delay = 100;
		if(PRINT_CNT%print_delay==0) {
			rtd_pr_vpq_info("TC frame sync, 90k clock diff = %d, VGIP lint cnt diff = %d\n", clk_1-clk_0, line_cnt_1-line_cnt_0);
		}
	}
	PRINT_CNT++;

	return 0;
}

void fwif_color_TC_Flow(unsigned char TC_En)
{
	extern dm_dm_submodule_enable_RBUS dm_submodule_temp;
	unsigned int I3DDMA_Color_format, DisplayMode_Src;

	I3DDMA_Color_format = (unsigned int)drvif_I3DDMA_Get_Input_Info_Vaule(I3DDMA_INFO_TARGET_COLOR);
	DisplayMode_Src = (unsigned int)Get_DisplayMode_Src(SLR_MAIN_DISPLAY);
	rtd_pr_vpq_info("fwif_color_TC_Flow, TC_En=%d, I3DDMA_Color_format=%d, DisplayMode_Src=%d,\n", TC_En, I3DDMA_Color_format, DisplayMode_Src);

	if (TC_En == 1) {
		dm_submodule_temp.regValue = 0;
		drvif_color_set_TC_Run_Mode(1);
		drvif_color_set_TC_Enable(1);

	} else {
#if 0	/* move to fwif_color_set_HDR10_runmode() */
		if ((I3DDMA_Color_format == I3DDMA_COLOR_YUV444) && (DisplayMode_Src == VSC_INPUTSRC_HDMI))
			drvif_color_set_TC_Run_Mode(1);
		else
			drvif_color_set_TC_Run_Mode(0);
#endif
		drvif_color_set_TC_Enable(0);
	}
}

char fwif_color_set_TC_FrameSync_Enable(unsigned char Enable_flag)
{
	extern VIP_TCHDR_Mode_TBL TCHDR_Mode_TBL;

	_RPC_system_setting_info *RPC_sys_info = NULL;
	SLR_VOINFO* pVOInfo = NULL;
	DRV_TC_HDR_CTRL *pTC_HDR_CTRL = NULL;

	pTC_HDR_CTRL = (DRV_TC_HDR_CTRL*)fwif_color_Get_TC_CTRL();

	pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());

	RPC_sys_info = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	if (RPC_sys_info == NULL || pVOInfo == NULL || pTC_HDR_CTRL == NULL) {
		rtd_pr_vpq_emerg("TC frame sync, point = NULL, syste, info = %p, pVOInfo = %p, pTC_HDR_CTRL= %p\n", RPC_sys_info, pVOInfo, pTC_HDR_CTRL);
		return -1;
	}

	if (Enable_flag == 1) {
		if (pVOInfo->video_full_range_flag == 1)
			pTC_HDR_CTRL->TC_CTRL[TC_HDR_display_yuv_range] = TC_YUV_Range_Full;
		else
			pTC_HDR_CTRL->TC_CTRL[TC_HDR_display_yuv_range] = TC_YUV_Range_Limit;

		if (((pVOInfo->colour_primaries == 9) || (pVOInfo->colour_primaries == 2)) && ((pVOInfo->transfer_characteristics == 16) || (pVOInfo->transfer_characteristics == 18)))
			pTC_HDR_CTRL->TC_CTRL[TC_HDR_display_proc_mode] = TC_Proc_Mode_HDR;
		else
			pTC_HDR_CTRL->TC_CTRL[TC_HDR_display_proc_mode] = TC_Proc_Mode_SDR;

		pTC_HDR_CTRL->TC_CTRL[TC_HDR_display_Brightness] = TCHDR_Mode_TBL.display_Brightness;
		pTC_HDR_CTRL->TC_CTRL[TC_HDR_display_OETF] = TCHDR_Mode_TBL.display_OETF;

		pTC_HDR_CTRL->Enable = 1;
	} else {
		pTC_HDR_CTRL->Enable = 0;
	}

	return 0;

}

char fwif_color_Reg_TC_DMA_addr(void)
{
	DRV_TC_HDR_CTRL* TC_HDR_CTRL = NULL;
	unsigned int addr_C_LUT = 0, addr_I_LUT = 0, addr_S_LUT = 0, addr_P_LUT = 0, addr_D_LUT = 0,size = 0;
	unsigned int  *pVir_addr = NULL;
	unsigned char C_LUT_remap = 0, I_LUT_remap = 0, S_LUT_remap = 0, P_LUT_remap = 0, D_LUT_remap = 0;
#if 0
	TC_HDR_CTRL = drvif_fwif_color_Get_TC_CTRL();
	addr_C_LUT = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_TC_C_LUT);
	addr_I_LUT = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_TC_I_LUT);
	addr_S_LUT = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_TC_S_LUT);
	addr_P_LUT = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_TC_P_LUT);
	addr_D_LUT = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_TC_D_LUT);
#else
	unsigned int VIP_DMAto3DTable_TC_C_LUT_SIZE = 20 * 1024;
	unsigned int VIP_DMAto3DTable_TC_I_LUT_SIZE = 20 * 1024;
	unsigned int VIP_DMAto3DTable_TC_S_LUT_SIZE = 20 * 1024;
	unsigned int VIP_DMAto3DTable_TC_P_LUT_SIZE = 20 * 1024;
	unsigned int VIP_DMAto3DTable_TC_D_LUT_SIZE = 20 * 1024;
	TC_HDR_CTRL = drvif_fwif_color_Get_TC_CTRL();
	addr_C_LUT = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_TC_LUT);
	addr_I_LUT = addr_C_LUT + 20 * 1024;
	addr_S_LUT = addr_C_LUT + 20 * 1024 * 2;
	addr_P_LUT = addr_C_LUT + 20 * 1024 * 3;
	addr_D_LUT = addr_C_LUT + 20 * 1024 * 4;

#endif
	if (TC_HDR_CTRL == NULL || addr_C_LUT == 0 || addr_I_LUT == 0 || addr_S_LUT == 0 || addr_P_LUT == 0 || addr_D_LUT == 0) {
		rtd_pr_vpq_emerg("get TC DMA error, TC_HDR_CTRL= %p, addr_C_LUT = %x, addr_I_LUT = %x, addr_S_LUT = %x, addr_P_LUT = %x, addr_D_LUT = %x\n",
			TC_HDR_CTRL, addr_C_LUT, addr_I_LUT, addr_S_LUT, addr_P_LUT, addr_D_LUT);
		return -1;
	}

	/* TC C_LUT*/
	if (TC_HDR_CTRL->C_LUT_DMA.pVir_addr_align == NULL) {
		addr_C_LUT = drvif_memory_get_data_align(addr_C_LUT, (1 << 12));
		size = drvif_memory_get_data_align(VIP_DMAto3DTable_TC_C_LUT_SIZE, (1 << 12));
		TC_HDR_CTRL->C_LUT_DMA.phy_addr_align = addr_C_LUT;
		TC_HDR_CTRL->C_LUT_DMA.size = size;
		pVir_addr = dvr_remap_uncached_memory(addr_C_LUT, size, __builtin_return_address(0));
		TC_HDR_CTRL->C_LUT_DMA.pVir_addr_align = pVir_addr;
		C_LUT_remap = 1;
	}

	/* TC I_LUT*/
	if (TC_HDR_CTRL->I_LUT_DMA.pVir_addr_align ==  NULL) {
		addr_I_LUT = drvif_memory_get_data_align(addr_I_LUT, (1 << 12));
		size = drvif_memory_get_data_align(VIP_DMAto3DTable_TC_I_LUT_SIZE, (1 << 12));
		TC_HDR_CTRL->I_LUT_DMA.phy_addr_align = addr_I_LUT;
		TC_HDR_CTRL->I_LUT_DMA.size = size;
		pVir_addr = dvr_remap_uncached_memory(addr_I_LUT, size, __builtin_return_address(0));
		TC_HDR_CTRL->I_LUT_DMA.pVir_addr_align = pVir_addr;
		I_LUT_remap = 1;
	}

	/* TC S_LUT*/
	if (TC_HDR_CTRL->S_LUT_DMA.pVir_addr_align == NULL) {
		addr_S_LUT = drvif_memory_get_data_align(addr_S_LUT, (1 << 12));
		size = drvif_memory_get_data_align(VIP_DMAto3DTable_TC_S_LUT_SIZE, (1 << 12));
		TC_HDR_CTRL->S_LUT_DMA.phy_addr_align = addr_S_LUT;
		TC_HDR_CTRL->S_LUT_DMA.size = size;
		pVir_addr = dvr_remap_uncached_memory(addr_S_LUT, size, __builtin_return_address(0));
		TC_HDR_CTRL->S_LUT_DMA.pVir_addr_align = pVir_addr;
		S_LUT_remap = 1;
	}

	/* TC P_LUT*/
	if (TC_HDR_CTRL->P_LUT_DMA.pVir_addr_align == NULL) {
		addr_P_LUT = drvif_memory_get_data_align(addr_P_LUT, (1 << 12));
		size = drvif_memory_get_data_align(VIP_DMAto3DTable_TC_P_LUT_SIZE, (1 << 12));
		TC_HDR_CTRL->P_LUT_DMA.phy_addr_align = addr_P_LUT;
		TC_HDR_CTRL->P_LUT_DMA.size = size;
		pVir_addr = dvr_remap_uncached_memory(addr_P_LUT, size, __builtin_return_address(0));
		TC_HDR_CTRL->P_LUT_DMA.pVir_addr_align = pVir_addr;
		P_LUT_remap = 1;
	}

	/* TC D_LUT*/
	if (TC_HDR_CTRL->D_LUT_DMA.pVir_addr_align == NULL) {
		addr_D_LUT = drvif_memory_get_data_align(addr_D_LUT, (1 << 12));
		size = drvif_memory_get_data_align(VIP_DMAto3DTable_TC_D_LUT_SIZE, (1 << 12));
		TC_HDR_CTRL->D_LUT_DMA.phy_addr_align = addr_D_LUT;
		TC_HDR_CTRL->D_LUT_DMA.size = size;
		pVir_addr = dvr_remap_uncached_memory(addr_D_LUT, size, __builtin_return_address(0));
		TC_HDR_CTRL->D_LUT_DMA.pVir_addr_align = pVir_addr;
		D_LUT_remap = 1;
	}
	rtd_pr_vpq_info("TC ini,Clut[%x,%p,%d,%d],Ilut[%x,%p,%d,%d],Slut[%x,%p,%d,%d],Plut[%x,%p,%d,%d],Dlut[%x,%p,%d,%d]\n",
		TC_HDR_CTRL->C_LUT_DMA.phy_addr_align, TC_HDR_CTRL->C_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->C_LUT_DMA.size, C_LUT_remap,
		TC_HDR_CTRL->I_LUT_DMA.phy_addr_align, TC_HDR_CTRL->I_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->I_LUT_DMA.size, I_LUT_remap,
		TC_HDR_CTRL->S_LUT_DMA.phy_addr_align, TC_HDR_CTRL->S_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->S_LUT_DMA.size, S_LUT_remap,
		TC_HDR_CTRL->P_LUT_DMA.phy_addr_align, TC_HDR_CTRL->P_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->P_LUT_DMA.size, P_LUT_remap,
		TC_HDR_CTRL->D_LUT_DMA.phy_addr_align, TC_HDR_CTRL->D_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->D_LUT_DMA.size, D_LUT_remap);

#ifdef CONFIG_BW_96B_ALIGNED
	/* TC C_LUT*/
	if (C_LUT_remap == 1) {
		TC_HDR_CTRL->C_LUT_DMA.size = dvr_size_alignment(TC_HDR_CTRL->C_LUT_DMA.size);
		TC_HDR_CTRL->C_LUT_DMA.phy_addr_align = (unsigned int)dvr_memory_alignment((unsigned long)TC_HDR_CTRL->C_LUT_DMA.phy_addr_align, TC_HDR_CTRL->C_LUT_DMA.size);
		TC_HDR_CTRL->C_LUT_DMA.pVir_addr_align = (unsigned int*)dvr_memory_alignment((unsigned long)TC_HDR_CTRL->C_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->C_LUT_DMA.size);
		if ((TC_HDR_CTRL->C_LUT_DMA.phy_addr_align == 0) || (TC_HDR_CTRL->C_LUT_DMA.pVir_addr_align == NULL)) {
			rtd_pr_vpq_emerg("TC, C_LUT 96 aligned fail, addr=%x, pVir_addr=%p,\n",
				TC_HDR_CTRL->C_LUT_DMA.phy_addr_align, TC_HDR_CTRL->C_LUT_DMA.pVir_addr_align);
			BUG();
		}

	}

	/* TC I_LUT*/
	if (I_LUT_remap == 1) {
		TC_HDR_CTRL->I_LUT_DMA.size = dvr_size_alignment(TC_HDR_CTRL->I_LUT_DMA.size);
		TC_HDR_CTRL->I_LUT_DMA.phy_addr_align = (unsigned int)dvr_memory_alignment((unsigned long)TC_HDR_CTRL->I_LUT_DMA.phy_addr_align, TC_HDR_CTRL->I_LUT_DMA.size);
		TC_HDR_CTRL->I_LUT_DMA.pVir_addr_align = (unsigned int*)dvr_memory_alignment((unsigned long)TC_HDR_CTRL->I_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->I_LUT_DMA.size);
		if ((TC_HDR_CTRL->I_LUT_DMA.phy_addr_align == 0) || (TC_HDR_CTRL->I_LUT_DMA.pVir_addr_align == NULL)) {
			rtd_pr_vpq_emerg("TC, I_LUT 96 aligned fail, addr=%x, pVir_addr=%p,\n",
				TC_HDR_CTRL->I_LUT_DMA.phy_addr_align, TC_HDR_CTRL->I_LUT_DMA.pVir_addr_align);
			BUG();
		}
	}

	/* TC S_LUT*/
	if (S_LUT_remap == 1) {
		TC_HDR_CTRL->S_LUT_DMA.size = dvr_size_alignment(TC_HDR_CTRL->S_LUT_DMA.size);
		TC_HDR_CTRL->S_LUT_DMA.phy_addr_align = (unsigned int)dvr_memory_alignment((unsigned long)TC_HDR_CTRL->S_LUT_DMA.phy_addr_align, TC_HDR_CTRL->S_LUT_DMA.size);
		TC_HDR_CTRL->S_LUT_DMA.pVir_addr_align = (unsigned int*)dvr_memory_alignment((unsigned long)TC_HDR_CTRL->S_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->S_LUT_DMA.size);
		if ((TC_HDR_CTRL->S_LUT_DMA.phy_addr_align == 0) || (TC_HDR_CTRL->S_LUT_DMA.pVir_addr_align == NULL)) {
			rtd_pr_vpq_emerg("TC, S_LUT 96 aligned fail, addr=%x, pVir_addr=%p,\n",
				TC_HDR_CTRL->S_LUT_DMA.phy_addr_align, TC_HDR_CTRL->S_LUT_DMA.pVir_addr_align);
			BUG();
		}
	}

	/* TC P_LUT*/
	if (P_LUT_remap == 1) {
		TC_HDR_CTRL->P_LUT_DMA.size = dvr_size_alignment(TC_HDR_CTRL->P_LUT_DMA.size);
		TC_HDR_CTRL->P_LUT_DMA.phy_addr_align = (unsigned int)dvr_memory_alignment((unsigned long)TC_HDR_CTRL->P_LUT_DMA.phy_addr_align, TC_HDR_CTRL->P_LUT_DMA.size);
		TC_HDR_CTRL->P_LUT_DMA.pVir_addr_align = (unsigned int*)dvr_memory_alignment((unsigned long)TC_HDR_CTRL->P_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->P_LUT_DMA.size);
			if ((TC_HDR_CTRL->P_LUT_DMA.phy_addr_align == 0) || (TC_HDR_CTRL->P_LUT_DMA.pVir_addr_align == NULL)) {
			rtd_pr_vpq_emerg("TC, P_LUT 96 aligned fail, addr=%x, pVir_addr=%p,\n",
				TC_HDR_CTRL->P_LUT_DMA.phy_addr_align, TC_HDR_CTRL->P_LUT_DMA.pVir_addr_align);
			BUG();
		}
	}

	/* TC D_LUT*/
	if (D_LUT_remap == 1) {
		TC_HDR_CTRL->D_LUT_DMA.size = dvr_size_alignment(TC_HDR_CTRL->D_LUT_DMA.size);
		TC_HDR_CTRL->D_LUT_DMA.phy_addr_align = (unsigned int)dvr_memory_alignment((unsigned long)TC_HDR_CTRL->D_LUT_DMA.phy_addr_align, TC_HDR_CTRL->D_LUT_DMA.size);
		TC_HDR_CTRL->D_LUT_DMA.pVir_addr_align = (unsigned int*)dvr_memory_alignment((unsigned long)TC_HDR_CTRL->D_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->D_LUT_DMA.size);
			if ((TC_HDR_CTRL->D_LUT_DMA.phy_addr_align == 0) || (TC_HDR_CTRL->D_LUT_DMA.pVir_addr_align == NULL)) {
			rtd_pr_vpq_emerg("TC, D_LUT 96 aligned fail, addr=%x, pVir_addr=%p,\n",
				TC_HDR_CTRL->D_LUT_DMA.phy_addr_align, TC_HDR_CTRL->D_LUT_DMA.pVir_addr_align);
			BUG();
		}
	}

	rtd_pr_vpq_info("TC ini, 96B aligned,Clut[%x,%p,%d,%d],Ilut[%x,%p,%d,%d],Slut[%x,%p,%d,%d],Plut[%x,%p,%d,%d],Dlut[%x,%p,%d,%d]\n",
		TC_HDR_CTRL->C_LUT_DMA.phy_addr_align, TC_HDR_CTRL->C_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->C_LUT_DMA.size, C_LUT_remap,
		TC_HDR_CTRL->I_LUT_DMA.phy_addr_align, TC_HDR_CTRL->I_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->I_LUT_DMA.size, I_LUT_remap,
		TC_HDR_CTRL->S_LUT_DMA.phy_addr_align, TC_HDR_CTRL->S_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->S_LUT_DMA.size, S_LUT_remap,
		TC_HDR_CTRL->P_LUT_DMA.phy_addr_align, TC_HDR_CTRL->P_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->P_LUT_DMA.size, P_LUT_remap,
		TC_HDR_CTRL->D_LUT_DMA.phy_addr_align, TC_HDR_CTRL->D_LUT_DMA.pVir_addr_align, TC_HDR_CTRL->D_LUT_DMA.size, D_LUT_remap);
#endif

	return 0;
}

#endif
//====================20161027 END=========================================================

/*========================== ST2094==========================================*/
#if 1
char fwif_color_set_ST2094_FrameSync_Enable(unsigned char Enable)
{
	VIP_ST2094_CTRL* ST2094_CTRL = NULL;
	extern VIP_ST2094_TBL ST2094_TBL;
	ST2094_CTRL = drvif_fwif_color_Get_ST2094_Ctrl();

	if (ST2094_CTRL == NULL ) {
		rtd_pr_vpq_emerg("get ST2094 CTRL error, ST2094_CTRL=%p\n",
			ST2094_CTRL);
		return -1;
	}

	ST2094_CTRL->Enable = Enable;

	if (Enable == 1) {
		drvif_fwif_color_Set_ST2094_demo_flag(ST2094_Demo_OFF, ST2094_flow_layer);
		memcpy((unsigned char*)drvif_fwif_color_Get_ST2094_TBL(),  (unsigned char*)&ST2094_TBL, sizeof(VIP_ST2094_TBL));
	}
	return 0;
}

int fwif_color_ScalerVIP_ST2094_demo_flow(void)
{
	//extern unsigned int EOTF_LUT_R[1025];
	//extern unsigned short OETF_LUT_ByMaxCLL_ByPanelLuminance[1025];
	//extern unsigned int hdr_RGB2OPT[HDR_RGB2OPT_TABLE_NUM][9];
	//extern unsigned short tRGB2YUV_COEF[RGB2YUV_COEF_MATRIX_MODE_Max][RGB2YUV_COEF_MATRIX_ITEMS_Max];
	extern unsigned short OETF_ST2094_demo_hdr10[OETF_size];
	extern unsigned int EOTF_ST2094_demo_hdr10[EOTF_size];

	SLR_VIP_TABLE *gVIP_Table;
	unsigned char LC_En,/* LC_table_sel,*/ vip_src;
	_RPC_system_setting_info *RPC_sys_info;
	_system_setting_info * VIP_system_info_structure_table;
	VIP_ST2094_CTRL* ST2094_CTRL = NULL;
	static unsigned char CNT = 0;
	int ST2094_demo_mode[VIP_ST2094_layer_MAX] = {ST2094_Demo_OFF};
	unsigned char Debug_Log, Debug_log_delay;
	//SLR_VOINFO* pVOInfo = NULL;

	ST2094_CTRL = drvif_fwif_color_Get_ST2094_Ctrl();
	RPC_sys_info = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	gVIP_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	ST2094_demo_mode[ST2094_flow_layer] = drvif_fwif_color_Get_ST2094_demo_flag(ST2094_flow_layer);
	ST2094_demo_mode[ST2094_engMenu_layer] = drvif_fwif_color_Get_ST2094_demo_flag(ST2094_engMenu_layer);

	CNT++;

	if (ST2094_CTRL == NULL || RPC_sys_info == NULL || gVIP_Table == NULL || VIP_system_info_structure_table == NULL) {
		if ((CNT % 100) == 0)
			rtd_pr_vpq_emerg("ST2094 demo flow, ST2094_CTRL=%p, RPC_sys_info=%p, gVIP_Table=%p,VIP_system_info_structure_table=%p \n",
				ST2094_CTRL, RPC_sys_info, gVIP_Table, VIP_system_info_structure_table);
		return -1;
	}

	Debug_Log = ST2094_CTRL->Debug_Log;
	Debug_log_delay = ST2094_CTRL->Debug_Delay;

	if (ST2094_demo_mode[ST2094_engMenu_layer] != ST2094_demo_mode[ST2094_flow_layer]) {
		if (ST2094_demo_mode[ST2094_engMenu_layer] == ST2094_Demo_OFF) {

			drvif_color_set_BBC_Enable(2);
			drvif_DM2_GAMMA_Enable(1);

			vip_src = RPC_sys_info->VIP_source;
			LC_En = gVIP_Table->VIP_QUALITY_Extend_Coef[vip_src][VIP_QUALITY_FUNCTION_LC_Enable];
			//LC_table_sel = gVIP_Table->VIP_QUALITY_Extend_Coef[vip_src][VIP_QUALITY_FUNCTION_LC_Table];
			Scaler_SetLocalContrastEnable(LC_En);

			/* set color matrs flow*/
			Scaler_Set_HDR_YUV2RGB(SLR_MAIN_DISPLAY, HAL_VPQ_HDR_MODE_ST2094, HAL_VPQ_COLORIMETRY_BT2020);
			memcpy((unsigned short *)(&VIP_system_info_structure_table->RGB2YUV_COEF_CSMatrix), &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_0_255_TO_YCC709_16_235][0]), sizeof(VIP_RGB2YUV_COEF_CSMatrix));
			scalerVIP_Write_RGB2YUV(1);

			drvif_fwif_color_Set_ST2094_demo_flag(ST2094_Demo_OFF, ST2094_flow_layer);

		} else if (ST2094_demo_mode[ST2094_engMenu_layer] == ST2094_Demo_ON_HDR10) {
			//pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());
			drvif_DM2_EOTF_Set_By_DMA(EOTF_ST2094_demo_hdr10, EOTF_ST2094_demo_hdr10, EOTF_ST2094_demo_hdr10,
				ST2094_CTRL->EOTF_DMA.phy_addr_align, ST2094_CTRL->EOTF_DMA.pVir_addr_align);
			drvif_DM2_OETF_Set_By_DMA(OETF_ST2094_demo_hdr10, OETF_ST2094_demo_hdr10, OETF_ST2094_demo_hdr10,
				ST2094_CTRL->OETF_DMA.phy_addr_align, ST2094_CTRL->OETF_DMA.pVir_addr_align);
			drvif_color_Set_ST2094_3Dlut_CInv(1024, 0);
			drvif_color_set_BBC_Enable(0);
			drvif_DM2_GAMMA_Enable(0);
			drvif_color_Set_HDR_OETF_Decrease(0);

			Scaler_SetLocalContrastEnable(0);

			/* set color matrs flow*/
			Scaler_Set_HDR_YUV2RGB(SLR_MAIN_DISPLAY, HAL_VPQ_HDR_MODE_HDR10, HAL_VPQ_COLORIMETRY_BT2020);
			//drvif_color_colorspacergb2yuvtransfer(SLR_MAIN_DISPLAY, &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235][0]));
			memcpy((unsigned short *)(&VIP_system_info_structure_table->RGB2YUV_COEF_CSMatrix), &(tRGB2YUV_COEF[RGB2YUV_COEF_RGB_16_235_TO_YCC709_16_235][0]), sizeof(VIP_RGB2YUV_COEF_CSMatrix));
			scalerVIP_Write_RGB2YUV(1);

			drvif_fwif_color_Set_ST2094_demo_flag(ST2094_Demo_ON_HDR10, ST2094_flow_layer);

		}
	}


	if((Debug_Log&_BIT2)!=0) {
		if (CNT >= Debug_log_delay) {
			CNT = 0;
			rtd_pr_vpq_info("ST2094 demo mode, flow =%d, eng=%d \n", ST2094_demo_mode[ST2094_flow_layer], ST2094_demo_mode[ST2094_engMenu_layer]);
		}
	}

	return ST2094_demo_mode[ST2094_engMenu_layer];

}

char fwif_color_ScalerVIP_ST2094_frameSync(void)
{
	extern VIP_ST2094_TBL ST2094_TBL;
	VIP_ST2094_CTRL* ST2094_CTRL = NULL;
	static unsigned char CNT = 0;
	_RPC_system_setting_info *RPC_sys_info;
	unsigned char Debug_Log, Debug_log_delay;
	unsigned short v_sta, v_len;
	unsigned short line_start, line_end;
	unsigned int clk_start, clk_end;

	CNT++;
	ST2094_CTRL = drvif_fwif_color_Get_ST2094_Ctrl();
	RPC_sys_info = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	if (ST2094_CTRL == NULL || RPC_sys_info == NULL) {
		if ((CNT % 100) == 0)
			rtd_pr_vpq_emerg("ST2094_frameSync error, ST2094_CTRL=%p, RPC_sys_info=%p \n", ST2094_CTRL, RPC_sys_info);
		return -1;
	}

	if (ST2094_CTRL->Enable != 1)	/* is not ST2094 case */
		return 1;

	Debug_Log = ST2094_CTRL->Debug_Log;
	Debug_log_delay = ST2094_CTRL->Debug_Delay;

	if (fwif_color_ScalerVIP_ST2094_demo_flow() == ST2094_Demo_OFF){	/* default setting, demo mode is enabled by engineer menu or tool*/

		if((Debug_Log&_BIT2)!=0) {
			clk_start = drvif_Get_90k_Lo_clk();
			drvif_Get_VGIP_Active_Info(&v_sta, &v_len, &line_start);
		}

		drvif_fwif_color_ScalerVIP_set_ST2094_metadata2reg_frameSync(0, RPC_sys_info, ST2094_CTRL);

		if((Debug_Log&_BIT2)!=0) {
			clk_end = drvif_Get_90k_Lo_clk();
			drvif_Get_VGIP_Active_Info(&v_sta, &v_len, &line_end);

			ST2094_CTRL->Debug_VGIP_Line_sta = line_start;
			ST2094_CTRL->Debug_VGIP_Line_end = line_end;
			ST2094_CTRL->Debug_VGIP_Line_diff = line_end-line_start;
			ST2094_CTRL->Debug_90clk_sta = clk_start;
			ST2094_CTRL->Debug_90clk_end = clk_end;
			ST2094_CTRL->Debug_90clk_diff = clk_end-clk_start;

			if (CNT >= Debug_log_delay) {
				CNT = 0;
				rtd_pr_vpq_info("ST2094 frame sync, 90k clock diff = %d, VGIP lint cnt diff = %d,v_sta=%d, v_len=%d, \n",
					clk_end-clk_start, line_end-line_start, v_sta, v_len);
			}
		}

	}

	return 0;
}

char fwif_color_ST2094_Ctrl_Structure_ini(void)
{
	VIP_ST2094_CTRL* ST2094_CTRL = NULL;
	unsigned int eotf_phy_addr = 0, oetf_phy_addr = 0, HDR_3D_LUT_phy_addr = 0;
	unsigned int  *pVir_addr = NULL;
	unsigned int size;
	unsigned char OETF_remap = 0, EOTF_remap = 0/*, HDR_3DLUT_remap = 0*/;
	_RPC_system_setting_info *RPC_sys_info;
	RPC_sys_info = (_RPC_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	ST2094_CTRL = drvif_fwif_color_Get_ST2094_Ctrl();
	eotf_phy_addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_EOTF);
	oetf_phy_addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_OETF);
	HDR_3D_LUT_phy_addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_3D_LUT);

	if (ST2094_CTRL == NULL || eotf_phy_addr == 0 || oetf_phy_addr == 0 || HDR_3D_LUT_phy_addr == 0 || RPC_sys_info == NULL) {
		rtd_pr_vpq_emerg("get ST2094 DMA error, ST2094_CTRL=%p, eotf_phy_addr=%x, oetf_phy_addr=%x, HDR_3D_LUT_phy_addr=%x,RPC_sys_info=%p\n",
			ST2094_CTRL, eotf_phy_addr, oetf_phy_addr, HDR_3D_LUT_phy_addr,RPC_sys_info);
		return -1;
	}

	/* ctrl ini*/
	ST2094_CTRL->Enable = 0;
	ST2094_CTRL->Debug_Log = 0;
	ST2094_CTRL->Debug_Delay = 50;

	/* EOTF DMA */
	if (ST2094_CTRL->EOTF_DMA.pVir_addr_align == NULL) {
		eotf_phy_addr = drvif_memory_get_data_align(eotf_phy_addr, (1 << 12));
		size = drvif_memory_get_data_align(VIP_DMAto3DTable_HDR_EOTF_SIZE, (1 << 12));
		ST2094_CTRL->EOTF_DMA.phy_addr_align = eotf_phy_addr;
		ST2094_CTRL->EOTF_DMA.size = size;
		pVir_addr = dvr_remap_uncached_memory(eotf_phy_addr, size, __builtin_return_address(0));
		ST2094_CTRL->EOTF_DMA.pVir_addr_align = pVir_addr;
		EOTF_remap = 1;
	}

	/* OETF DMA */
	if (ST2094_CTRL->OETF_DMA.pVir_addr_align == NULL) {
		oetf_phy_addr = drvif_memory_get_data_align(oetf_phy_addr, (1 << 12));
		size = drvif_memory_get_data_align(VIP_DMAto3DTable_HDR_OETF_SIZE, (1 << 12));
		ST2094_CTRL->OETF_DMA.phy_addr_align = oetf_phy_addr;
		ST2094_CTRL->OETF_DMA.size = size;
		pVir_addr = dvr_remap_uncached_memory(oetf_phy_addr, size, __builtin_return_address(0));
		ST2094_CTRL->OETF_DMA.pVir_addr_align = pVir_addr;
		OETF_remap = 1;
	}

	rtd_pr_vpq_info("ST2094_ini, EOTF:addr=%x, pVir_addr=%p, size_aliged=%d, remap=%d, OETF:addr=%x, pVir_addr=%p, size_aliged=%d, remap=%d,\n",
		ST2094_CTRL->EOTF_DMA.phy_addr_align, ST2094_CTRL->EOTF_DMA.pVir_addr_align, ST2094_CTRL->EOTF_DMA.size, EOTF_remap,
		ST2094_CTRL->OETF_DMA.phy_addr_align, ST2094_CTRL->OETF_DMA.pVir_addr_align, ST2094_CTRL->OETF_DMA.size, OETF_remap);

#ifdef CONFIG_BW_96B_ALIGNED
	/* EOTF DMA */
	if (EOTF_remap == 1) {
		ST2094_CTRL->EOTF_DMA.size = dvr_size_alignment(ST2094_CTRL->EOTF_DMA.size);
		ST2094_CTRL->EOTF_DMA.phy_addr_align = (unsigned int)dvr_memory_alignment((unsigned long)ST2094_CTRL->EOTF_DMA.phy_addr_align, ST2094_CTRL->EOTF_DMA.size);
		ST2094_CTRL->EOTF_DMA.pVir_addr_align = (unsigned int*)dvr_memory_alignment((unsigned long)ST2094_CTRL->EOTF_DMA.pVir_addr_align, ST2094_CTRL->EOTF_DMA.size);
		if ((ST2094_CTRL->EOTF_DMA.phy_addr_align == 0) || (ST2094_CTRL->EOTF_DMA.pVir_addr_align == NULL)) {
			rtd_pr_vpq_emerg("ST2094, EOTF 96 aligned fail, addr=%x, pVir_addr=%p,\n",
				ST2094_CTRL->EOTF_DMA.phy_addr_align, ST2094_CTRL->EOTF_DMA.pVir_addr_align);
			BUG();
		}
	}

	/* OETF DMA */
	if (OETF_remap == 1) {
		ST2094_CTRL->OETF_DMA.size = dvr_size_alignment(ST2094_CTRL->OETF_DMA.size);
		ST2094_CTRL->OETF_DMA.phy_addr_align = (unsigned int)dvr_memory_alignment((unsigned long)ST2094_CTRL->OETF_DMA.phy_addr_align, ST2094_CTRL->OETF_DMA.size);
		ST2094_CTRL->OETF_DMA.pVir_addr_align = (unsigned int*)dvr_memory_alignment((unsigned long)ST2094_CTRL->OETF_DMA.pVir_addr_align, ST2094_CTRL->OETF_DMA.size);
		if ((ST2094_CTRL->OETF_DMA.phy_addr_align == 0) || (ST2094_CTRL->OETF_DMA.pVir_addr_align == NULL)) {
			rtd_pr_vpq_emerg("ST2094, OETF 96 aligned fail, addr=%x, pVir_addr=%p,\n",
				ST2094_CTRL->OETF_DMA.phy_addr_align, ST2094_CTRL->OETF_DMA.pVir_addr_align);
			BUG();
		}
	}

	rtd_pr_vpq_info("ST2094_ini, 96B aligned, EOTF:addr=%x, pVir_addr=%p, size_aliged=%d, remap=%d, OETF:addr=%x, pVir_addr=%p, size_aliged=%d, remap=%d,\n",
		ST2094_CTRL->EOTF_DMA.phy_addr_align, ST2094_CTRL->EOTF_DMA.pVir_addr_align, ST2094_CTRL->EOTF_DMA.size, EOTF_remap,
		ST2094_CTRL->OETF_DMA.phy_addr_align, ST2094_CTRL->OETF_DMA.pVir_addr_align, ST2094_CTRL->OETF_DMA.size, OETF_remap);
#endif

#if 0
	/* 3D LUT DMA */
	if (ST2094_CTRL->HDR_3D_LUT_DMA.pVir_addr_align == NULL) {
		HDR_3D_LUT_phy_addr = drvif_memory_get_data_align(HDR_3D_LUT_phy_addr, (1 << 12));
		size = drvif_memory_get_data_align(VIP_DMAto3DTable_HDR_3D_LUT_SIZE, (1 << 12));
		ST2094_CTRL->HDR_3D_LUT_DMA.phy_addr_align = HDR_3D_LUT_phy_addr;
		ST2094_CTRL->HDR_3D_LUT_DMA.size = size;
		pVir_addr = dvr_remap_uncached_memory(HDR_3D_LUT_phy_addr, size, __builtin_return_address(0));
		ST2094_CTRL->HDR_3D_LUT_DMA.pVir_addr_align = pVir_addr;
	}
#endif
	return 0;
}

#endif
/*========================== ST2094==========================================*/
void fwif_color_sld_still_image(int* thl_count_static_time, int* thl_stop_global_drop_count_frame)
{


	unsigned int  sld_logo_cnt_cur = 0;

	color_sld_sld_cnt_0_RBUS color_sld_read_only_logo_cnt;
	color_sld_sld_cnt_1_RBUS color_sld_read_only_drop_cnt;
	color_sld_sld_control_RBUS color_sld_control;

	static unsigned int count_static_time      = 0;
	static unsigned int pre_frame_countIdx = 0;
	static unsigned int global_drop_count_frame = 100;

	//extern  int thl_count_static_time;
	//extern  int (*thl_stop_global_drop_count_frame);


	color_sld_read_only_logo_cnt.regValue = IoReg_Read32(COLOR_SLD_SLD_CNT_0_reg);
	color_sld_read_only_drop_cnt.regValue = IoReg_Read32(COLOR_SLD_SLD_CNT_1_reg);

	sld_logo_cnt_cur = color_sld_read_only_logo_cnt.sld_logo_cnt;

          //printk(KERN_DEBUG "sld_logo_cnt_cur = %d\n",sld_logo_cnt_cur);
          //printk(KERN_DEBUG "pre,curr = %d, %d\n",pre_frame_countIdx,sld_logo_cnt_cur);
          //printk(KERN_DEBUG "count_static_time = %d\n",count_static_time);


	if(  ( ((pre_frame_countIdx - sld_logo_cnt_cur) < 64 ) && (pre_frame_countIdx >= sld_logo_cnt_cur))
	        ||
	 (((sld_logo_cnt_cur - pre_frame_countIdx ) < 64 ) && (sld_logo_cnt_cur >= pre_frame_countIdx )))
	{
		count_static_time ++;
                  //printk(KERN_DEBUG "pre_frame_countIdx = %d\n",pre_frame_countIdx);

	}
	else
	{
		count_static_time = 0;
	}

          //printk(KERN_DEBUG "pre_frame_countIdx = %d\n",pre_frame_countIdx);

	if(count_static_time > (*thl_count_static_time))
	{
		count_static_time = 0;

		color_sld_control.regValue = IoReg_Read32(COLOR_SLD_SLD_CONTROL_reg);
		color_sld_control.sld_global_drop= 1;
		IoReg_Write32(COLOR_SLD_SLD_CONTROL_reg, color_sld_control.regValue);

	          //printk(KERN_DEBUG "(*thl_count_static_time) = %d\n",(*thl_count_static_time));
	          //printk(KERN_DEBUG "(*thl_stop_global_drop_count_frame) = %d\n",(*thl_stop_global_drop_count_frame));

                   //printk(KERN_DEBUG "sld global drop--\n");
		global_drop_count_frame = 0;
	}

	color_sld_control.regValue = IoReg_Read32(COLOR_SLD_SLD_CONTROL_reg);
	global_drop_count_frame ++;
	if(global_drop_count_frame < (*thl_stop_global_drop_count_frame))
	{

		color_sld_control.regValue = IoReg_Read32(COLOR_SLD_SLD_CONTROL_reg);
		color_sld_control.sld_global_drop= 1;
		IoReg_Write32(COLOR_SLD_SLD_CONTROL_reg, color_sld_control.regValue);
                   //printk(KERN_DEBUG "global_drop_count_frame < (*thl_stop_global_drop_count_frame)\n");

	}
	else
	{

		color_sld_control.regValue = IoReg_Read32(COLOR_SLD_SLD_CONTROL_reg);
		color_sld_control.sld_global_drop= 0;
		IoReg_Write32(COLOR_SLD_SLD_CONTROL_reg, color_sld_control.regValue);
                   //printk(KERN_DEBUG "global_drop_count_frame > (*thl_stop_global_drop_count_frame)\n");

	}
	pre_frame_countIdx = sld_logo_cnt_cur;

}

extern unsigned char SLD_DMA_Ready;
void fwif_color_set_SLD_init(void)
{
	extern DRV_SLD_sld_control     sld_control_tbl;
	extern DRV_SLD_sld_Y_curve_map sld_Y_curve_map_tbl;
	extern DRV_SLD_sld_hpf_1 	   sld_hpf_1_tbl;
	extern DRV_SLD_sld_lpf_0       sld_lpf_0_tbl;
	extern DRV_SLD_local_gain_tbl sld_local_gain_tbl[Local_Gain_Tbl_NUM];
	
	DRV_SLD_sld_control     	   sld_control_prt;
	DRV_SLD_sld_Y_curve_map 	   sld_Y_curve_map_prt;
	DRV_SLD_sld_hpf_1 			   sld_hpf_1_prt;
	DRV_SLD_sld_lpf_0 			   sld_lpf_0_prt;
	DRV_SLD_local_gain_tbl 	   sld_local_gain_ptr;	
	
	VIP_SLD_DMA_CTRL *SLD_DMA_CTRL[2] = {NULL, NULL};
	unsigned int sld_size = 0;
	unsigned int sld_addr = 0;
	//unsigned int align_value = 0;
	unsigned int sld_buffer_size = 0x11CC40;//0x50040;
	unsigned short panel_width, panel_heigth, h_s, h_e, v_s, v_e;
	unsigned int sld_addr_align, sld_buffer_size_aligned; 
	//unsigned int sld_aligned_val;
	unsigned int pAddr_APL0, pAddr_APL1;
	unsigned int pAddr_APL0_align, pAddr_APL1_align, sld_apl_buf0_size_align, sld_apl_buf1_size_align;
	unsigned int *sld_apl_va0, *sld_apl_va1, *sld_apl_va0_align, *sld_apl_va1_align;
	unsigned int sld_apl_buf0_size = 20 * 1024;
	unsigned int sld_apl_buf1_size = 20 * 1024;
	ppoverlay_display_timing_ctrl2_RBUS ppoverlay_display_timing_ctrl2_reg;
#ifdef CONFIG_BW_96B_ALIGNED	
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif	
#endif
	 if (0/*strcmp(webos_strToolOption.eBackLight, "oled") == 0*/) {	
		memcpy(&sld_control_prt, &sld_control_tbl, sizeof(DRV_SLD_sld_control));
		memcpy(&sld_Y_curve_map_prt, &sld_Y_curve_map_tbl, sizeof(DRV_SLD_sld_Y_curve_map));
		memcpy(&sld_hpf_1_prt, &sld_hpf_1_tbl, sizeof(DRV_SLD_sld_hpf_1));
		memcpy(&sld_lpf_0_prt, &sld_lpf_0_tbl, sizeof(DRV_SLD_sld_lpf_0));
		memcpy(&sld_local_gain_ptr, &sld_local_gain_tbl[0], 576*sizeof(unsigned short));
		
		sld_size = carvedout_buf_query(CARVEDOUT_SCALER_OD, (void *) &sld_addr);
	    if (sld_addr == 0 || sld_size == 0) {
	        //rtd_printk("[%s %d] ERR : %x %x\n", __func__, __LINE__, sld_addr, sld_size);
			rtd_pr_vpq_emerg("[%s %d] ERR : %x %x\n", __func__, __LINE__, sld_addr, sld_size);
	        return;
	    }

		pAddr_APL0 = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_SLD_APL_DMA);
		pAddr_APL1 = pAddr_APL0 + 20 * 1024;
		if (pAddr_APL0 == 0) {
			//rtd_printk("[%s %d] ERR : %x %x\n", __func__, __LINE__, sld_addr, sld_size);
			rtd_pr_vpq_emerg("[%s %d] ERR : %x\n", __func__, __LINE__, pAddr_APL0);
			return;
		}
		
		sld_addr = drvif_memory_get_data_align(sld_addr, (1 << 12));
		sld_buffer_size = drvif_memory_get_data_align(sld_buffer_size, (1 << 12));

		SLD_DMA_CTRL[0] = drvif_fwif_color_Get_SLD_APL_DMA_CTRL(0);
		SLD_DMA_CTRL[1] = drvif_fwif_color_Get_SLD_APL_DMA_CTRL(1);

		pAddr_APL0 = drvif_memory_get_data_align(pAddr_APL0, (1 << 12));
		pAddr_APL1 = drvif_memory_get_data_align(pAddr_APL1, (1 << 12));
		sld_apl_buf0_size = drvif_memory_get_data_align(sld_apl_buf0_size, (1 << 12));
		sld_apl_buf1_size = drvif_memory_get_data_align(sld_apl_buf1_size, (1 << 12));

#ifdef CONFIG_BW_96B_ALIGNED
		sld_buffer_size_aligned = dvr_size_alignment(sld_buffer_size);
		sld_addr_align = (unsigned int)dvr_memory_alignment((unsigned long)sld_addr, sld_buffer_size_aligned);

		if (SLD_DMA_CTRL[0]->pVir_addr_align == NULL) {
			rtd_pr_vpq_info("SLD_HW, SLD_DMA_CTRL[0] remap \n");
			sld_apl_va0 = dvr_remap_uncached_memory(pAddr_APL0, sld_apl_buf0_size, __builtin_return_address(0));
#ifdef CONFIG_ARM64 //ARM32 compatible
			va_temp = (unsigned long)sld_apl_va0;
#else
			va_temp = (unsigned int)sld_apl_va0;
#endif
			// 96b align
			sld_apl_buf0_size_align = dvr_size_alignment(sld_apl_buf0_size);
			pAddr_APL0_align = (unsigned int)dvr_memory_alignment((unsigned long)pAddr_APL0, sld_apl_buf0_size_align);
			sld_apl_va0_align = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, sld_apl_buf0_size_align);
		
			SLD_DMA_CTRL[0]->phy_addr_align = pAddr_APL0_align;
			SLD_DMA_CTRL[0]->size = sld_apl_buf0_size_align;
			SLD_DMA_CTRL[0]->pVir_addr_align = sld_apl_va0_align;
		}
		if (SLD_DMA_CTRL[1]->pVir_addr_align == NULL) {
			rtd_pr_vpq_info("SLD_HW, SLD_DMA_CTRL[1] remap \n");
			sld_apl_va1 = dvr_remap_uncached_memory(pAddr_APL1, sld_apl_buf1_size, __builtin_return_address(0));
#ifdef CONFIG_ARM64 //ARM32 compatible
			va_temp = (unsigned long)sld_apl_va1;
#else
			va_temp = (unsigned int)sld_apl_va1;
#endif
			// 96b align
			sld_apl_buf1_size_align = dvr_size_alignment(sld_apl_buf1_size);
			pAddr_APL1_align = (unsigned int)dvr_memory_alignment((unsigned long)pAddr_APL1, sld_apl_buf1_size_align);
			sld_apl_va1_align = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, sld_apl_buf1_size_align);
		
			SLD_DMA_CTRL[1]->phy_addr_align = pAddr_APL1_align;
			SLD_DMA_CTRL[1]->size = sld_apl_buf1_size_align;
			SLD_DMA_CTRL[1]->pVir_addr_align = sld_apl_va1_align;		
		}		
		//sld_aligned_val = 6;
#else	
		sld_buffer_size_aligned = sld_buffer_size;
		sld_addr_align = sld_addr;

		if (SLD_DMA_CTRL[0]->pVir_addr_align == NULL) {
			rtd_pr_vpq_info("SLD_HW, SLD_DMA_CTRL[0] remap \n");
			sld_apl_va0 = dvr_remap_uncached_memory(pAddr_APL0, sld_apl_buf0_size, __builtin_return_address(0));
			// no 96b align
			sld_apl_buf0_size_align = sld_apl_buf0_size;
			pAddr_APL0_align = pAddr_APL0;
			sld_apl_va0_align = sld_apl_va0;
		
			SLD_DMA_CTRL[0]->phy_addr_align = pAddr_APL0_align;
			SLD_DMA_CTRL[0]->size = sld_apl_buf0_size_align;
			SLD_DMA_CTRL[0]->pVir_addr_align = sld_apl_va0_align;
		}
		if (SLD_DMA_CTRL[1]->pVir_addr_align == NULL) {
			rtd_pr_vpq_info("SLD_HW, SLD_DMA_CTRL[1] remap \n");
			sld_apl_va1 = dvr_remap_uncached_memory(pAddr_APL1, sld_apl_buf1_size, __builtin_return_address(0));
			// no 96b align
			sld_apl_buf1_size_align = sld_apl_buf1_size;
			pAddr_APL1_align = pAddr_APL1;
			sld_apl_va1_align = sld_apl_va1;
		
			SLD_DMA_CTRL[1]->phy_addr_align = pAddr_APL1_align;
			SLD_DMA_CTRL[1]->size = sld_apl_buf1_size_align;
			SLD_DMA_CTRL[1]->pVir_addr_align = sld_apl_va1_align;		
		}	
		//sld_aligned_val = 0;
#endif

		rtd_pr_vpq_info("SLD_HW,DMA_CTRL[0]:pa=%x,va=%lx, size=%d,DMA_CTRL[1]:pa=%x,va=%lx,size=%d\n",
			SLD_DMA_CTRL[0]->phy_addr_align, (unsigned long)SLD_DMA_CTRL[0]->pVir_addr_align, SLD_DMA_CTRL[0]->size,
			SLD_DMA_CTRL[1]->phy_addr_align, (unsigned long)SLD_DMA_CTRL[1]->pVir_addr_align, SLD_DMA_CTRL[1]->size);

		drvif_color_Get_main_den_h_v_start_end(&h_s, &h_e, &v_s, &v_e);
		panel_width = h_e - h_s;
		panel_heigth = v_e - v_s;

		if (panel_width == 3840 && panel_heigth == 2160)
			sld_control_prt.sld_scale_mode = 1;
		else
			sld_control_prt.sld_scale_mode = 0;

		if (drvif_color_set_SLD_CTRL(sld_addr_align, sld_buffer_size_aligned, (unsigned char)sld_control_prt.sld_scale_mode, panel_width, panel_heigth) == 1) {
			drvif_color_set_SLD_control(&sld_control_prt);
			drvif_color_set_SLD_Y_curve_map(&sld_Y_curve_map_prt);
			drvif_color_set_SLD_step(&sld_hpf_1_prt);
			drvif_color_set_SLD_lpf(&sld_lpf_0_prt);
			drif_color_SLD_apply_normal_setting();
			drvif_color_set_SLD_Enable(sld_control_prt.sld_en);
			drvif_SLD_table_set(0, &sld_local_gain_ptr);
			drvif_SLD_table_enable(0, 1);
			drvif_SLD_Block_APL_init(SLD_DMA_CTRL[0]->phy_addr_align, SLD_DMA_CTRL[1]->phy_addr_align);
			SLD_DMA_Ready = 1;
			ppoverlay_display_timing_ctrl2_reg.regValue = IoReg_Read32(PPOVERLAY_Display_Timing_CTRL2_reg);
			ppoverlay_display_timing_ctrl2_reg.sld_after_osd = 0 ;
			IoReg_Write32(PPOVERLAY_Display_Timing_CTRL2_reg, ppoverlay_display_timing_ctrl2_reg.regValue);
			
			rtd_pr_vpq_info("SLD_HW, ini done \n");
		} else {
			sld_control_prt.sld_en = 0;
			//drvif_color_set_SLD_control(&sld_control_prt);
			drvif_color_set_SLD_Enable(sld_control_prt.sld_en);
			SLD_DMA_Ready = 0;
			rtd_pr_vpq_info("SLD_HW, DMA setting need to check \n");	
		}
	} else {
		sld_control_prt.sld_en = 0;
		//drvif_color_set_SLD_control(&sld_control_prt);
		drvif_color_set_SLD_Enable(sld_control_prt.sld_en);
		SLD_DMA_Ready = 0;
		rtd_pr_vpq_info("SLD_HW, Bypass \n");
	}

}

char fwif_color_SLD_Block_APL_Read_by_DMA_ISR(void/*unsigned short *pout_tbl*/)
{
	if (SLD_DMA_Ready == 1) {
		drvif_SLD_Block_APL_Read_by_DMA_ISR();
	}
	return 0;
}

char fwif_color_fwif_color_Get_SLD_APL(unsigned short *pTBL, unsigned int num)
{
	return drvif_fwif_color_Get_SLD_APL(pTBL, num);	
}

#if 0/*SLD, hack, elieli*/
//juwen, 0603, SLD
void fwif_color_set_SLD_Enable(unsigned char src_idx,bool enable)
{

	drvif_color_set_SLD_Enable(enable);
}

void fwif_color_set_SLD_Ctrl(unsigned char src_idx, DRV_Still_Logo_Detection_Table* ptr)
{
	DRV_SLD_Ctrl data;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	if (VIP_system_info_structure_table->PQ_Setting_Info.SLD_INFO.SLD_Size.sld_width > 2000) /* 4K */
		ptr->SLD_Ctrl.sld_scale_mode = 1;
	else
		ptr->SLD_Ctrl.sld_scale_mode = 0;

	data.sld_en= ptr->SLD_Ctrl.sld_en;//juwen, enable not put in table?delete ?
	data.sld_blend_en= ptr->SLD_Ctrl.sld_blend_en;
	data.sld_global_drop= ptr->SLD_Ctrl.sld_global_drop;
	data.sld_hpf_type= ptr->SLD_Ctrl.sld_hpf_type;
	data.sld_hpf_thl = ptr->SLD_Ctrl.sld_hpf_thl;
	data.sld_scale_mode = ptr->SLD_Ctrl.sld_scale_mode;

	drvif_color_set_SLD_control((DRV_SLD_Ctrl*) &data);
}

void fwif_color_set_SLD_input_size(unsigned short sld_width, unsigned short sld_height)
{
	DRV_SLD_Size data;
	_system_setting_info *VIP_system_info_structure_table = NULL;
	VIP_system_info_structure_table = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	data.sld_height = sld_height;
	data.sld_width = sld_width;

	VIP_system_info_structure_table->PQ_Setting_Info.SLD_INFO.SLD_Size.sld_height = fwif_color_ChangeOneUINT16Endian(sld_height, 0);
	VIP_system_info_structure_table->PQ_Setting_Info.SLD_INFO.SLD_Size.sld_width= fwif_color_ChangeOneUINT16Endian(sld_width, 0);

	drvif_color_set_SLD_input_size( (DRV_SLD_Size*) &data);
}


void fwif_color_set_SLD_curve_map(unsigned char src_idx, DRV_Still_Logo_Detection_Table* ptr)
{
	DRV_SLD_CurveMap data;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	data.sld_curve_seg_0= ptr->SLD_CurveMap.sld_curve_seg_0;
	data.sld_curve_seg_1= ptr->SLD_CurveMap.sld_curve_seg_1;

	data.sld_curve_gain_0= ptr->SLD_CurveMap.sld_curve_gain_0;
	data.sld_curve_gain_1= ptr->SLD_CurveMap.sld_curve_gain_1;
	data.sld_curve_gain_2= ptr->SLD_CurveMap.sld_curve_gain_2;

	data.sld_curve_offset_0= ptr->SLD_CurveMap.sld_curve_offset_0;
	data.sld_curve_offset_1= ptr->SLD_CurveMap.sld_curve_offset_1;
	data.sld_curve_offset_2= ptr->SLD_CurveMap.sld_curve_offset_2;


	drvif_color_set_SLD_curve_map((DRV_SLD_CurveMap*) &data);
}

void fwif_color_set_SLD_drop(unsigned char src_idx, DRV_Still_Logo_Detection_Table* ptr)
{
	DRV_SLD_DROP data;
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	data.sld_cnt_thl= ptr->SLD_DROP.sld_cnt_thl;
	data.sld_hpf_diff_thl= ptr->SLD_DROP.sld_hpf_diff_thl;
	data.sld_pixel_diff_thl= ptr->SLD_DROP.sld_pixel_diff_thl;

	drvif_color_set_SLD_drop((DRV_SLD_DROP*) &data);
}
#endif

void fwif_color_set_BOE_RGBW(int w_rate)
{
	return;
	// 20170531 henry merlin3 remove
	// 20160627 jyyang
//	extern unsigned short BOE_RGBW_TAB_160713[16128];
//	drvif_color_set_BOE_RGBW(BOE_RGBW_TAB_160713, w_rate);
}

unsigned char fwif_color_init_PQ_device_struct_ShareMemory(void)
{
#if 0
	int ret;
	g_Share_Memory_PQ_device_struct = ((PQ_device_struct *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_PQ_DEVICE));
	if (NULL == g_Share_Memory_PQ_device_struct)
		return 0;

	memset(g_Share_Memory_PQ_device_struct, 0, sizeof(PQ_device_struct));

	ret = Scaler_SendRPC(SCALERIOC_VIP_PQ_DEVICE, 0, 0);
	if (0 !=  ret) {
		VIPprintf("ret = %d, update fwif_color_set_PQ_device_struct_ShareMemory to driver fail !!!\n", ret);
	}

	return !ret;
#endif
	return TRUE;
}

void fwif_color_set_RGBW_histogram(int *hist)
{
#ifdef RTK_RGBW // henry - merlin5 remove rtk rgbw
	rgbw_d_rgbw_adaptwhite_1_RBUS rgbw_d_rgbw_adaptwhite_1_REG;
	rgbw_d_rgbw_adaptwhite_2_RBUS rgbw_d_rgbw_adaptwhite_2_REG;
	rgbw_d_rgbw_adaptwhite_3_RBUS rgbw_d_rgbw_adaptwhite_3_REG;
	rgbw_d_rgbw_adaptwhite_4_RBUS rgbw_d_rgbw_adaptwhite_4_REG;
	rgbw_d_rgbw_adaptwhite_hist_1_RBUS rgbw_d_rgbw_adaptwhite_hist_1_REG;
	rgbw_d_rgbw_adaptwhite_hist_2_RBUS rgbw_d_rgbw_adaptwhite_hist_2_REG;
	rgbw_d_rgbw_adaptwhite_hist_3_RBUS rgbw_d_rgbw_adaptwhite_hist_3_REG;
	rgbw_d_rgbw_adaptwhite_hist_4_RBUS rgbw_d_rgbw_adaptwhite_hist_4_REG;

	int shiftb;

	rgbw_d_rgbw_adaptwhite_1_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_1_reg);
	rgbw_d_rgbw_adaptwhite_2_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_2_reg);
	rgbw_d_rgbw_adaptwhite_3_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_3_reg);
	rgbw_d_rgbw_adaptwhite_4_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_4_reg);

	rgbw_d_rgbw_adaptwhite_hist_1_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_HIST_1_reg);
	rgbw_d_rgbw_adaptwhite_hist_2_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_HIST_2_reg);
	rgbw_d_rgbw_adaptwhite_hist_3_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_HIST_3_reg);
	rgbw_d_rgbw_adaptwhite_hist_4_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_HIST_4_reg);

	shiftb = 14 - rgbw_d_rgbw_adaptwhite_2_REG.hist_shift_sel;

	hist[0] = rgbw_d_rgbw_adaptwhite_hist_1_REG.hist_bin0>>shiftb;
	hist[1] = rgbw_d_rgbw_adaptwhite_hist_1_REG.hist_bin1>>shiftb;
	hist[2] = rgbw_d_rgbw_adaptwhite_hist_2_REG.hist_bin2>>shiftb;
	hist[3] = rgbw_d_rgbw_adaptwhite_hist_2_REG.hist_bin3>>shiftb;
	hist[4] = rgbw_d_rgbw_adaptwhite_hist_3_REG.hist_bin4>>shiftb;
	hist[5] = rgbw_d_rgbw_adaptwhite_hist_3_REG.hist_bin5>>shiftb;
	hist[6] = rgbw_d_rgbw_adaptwhite_hist_4_REG.hist_bin6>>shiftb;
	hist[7] = rgbw_d_rgbw_adaptwhite_hist_4_REG.hist_bin7>>shiftb;
#endif
}

void fwif_color_set_RGBW_adaptive_white(int hist[9][8])
{
#ifdef RTK_RGBW // henry - merlin5 remove rtk rgbw
	rgbw_d_rgbw_adaptwhite_1_RBUS rgbw_d_rgbw_adaptwhite_1_REG;
	rgbw_d_rgbw_adaptwhite_2_RBUS rgbw_d_rgbw_adaptwhite_2_REG;
	rgbw_d_rgbw_adaptwhite_3_RBUS rgbw_d_rgbw_adaptwhite_3_REG;
	rgbw_d_rgbw_adaptwhite_4_RBUS rgbw_d_rgbw_adaptwhite_4_REG;
	int i,j;
	int wt_sum = 0;
	int hist_wt[9][8] = {
			{1, 3, 7, 7, 9, 11, 13, 13,},   // max-min
			{0, 4, 8, 12, 16, 20, 23, 27,}, // red
			{0, 5, 10, 17, 19, 22, 24, 27,},// green
			{0, 4, 8, 12, 16, 20, 23, 27,}, // blue
			{0, 9, 18, 27, 27, 27, 27, 27,},// cyan
			{0, 0, 0, 0, 7, 14, 21, 27,},   // meganta
			{0, 4, 10, 17, 21, 25, 29, 34,},// yellow
			{0, 0, 0, 0, 0, 0, 0, 0,},      // white
			{0, 0, 0, 5, 10, 12, 15, 17,},  // min(Sat, min)
		};
	int wc_grids[33] = {0,128,256,380,450,490,515,540,560,579,597,613,628,642,655,667,678,688,697,705,713,721,729,737,745,733,761,769,777,785,793,801,809};
	int wc_idx;
	int wc_ph;
	int wc_out;

	rgbw_d_rgbw_adaptwhite_1_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_1_reg);
	rgbw_d_rgbw_adaptwhite_2_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_2_reg);
	rgbw_d_rgbw_adaptwhite_3_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_3_reg);
	rgbw_d_rgbw_adaptwhite_4_REG.regValue = IoReg_Read32(RGBW_D_RGBW_ADAPTWHITE_4_reg);

	for(i=0;i<9;i++) {
	for(j=0;j<8;j++) {
			wt_sum+=hist[i][j]*hist_wt[i][j];
		}
	}
	// w_cut mapping // 33 grid = X(0~4096) Y(0~1024)
	wc_idx = wt_sum/128;
	wc_ph = wt_sum - wc_idx*128;
	wc_out = wc_grids[wc_idx] + (wc_grids[wc_idx+1]-wc_grids[wc_idx])*wc_ph/128;
	wc_out = (wc_out<0)?0:((wc_out>1023)?1023:wc_out);
	rgbw_d_rgbw_adaptwhite_1_REG.adaptwhite_cutweight = wc_out;
	IoReg_Write32(RGBW_D_RGBW_ADAPTWHITE_1_reg, rgbw_d_rgbw_adaptwhite_1_REG.regValue);
#endif
}


void fwif_color_colorwrite_Output_gamma(unsigned char value)
{
	unsigned char fmt;
	VIP_Output_Gamma *prt_CTRL;

	if (value >= Output_Gamma_TBL_MAX) {
		drvif_color_set_output_gamma_format(0, 0, 0, 0);
		return;
	}

	prt_CTRL = &Output_Gamma[value];

	if (prt_CTRL->Output_InvOutput_Gamma_CTRL_ITEM.output_Gamma_En != 1) {
		drvif_color_set_output_gamma_format(0, 0, 0, 0);
		//return;
	}

	fmt = drvif_color_Get_RGBW_Mode();

	if (prt_CTRL->Output_InvOutput_Gamma_CTRL_ITEM.output_Location == 1 && (fmt == 1 || fmt == 2))
		fmt = 1;
	else
		fmt = 0;

	drvif_color_colorwrite_output_gamma(&Output_Gamma[value].Output_Gamma_TBL.TBL_R[0], GAMMA_CHANNEL_R);
	drvif_color_colorwrite_output_gamma(&Output_Gamma[value].Output_Gamma_TBL.TBL_G[0], GAMMA_CHANNEL_G);
	drvif_color_colorwrite_output_gamma(&Output_Gamma[value].Output_Gamma_TBL.TBL_B[0], GAMMA_CHANNEL_B);
	drvif_color_colorwrite_output_gamma(&Output_Gamma[value].Output_Gamma_TBL.TBL_W[0], GAMMA_CHANNEL_W);

	drvif_color_set_output_gamma_format(prt_CTRL->Output_InvOutput_Gamma_CTRL_ITEM.output_Gamma_En, fmt, prt_CTRL->Output_InvOutput_Gamma_CTRL_ITEM.output_Location, 0);

}

void fwif_color_set_InvOutputGamma_System(unsigned int gamma_curve_index)
{
	down(&Gamma_Semaphore);
    rtd_pr_vpq_emerg("fwif_color_set_InvOutputGamma_System:%d\n",gamma_curve_index);

	if (gamma_curve_index == GAMMA_CURVE_RELATE_TO_GAMMA_MODE)
		fwif_color_get_gamma_default(g_GammaMode, &tGAMMA_temp_R, &tGAMMA_temp_G, &tGAMMA_temp_B);
	else
		fwif_color_set_gamma_curve_index(gamma_curve_index, &tGAMMA_temp_R, &tGAMMA_temp_G, &tGAMMA_temp_B);
	fwif_color_gamma_decode(GOut_R, GOut_G, GOut_B, tGAMMA_temp_R, tGAMMA_temp_G, tGAMMA_temp_B);
	fwif_color_gamma_curve_data_protect(GOut_R, GOut_G, GOut_B);
	fwif_color_out_gamma_encode(final_OutGAMMA_R, final_OutGAMMA_G, final_OutGAMMA_B, GOut_R, GOut_G, GOut_B);

	drvif_color_colorwrite_inv_output_gamma(final_OutGAMMA_R, GAMMA_CHANNEL_R);
	drvif_color_colorwrite_inv_output_gamma(final_OutGAMMA_G, GAMMA_CHANNEL_G);
	drvif_color_colorwrite_inv_output_gamma(final_OutGAMMA_B, GAMMA_CHANNEL_B);
	drvif_color_colorwrite_inv_output_gamma_Enable(1);

	up(&Gamma_Semaphore);
}

void fwif_color_colorwrite_InvOutput_gamma(unsigned char value)
{
	VIP_InvOutput_Gamma *prt_CTRL;

	if (value >= InvOutput_Gamma_TBL_MAX) {
		drvif_color_colorwrite_inv_output_gamma_Enable(0);
		return;
	}

	prt_CTRL = &InvOutput_Gamma[value];

	if (prt_CTRL->InvOutput_Gamma_En != 1) {
		drvif_color_colorwrite_inv_output_gamma_Enable(0);
		return;
	}

	drvif_color_colorwrite_inv_output_gamma(&InvOutput_Gamma[value].InvOutput_Gamma_TBL.TBL_R[0], GAMMA_CHANNEL_R);
	drvif_color_colorwrite_inv_output_gamma(&InvOutput_Gamma[value].InvOutput_Gamma_TBL.TBL_G[0], GAMMA_CHANNEL_G);
	drvif_color_colorwrite_inv_output_gamma(&InvOutput_Gamma[value].InvOutput_Gamma_TBL.TBL_B[0], GAMMA_CHANNEL_B);

	drvif_color_colorwrite_inv_output_gamma_Enable(prt_CTRL->InvOutput_Gamma_En);

}

void fwif_color_rtice_DM2_EOTF_Set(unsigned char HDR_sel, unsigned int *EOTF_table32_R, unsigned int *EOTF_table32_G, unsigned int *EOTF_table32_B)
{
	if (HDR_sel == 0) {
		drvif_DM2_EOTF_Enable(1, 1);
		drvif_DM2_B0203_noSram_Enable(1, 1);
#if 0	/* use  DMA driver writing*/
		drvif_DM2_EOTF_Set(EOTF_table32_R, EOTF_table32_G, EOTF_table32_B);
#else
		fwif_color_DM2_EOTF_Set_By_DMA(EOTF_table32_R, EOTF_table32_G, EOTF_table32_B);
#endif
	} else {
		drvif_DM2_HDR1_2_EOTF_Enable(1, 1);
		drvif_DM2_HDR1_2_B0203_noSram_Enable(1, 1);
#if 0	/* use  DMA driver writing*/
		drvif_DM2_EOTF_Set(EOTF_table32_R, EOTF_table32_G, EOTF_table32_B);
#else
		fwif_color_DM2_HDR1_2_EOTF_Set_By_DMA(EOTF_table32_R, EOTF_table32_G, EOTF_table32_B);
#endif
	}
	
}

void fwif_color_rtice_DM2_EOTF_Get(unsigned char HDR_sel, unsigned int *EOTF_table32_R, unsigned int *EOTF_table32_G, unsigned int *EOTF_table32_B)
{
	if (HDR_sel == 0) {	
		drvif_DM2_EOTF_Enable(1, 1);
		drvif_DM2_B0203_noSram_Enable(1, 1);
		drvif_DM2_EOTF_Get(EOTF_table32_R, EOTF_table32_G, EOTF_table32_B);
		//printk("\n[eli]re=%d,%d,%d\n", EOTF_table32_R[1], EOTF_table32_G[2], EOTF_table32_B[3]);
	} else {
		drvif_DM2_HDR1_2_EOTF_Enable(1, 1);
		drvif_DM2_HDR1_2_B0203_noSram_Enable(1, 1);
		drvif_DM2_HDR_1_2_EOTF_Get(EOTF_table32_R, EOTF_table32_G, EOTF_table32_B);
		//printk("\n[eli]re=%d,%d,%d\n", EOTF_table32_R[1], EOTF_table32_G[2], EOTF_table32_B[3]);
	}
}

void fwif_color_rtice_DM2_OETF_Set(unsigned char HDR_sel, unsigned short *OETF_table16_R, unsigned short *OETF_table16_G, unsigned short *OETF_table16_B)
{
	if (HDR_sel == 0) {
		drvif_DM2_OETF_Enable(1, 1);
		drvif_DM2_B0203_noSram_Enable(1, 1);
#if 0	/* use  DMA driver writing*/
		drvif_DM2_OETF_Set(OETF_table16_R, OETF_table16_G, OETF_table16_B);
#else
		fwif_color_DM2_OETF_Set_By_DMA(OETF_table16_R, OETF_table16_G, OETF_table16_B);
#endif
	}
	else {
		drvif_DM2_HDR1_2_OETF_Enable(1, 1);
		drvif_DM2_HDR1_2_B0203_noSram_Enable(1, 1);
#if 0	/* use  DMA driver writing*/
		drvif_DM2_OETF_Set(OETF_table16_R, OETF_table16_G, OETF_table16_B);
#else
		fwif_color_DM2_HDR1_2_OETF_Set_By_DMA(OETF_table16_R, OETF_table16_G, OETF_table16_B);
#endif

	}
}

void fwif_color_rtice_DM2_OETF_Get(unsigned char HDR_sel, unsigned short *OETF_table16_R, unsigned short *OETF_table16_G, unsigned short *OETF_table16_B)
{
	if (HDR_sel == 0) {
		drvif_DM2_OETF_Enable(1, 1);
		drvif_DM2_B0203_noSram_Enable(1, 1);
		drvif_DM2_OETF_Get(OETF_table16_R, OETF_table16_G, OETF_table16_B);
	} else {
		drvif_DM2_HDR1_2_OETF_Enable(1, 1);
		drvif_DM2_HDR1_2_B0203_noSram_Enable(1, 1);
		drvif_DM2_HDR_1_2_OETF_Get(OETF_table16_R, OETF_table16_G, OETF_table16_B);
	}
}

char fwif_color_rtice_DM2_ToneMapping_Set(unsigned char HDR_sel, short *TM_table12_R, short *TM_table12_G, short *TM_table12_B)
{
	if (HDR_sel == 0) {

		if (drvif_Wait_VGIP_start(1, 50, 0x032500) < 0)
			return -1;
		if (drvif_DM2_ToneMapping_Enable(1, 1) < 0)
			return -1;
		if (drvif_DM2_ToneMapping_Set(TM_table12_R, TM_table12_G, TM_table12_B) < 0)
			return -1;
	} else {

	
	if (drvif_Wait_VGIP_start(1, 50, 0x032500) < 0)
		return -1;
	if (drvif_DM2_HDR1_2_ToneMapping_Enable(1, 1) < 0)
		return -1;
	if (drvif_DM2_HDR1_2_ToneMapping_Set(TM_table12_R, TM_table12_G, TM_table12_B) < 0)
		return -1;

	}
	return 0;
}

char fwif_color_rtice_DM2_ToneMapping_Get(unsigned char HDR_sel, short *TM_table12_R, short *TM_table12_G, short *TM_table12_B)
{
	if (HDR_sel == 0) {

		if (drvif_Wait_VGIP_start(1, 50, 0x032500) < 0)
			return -1;
		//if (drvif_DM2_ToneMapping_Enable(1, 1) < 0)
			//return -2;
		if (drvif_DM2_ToneMapping_Get(TM_table12_R, TM_table12_G, TM_table12_B) < 0)
			return -3;
	} else {
		if (drvif_Wait_VGIP_start(1, 50, 0x032500) < 0)
			return -1;
		//if (drvif_DM2_HDR1_2_ToneMapping_Enable(1, 1) < 0)
			//return -2;
		if (drvif_DM2_HDR1_2_ToneMapping_Get(TM_table12_R, TM_table12_G, TM_table12_B) < 0)
			return -3;
	}
	
	return 0;
}

char fwif_color_rtice_DM2_3D_24x24x24_LUT_Set(unsigned char HDR_sel, unsigned char enable, unsigned short *pArray)
{
	extern UINT16 HDR_3DLUT_Compact[HDR_24x24x24_size*3];
	/*_system_setting_info *system_setting_info = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);*/
	char ret;
	static PQ_HDR_3dLUT_16_PARAM args;
	args.c3dLUT_16_enable = enable;
	args.a3dLUT_16_pArray = pArray;

	//ret = fwif_color_set_DM_HDR_3dLUT_24x24x24_16_TV006(&args, 0);
	if (HDR_sel == 0) {
		fwif_color_DM2_3D_LUT_BIT_Change(pArray, &HDR_3DLUT_Compact[0], NEW_24x24x24);
		ret = drvif_Set_DM_HDR_3dLUT_24x24x24_16(enable, &HDR_3DLUT_Compact[0]);
	} else {
		fwif_color_DM2_3D_LUT_BIT_Change(pArray, &HDR_3DLUT_Compact[0], NEW_24x24x24);
		ret = drvif_Set_DM_HDR_1_2_3dLUT_24x24x24_16(enable, &HDR_3DLUT_Compact[0]);

	}
	
#if 0
	/*ret = drvif_Wait_VGIP_start(1, 50, 0x032500);
	if (ret < 0)
		return -1;*/
	if (fwif_HDR_compare_3DLUT((void*) &args, NEW_24x24x24) != 1) {
		rtd_pr_vpq_emerg("Rtice HDR 3D LUT same\n");
		//return 0;
	}

	fwif_color_DM2_3D_LUT_BIT_Change(pArray, &HDR_3DLUT_Compact[0], NEW_24x24x24);
#if 0	/*use DMA drvier*/
	ret = drvif_Set_DM_HDR_3dLUT_24x24x24_16(enable, &HDR_3DLUT_Compact[0]);
#else
	ret = fwif_color_DM2_3D_24x24x24_LUT_Set_By_DMA(enable, &HDR_3DLUT_Compact[0]);
#endif
	if (ret < 0)
		return -1;
#endif
	return ret;
}

char fwif_color_rtice_DM2_3D_24x24x24_LUT_Get(unsigned char HDR_sel, unsigned short *pArray, unsigned char getFromReg)
{
	char ret = 0;
	unsigned int i;
	/*ret = drvif_Wait_VGIP_start(1, 50, 0x032500);
	if (ret < 0)
		return -1;*/
	if (HDR_sel == 0) {

		if (getFromReg == 1) {
			ret = drvif_Get_DM_HDR_3dLUT_24x24x24_16(pArray);
			if (ret < 0)
				return -1;

			/* return from compact form*/
			for (i=0;i<(HDR_24x24x24_size*3);i++)
				pArray[i] = pArray[i]<<4;
		} else {
			memcpy((unsigned char*)pArray, (unsigned char*)pre_hdr_3dlut, sizeof(short)*(HDR_24x24x24_size*3));
		}
	} else {
		ret = drvif_Get_DM_HDR1_2_3dLUT_24x24x24_16(pArray);
		if (ret < 0)
			return -1;
	
		/* return from compact form*/
		for (i=0;i<(HDR_24x24x24_size*3);i++)
			pArray[i] = pArray[i]<<4;

	}
	return ret;
}

char fwif_color_rtice_DM2_3D_17x17x17_LUT_Set(unsigned char HDR_sel, unsigned char enable, unsigned short *pArray)
{
	//extern UINT16 HDR_3DLUT_Compact[HDR_24x24x24_size*3];
	/*_system_setting_info *system_setting_info = (_system_setting_info *)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);*/
	char ret;
	static PQ_HDR_3dLUT_16_PARAM args;
	args.c3dLUT_16_enable = enable;
	args.a3dLUT_16_pArray = pArray;

	if (HDR_sel == 0)
		ret = fwif_color_set_DM_HDR_3dLUT_17x17x17_16_TV006(&args, 1);
	else
		ret = fwif_color_set_DM_HDR1_2_3dLUT_17x17x17_16_TV006(&args, 1);
	return ret;
}

char fwif_color_rtice_DM2_3D_17x17x17_LUT_Get(unsigned char HDR_sel, unsigned short *pArray, unsigned char getFromReg)
{
	char ret = 0;
	unsigned int i;
	unsigned int *buff;
	unsigned char enable;
	/*ret = drvif_Wait_VGIP_start(1, 50, 0x032500);
	if (ret < 0)
		return -1;*/

	buff = (unsigned int *)vip_malloc((VIP_DM_HDR_3D_LUT_UI_TBL_SIZE) * sizeof(unsigned int));

	if (NULL == buff)
		return -1;
	
	if (HDR_sel == 0) {
		if (getFromReg == 1) {
			drvif_Read_DM_HDR_3dLUT(&enable, DM_HDR_3D_DRV_LUT);
			fwif_color_DM_HDR_3dLUT_Decode(DM_HDR_3D_DRV_LUT, buff);

			/* return from compact form*/
			for (i=0;i<VIP_DM_HDR_3D_LUT_UI_TBL_SIZE;i++)
				pArray[i] = buff[i]<<4;
		} else {
			memcpy((unsigned char*)pArray, (unsigned char*)pre_hdr_3dlut, sizeof(short)*(VIP_DM_HDR_3D_LUT_UI_TBL_SIZE));
		}
	} else {
		drvif_Read_DM_HDR_1_2_HDR_3dLUT(&enable, DM_HDR_3D_DRV_LUT);
		fwif_color_DM_HDR_3dLUT_Decode(DM_HDR_3D_DRV_LUT, buff);
		
		/* return from compact form*/
		for (i=0;i<VIP_DM_HDR_3D_LUT_UI_TBL_SIZE;i++)
			pArray[i] = buff[i]<<4;
	}

	vip_free((void *)buff);

	return ret;
}

char fwif_color_DM2_3D_LUT_BIT_Change(unsigned short *pArray, unsigned short *outArray, VIP_HDR10_CSC3_TABLE_Mode mode)
{
	unsigned int HDR3DLUT_ZIZE, i;
	if (mode == OLD_17x17x17)
		HDR3DLUT_ZIZE = VIP_DM_HDR_3D_LUT_UI_TBL_SIZE;
	else if (mode == NEW_24x24x24)
		HDR3DLUT_ZIZE = HDR_24x24x24_size*3;

	if (pArray == NULL || outArray == NULL) {
		rtd_pr_vpq_emerg("NULL point in DM2_3D_LUT_BIT_Change\n");
		return -1;
	}

	for (i=0;i<HDR3DLUT_ZIZE;i++)
		outArray[i] = pArray[i]>>4;

	return 0;
}

char fwif_color_DM2_EOTF_Set_By_DMA(unsigned int *EOTF_table32_R, unsigned int *EOTF_table32_G, unsigned int *EOTF_table32_B)
{
	char ret;
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;	unsigned short v_sta, v_len, line_cnt, v_end;
#else
	unsigned int va_temp;	unsigned short v_sta, v_len, line_cnt, v_end;
#endif
	unsigned short delay1, delay2;

	delay1 = 30;

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_EOTF);

	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(VIP_DMAto3DTable_HDR_EOTF_SIZE, (1 << 12));

	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_EOTF_Set_By_DMA, addr = NULL\n");
		return -1;
	}

	ret = drvif_Get_VO_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_EOTF_Set_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_DM2_EOTF_Set_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			//return -1;
		}
	}
	pVir_addr = dvr_remap_uncached_memory(addr, size, __builtin_return_address(0));

	size_aligned = size;
	addr_aligned = addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	rtd_pr_vpq_debug("DM2_EOTF, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
		addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);

	ret = drvif_DM2_EOTF_Set_By_DMA(EOTF_table32_R, EOTF_table32_G, EOTF_table32_B, addr_aligned, (unsigned int*) pVir_addr_aligned);
	dvr_unmap_memory((void *)pVir_addr, size);

	return ret;
}

char fwif_color_DM2_HDR1_2_EOTF_Set_By_DMA(unsigned int *EOTF_table32_R, unsigned int *EOTF_table32_G, unsigned int *EOTF_table32_B)
{
	char ret;
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;	unsigned short v_sta, v_len, line_cnt, v_end;
#else
	unsigned int va_temp;	unsigned short v_sta, v_len, line_cnt, v_end;
#endif
	unsigned short delay1, delay2;

	delay1 = 30;

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_EOTF);

	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(VIP_DMAto3DTable_HDR_EOTF_SIZE, (1 << 12));

	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_HDR1_2_EOTF_Set_By_DMA, addr = NULL\n");
		return -1;
	}

	ret = drvif_Get_VO2_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_HDR1_2_EOTF_Set_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO2_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_DM2_HDR1_2_EOTF_Set_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			//return -1;
		}
	}
	pVir_addr = dvr_remap_uncached_memory(addr, size, __builtin_return_address(0));

	size_aligned = size;
	addr_aligned = addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	rtd_pr_vpq_debug("DM2_HDR1_2_EOTF, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
		addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);

	ret = drvif_DM2_HDR1_2_EOTF_Set_By_DMA(EOTF_table32_R, EOTF_table32_G, EOTF_table32_B, addr_aligned, (unsigned int*) pVir_addr_aligned);
	dvr_unmap_memory((void *)pVir_addr, size);

	return ret;
}

char fwif_color_DM2_OETF_Set_By_DMA(unsigned short *OETF_table16_R, unsigned short *OETF_table16_G, unsigned short *OETF_table16_B)
{
	char ret;
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif
	unsigned short v_sta, v_len, line_cnt, v_end;
	unsigned short delay1, delay2;

	delay1 = 30;

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_OETF);

	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(VIP_DMAto3DTable_HDR_OETF_SIZE, (1 << 12));

	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_OETF_Set_By_DMA, addr = NULL\n");
		return -1;
	}

	ret = drvif_Get_VO_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_OETF_Set_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_DM2_OETF_Set_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			return -1;
		}
	}
	pVir_addr = dvr_remap_uncached_memory(addr, size, __builtin_return_address(0));

	size_aligned = size;
	addr_aligned = addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	rtd_pr_vpq_debug("DM2_OETF, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
		addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);

	 ret = drvif_DM2_OETF_Set_By_DMA(OETF_table16_R, OETF_table16_G, OETF_table16_B, addr_aligned, (unsigned int*)pVir_addr_aligned);
	dvr_unmap_memory((void *)pVir_addr, size);

	return ret;
}

char fwif_color_DM2_HDR1_2_OETF_Set_By_DMA(unsigned short *OETF_table16_R, unsigned short *OETF_table16_G, unsigned short *OETF_table16_B)
{
	char ret;
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif
	unsigned short v_sta, v_len, line_cnt, v_end;
	unsigned short delay1, delay2;

	delay1 = 30;

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_OETF);

	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(VIP_DMAto3DTable_HDR_OETF_SIZE, (1 << 12));

	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_HDR1_2_OETF_Set_By_DMA, addr = NULL\n");
		return -1;
	}

	ret = drvif_Get_VO2_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_HDR1_2_OETF_Set_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO2_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_DM2_HDR1_2_OETF_Set_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			return -1;
		}
	}
	pVir_addr = dvr_remap_uncached_memory(addr, size, __builtin_return_address(0));

	size_aligned = size;
	addr_aligned = addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	rtd_pr_vpq_debug("DM2_HDR1_2_OETF, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
		addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);

	 ret = drvif_DM2_HDR1_2_OETF_Set_By_DMA(OETF_table16_R, OETF_table16_G, OETF_table16_B, addr_aligned, (unsigned int*)pVir_addr_aligned);
	dvr_unmap_memory((void *)pVir_addr, size);

	return ret;
}



char fwif_color_DM2_ToneMapping_Set_By_DMA(short *TM_table12_R, short *TM_table12_G, short *TM_table12_B)
{
	char ret;
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;	unsigned short v_sta, v_len, line_cnt, v_end;
#else
	unsigned int va_temp;	unsigned short v_sta, v_len, line_cnt, v_end;
#endif
	unsigned short delay1, delay2;

	delay1 = 30;

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_TM);

	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(VIP_DMAto3DTable_HDR_TM_and_SIP2_SIZE, (1 << 12));

	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_ToneMapping_Set_By_DMA, addr = NULL\n");
		return -1;
	}

	ret = drvif_Get_VO_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_ToneMapping_Set_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_DM2_ToneMapping_Set_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			//return -1;
		}
	}
	pVir_addr = dvr_remap_uncached_memory(addr, size, __builtin_return_address(0));

	size_aligned = size;
	addr_aligned = addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	rtd_pr_vpq_info("DM2_TM, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
		addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);

	ret = drvif_DM2_ToneMapping_Set_By_DMA(TM_table12_R, TM_table12_G, TM_table12_B, addr_aligned, (unsigned int*) pVir_addr_aligned);
	dvr_unmap_memory((void *)pVir_addr, size);

	return ret;
}

char fwif_color_DM2_HDR1_2_ToneMapping_Set_By_DMA(short *TM_table12_R, short *TM_table12_G, short *TM_table12_B)
{
	char ret;
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;	unsigned short v_sta, v_len, line_cnt, v_end;
#else
	unsigned int va_temp;	unsigned short v_sta, v_len, line_cnt, v_end;
#endif
	unsigned short delay1, delay2;

	delay1 = 30;

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_TM);

	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(VIP_DMAto3DTable_HDR_TM_and_SIP2_SIZE, (1 << 12));

	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_HDR1_2_ToneMapping_Set_By_DMA, addr = NULL\n");
		return -1;
	}

	ret = drvif_Get_VO2_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_HDR1_2_ToneMapping_Set_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO2_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_DM2_HDR1_2_ToneMapping_Set_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			//return -1;
		}
	}
	pVir_addr = dvr_remap_uncached_memory(addr, size, __builtin_return_address(0));

	size_aligned = size;
	addr_aligned = addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	rtd_pr_vpq_info("DM2_HDR1_2_TM, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
		addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);

	ret = drvif_DM2_HDR1_2_ToneMapping_Set_By_DMA(TM_table12_R, TM_table12_G, TM_table12_B, addr_aligned, (unsigned int*) pVir_addr_aligned);
	dvr_unmap_memory((void *)pVir_addr, size);

	return ret;
}


char fwif_color_DM2_3D_24x24x24_LUT_Set_By_DMA(unsigned char enable, unsigned short *pArray)
{
#if 0	// use uncached_memory
	char ret;
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif
	unsigned short v_sta, v_len, line_cnt, v_end;
	unsigned short delay1, delay2;
	static unsigned char print_cnt = HDR_DMA_Status_MAX;
	delay1 = 30;

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_3D_LUT);

	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(VIP_DMAto3DTable_HDR_3D_LUT_SIZE, (1 << 12));

	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_3D_24x24x24_LUT_Set_By_DMA, addr = NULL\n");
		return -1;
	}

	ret = drvif_Get_VO_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_3D_24x24x24_LUT_Set_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_DM2_3D_24x24x24_LUT_Set_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			//return -1;
		}
	}

	size_aligned = size;
	addr_aligned = addr;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
#endif
	pVir_addr = dvr_remap_uncached_memory(addr, PAGE_ALIGN(size_aligned), __builtin_return_address(0));

#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	if (print_cnt >= HDR_DMA_Status_MAX) {
		rtd_pr_vpq_info("DM2_3D LUT, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
			addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);
		print_cnt = 0;
	}
	print_cnt++;

	ret = drvif_Set_DM_HDR_3dLUT_24x24x24_16_By_DMA(enable, pArray, addr_aligned, (unsigned int*) pVir_addr_aligned, 0);
	dvr_unmap_memory((void *)pVir_addr, PAGE_ALIGN(size_aligned));
#else	// use cached_memory
	char ret;
	unsigned int addr = 0, size;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr = NULL;
	unsigned int  *pVir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif
	unsigned short v_sta, v_len, line_cnt, v_end;
	unsigned short delay1, delay2;
	static unsigned char print_cnt = HDR_DMA_Status_MAX;
	delay1 = 30;

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_3D_LUT);

	addr = drvif_memory_get_data_align(addr, (1 << 12));
	//size = drvif_memory_get_data_align(VIP_DMAto3DTable_HDR_3D_LUT_SIZE, (1 << 12));
	size = drvif_memory_get_data_align(124416, (1 << 12));	// 24x24x24 table use 124416 byte

	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_3D_24x24x24_LUT_Set_By_DMA, addr = NULL\n");
		return -1;
	}

	ret = drvif_Get_VO_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_DM2_3D_24x24x24_LUT_Set_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_DM2_3D_24x24x24_LUT_Set_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			//return -1;
		}
	}

	size_aligned = size;
	addr_aligned = addr;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
#endif
	pVir_addr = dvr_remap_cached_memory(addr, PAGE_ALIGN(size_aligned), __builtin_return_address(0));

#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	if (print_cnt >= HDR_DMA_Status_MAX) {
		rtd_pr_vpq_info("DM2_3D LUT, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
			addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);
		print_cnt = 0;
	}
	print_cnt++;

	ret = drvif_Set_DM_HDR_3dLUT_24x24x24_16_By_DMA(enable, pArray, addr_aligned, (unsigned int*) pVir_addr_aligned, size);
	dvr_unmap_memory((void *)pVir_addr, PAGE_ALIGN(size_aligned));

	return ret;

#endif
	//return ret;

}

char fwif_color_DM2_3D_17x17x17_LUT_Set_By_DMA(unsigned char enable, unsigned short *pArray)
{
	char ret;
	unsigned int addr = 0, size;
	unsigned int *pVir_addr = 0;
	unsigned short v_sta, v_len, line_cnt, v_end;
	unsigned short delay1, delay2;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr_aligned = NULL;
	static unsigned char print_cnt = HDR_DMA_Status_MAX;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif
	delay1 = 30;

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_3D_LUT);
	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(58956, (1 << 12));
	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_DM_3D_17x17x17_LUT_Set_By_DMA, addr = NULL\n");
		return -1;
	}

	ret = drvif_Get_VO_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_DM_3D_17x17x17_LUT_Set_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_DM_3D_17x17x17_LUT_Set_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			//return -1;
		}
	}

	size_aligned = size;
	addr_aligned = addr;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
#endif
	pVir_addr = dvr_remap_cached_memory(addr, PAGE_ALIGN(size_aligned), __builtin_return_address(0));

#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	if (print_cnt >= HDR_DMA_Status_MAX) {
		rtd_pr_vpq_info("DM2_3D LUT, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
			addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);
		print_cnt = 0;
	}
	print_cnt++;

	ret = drvif_Set_DM_HDR_3dLUT_17x17x17_16_By_DMA(enable, pArray, addr_aligned, (unsigned int*) pVir_addr_aligned, size);
	dvr_unmap_memory((void *)pVir_addr, PAGE_ALIGN(size_aligned));

	return ret;

}

char fwif_color_DM2_HDR1_2_3D_17x17x17_LUT_Set_By_DMA(unsigned char enable, unsigned short *pArray)
{
	char ret;
	unsigned int addr = 0, size;
	unsigned int *pVir_addr = 0;
	unsigned short v_sta, v_len, line_cnt, v_end;
	unsigned short delay1, delay2;
	unsigned int addr_aligned = 0, size_aligned;
	unsigned int  *pVir_addr_aligned = NULL;
	static unsigned char print_cnt = HDR_DMA_Status_MAX;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif
	delay1 = 30;

	addr = get_query_VIP_DMAto3DTABLE_start_address(DMAto3DTABLE_HDR_3D_LUT);
	addr = drvif_memory_get_data_align(addr, (1 << 12));
	size = drvif_memory_get_data_align(58956, (1 << 12));
	if (addr == 0) {
		rtd_pr_vpq_emerg("fwif_color_DM_HDR1_2_3D_17x17x17_LUT_Set_By_DMA, addr = NULL\n");
		return -1;
	}

	ret = drvif_Get_VO2_Active_Info(&v_sta, &v_end, &line_cnt);
	if (ret < 0) {
		rtd_pr_vpq_emerg("fwif_color_DM_HDR1_2_3D_17x17x17_LUT_Set_By_DMA is not ready, ret = %d\n", ret);
		//return -1;
	} else {
		/* wait for active area to write DMA*/
		v_len = ((v_end - v_sta)<0)?(0):((v_end - v_sta));
		delay2 = delay1 + (v_len >> 1);
		ret = drvif_Wait_VO2_start(delay1, v_len, 0x032500);
		if (ret < 0) {
			rtd_pr_vpq_emerg("fwif_color_DM_HDR1_2_3D_17x17x17_LUT_Set_By_DMA fail to wait for active, ret = %d, v_end=%d, v_sta=%d, delay1=%d, delay2=%d,\n",
				ret, v_end, v_sta, delay1, delay2);
			//return -1;
		}
	}

	size_aligned = size;
	addr_aligned = addr;

#ifdef CONFIG_BW_96B_ALIGNED
	size_aligned = dvr_size_alignment(size);
#endif
	pVir_addr = dvr_remap_cached_memory(addr, PAGE_ALIGN(size_aligned), __builtin_return_address(0));

#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else
	va_temp = (unsigned int)pVir_addr;
#endif
	pVir_addr_aligned = (unsigned int*)va_temp;

#ifdef CONFIG_BW_96B_ALIGNED
	addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)addr, size_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
	va_temp = (unsigned long)pVir_addr;
#else //CONFIG_ARM64
	va_temp = (unsigned int)pVir_addr;
#endif //CONFIG_ARM64
	pVir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, size_aligned);
#endif

	if (print_cnt >= HDR_DMA_Status_MAX) {
		rtd_pr_vpq_info("DM2_HDR1_2_3D LUT, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
			addr, pVir_addr, addr_aligned, pVir_addr_aligned, size, size_aligned);
		print_cnt = 0;
	}
	print_cnt++;

	ret = drvif_Set_DM_HDR1_2_3dLUT_17x17x17_16_By_DMA(enable, pArray, addr_aligned, (unsigned int*) pVir_addr_aligned, size);
	dvr_unmap_memory((void *)pVir_addr, PAGE_ALIGN(size_aligned));

	return ret;

}

void fwif_color_Set_system_info_structure_table(unsigned long arg)
{
	printk("fwif_color_SetDCC_system_info_structure_table\n");
	system_info_structure_table = ((_system_setting_info*)arg);
}

void fwif_color_Set_RPC_system_info_structure_table(unsigned long arg)
{
	printk(KERN_EMERG "fwif_color_Set_RPC_system_info_structure_table\n");
	RPC_system_info_structure_table = ((_RPC_system_setting_info*)arg);
}

void fwif_color_Share_Memory_Access_VIP_TABLE_Struct(unsigned long arg)
{
	printk("fwif_color_Share_Memory_Access_VIP_TABLE_Struct\n");
	g_Share_Memory_VIP_TABLE_Struct_isr= ((SLR_VIP_TABLE *)arg);

	#ifdef VCPU_INTERRUPT
	ROSPM_AddDevice(&vip_device);
	#endif
}

void fwif_color_Share_Memory_Access_VIP_TABLE_CRC_Struct(unsigned long arg)
{
	vip_table_crc_isr = ((VIP_table_crc_value *)arg);
}

unsigned char fwif_color_get_force_run_i3ddma_enable(unsigned char display)
{
#ifdef CONFIG_FORCE_RUN_I3DDMA
	return (get_nn_force_i3ddma_enable()|get_force_i3ddma_enable(display));
#else
	return 0;
#endif
}

void fwif_color_set_gamma_from_MagicGamma_MiddleWare(void)
{
#if 1//add for Gamma&InvGamma with CTP@InvOutputGamma
	return; //from merlin7 no more used
#else

	extern VIP_MAGIC_GAMMA_Curve_Driver_Data g_MagicGammaDriverDataSave;
	unsigned char display = 0;
	unsigned char src_idx = 0;
	Scaler_Get_Display_info(&display,&src_idx);

	down(&Gamma_Semaphore);

	//0. gamma curve reg control
	fwif_color_gamma_control_front(display);

	if (Scaler_access_Project_TV002_Style(0, 0) == Project_TV002_Style_1) {
		Scaler_get_gamma_decoded_TV002(GOut_R, GOut_G, GOut_B);
	} else {
		//1. choose encode gamma data
		fwif_color_get_gamma_default(g_GammaMode, &tGAMMA_temp_R, &tGAMMA_temp_G, &tGAMMA_temp_B);

		//2. decode gamma data to gamma curve
		fwif_color_gamma_decode(GOut_R, GOut_G, GOut_B, tGAMMA_temp_R, tGAMMA_temp_G, tGAMMA_temp_B);

		//3. calc gamma curve multiply from vpq ext HAL setting
		fwif_color_Cal_gammaCurve_from_MagicGamma_MiddleWare(&g_MagicGammaDriverDataSave);

		// following is same as fwif_set_gamma
		//4. gamma curve data protect and debug
		fwif_color_gamma_curve_data_protect(GOut_R, GOut_G, GOut_B);		//DO NOT mark this, must check

		//5. encode gamma cuve to gamma data
#ifdef ENABLE_xvYcc
		fwif_color_gamma_remmping_for_xvYcc(src_idx);
#endif
	}

#ifdef CONFIG_RTK_GAMUT_SUPPORT
	fwif_color_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B, Power1div22Gamma, Power1div22Gamma, Power1div22Gamma);
	drvif_color_inv_gamma_enable(SLR_MAIN_DISPLAY, 1, 0);
#else
	fwif_color_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B, GOut_R, GOut_G, GOut_B);
#endif
	//fwif_color_encode_gamma_debug(2); //debug

	//6. write gamma table
	fwif_color_set_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B);

	//7. gamma curve reg control
	fwif_color_gamma_control_back(display, 1);

	up(&Gamma_Semaphore);
#endif
}

char fwif_color_Cal_gammaCurve_from_MagicGamma_MiddleWare(VIP_MAGIC_GAMMA_Curve_Driver_Data *pData)
{
	unsigned short i, j, shift_bit, step;
	unsigned short MagicGammaR_tmp[MAGIC_GAMMA_POINT_NUM],	MagicGammaG_tmp[MAGIC_GAMMA_POINT_NUM],  MagicGammaB_tmp[MAGIC_GAMMA_POINT_NUM];
	unsigned short spec_index[MAGIC_GAMMA_POINT_NUM]={0, 107, 207, 311, 411, 515, 619, 719, 823, 923, 1023};
	unsigned short r0,r1, g0,g1, b0,b1, index0, index1, tmp, idx = 0;
	unsigned int ratioR = 0, ratioG = 0, ratioB = 0;
	unsigned char ratio_shiftBit =10;
	int hdiff, qdiff;
	extern unsigned short g_GammaRemap[4097];

	// error check;
	if(pData == NULL)
	{
		rtd_pr_vpq_err("%s pData = NULL\n", __FUNCTION__);
		return -1;
	}

	shift_bit = pData->shift_bit;

	//change gamma power by pic mode
	for(i=0;i<MAGIC_GAMMA_POINT_NUM;i++)
	{
		MagicGammaR_tmp[i] = pData->GammaR[i];
		MagicGammaG_tmp[i] = pData->GammaG[i];
		MagicGammaB_tmp[i] = pData->GammaB[i];

		MagicGammaR_tmp[i] = (MagicGammaR_tmp[i] * pData->Gamma_Coef[i])>>shift_bit;
		MagicGammaG_tmp[i] = (MagicGammaG_tmp[i] * pData->Gamma_Coef[i])>>shift_bit;
		MagicGammaB_tmp[i] = (MagicGammaB_tmp[i] * pData->Gamma_Coef[i])>>shift_bit;
	}

	//data check;
	for(i=0;i<MAGIC_GAMMA_POINT_NUM-1;i++)
	{
		if(spec_index[i]>=spec_index[i+1])
		{
			rtd_pr_vpq_err("spec_index Error, return\n");
			return -1;

		}
		if(MagicGammaR_tmp[i]>=MagicGammaR_tmp[i+1])
		{
			rtd_pr_vpq_err("MagicGammaR_tmp Error, return\n");
			return -1;

		}
		if(MagicGammaG_tmp[i]>=MagicGammaG_tmp[i+1])
		{
			rtd_pr_vpq_err("MagicGammaR_tmp Error, return\n");
			return -1;

		}
		if(MagicGammaB_tmp[i]>=MagicGammaB_tmp[i+1])
		{
			rtd_pr_vpq_err("MagicGammaR_tmp Error, return\n");
			return -1;

		}

	}
	if((spec_index[0]!=0) || (spec_index[MAGIC_GAMMA_POINT_NUM-1]!=(Bin_Num_Gamma-1)))
	{
		rtd_pr_vpq_err("(spec_index[0]!=0) || (spec_index[MAGIC_GAMMA_POINT_NUM]!=(Bin_Num_Gamma-1)), return\n");
		return -1;

	}
	if((MagicGammaR_tmp[0]!=0) || (MagicGammaG_tmp[0]!=0) || (MagicGammaB_tmp[0]!=0))
	{
		rtd_pr_vpq_err("(MagicGammaR_tmp[0]!=0) || (MagicGammaG_tmp[0]!=0) || (MagicGammaB_tmp[0]!=0), return\n");
		return -1;

	}

	// Red
	for (i = 0, j = 0; i < 4096; i+=4, j++) {
		g_GammaRemap[i] = GOut_R[j];
	}
	g_GammaRemap[4096] = GOut_R[1023];

	for (i = 0; i < 4096; i+=4) {
		hdiff = (g_GammaRemap[i+4]-g_GammaRemap[i])>>1;
		qdiff = hdiff>>1;
		g_GammaRemap[i+1] = g_GammaRemap[i]+qdiff;
		g_GammaRemap[i+2] = g_GammaRemap[i]+hdiff;
		g_GammaRemap[i+3] = g_GammaRemap[i+2]+qdiff;
	}

	step = 0; index0 = 0; index1 = 0;
	r0 = 0; r1 = 0;
	for(i = 0; i < Bin_Num_Gamma; i++)
	{
		if(i == spec_index[step])
		{
			GOut_R[i] = g_GammaRemap[MagicGammaR_tmp[step]];
			if((step+1)<MAGIC_GAMMA_POINT_NUM)
			{
				index0 = spec_index[step];
				r0 = MagicGammaR_tmp[step];
				index1 = spec_index[step+1];
				r1 = MagicGammaR_tmp[step+1];
				tmp = index1 - index0;
				ratioR = ((r1 - r0)<<ratio_shiftBit)/tmp;
				idx = 1;
				step++;
			}
		}
		else if (step > 0)
		{
			GOut_R[i] = MagicGammaR_tmp[step-1] + ((idx * ratioR)>>ratio_shiftBit);
			if (GOut_R[i] > 4096)
				GOut_R[i] = 4096;
			GOut_R[i] = g_GammaRemap[GOut_R[i]];
			idx++;
		}
	}

	// Green
	for (i = 0, j = 0; i < 4096; i+=4, j++) {
		g_GammaRemap[i] = GOut_G[j];;
	}
	g_GammaRemap[4096] = GOut_G[1023];

	for (i = 0; i < 4096; i+=4) {
		hdiff = (g_GammaRemap[i+4]-g_GammaRemap[i])>>1;
		qdiff = hdiff>>1;
		g_GammaRemap[i+1] = g_GammaRemap[i]+qdiff;
		g_GammaRemap[i+2] = g_GammaRemap[i]+hdiff;
		g_GammaRemap[i+3] = g_GammaRemap[i+2]+qdiff;
	}

	step = 0; index0 = 0; index1 = 0;
	g0 = 0; g1 = 0;
	for(i = 0; i < Bin_Num_Gamma; i++)
	{
		if(i == spec_index[step])
		{
			GOut_G[i] = g_GammaRemap[MagicGammaR_tmp[step]];
			if((step+1)<MAGIC_GAMMA_POINT_NUM)
			{
				index0 = spec_index[step];
				g0 = MagicGammaG_tmp[step];
				index1 = spec_index[step+1];
				g1 = MagicGammaG_tmp[step+1];
				tmp = index1 - index0;
				ratioG = ((g1 - g0)<<ratio_shiftBit)/tmp;

				idx = 1;
				step++;
			}
		}
		else if (step > 0)
		{
			GOut_G[i] = MagicGammaG_tmp[step-1] + ((idx * ratioG)>>ratio_shiftBit);
			if (GOut_G[i] > 4096)
				GOut_G[i] = 4096;
			GOut_G[i] = g_GammaRemap[GOut_G[i]];
			idx++;
		}
	}

	// Blue
	for (i = 0, j = 0; i < 4096; i+=4, j++) {
		g_GammaRemap[i] = GOut_B[j];;
	}
	g_GammaRemap[4096] = GOut_B[1023];

	for (i = 0; i < 4096; i+=4) {
		hdiff = (g_GammaRemap[i+4]-g_GammaRemap[i])>>1;
		qdiff = hdiff>>1;
		g_GammaRemap[i+1] = g_GammaRemap[i]+qdiff;
		g_GammaRemap[i+2] = g_GammaRemap[i]+hdiff;
		g_GammaRemap[i+3] = g_GammaRemap[i+2]+qdiff;
	}

	step = 0; index0 = 0; index1 = 0;
	b0 = 0; b1 = 0;
	for(i = 0; i < Bin_Num_Gamma; i++)
	{
		if(i == spec_index[step])
		{
			GOut_B[i] = g_GammaRemap[MagicGammaR_tmp[step]];
			if((step+1)<MAGIC_GAMMA_POINT_NUM)
			{
				index0 = spec_index[step];
				b0 = MagicGammaB_tmp[step];
				index1 = spec_index[step+1];
				b1 = MagicGammaB_tmp[step+1];
				tmp = index1 - index0;
				ratioB = ((b1 - b0)<<ratio_shiftBit)/tmp;

				idx = 1;
				step++;
			}
		}
		else if (step > 0)
		{
			GOut_B[i] = MagicGammaB_tmp[step-1] + ((idx * ratioB)>>ratio_shiftBit);
			if (GOut_B[i] > 4096)
				GOut_B[i] = 4096;
			GOut_B[i] = g_GammaRemap[GOut_B[i]];
			idx++;
		}
	}


	//data protect
	GOut_R[0]=0;
	GOut_G[0]=0;
	GOut_B[0]=0;
	GOut_R[Bin_Num_Gamma] = GOut_R[Bin_Num_Gamma - 1];
	GOut_G[Bin_Num_Gamma] = GOut_G[Bin_Num_Gamma - 1];
	GOut_B[Bin_Num_Gamma] = GOut_B[Bin_Num_Gamma - 1];

#if 0
	printf("GOut_R=\n");
	for(i = 0; i <= Bin_Num_Gamma; i++)
		printf("%d\n",GOut_R[i]);
	printf("\n");

	printf("MagicGammaR_tmp=\n");
	for(i = 0; i <= MAGIC_GAMMA_POINT_NUM; i++)
		printf("%d\n",MagicGammaR_tmp[i]);
	printf("\n");
#endif
	return 0;
}

#ifdef CONFIG_RTK_SW_OUTGAMMA_CT
void fwif_color_set_rtk_colortemp_output_gamma(unsigned char enable, unsigned short Red_Con, unsigned short Green_Con, unsigned short Blue_Con,
	short Red_Bri, short Green_Bri, short Blue_Bri, unsigned char waitSync)
{
	static short OutGamma[3][1025];
	extern unsigned int out_GAMMA_R[512];
	extern unsigned int out_GAMMA_G[512];
	extern unsigned int out_GAMMA_B[512];
	int i;

	down(&Gamma_Semaphore);
	for (i = 0; i < 1025; i++) {
		OutGamma[0][i] = ((GOut_R[i]*(int)Red_Con)>>10)+Red_Bri*2;
		OutGamma[1][i] = ((GOut_G[i]*(int)Green_Con)>>10)+Green_Bri*2;
		OutGamma[2][i] = ((GOut_B[i]*(int)Blue_Con)>>10)+Blue_Bri*2;

		OutGamma[0][i] = OutGamma[0][i] > 8191 ? 8191 : (OutGamma[0][i] < 0 ? 0 : OutGamma[0][i]);
		OutGamma[1][i] = OutGamma[1][i] > 8191 ? 8191 : (OutGamma[1][i] < 0 ? 0 : OutGamma[1][i]);
		OutGamma[2][i] = OutGamma[2][i] > 8191 ? 8191 : (OutGamma[2][i] < 0 ? 0 : OutGamma[2][i]);
	}
	fwif_color_out_gamma_control_front();
	fwif_color_out_gamma_encode(out_GAMMA_R, out_GAMMA_G, out_GAMMA_B, OutGamma[0], OutGamma[1], OutGamma[2]);
	if (waitSync)
		fwif_color_WaitFor_SYNC_START_MEMCDTG();
	drvif_color_Out_Gamma_Curve_Write(out_GAMMA_R, GAMMA_CHANNEL_R);	/*R*/
	drvif_color_Out_Gamma_Curve_Write(out_GAMMA_G, GAMMA_CHANNEL_G);	/*G*/
	drvif_color_Out_Gamma_Curve_Write(out_GAMMA_B, GAMMA_CHANNEL_B);	/*B*/
	fwif_color_out_gamma_control_back();
	fwif_color_out_gamma_control_enable(enable);
	up(&Gamma_Semaphore);
}
#endif

void fwif_color_set_clarity_resolution(void)
{
	unsigned short value = Scaler_GetSharpnessTable();
	unsigned char gain = 0;

	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}

	switch(Scaler_get_Clarity_RealityCreation()) {
	case 0: //off
		gain = 0;
		break;
	case 1: //auto
	default:
		if (value < Sharp_table_num)
			gain = gVip_Table->Ddomain_SHPTable[value].SR_Control.Ring_Gen_Gain;
		break;
	case 2: //manual
		gain = Scaler_get_Clarity_Resolution()<<1;
		break;
	}
	drvif_color_setSR_Ring_Gen_Gain(gain);
}

void fwif_color_set_live_colour(unsigned char level)
{
	short gain_preset[4] = {0, 64, 96, 128};
	int dhue;
	int dsatbysat[SATSEGMAX];
	int ditnbyitn[ITNSEGMAX];

	if (level > 3)
		return;

	down(&ICM_Semaphore);
	fwif_color_icm_global_gain_access(1, ICM_Global_Sat, &gain_preset[level]);
	drvif_color_icm_Get_Global_Ctrl(FALSE, &dhue, dsatbysat, ditnbyitn);
	fwif_color_icm_global_gain_calc(&dhue, dsatbysat, ditnbyitn);
	fwif_color_icm_global_adjust_on_elem_table(&icm_tab_elem_of_vip_table, dhue, dsatbysat, ditnbyitn, &icm_tab_elem_write);
	drvif_color_icm_Write3DTable(icm_tab_elem_write.elem);
	up(&ICM_Semaphore);
}

void fwif_color_set_mastered_4k(void) /*fake function*/
{
	unsigned short value = Scaler_GetSharpnessTable();
	unsigned char mode = Scaler_DispGetInputInfo(SLR_INPUT_MODE_CURR);
	unsigned char gain = 0;

	if ((mode == _MODE_1080P60) && (Scaler_DispGetInputInfo(SLR_INPUT_V_FREQ) < 245) && (Scaler_DispGetInputInfo(SLR_INPUT_V_FREQ) > 235)) {
		SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
		if (gVip_Table == NULL) {
			VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
			return;
		}

		if (Scaler_get_Clarity_Mastered4K()) {
			gain = 128;
		} else {
			if (value < Sharp_table_num)
				gain = gVip_Table->Ddomain_SHPTable[value].SR_Control.Ring_Gen_Gain;
		}
		drvif_color_setSR_Ring_Gen_Gain(gain);
	}
}

#define DRTM_Log_Show_Num 300
#define DRTM_ABS(x) ((x >= 0)?(x):((x)*(-1)))
#define VIP_DRTM_Monitor_items 6
#define VIP_DRTM_buf_num 2
#define VIP_DRTM_continue_print_max 30
unsigned int VIP_RTNR_measured[VIP_DRTM_buf_num][VIP_DRTM_Monitor_items];
unsigned int VIP_DI_measured[VIP_DRTM_buf_num][VIP_DRTM_Monitor_items];
extern unsigned int set_di_sta_90k;

unsigned int VIP_RTNR_measured_print[VIP_DRTM_buf_num][VIP_DRTM_Monitor_items];
unsigned int VIP_RTNR_measured_times_print[VIP_DRTM_Monitor_items]={0};
unsigned int VIP_RTNR_measured_t_record[VIP_DRTM_Monitor_items]={0};

unsigned int VIP_DI_measured_print[VIP_DRTM_buf_num][VIP_DRTM_Monitor_items];
unsigned int VIP_DI_measured_times_print[VIP_DRTM_Monitor_items]={0};
unsigned int VIP_DI_measured_t_record[VIP_DRTM_Monitor_items]={0};

void fwif_color_DI_RTNR_Timing_Measure_Check_ISR(void)
{
	unsigned char i, j;
	int diff_rtnr[VIP_DRTM_Monitor_items], diff_di[VIP_DRTM_Monitor_items];
	int tmp;
	static unsigned short cnt = 0;
	unsigned int t_now  = 0;
	unsigned int t_diff = 0;
	unsigned int t_setDI = 0, t_swDetect = 0, t_SMT = 0, t_DMA_check = 0;
	unsigned int t_diff_min = 0xffffffff;
	unsigned int t_th = 3 * 42 * 90; // 3 frames
	_RPC_system_setting_info *RPC_sysInfo = NULL;
	unsigned char final_print_update = 0;
	static unsigned char need_to_print_flag = 0;
	static unsigned int t_print_pre = 0;
	unsigned char filed_confuse = 0, rtnr_in = 0, filed_confuse_now = 0;
	static unsigned char filed_confuse_pre = 0xff;
	static unsigned char print_continue_cnt = 0;

	RPC_sysInfo = (_RPC_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);	
	if (RPC_sysInfo == NULL) {
		rtd_printk(KERN_INFO,"DRTM", "rpc sys info = NULL,,fwif_color_DI_RTNR_Timing_Measure_Check_ISR\n");
		return;
	}

	// newest index is  0
	drvif_color_Get_DI_RTNR_Timing_Measurement(&VIP_RTNR_measured[0][0], &VIP_DI_measured[0][0]);
	t_now = drvif_Get_90k_Lo_clk();

	// set di 90k
	t_setDI = set_di_sta_90k;
	t_diff = (t_now < t_setDI)?(t_now):(t_now - t_setDI);
	if (t_diff < t_diff_min)
		t_diff_min = t_diff;

	// sw reset 90k
	t_swDetect = Scaler_ChangeUINT32Endian(RPC_sysInfo->PQ_IP_Enable_Monitor_2.DI_RTNR_SW_Detection_90k);
	t_diff = (t_now < t_swDetect)?(t_now):(t_now - t_swDetect);
	if (t_diff < t_diff_min)
		t_diff_min = t_diff;

	// smt 90k
	t_SMT = Scaler_ChangeUINT32Endian(RPC_sysInfo->PQ_IP_Enable_Monitor_2.DI_RTNR_SMT_90k);
	t_diff = (t_now < t_SMT)?(t_now):(t_now - t_SMT);
	if (t_diff < t_diff_min)
		t_diff_min = t_diff;

	// DMA check 90k
	t_DMA_check = Scaler_ChangeUINT32Endian(RPC_sysInfo->PQ_IP_Enable_Monitor_2.DI_RTNR_DMA_Check_90k);
	t_diff = (t_now < t_DMA_check)?(t_now):(t_now - t_DMA_check);
	if (t_diff < t_diff_min)
		t_diff_min = t_diff;	
	
	// 0. vact rinsing->vact falling, 1. vact falling -> vs rising, 2. vs rising -> vact rinsing
	// 3. hact rising->hact falling, 4. hact falling->hact rising, 5. den rising->den rising
	for (i=0;i<VIP_DRTM_Monitor_items;i++) {
		tmp = (int)VIP_RTNR_measured[0][i] - (int)VIP_RTNR_measured[1][i];
		diff_rtnr[i] = DRTM_ABS(tmp);
		tmp = (int)VIP_DI_measured[0][i] - (int)VIP_DI_measured[1][i];
		diff_di[i] = DRTM_ABS(tmp);
	}

	for (i=0;i<VIP_DRTM_Monitor_items;i++) {
		if (diff_rtnr[i] != 0) {
			VIP_RTNR_measured_times_print[i]++;
			VIP_RTNR_measured_t_record[i] = t_now;
			final_print_update = 1;
		}
		if (diff_di[i] != 0) {
			VIP_DI_measured_times_print[i]++;
			VIP_DI_measured_t_record[i] = t_now;
			final_print_update = 1;
		}
	}

	if (final_print_update == 1) {
		memcpy(&VIP_RTNR_measured_print[0][0], &VIP_RTNR_measured[0][0], sizeof(int)*VIP_DRTM_buf_num*VIP_DRTM_Monitor_items);
		memcpy(&VIP_DI_measured_print[0][0], &VIP_DI_measured[0][0], sizeof(int)*VIP_DRTM_buf_num*VIP_DRTM_Monitor_items);
		need_to_print_flag = 1;
	} 

	if (t_diff_min < t_th)
		cnt = DRTM_Log_Show_Num;
	else
		cnt++;

	if (cnt >= DRTM_Log_Show_Num) {
		if (need_to_print_flag == 1) {
			if (print_continue_cnt < VIP_DRTM_continue_print_max) {
				rtd_printk(KERN_INFO,"DRTM","NR,vact:%d-%d@%d[%d],1:%d-%d@%d[%d],2:%d-%d@%d[%d],hact:%d-%d@%d[%d],4:%d-%d@%d[%d],5:%d-%d@%d[%d]\n",
					VIP_RTNR_measured_print[1][0], VIP_RTNR_measured_print[0][0], VIP_RTNR_measured_t_record[0], VIP_RTNR_measured_times_print[0],
					VIP_RTNR_measured_print[1][1], VIP_RTNR_measured_print[0][1], VIP_RTNR_measured_t_record[1], VIP_RTNR_measured_times_print[1], 
					VIP_RTNR_measured_print[1][2], VIP_RTNR_measured_print[0][2], VIP_RTNR_measured_t_record[2], VIP_RTNR_measured_times_print[2], 
					VIP_RTNR_measured_print[1][3], VIP_RTNR_measured_print[0][3], VIP_RTNR_measured_t_record[3], VIP_RTNR_measured_times_print[3], 
					VIP_RTNR_measured_print[1][4], VIP_RTNR_measured_print[0][4], VIP_RTNR_measured_t_record[4], VIP_RTNR_measured_times_print[4], 
					VIP_RTNR_measured_print[1][5], VIP_RTNR_measured_print[0][5], VIP_RTNR_measured_t_record[5], VIP_RTNR_measured_times_print[5]);
				rtd_printk(KERN_INFO,"DRTM","DI,vact:%d-%d@%d[%d],1:%d-%d@%d[%d],2:%d-%d@%d[%d],hact:%d-%d@%d[%d],4:%d-%d@%d[%d],5:%d-%d@%d[%d]\n",
					VIP_DI_measured_print[1][0], VIP_DI_measured_print[0][0], VIP_DI_measured_t_record[0], VIP_DI_measured_times_print[0], 
					VIP_DI_measured_print[1][1], VIP_DI_measured_print[0][1], VIP_DI_measured_t_record[1], VIP_DI_measured_times_print[1], 
					VIP_DI_measured_print[1][2], VIP_DI_measured_print[0][2], VIP_DI_measured_t_record[2], VIP_DI_measured_times_print[2], 
					VIP_DI_measured_print[1][3], VIP_DI_measured_print[0][3], VIP_DI_measured_t_record[3], VIP_DI_measured_times_print[3], 
					VIP_DI_measured_print[1][4], VIP_DI_measured_print[0][4], VIP_DI_measured_t_record[4], VIP_DI_measured_times_print[4], 
					VIP_DI_measured_print[1][5], VIP_DI_measured_print[0][5], VIP_DI_measured_t_record[5], VIP_DI_measured_times_print[5]);
				rtd_printk(KERN_INFO,"DRTM","TR,t:%d-%d,t_setDI=%d,t_swDetect=%d,t_SMT=%d,t_DMA_check=%d, print_continue_cnt=%d,\n",
					t_print_pre, t_now, t_setDI, t_swDetect, t_SMT, t_DMA_check, print_continue_cnt);			
				for (i=0;i<VIP_DRTM_Monitor_items;i++) {
					VIP_RTNR_measured_times_print[i] = 0;
					VIP_DI_measured_times_print[i] = 0;
					VIP_RTNR_measured_t_record[i] = 0;
					VIP_DI_measured_t_record[i] = 0;
				}
				print_continue_cnt = ((print_continue_cnt+1)>=VIP_DRTM_continue_print_max)?(VIP_DRTM_continue_print_max):((print_continue_cnt+1));
				need_to_print_flag = 0;
				t_print_pre = t_now;
			}
		} else {
			print_continue_cnt = 0;	
		}
		cnt = 0;
	} else {
		print_continue_cnt = 0;
	}
	
	for (j=0;j<(VIP_DRTM_buf_num-1);j++) {
		memcpy(&VIP_RTNR_measured[VIP_DRTM_buf_num-1-j][0], &VIP_RTNR_measured[VIP_DRTM_buf_num-2-j][0], sizeof(int)*VIP_DRTM_Monitor_items);
		memcpy(&VIP_DI_measured[VIP_DRTM_buf_num-1-j][0], &VIP_DI_measured[VIP_DRTM_buf_num-2-j][0], sizeof(int)*VIP_DRTM_Monitor_items);
		//VIP_DI_RTNR_measured_90k[VIP_DRTM_buf_num-1-j] = VIP_DI_RTNR_measured_90k[VIP_DRTM_buf_num-2-j];
	}

	// field confuse check
	filed_confuse = drvif_color_Get_DI_field_confuse();
	rtnr_in = drvif_color_Get_RTNR_progressive_input();

	if (filed_confuse == 2)
		filed_confuse_now = 2;
	else if (filed_confuse == 1 && rtnr_in == 0)
		filed_confuse_now = 1;
	else
		filed_confuse_now = 0;

	if (filed_confuse_pre != filed_confuse_now) {
		rtd_printk(KERN_INFO,"DRTM","filed_confuse_pre=%d, filed_confuse_now=%d, filed_confuse=%d, rtnr_in=%d @%d\n",
			filed_confuse_pre, filed_confuse_now, filed_confuse, rtnr_in, t_now);

		filed_confuse_pre = filed_confuse_now;
	}
	// 400c[31] single
}


char DI_PQC_CRC_Check_reset_cnt;
unsigned char DI_SW_Reset_INIT_Flag = 0;
extern unsigned int DI_SW_Detection_in_VPQ_TSK_Stable_CNT;
void fwif_color_DI_IP_ini(void)
{
	unsigned long addr_sta, addr_end, size;
	DI_PQC_CRC_Check_reset_cnt = 0;
	DI_SW_Reset_INIT_Flag = 1;
	DI_SW_Detection_in_VPQ_TSK_Stable_CNT = 0;
#if 0	
	addr_sta = get_query_start_address(QUERY_IDX_DI);
	addr_end = addr_sta + VIP_DI_1_BUFFER_SIZE;
#else
#ifdef CONFIG_OPTEE_SECURE_SVP_PROTECTION
	size = (unsigned int)carvedout_buf_query_secure(CARVEDOUT_SCALER_DI_NR, (void **)&addr_sta) ;
#else
	size = (unsigned int)carvedout_buf_query(CARVEDOUT_SCALER_DI_NR, (void **)&addr_sta) ;
#endif
	addr_end = addr_sta + size;
#endif	
	rtd_pr_vpq_info("DI_Bnd_setting, sta=%lx, end=%lx\n", addr_sta, addr_end);
	drvif_color_DI_Addr_Boundary_ini((unsigned int)addr_sta, (unsigned int)addr_end, (unsigned int)addr_sta, (unsigned int)addr_end);
	drvif_color_set_DI_detection(1, 0 ,0);
	drv_memory_di_Set_PQC_init();
	drvif_color_set_DI_RTNR_Timing_Measurement();
}

void fwif_color_DI_IEGSM_ini(void)
{
	unsigned long addr_sta, addr_end, size;

#if 0	
		addr_sta = get_query_start_address(QUERY_IDX_DI);
		addr_end = addr_sta + VIP_DI_1_BUFFER_SIZE;
#else
#ifdef CONFIG_OPTEE_SECURE_SVP_PROTECTION
	size = (unsigned int)carvedout_buf_query_secure(CARVEDOUT_SCALER_DI_NR, (void **)&addr_sta) ;
#else
	size = (unsigned int)carvedout_buf_query(CARVEDOUT_SCALER_DI_NR, (void **)&addr_sta) ;
#endif
	addr_end = addr_sta + size;
#endif	

	drvif_color_iEdgeSmooth_Addr_Boundary_ini((unsigned int)addr_sta, (unsigned int)addr_end);
}

unsigned int get_query_VIP_DMAto3DTABLE_start_address(unsigned char idx)
{
	unsigned int base_addr =0, addr = 0;

 	base_addr = get_query_start_address(QUERY_IDX_VIP_DMAto3DTABLE);
	//base_addr = drvif_memory_get_data_align(base_addr, (1 << 12));

	if (base_addr == 0) {
			rtd_pr_vpq_emerg("\n  get DMA error, base address = 0 \n");
	} else {
		if (idx == DMAto3DTABLE_HDR_3D_LUT)
			addr = base_addr;
		else if (idx == DMAto3DTABLE_HDR_EOTF)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE;
		else if (idx == DMAto3DTABLE_HDR_OETF)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE;
		else if (idx == DMAto3DTABLE_HDR_D_3D_LUT)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + 
				VIP_DMAto3DTable_HDR_OETF_SIZE;
		else if (idx == DMAto3DTABLE_ICM)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + 
				VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE;
#if 0
		else if ((idx == DMAto3DTABLE_TC_C_LUT) || (idx == DMAto3DTABLE_SIP_1))
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE +
				VIP_DMAto3DTable_ICM_SIZE;
		else if (idx == DMAto3DTABLE_TC_I_LUT)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE +
				VIP_DMAto3DTable_ICM_SIZE + VIP_DMAto3DTable_TC_C_LUT_SIZE;
		else if (idx == DMAto3DTABLE_TC_S_LUT)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE +
				VIP_DMAto3DTable_ICM_SIZE + VIP_DMAto3DTable_TC_C_LUT_SIZE + VIP_DMAto3DTable_TC_I_LUT_SIZE;
		else if (idx == DMAto3DTABLE_TC_P_LUT)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE +
				VIP_DMAto3DTable_ICM_SIZE + VIP_DMAto3DTable_TC_C_LUT_SIZE + VIP_DMAto3DTable_TC_I_LUT_SIZE + VIP_DMAto3DTable_TC_S_LUT_SIZE;
		else if (idx == DMAto3DTABLE_TC_D_LUT)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE +
				VIP_DMAto3DTable_ICM_SIZE + VIP_DMAto3DTable_TC_C_LUT_SIZE + VIP_DMAto3DTable_TC_I_LUT_SIZE + VIP_DMAto3DTable_TC_S_LUT_SIZE + VIP_DMAto3DTable_TC_P_LUT_SIZE;
#endif
		else if ((idx == DMAto3DTABLE_TC_LUT) || (idx == DMAto3DTABLE_SIP_1) || (idx == DMAto3DTABLE_SLC))
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + 
				VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE + VIP_DMAto3DTable_ICM_SIZE;
		else if ((idx == DMAto3DTABLE_HDR_TM) || (idx == DMAto3DTABLE_SIP_2))
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + 
				VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE + VIP_DMAto3DTable_ICM_SIZE + 
				VIP_DMAto3DTable_TC_LUT_and_SIP1_and_SLC_SIZE;
		else if (idx == DMAto3DTABLE_SLD_APL_DMA)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + 
				VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE + VIP_DMAto3DTable_ICM_SIZE + 
				VIP_DMAto3DTable_TC_LUT_and_SIP1_and_SLC_SIZE + VIP_DMAto3DTable_HDR_TM_and_SIP2_SIZE;
		else if (idx == DMAto3DTABLE_SRNN_MODE2)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + 
				VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE + VIP_DMAto3DTable_ICM_SIZE + 
				VIP_DMAto3DTable_TC_LUT_and_SIP1_and_SLC_SIZE + VIP_DMAto3DTable_HDR_TM_and_SIP2_SIZE + VIP_DMAto3DTABLE_SLD_APL_DMA_SIZE;
		else if (idx == DMAto3DTABLE_SRNN_MODE3)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + 
				VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE + VIP_DMAto3DTable_ICM_SIZE + 
				VIP_DMAto3DTable_TC_LUT_and_SIP1_and_SLC_SIZE + VIP_DMAto3DTable_HDR_TM_and_SIP2_SIZE + VIP_DMAto3DTABLE_SLD_APL_DMA_SIZE + 
				VIP_DMAto3DTABLE_SRNN_MODE2_SIZE;
		else if (idx == DMAto3DTABLE_SRNN_MODE4)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + 
				VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE + VIP_DMAto3DTable_ICM_SIZE + 
				VIP_DMAto3DTable_TC_LUT_and_SIP1_and_SLC_SIZE + VIP_DMAto3DTable_HDR_TM_and_SIP2_SIZE + VIP_DMAto3DTABLE_SLD_APL_DMA_SIZE + 
				VIP_DMAto3DTABLE_SRNN_MODE2_SIZE + VIP_DMAto3DTABLE_SRNN_MODE3_SIZE;
		else if (idx == DMAto3DTABLE_SRNN_MODE5)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + 
				VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE + VIP_DMAto3DTable_ICM_SIZE + 
				VIP_DMAto3DTable_TC_LUT_and_SIP1_and_SLC_SIZE + VIP_DMAto3DTable_HDR_TM_and_SIP2_SIZE + VIP_DMAto3DTABLE_SLD_APL_DMA_SIZE + 
				VIP_DMAto3DTABLE_SRNN_MODE2_SIZE + VIP_DMAto3DTABLE_SRNN_MODE3_SIZE + VIP_DMAto3DTABLE_SRNN_MODE4_SIZE;
		else if (idx == DMAto3DTABLE_SRNN_MODE6)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + 
				VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE + VIP_DMAto3DTable_ICM_SIZE + 
				VIP_DMAto3DTable_TC_LUT_and_SIP1_and_SLC_SIZE + VIP_DMAto3DTable_HDR_TM_and_SIP2_SIZE + VIP_DMAto3DTABLE_SLD_APL_DMA_SIZE + 
				VIP_DMAto3DTABLE_SRNN_MODE2_SIZE + VIP_DMAto3DTABLE_SRNN_MODE3_SIZE + VIP_DMAto3DTABLE_SRNN_MODE4_SIZE + 
				VIP_DMAto3DTABLE_SRNN_MODE5_SIZE;
		else if (idx == DMAto3DTABLE_SRNN_MODE7)
			addr = base_addr + VIP_DMAto3DTable_HDR_3D_LUT_SIZE + VIP_DMAto3DTable_HDR_EOTF_SIZE + 
				VIP_DMAto3DTable_HDR_OETF_SIZE + VIP_DMAto3DTable_D_3D_LUT_SIZE + VIP_DMAto3DTable_ICM_SIZE + 
				VIP_DMAto3DTable_TC_LUT_and_SIP1_and_SLC_SIZE + VIP_DMAto3DTable_HDR_TM_and_SIP2_SIZE + VIP_DMAto3DTABLE_SLD_APL_DMA_SIZE + 
				VIP_DMAto3DTABLE_SRNN_MODE2_SIZE + VIP_DMAto3DTABLE_SRNN_MODE3_SIZE + VIP_DMAto3DTABLE_SRNN_MODE4_SIZE + 
				VIP_DMAto3DTABLE_SRNN_MODE5_SIZE + VIP_DMAto3DTABLE_SRNN_MODE6_SIZE;
		else
			rtd_pr_vpq_emerg("\n  get DMA table index error, idx = %d \n", idx);
	}
	return addr;
}


//extern DRV_DeMura_CTRL_TBL DeMura_CTRL_TBL;
extern VIP_DeMura_TBL DeMura_TBL;
unsigned char fwif_color_set_DeMura_TBL_Mode(unsigned char mode)
{
	if (mode >= VIP_DeMura_TBL_Mode_MAX)
		mode = DeMura_TBL_241x136;
	DeMura_TBL.table_mode = mode;
	return 0;
}

unsigned char fwif_color_get_DeMura_TBL_Mode(void)
{
	return DeMura_TBL.table_mode;
}

extern struct semaphore VPQ_Demura_Semaphore;
char fwif_color_DeMura_init(unsigned char bLogEn, unsigned char unpdateTBL_only)
{
	extern DRV_DeMura_DMA_TBL DMA_TBL_Buff;
	DRV_DeMura_DMA_TBL DMA_TBL;

	//unsigned int phy_memory, size;
	DRV_DeMura_CTRL_TBL buff = {0};
	//unsigned int tbl_line_size; // Mark2 remove
	unsigned int tbl_frame_size;// Mark2 add
	unsigned short panel_width, panel_heigth, h_s, h_e, v_s, v_e;
	unsigned int base_addr;
	unsigned int *vir_addr;
	char ret = 0;
	unsigned int base_addr_aligned = 0, sizeDemuraTbl_aligned;
	unsigned int  *vir_addr_aligned = NULL;
#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif
	unsigned char aligned_val = 0;
	//unsigned int sizeDemuraTbl = sizeof(unsigned char)*VIP_Demura_Encode_TBL_ROW*VIP_Demura_Encode_TBL_COL;
	unsigned int size_offset = 10 * 1024; // avoid trash other memory while size do 4k and 96B aligned
	unsigned int sizeDemuraTbl = VIP_DeMura_BUFFER_SIZE - size_offset;

	if (drvif_color_get_HW_MEX_STATUS(MEX_RTK_DEMURA) != 1) {
		rtd_pr_vpq_info("HW_MEX,  MEX_RTK_DEMURA != 1, EN\n");
		return -1;
	}

	down(&VPQ_Demura_Semaphore);

	drvif_color_Get_main_den_h_v_start_end(&h_s, &h_e, &v_s, &v_e);

	panel_width = h_e - h_s;
	panel_heigth = v_e - v_s;

	memcpy(&buff, &DeMura_TBL.DeMura_CTRL_TBL, sizeof(DRV_DeMura_CTRL_TBL));

	base_addr = get_query_start_address(QUERY_IDX_VIP_DeMura);
	base_addr = drvif_memory_get_data_align(base_addr, (1 << 12));
	sizeDemuraTbl = drvif_memory_get_data_align(sizeDemuraTbl, (1 << 12));


	if (base_addr == 0) {
		rtd_pr_vpq_emerg("[%s] addr = NULL\n", __func__);
		ret = -1;
	} else {
		vir_addr = dvr_remap_uncached_memory(base_addr, sizeDemuraTbl, __builtin_return_address(0));

		if (DeMura_TBL.DeMura_CTRL_TBL.demura_12bitmode_en == 1)
		{
			if (DeMura_TBL.table_mode == DeMura_TBL_481x271) {
			DMA_TBL.burst_len = 32;

			switch( DeMura_TBL.DeMura_CTRL_TBL.demura_table_level )
			{
				case 0: // 3 planes
					if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
					{
						DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_Y_481x271_3Plane;
						tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_Y_481x271_3Plane<<4;
						//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_481x271_3Plane >> 4);
						//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_481x271_3Plane >> 4);
						//tbl_line_size = VIP_DemuraTBL_LineSize_Y_481x271_3Plane;
					}
					else // RGB mode
					{
						DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_RGB_481x271_3Plane;
						tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_RGB_481x271_3Plane<<4;
						//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_481x271_3Plane >> 4);
						//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_481x271_3Plane >> 4);
						//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_481x271_3Plane;
					}
					break;
				case 1: // 4 planes
					if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
					{
						DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_Y_481x271_4Plane;
						tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_Y_481x271_4Plane<<4;
						//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_481x271_4Plane >> 4);
						//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_481x271_4Plane >> 4);
						//tbl_line_size = VIP_DemuraTBL_LineSize_Y_481x271_4Plane;
					}
					else // RGB mode
					{
						DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_RGB_481x271_4Plane;
						tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_RGB_481x271_4Plane<<4;
						//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_481x271_4Plane >> 4) - 1;
						//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_481x271_4Plane >> 4);
						//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_481x271_4Plane;
					}
					break;
				case 2: // 5 planes
					if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
					{
						DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_Y_481x271_5Plane;
						tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_Y_481x271_5Plane<<4;
						//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_481x271_5Plane >> 4);
						//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_481x271_5Plane >> 4);
						//tbl_line_size = VIP_DemuraTBL_LineSize_Y_481x271_5Plane;
					}
					else // RGB mode
					{
						DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_RGB_481x271_5Plane;
						tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_RGB_481x271_5Plane<<4;
						//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_481x271_5Plane >> 4) - 1;
						//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_481x271_5Plane >> 4);
						//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_481x271_5Plane;
					}
					break;
				default:
					if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
					{
						DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_Y_481x271_3Plane;
						tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_Y_481x271_3Plane<<4;
						//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_481x271_3Plane >> 4);
						//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_481x271_3Plane >> 4);
						//tbl_line_size = VIP_DemuraTBL_LineSize_Y_481x271_3Plane;
					}
					else // RGB mode
					{
						DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_RGB_481x271_3Plane;
						tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_RGB_481x271_3Plane<<4;
						//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_481x271_3Plane >> 4) - 1;
						//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_481x271_3Plane >> 4);
						//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_481x271_3Plane;
					}
					rtd_pr_vpq_emerg("[%s] Plane number invalid!\n", __func__);
					break;
			}

			DMA_TBL.table_height = 271;		/* table mode = DeMura_TBL_481x271, table size = 481x271 for 2k(blk size=4x4) and 4k(blk size=8x8) panel*/
			DMA_TBL.table_width = 481;

			if (panel_heigth == 2160 && panel_width == 3840)	/* 4k panel*/
				buff.demura_block_size = 0;		/* block size = 8x8 */
			else if (panel_heigth == 1080 && panel_width == 1920)/* 2k panel*/
				buff.demura_block_size = 2;		/* block size = 4x4 */
			else
				buff.demura_en = 0;

			}
			else 
			{
				DMA_TBL.burst_len = 32;

				switch( DeMura_TBL.DeMura_CTRL_TBL.demura_table_level )
				{
					case 0: // 3 planes
						if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_Y_241x136_3Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_Y_241x136_3Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_241x136_3Plane >> 4);
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_241x136_3Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_Y_241x136_3Plane;
						}
						else // RGB mode
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_RGB_241x136_3Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_RGB_241x136_3Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_241x136_3Plane >> 4) - 1;
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_241x136_3Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_241x136_3Plane;
						}
						break;
					case 1: // 4 planes
						if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_Y_241x136_4Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_Y_241x136_4Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_241x136_4Plane >> 4);
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_241x136_4Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_Y_241x136_4Plane;
						}
						else // RGB mode
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_RGB_241x136_4Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_RGB_241x136_4Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_241x136_4Plane >> 4) - 1;
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_241x136_4Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_241x136_4Plane;
						}
						break;
					case 2: // 5 planes
						if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_Y_241x136_5Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_Y_241x136_5Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_241x136_5Plane >> 4);
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_241x136_5Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_Y_241x136_5Plane;
						}
						else // RGB mode
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_RGB_241x136_5Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_RGB_241x136_5Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_241x136_5Plane >> 4) - 1;
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_241x136_5Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_241x136_5Plane;
						}
						break;
					default:
						rtd_pr_vpq_emerg("[%s] Plane number invalid!\n", __func__);
						if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_Y_241x136_3Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_Y_241x136_3Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_241x136_3Plane >> 4);
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_241x136_3Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_Y_241x136_3Plane;
						}
						else // RGB mode
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_12bit_RGB_241x136_3Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_12bit_RGB_241x136_3Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_241x136_3Plane >> 4);
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_241x136_3Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_241x136_3Plane;
						}
				}

				DMA_TBL.table_height = 136;		/* table mode = DeMura_TBL_241x136, table size = 136x241 for 2k(blk size=8x8) and 4k(blk size=16x16) panel*/
				DMA_TBL.table_width = 241;

				if (panel_heigth == 2160 && panel_width == 3840)	/* 4k panel*/
					buff.demura_block_size = 1;		/* block size = 16x16 */
				else if (panel_heigth == 1080 && panel_width == 1920)/* 2k panel*/
					buff.demura_block_size = 0;		/* block size = 8x8 */
				else
					buff.demura_en = 0;
			}

			sizeDemuraTbl_aligned = sizeDemuraTbl;
			base_addr_aligned = base_addr;

			}
		else
			{
			if (DeMura_TBL.table_mode == DeMura_TBL_481x271) {
				DMA_TBL.burst_len = 32;

				switch( DeMura_TBL.DeMura_CTRL_TBL.demura_table_level )
				{
					case 0: // 3 planes
						if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_Y_481x271_3Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_Y_481x271_3Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_481x271_3Plane >> 4);
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_481x271_3Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_Y_481x271_3Plane;
						}
						else // RGB mode
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_RGB_481x271_3Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_RGB_481x271_3Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_481x271_3Plane >> 4);
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_481x271_3Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_481x271_3Plane;
						}
						break;
					case 1: // 4 planes
						if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_Y_481x271_4Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_Y_481x271_4Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_481x271_4Plane >> 4);
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_481x271_4Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_Y_481x271_4Plane;
						}
						else // RGB mode
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_RGB_481x271_4Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_RGB_481x271_4Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_481x271_4Plane >> 4) - 1;
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_481x271_4Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_481x271_4Plane;
						}
						break;
					case 2: // 5 planes
						if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_Y_481x271_5Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_Y_481x271_5Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_481x271_5Plane >> 4);
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_481x271_5Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_Y_481x271_5Plane;
						}
						else // RGB mode
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_RGB_481x271_5Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_RGB_481x271_5Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_481x271_5Plane >> 4) - 1;
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_481x271_5Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_481x271_5Plane;
						}
						break;
					default:
						if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_Y_481x271_3Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_Y_481x271_3Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_481x271_3Plane >> 4);
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_481x271_3Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_Y_481x271_3Plane;
						}
						else // RGB mode
						{
							DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_RGB_481x271_3Plane;
							tbl_frame_size=VIP_DemuraTBL_frame_burst_num_RGB_481x271_3Plane<<4;
							//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_481x271_3Plane >> 4) - 1;
							//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_481x271_3Plane >> 4);
							//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_481x271_3Plane;
						}
						rtd_pr_vpq_emerg("[%s] Plane number invalid!\n", __func__);
						break;
				}

				DMA_TBL.table_height = 271;		/* table mode = DeMura_TBL_481x271, table size = 481x271 for 2k(blk size=4x4) and 4k(blk size=8x8) panel*/
				DMA_TBL.table_width = 481;

				if (panel_heigth == 2160 && panel_width == 3840)	/* 4k panel*/
					buff.demura_block_size = 0;		/* block size = 8x8 */
				else if (panel_heigth == 1080 && panel_width == 1920)/* 2k panel*/
					buff.demura_block_size = 2;		/* block size = 4x4 */
				else
					buff.demura_en = 0;

				}
				else {
					DMA_TBL.burst_len = 32;

					switch( DeMura_TBL.DeMura_CTRL_TBL.demura_table_level )
					{
						case 0: // 3 planes
							if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
							{
								DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_Y_241x136_3Plane;
								tbl_frame_size=VIP_DemuraTBL_frame_burst_num_Y_241x136_3Plane<<4;
								//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_241x136_3Plane >> 4);
								//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_241x136_3Plane >> 4);
								//tbl_line_size = VIP_DemuraTBL_LineSize_Y_241x136_3Plane;
							}
							else // RGB mode
							{
								DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_RGB_241x136_3Plane;
								tbl_frame_size=VIP_DemuraTBL_frame_burst_num_RGB_241x136_3Plane<<4;
								//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_241x136_3Plane >> 4) - 1;
								//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_241x136_3Plane >> 4);
								//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_241x136_3Plane;
							}
							break;
						case 1: // 4 planes
							if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
							{
								DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_Y_241x136_4Plane;
								tbl_frame_size=VIP_DemuraTBL_frame_burst_num_Y_241x136_4Plane<<4;
								//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_241x136_4Plane >> 4);
								//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_241x136_4Plane >> 4);
								//tbl_line_size = VIP_DemuraTBL_LineSize_Y_241x136_4Plane;
							}
							else // RGB mode
							{
								DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_RGB_241x136_4Plane;
								tbl_frame_size=VIP_DemuraTBL_frame_burst_num_RGB_241x136_4Plane<<4;
								//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_241x136_4Plane >> 4) - 1;
								//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_241x136_4Plane >> 4);
								//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_241x136_4Plane;
							}
							break;
						case 2: // 5 planes
							if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
							{
								DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_Y_241x136_5Plane;
								tbl_frame_size=VIP_DemuraTBL_frame_burst_num_Y_241x136_5Plane<<4;
								//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_241x136_5Plane >> 4);
								//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_241x136_5Plane >> 4);
								//tbl_line_size = VIP_DemuraTBL_LineSize_Y_241x136_5Plane;
							}
							else // RGB mode
							{
								DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_RGB_241x136_5Plane;
								tbl_frame_size=VIP_DemuraTBL_frame_burst_num_RGB_241x136_5Plane<<4;
								//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_241x136_5Plane >> 4) - 1;
								//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_241x136_5Plane >> 4);
								//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_241x136_5Plane;
							}
							break;
						default:
							rtd_pr_vpq_emerg("[%s] Plane number invalid!\n", __func__);
							if (DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate == DeMura_Ch_Y_Mode)
							{
								DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_Y_241x136_3Plane;
								tbl_frame_size=VIP_DemuraTBL_frame_burst_num_Y_241x136_3Plane<<4;
								//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_Y_241x136_3Plane >> 4);
								//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_Y_241x136_3Plane >> 4);
								//tbl_line_size = VIP_DemuraTBL_LineSize_Y_241x136_3Plane;
							}
							else // RGB mode
							{
								DMA_TBL.frame_burst_num=VIP_DemuraTBL_frame_burst_num_RGB_241x136_3Plane;
								tbl_frame_size=VIP_DemuraTBL_frame_burst_num_RGB_241x136_3Plane<<4;
								//DMA_TBL.line_128_num =  (VIP_DemuraTBL_LineSize_RGB_241x136_3Plane >> 4);
								//DMA_TBL.line_step = (VIP_DemuraTBL_LineSize_RGB_241x136_3Plane >> 4);
								//tbl_line_size = VIP_DemuraTBL_LineSize_RGB_241x136_3Plane;
							}
					}

					DMA_TBL.table_height = 136;		/* table mode = DeMura_TBL_241x136, table size = 136x241 for 2k(blk size=8x8) and 4k(blk size=16x16) panel*/
					DMA_TBL.table_width = 241;

					if (panel_heigth == 2160 && panel_width == 3840)	/* 4k panel*/
						buff.demura_block_size = 1;		/* block size = 16x16 */
					else if (panel_heigth == 1080 && panel_width == 1920)/* 2k panel*/
						buff.demura_block_size = 0;		/* block size = 8x8 */
					else
						buff.demura_en = 0;
				}
			}
			sizeDemuraTbl_aligned = sizeDemuraTbl;
			base_addr_aligned = base_addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
		va_temp = (unsigned long)vir_addr;
#else
		va_temp = (unsigned int)vir_addr;
#endif
		vir_addr_aligned = (unsigned int*)va_temp;
		aligned_val = 0;

#ifdef CONFIG_BW_96B_ALIGNED
		sizeDemuraTbl_aligned = dvr_size_alignment(sizeDemuraTbl);
		base_addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)base_addr, sizeDemuraTbl_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
		va_temp = (unsigned long)vir_addr;
#else //CONFIG_ARM64
		va_temp = (unsigned int)vir_addr;
#endif //CONFIG_ARM64
		vir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, sizeDemuraTbl_aligned);
		aligned_val = 6;
#endif

		if(bLogEn!=0)
		{
			rtd_pr_vpq_info("Demura, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
				base_addr, vir_addr, base_addr_aligned, vir_addr_aligned, sizeDemuraTbl, sizeDemuraTbl_aligned);
		}
		if (aligned_val != 0) {
			DMA_TBL.burst_len = ((DMA_TBL.burst_len%aligned_val)==0)?(DMA_TBL.burst_len):(DMA_TBL.burst_len - (DMA_TBL.burst_len % aligned_val));
			//DMA_TBL.line_step = ((DMA_TBL.line_step%aligned_val)==0)?(DMA_TBL.line_step):(DMA_TBL.line_step + (aligned_val - (DMA_TBL.line_step % aligned_val)));
		}

		/*printf("[DeMura] = hs=%d,he=%d,vs=%d,ve=%d,ret=%d,\n", h_s, h_e, v_s, v_e, DMA_ret);*/
		memcpy((unsigned char*)&DMA_TBL_Buff, (unsigned char*)&DMA_TBL, sizeof(DRV_DeMura_DMA_TBL));
		ret = drvif_color_set_DeMura(&DMA_TBL, &buff, &DeMura_TBL.TBL[0], base_addr_aligned, vir_addr_aligned, tbl_frame_size, unpdateTBL_only);

		dvr_unmap_memory((void *)vir_addr, sizeDemuraTbl);
	}
	up(&VPQ_Demura_Semaphore);
	return ret;
}

/* for SIW Demura */
char fwif_color_set_SIW_DeMura(unsigned char* data, unsigned int size)
{
	unsigned int base_addr;
	unsigned int *vir_addr;
	char ret = 0;
	unsigned int base_addr_aligned = 0, sizeDemuraTbl_aligned;
	unsigned int  *vir_addr_aligned = NULL;
	sys_reg_sys_dclk_gate_sel0_RBUS sys_reg_sys_dclk_gate_sel0_reg;

#ifdef CONFIG_ARM64 //ARM32 compatible
	unsigned long va_temp;
#else
	unsigned int va_temp;
#endif
	//unsigned char aligned_val = 0;
	unsigned int size_offset = 10 * 1024; // avoid trash other memory while size do 4k and 96B aligned
	unsigned int sizeDemuraTbl = VIP_DeMura_BUFFER_SIZE - size_offset;

	if (drvif_color_get_HW_MEX_STATUS(MEX_SIW_DEMURA) != 1) {
		rtd_pr_vpq_info("HW_MEX,  MEX_SIW_DEMURA != 1, EN\n");
		return -1;
	}

	down(&VPQ_Demura_Semaphore);
	/* CLK & reset */
	sys_reg_sys_dclk_gate_sel0_reg.regValue = IoReg_Read32(SYS_REG_SYS_DCLK_GATE_SEL0_reg);
	sys_reg_sys_dclk_gate_sel0_reg.dclk_s2_f4p_gate_sel = 2;
	IoReg_Write32(SYS_REG_SYS_DCLK_GATE_SEL0_reg, sys_reg_sys_dclk_gate_sel0_reg.regValue);
	IoReg_Write32(SYS_REG_SYS_SRST4_reg, 0x00800001);	 // siw reset

	base_addr = get_query_start_address(QUERY_IDX_VIP_DeMura);
	base_addr = drvif_memory_get_data_align(base_addr, (1 << 12));
	sizeDemuraTbl = drvif_memory_get_data_align(sizeDemuraTbl, (1 << 12));

	if (base_addr == 0) {
		rtd_pr_vpq_emerg("[%s] addr = NULL\n", __func__);
		ret = -1;
	} else {

		vir_addr = dvr_remap_uncached_memory(base_addr, sizeDemuraTbl, __builtin_return_address(0));

		sizeDemuraTbl_aligned = sizeDemuraTbl;
		base_addr_aligned = base_addr;
#ifdef CONFIG_ARM64 //ARM32 compatible
		va_temp = (unsigned long)vir_addr;
#else
		va_temp = (unsigned int)vir_addr;
#endif
		vir_addr_aligned = (unsigned int*)va_temp;
		//aligned_val = 0;

#ifdef CONFIG_BW_96B_ALIGNED
		sizeDemuraTbl_aligned = dvr_size_alignment(sizeDemuraTbl);
		base_addr_aligned = (unsigned int)dvr_memory_alignment((unsigned long)base_addr, sizeDemuraTbl_aligned);
#ifdef CONFIG_ARM64 //ARM32 compatible
		va_temp = (unsigned long)vir_addr;
#else //CONFIG_ARM64
		va_temp = (unsigned int)vir_addr;
#endif //CONFIG_ARM64
		vir_addr_aligned = (unsigned int*)dvr_memory_alignment((unsigned long)va_temp, sizeDemuraTbl_aligned);
		//aligned_val = 6;
#endif

		if(0)
		{
			rtd_pr_vpq_info("Siw Demura, addr=%x, pVir_addr=%p, addr_aliged=%x, pVir_addr_aliged=%p, size=%d, size_aliged=%d,\n",
				base_addr, vir_addr, base_addr_aligned, vir_addr_aligned, sizeDemuraTbl, sizeDemuraTbl_aligned);
		}

		memcpy((unsigned char*)vir_addr_aligned, data, size);
		dvr_unmap_memory((void *)vir_addr, sizeDemuraTbl);

		IoReg_Write32(DEMURA_DEMURA_DMA_WRAP_ADDR_reg, base_addr_aligned);
		IoReg_Write32(DEMURA_DEMURA_DMA_CTRL_1_reg, 0x01e1010f);
		//rtd_outl(0xb802eb64, 0x08000000);	// DMA start address,
		
		IoReg_Write32(DEMURA_DEMURA_DMA_WRAP_LEN_reg, 0x000001e0);
		IoReg_Write32(DEMURA_DEMURA_DMA_WRAP_WORD_reg, 0x000eeaf0); // Mark2 use frame_busrt_num= ceil(total flash data/128)
		IoReg_Write32(DEMURA_DEMURA_DMA_CTRL_reg, 0x00003300);
		//rtd_outl(0x1802eb98, 0xc7000260);

	}
	up(&VPQ_Demura_Semaphore);
	return ret;
}

char fwif_color_Get_DeMura_CTRL(DRV_DeMura_CTRL_TBL *ptr)
{
	char ret;
	ret = drvif_color_Get_DeMura_CTRL(ptr);
	return ret;
}

char fwif_color_set_DeMura_En(unsigned char enable)
{
	drvif_color_set_DeMura_En(enable);
	return 0;
}

unsigned char fwif_color_get_DeMura_En(void)
{
	return drvif_color_get_DeMura_En();
}

unsigned char enc_data_6b[(481+1)*3*5];
void fwif_color_DeMura_encode( short* tbl_ori, unsigned char table_mode, unsigned char table_separate, unsigned char plane_num, VIP_DeMura_TBL * Demura_TBL)
{
	fwif_color_DeMura_encode_all_para(tbl_ori, table_mode, table_separate, plane_num, Demura_TBL, 481);
}

unsigned short enc_data_12b[271 * 481  * 3 * 5];
void fwif_color_DeMura_encode_12_bit(short* tbl_ori, unsigned char table_mode, unsigned char table_separate, unsigned char plane_num, VIP_DeMura_TBL * Demura_TBL, unsigned short in_line_size)
{
	// DeMura_TBL.table_mode
	// DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate
	unsigned int i, j, k, m, v_cnt;
	unsigned short tbl_height, tbl_width, tbl_ch;
	unsigned char line_pack_bit;
	unsigned char pack_tmp;
	//unsigned int line_size;
	unsigned char* pack_ptr;
	unsigned int byte_cnt;
    
	short abs_value[5];
	//short gain[5] = { 0x10,0x10,0x10,0x10,0x10 }; // 0x10~0x7f
	//short offset[5] = {0,0,0,0,0}; // -2048~2047
	//short no_compensate_flag[5] = { 0,0,0,0,0 }; // decide to do value compensate

	if (table_mode == DeMura_TBL_481x271)
	{
		tbl_height = 271;
		tbl_width = 481;
		/*if (plane_num == 3)
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_481x271_3Plane : VIP_DemuraTBL_LineSize_Y_481x271_3Plane;
		else if (plane_num == 4)
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_481x271_4Plane : VIP_DemuraTBL_LineSize_Y_481x271_4Plane;
		else
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_481x271_5Plane : VIP_DemuraTBL_LineSize_Y_481x271_5Plane;*/
	}
	else // DeMura_TBL_241x136
	{
		tbl_height = 136;
		tbl_width = 241;
		/*if (plane_num == 3)
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_241x136_3Plane : VIP_DemuraTBL_LineSize_Y_241x136_3Plane;
		else if (plane_num == 4)
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_241x136_4Plane : VIP_DemuraTBL_LineSize_Y_241x136_4Plane;
		else
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_241x136_5Plane : VIP_DemuraTBL_LineSize_Y_241x136_5Plane;*/
	}
	tbl_ch = table_separate ? 3 : 1;

	// decide to do value compensate
	/*for (m = 0; m < plane_num; m++)
	{
	if (no_compensate_flag[m])
	{
	gain[m] = 0x10;
	offset[m] = 0;
	}
	}*/


	for (i = 0; i<tbl_height; i++) // line 
	{
		for (j = 0; j<tbl_width; j++) // line value 4328
		{
			for (k = 0; k<tbl_ch; k++) // line value channels 9
			{
				for (m = 0; m<plane_num; m++) // how many planes 3
				{
					// raw data to abs value by gain and offset
					//tbl_ori[m][i*line_size*tbl_ch + k];
					abs_value[m] = *(tbl_ori + m * tbl_height * in_line_size * tbl_ch + (i * in_line_size + j) * tbl_ch + k);

					//abs_value[m] = ((abs_value[m] * gain[m] + 8) >> 4) + offset[m];  // range: 3.4bits, gain value close to 3bits = 8 

					enc_data_12b[(i * tbl_width * tbl_ch * plane_num) + (j * tbl_ch + k) * plane_num + m] = abs_value[m] & 0xfff;

				}
			}
			//if(j < 10 /*|| (j > 470)*/)
			//rtd_pr_vpq_info("ori[%d][%d][%d] = [%d], L = [%d]\n", i, j, m, *(tbl_ori + m * tbl_height * in_line_size * tbl_ch + (i * in_line_size + j) * tbl_ch + k), delta[m]);
		}
	}
	v_cnt = 0;
	pack_ptr = Demura_TBL->TBL;
	byte_cnt = 0;
	pack_tmp = 0;
	line_pack_bit = 0;

	//     0      1      2      3      4      5      6      7      8      9    10
	// |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  8 |
	// |  8b|4|4|  8b|  8b|4|4|  8b|  8b|4|4|  8b|  8b|4|4|  8b|  8b|4|4|  8b|  8b|
	//                                                                       |6b|2|
	//    |  12b  | 12b |  12b  |  12b|  12b  |  12b|  12b  |  12b|  12b  |  12b| 
	// |6b|2| 8b|2|6b|6b|2| 8b|2|6b|6b|2| 8b|2|6b|6b|2| 8b|2|6b|6b|2| 8b|2|6b|6b|2|
	// |  8b|4|4|  8b|  8b|4|4|  8b|  8b|4|4|  8b|  8b|4|4|  8b|  8b|4|4|  8b|6b|2|
	// 3 plane: 126bit, dummy 2bit  21 elements
	// 3 plane:
	// |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  8 |
	// |   18     |   18    |    18    |    18   |    18    |    18   |    18   |2|
	// |  12b  |*6|6*|  12b |  12b  |*6|6*|  12b |  12b  |*6|6*|  12b |  12b |*6|2| row 1
	// | 6*|  12b |  12b |*6|6*|  12b  |  12b |*6|6*|  12b  |  12b |*6|6*|  12b |2| row 2
	// |  12b  |*6|6*|  12b |  12b  |*6|6*|  12b |  12b  |*6|6*|  12b |  12b |*6|2| row 3

	// 4 plane: 120bit, dummy 8bit  10 elements
	// 4 plane:
	// |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  8 |
	// |      24     |      24     |      24     |      24     |      24     |  8 | row 1

	// 5 plane: 120bit, dummy 8bit  10 elements
	// 5 plane:
	// |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  12b |  8 |
	// |        30      |        30       |        30       |        30      |  8 |

	if (plane_num == 3)
	{
		for (i = 0; i < tbl_height*tbl_width*tbl_ch*plane_num; i++)
		{
			v_cnt = i;
			if (v_cnt % 21 == 10)
			{
				pack_tmp = ((enc_data_12b[i] & 0xFC0) >> 6) << 2;
				(*pack_ptr) = pack_tmp;
				pack_ptr++;
				byte_cnt++;
				// | 6 |2|
				pack_tmp = (enc_data_12b[i] & 0x3F) << 2;
				line_pack_bit = 6;

			}
			else if (v_cnt % 21 == 20)
			{
				// |2| 6 |                   
				pack_tmp |= (enc_data_12b[i] & 0xFC0) >> 6;
				(*pack_ptr) = pack_tmp;
				pack_ptr++;
				byte_cnt++;

				pack_tmp = (enc_data_12b[i] & 0x3F) << 2;
				(*pack_ptr) = pack_tmp;
				pack_ptr++;
				byte_cnt++;
				line_pack_bit = 0;

			}
			else
			{
				switch (line_pack_bit)
				{
				case 0:
					// |   12  |     first 8bit   
					// |  8 |
					pack_tmp = (enc_data_12b[i] & 0xFF0) >> 4;
					(*pack_ptr) = pack_tmp;
					pack_ptr++;
					byte_cnt++;
					// |    |4b|
					pack_tmp = (enc_data_12b[i] & 0xF) << 4;
					line_pack_bit = 4;

					break;
				case 4:
					// |    |  |4b|
					pack_tmp |= (enc_data_12b[i] & 0xF00) >> 8;
					(*pack_ptr) = pack_tmp;

					pack_ptr++;
					// |    |  |  |  8b|
					pack_tmp = enc_data_12b[i] & 0xFF;
					(*pack_ptr) = pack_tmp;
					line_pack_bit = 0;
					pack_ptr++;

					break;
				case 6:
					// |   |2|        12(11)
					pack_tmp |= (enc_data_12b[i] & 0xC00) >> 10;
					(*pack_ptr) = pack_tmp;
					pack_ptr++;
					byte_cnt++;
					// |   | |  8 |
					pack_tmp = (enc_data_12b[i] & 0x3FC) >> 2;
					(*pack_ptr) = pack_tmp;
					pack_ptr++;
					byte_cnt++;
					// |   | |    |2|
					pack_tmp = (enc_data_12b[i] & 0x3) << 6;
					line_pack_bit = 12;

					break;
				case 12:
					// | | 6|       12(12)
					pack_tmp |= (enc_data_12b[i] & 0xFC0) >> 6;
					(*pack_ptr) = pack_tmp;
					pack_ptr++;
					// | |  | 6|2|
					pack_tmp = (enc_data_12b[i] & 0x3F) << 2;
					line_pack_bit = 6;

					break;
				default:
					break;
				}
			}
		}
		if (v_cnt % 21 != 20)
		{
			(*pack_ptr) = pack_tmp;
			pack_ptr++;
			byte_cnt++;
		}
		while (byte_cnt % 16 != 0)
		{
			(*pack_ptr) = 0;
			pack_ptr++;
			byte_cnt++;
		}
	}
	else
	{
		for (i = 0; i < tbl_height*tbl_width*tbl_ch*plane_num; i++)
		{
			v_cnt = i;
			if (v_cnt % 10 == 9)
			{
				// |    |  |4b|
				pack_tmp |= (enc_data_12b[k] & 0xF00);
				(*pack_ptr) = pack_tmp;
				pack_ptr++;
				byte_cnt++;
				// |    |  |  |  8b|
				pack_tmp = (enc_data_12b[k] & 0xFF);
				(*pack_ptr) = pack_tmp;
				pack_ptr++;
				byte_cnt++;

				// |8b dummy|
				pack_tmp = 0;
				(*pack_ptr) = pack_tmp;
				pack_ptr++;
				byte_cnt++;

				line_pack_bit = 0;

			}
			else
			{
				switch (line_pack_bit)
				{
				case 0:
					// |   12  |     first 8bit   
					// |  8 |
					pack_tmp = (enc_data_12b[k] & 0xFF0);
					(*pack_ptr) = pack_tmp;
					pack_ptr++;
					byte_cnt++;
					// |    |4b|
					pack_tmp = (enc_data_12b[k] & 0xF) << 4;
					line_pack_bit = 4;

					break;
				case 4:
					// |    |  |4b|
					pack_tmp |= (enc_data_12b[k] & 0xF00);
					(*pack_ptr) = pack_tmp;
					pack_ptr++;
					byte_cnt++;
					// |    |  |  |  8b|
					pack_tmp = enc_data_12b[k] & 0xFF;
					(*pack_ptr) = pack_tmp;
					line_pack_bit = 0;
					pack_ptr++;
					byte_cnt++;

					break;
				default:
					break;
				}
			}
		}
		if (line_pack_bit != 0)
		{
			(*pack_ptr) = pack_tmp;
			pack_ptr++;
			byte_cnt++;
		}
		while (byte_cnt % 16 != 0)
		{
			(*pack_ptr) = 0;
			pack_ptr++;
			byte_cnt++;
		}
	}
	v_cnt = 0;
}

void fwif_color_DeMura_encode_all_para( short* tbl_ori, unsigned char table_mode, unsigned char table_separate, unsigned char plane_num, VIP_DeMura_TBL * Demura_TBL, unsigned short in_line_size)
{
	// DeMura_TBL.table_mode
	// DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate
	unsigned int i,j,k,m;
	unsigned short tbl_height, tbl_width, tbl_ch;
	short delta[5];
	short delta_max[5] = {0};
	short delta_min[5] = {0};
	unsigned char line_pack_bit;
	unsigned char pack_tmp;
	unsigned int line_size;
	unsigned char* pack_ptr;
	unsigned int byte_cnt;
    unsigned char scale[5] = {0};
	unsigned char no_scale_flag[5] = {0, 0, 0, 0, 0};


	if( table_mode == DeMura_TBL_481x271 )
	{
		tbl_height = 271;
		tbl_width = 481;
		if( plane_num==3 )
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_481x271_3Plane : VIP_DemuraTBL_LineSize_Y_481x271_3Plane;
		else if( plane_num==4 )
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_481x271_4Plane : VIP_DemuraTBL_LineSize_Y_481x271_4Plane;
		else
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_481x271_5Plane : VIP_DemuraTBL_LineSize_Y_481x271_5Plane;
	}
	else // DeMura_TBL_241x136
	{
		tbl_height = 136;
		tbl_width = 241;
		if( plane_num==3 )
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_241x136_3Plane : VIP_DemuraTBL_LineSize_Y_241x136_3Plane;
		else if( plane_num==4 )
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_241x136_4Plane : VIP_DemuraTBL_LineSize_Y_241x136_4Plane;
		else
			line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_241x136_5Plane : VIP_DemuraTBL_LineSize_Y_241x136_5Plane;
	}
	tbl_ch = table_separate ? 3 : 1;

	for( i=0; i<tbl_height; i++ ) // // line to choose scale
	{
		for( j=0; j<tbl_width; j++ )
		{
			for( k=0; k<tbl_ch; k++ )
			{
				for( m=0; m<plane_num; m++ )
				{
					// raw data to delta
					if(j != 0)
					{
						delta[m] = (*(tbl_ori + m * tbl_height * in_line_size * tbl_ch + (i * in_line_size + j) * tbl_ch + k)) - (*(tbl_ori + m * tbl_height * in_line_size * tbl_ch + (i * in_line_size + (j - 1)) * tbl_ch + k));//tbl_ori[m][ (i*line_size + j)*tbl_ch + k] - tbl_ori[m][ (i*line_size + (j-1))*tbl_ch + k];
						if (delta[m] > delta_max[m]) delta_max[m] = delta[m];
						if (delta[m] < delta_min[m]) delta_min[m] = delta[m];
					}
				}
			}
		}
	}
	//choose scale by delta value
	for( m=0; m<plane_num; m++ ) {
		if (delta_max[m] <= 31 && delta_min[m] >= (-32))
			scale[m] = 0;
		else if (delta_max[m] <= 63 && delta_min[m] >= (-64))
			scale[m] = 1;
		else
			scale[m] = 2;
		//printk("layer[%d] from [%d] to [%d], scaler[%d]\n", m, delta_min[m], delta_max[m], scale[m]);
	}
	for ( m=0; m<plane_num; m++ ) {
		if (no_scale_flag[m]) scale[m] = 0;	/* dark sence force no scale */

		//printk("final scaler[%d] = %d\n", m, scale[m]);
	}
	/*Demura_TBL->DeMura_CTRL_TBL.demura_table_scale = 3;
	Demura_TBL->DeMura_CTRL_TBL.demura_table_scale_L = scale[0];
	Demura_TBL->DeMura_CTRL_TBL.demura_table_scale_M = scale[1];
	Demura_TBL->DeMura_CTRL_TBL.demura_table_scale_M2 = scale[2];
	Demura_TBL->DeMura_CTRL_TBL.demura_table_scale_M3 = scale[3];
	Demura_TBL->DeMura_CTRL_TBL.demura_table_scale_H = scale[4];*/

	for( i=0; i<tbl_height; i++ ) // line
	{
		for( j=0; j<tbl_width; j++ )
		{
			for( k=0; k<tbl_ch; k++ )
			{
				for( m=0; m<plane_num; m++ )
				{
					// raw data to delta
					if( j==0 )
					{
						delta[m] = *(tbl_ori + m * tbl_height * in_line_size * tbl_ch + i * in_line_size * tbl_ch + k) >> scale[m];//tbl_ori[m][i*line_size*tbl_ch + k];
					}
					else
					{
						delta[m] = ((*(tbl_ori + m * tbl_height * in_line_size * tbl_ch + (i * in_line_size + j) * tbl_ch + k)) >> scale[m]) - ((*(tbl_ori + m * tbl_height * in_line_size * tbl_ch + (i * in_line_size + (j - 1)) * tbl_ch + k)) >> scale[m]);//tbl_ori[m][ (i*line_size + j)*tbl_ch + k] - tbl_ori[m][ (i*line_size + (j-1))*tbl_ch + k];
						/* for no scale, clip */
						if (no_scale_flag[m]) {
							if (delta[m] > 31) delta[m] = 31;
							if (delta[m] < -32) delta[m] = -32;
						}
					}

					// to signed 6-bit
					if( delta[m] < 0 )
						delta[m] += (j==0) ? 256 : 64;

					// delta to 6bit array
					// RGB: R0_lo R0_md R0_hi G0_lo G0_md G0_hi B0_lo B0_md B0_hi
					// Y: R0_lo R0_md R0_hi
					// first element: separate to 2 elements (2+6), all others move right 1 block
					if( j==0 ) // 8bit -> 2 + 6
					{
						enc_data_6b[ (0*tbl_ch+k)*plane_num + m ] = delta[m] >> 6;
						enc_data_6b[ (1*tbl_ch+k)*plane_num + m ] = delta[m] & 0x3f;
					}
					else
					{
						enc_data_6b[ ((j+1)*tbl_ch+k)*plane_num + m ] = delta[m] & 0x3f;
					}
				}
			}
			//if(j < 10 /*|| (j > 470)*/)
				//rtd_pr_vpq_info("ori[%d][%d][%d] = [%d], L = [%d]\n", i, j, m, *(tbl_ori + m * tbl_height * in_line_size * tbl_ch + (i * in_line_size + j) * tbl_ch + k), delta[m]);
		}
		// TBL[VIP_Demura_Encode_TBL_ROW*VIP_Demura_Encode_TBL_COL]
		pack_ptr = Demura_TBL->TBL + i * line_size;
		byte_cnt = 0;
		pack_tmp = 0;
		line_pack_bit = 0;
		// 6bit array to 8bit pack per line
		for( k=0; k< (tbl_width+1)*tbl_ch*plane_num; k++ )
		{
			// 3 plane: 21 elements -> 126bit, dummy 2bit
			//    0     1     2     3             16    17    18    19    20
			// |  6b |  6b |  6b |  6b |  ...  |  6b |  6b |  6b |  6b |  6b |2|
			// |   8   |   8   |   8   |  ...  |   8   |   8   |   8   |   8   |
			// 4,5 plane: 20 elements -> 120bit, dummy 8bit
			//    0     1     2     3             16    17    18    19
			// |  6b |  6b |  6b |  6b |  ...  |  6b |  6b |  6b |  6b |   8   |
			// |   8   |   8   |   8   |  ...  |   8   |   8   |   8   |   8   |
			if( (k%21==20) && (plane_num==3) )
			{
				// dummy 2 bits by shifting
				pack_tmp = enc_data_6b[k] << 2;
				(*pack_ptr) = pack_tmp;
				pack_ptr++;
				byte_cnt++;
			}
			else
			{
				switch( line_pack_bit )
				{
					case 0:
						// |  6  | |
						pack_tmp = enc_data_6b[k] << 2;
						line_pack_bit = 6;
						break;
					case 6:
						// |     |2| 4 |   |
						pack_tmp |= ( enc_data_6b[k] & 0x30 ) >> 4;
						(*pack_ptr) = pack_tmp;
						pack_ptr++;
						byte_cnt++;

						pack_tmp = ( enc_data_6b[k] & 0x0F ) << 4;
						line_pack_bit = 4;
						break;
					case 4:
						// |   | 4 |2|     |
						pack_tmp |= ( enc_data_6b[k] & 0x3C ) >> 2;
						(*pack_ptr) = pack_tmp;
						pack_ptr++;
						byte_cnt++;

						pack_tmp = ( enc_data_6b[k] & 0x03 ) << 6;
						line_pack_bit = 2;
						break;
					case 2:
						// | |  6  |
						pack_tmp |= ( enc_data_6b[k] & 0x3F );
						(*pack_ptr) = pack_tmp;
						pack_ptr++;
						byte_cnt++;

						pack_tmp = 0;
						line_pack_bit = 0;
						break;
					default:
						break;
				}

				if( (k%20==19) && ((plane_num==4) || (plane_num==5)))
				{
					// dummy 8 bits
					pack_tmp = 0;
					(*pack_ptr) = pack_tmp;
					pack_ptr++;
					byte_cnt++;
				}
			}
		}
		// line end, add dummy until 128bits
		if( line_pack_bit != 0 )
		{
			(*pack_ptr) = pack_tmp;
			pack_ptr++;
			byte_cnt++;
		}
		while( byte_cnt % 16 != 0 )
		{
			(*pack_ptr) = 0;
			pack_ptr++;
			byte_cnt++;
		}
	}

}

void fwif_color_set_INX_Demura_ctrl(VIP_DeMura_TBL * Demura_TBL)
{
	unsigned int gray_setting[7];
	unsigned char i, err;
	unsigned short div_tmp;
	
	// set control threshold table
	gray_setting[0] = INNX_Demura_gray_setting[0];
	gray_setting[1] = INNX_Demura_gray_setting[2];
	gray_setting[2] = INNX_Demura_gray_setting[3];
	gray_setting[3] = INNX_Demura_gray_setting[4];
	gray_setting[4] = INNX_Demura_gray_setting[5];
	gray_setting[5] = INNX_Demura_gray_setting[6];
	gray_setting[6] = INNX_Demura_gray_setting[1];

	//data check
	err = 0;
	for (i=1;i<5;i++) {
		if (gray_setting[i] <=  gray_setting[i-1]) {
			err =1;
		}
		if (err == 1) {
			rtd_pr_vpq_emerg("vpq_INNX_Demura threshold setting error,  lower_cutoff=%d, low_lv=%d, mid_lv=%d, high_lv=%d, high_cut=%d, use default\n",
				gray_setting[0], gray_setting[1], gray_setting[2], gray_setting[3], gray_setting[4]);
			return;
		}
	}

	// r, g, b low_cut threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_lower_cutoff = gray_setting[0];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_lower_cutoff = gray_setting[0];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_lower_cutoff = gray_setting[0];
	// r, g, b low level threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_l_level = gray_setting[1];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_l_level = gray_setting[1];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_l_level = gray_setting[1];
	// r, g, b mid level threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_m_level = gray_setting[2];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_m_level = gray_setting[2];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_m_level = gray_setting[2];
	// r, g, b mid2 level threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_m2_level = gray_setting[3];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_m2_level = gray_setting[3];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_m2_level = gray_setting[3];
	// r, g, b mid3 level threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_m3_level = gray_setting[4];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_m3_level = gray_setting[4];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_m3_level = gray_setting[4];
	// r, g, b high level threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_h_level = gray_setting[5];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_h_level = gray_setting[5];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_h_level = gray_setting[5];
	
	// r, g, b high_cut threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_upper_cutoff = gray_setting[6];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_upper_cutoff = gray_setting[6];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_upper_cutoff = gray_setting[6];



	// div. factor: slope settings, calculate from levels to 16-bits each
	// div_factor_l = 2^16 / ((l_level - lower_cutoff)*4)
	// div_factor_l_m = 2^16 / ((m_level - l_level)*4)
	// for 3 planes: div_factor_m_h = 2^16 / ((h_level - m_level)*4), div_factor_m1_m2 & div_factor_m2_m3 don't care
	// for 4 planes: div_factor_m1_m2 = 2^16 / ((m2_level - m_level)*4),
	//				 div_factor_m_h = 2^16 / ((h_level - m2_level)*4), div_factor_m2_m3 don't care
	// for 5 planes: div_factor_m1_m2 = 2^16 / ((m2_level - m_level)*4),
	//				 div_factor_m2_m3 = 2^16 / ((m3_level - m2_level)*4),
	//				 div_factor_m_h = 2^16 / ((h_level - m3_level)*4)
	// div_factor_h = 2^16 / ((upper_cutoff - h_level)*4)

	
	// r, g, b dvi_fac_L  threshold
	// div_factor_l = 2^16 / ((l_level - lower_cutoff)*4)
	div_tmp = (65536 / (gray_setting[1] -gray_setting[0]))>>2;
	Demura_TBL->DeMura_CTRL_TBL.r_div_factor_l = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.g_div_factor_l = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.b_div_factor_l = div_tmp;
	// r, g, b dvi_fac_L_M  threshold
	// div_factor_l_m = 2^16 / ((m_level - l_level)*4)
	div_tmp = (65536 / (gray_setting[2] -gray_setting[1]))>>2;
	Demura_TBL->DeMura_CTRL_TBL.r_div_factor_l_m = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.g_div_factor_l_m = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.b_div_factor_l_m = div_tmp;
	// r, g, b dvi_fac_m1_m2  threshold
	// for 5 planes: div_factor_m1_m2 = 2^16 / ((m2_level - m_level)*4),
	div_tmp = (65536 / (gray_setting[3] -gray_setting[2]))>>2;
	Demura_TBL->DeMura_CTRL_TBL.r_div_factor_m1_m2 = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.g_div_factor_m1_m2 = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.b_div_factor_m1_m2 = div_tmp;
	// r, g, b dvi_fac_m2_m3  threshold
	// for 5 planes:  div_factor_m2_m3 = 2^16 / ((m3_level - m2_level)*4),
	div_tmp = (65536 / (gray_setting[4] -gray_setting[3]))>>2;
	Demura_TBL->DeMura_CTRL_TBL.r_div_factor_m2_m3 = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.g_div_factor_m2_m3 = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.b_div_factor_m2_m3 = div_tmp;	
	// r, g, b dvi_fac_M_H  threshold
	// for 5 planes:  div_factor_m_h = 2^16 / ((h_level - m3_level)*4)
	div_tmp = (65536 / (gray_setting[5] -gray_setting[4]))>>2;
	Demura_TBL->DeMura_CTRL_TBL.r_div_factor_m_h= div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.g_div_factor_m_h = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.b_div_factor_m_h = div_tmp;
	
	// r, g, b dvi_fac_H  threshold
	// div_factor_h = 2^16 / ((upper_cutoff - h_level)*4)
	div_tmp = (65536 / (gray_setting[6] -gray_setting[5]))>>2;
	Demura_TBL->DeMura_CTRL_TBL.r_div_factor_h = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.g_div_factor_h = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.b_div_factor_h = div_tmp;

}


#if 1
/*========================= for INNX demura =================================*/
static int fwif_color_INNX_Demura_round_mod4_inx(int number)
{
	int o_value=0;
//number > 0
	if(  (number%4) == 0 ||   (number%4) == 1)
	{
		o_value = number ;
	}
	else if( (number%4) == 2)
	{
		o_value = number +2;
	}
	else //( (number%4) == 3)
	{
		o_value = number +1;
	}

	return o_value;
}

static int fwif_color_INNX_Demura_round_mod8192_inx(int number)
{
	int o_value=0;
//number > 0
	if(  (number%8192) < (8192/2))
	{
		o_value = number ;
	}
	else if( (number%4) == 2)
	{
		o_value = number +8192;
	}
	else //( (number%4) == 3)
	{
		o_value = number +8192;
	}

	return o_value;
}


static unsigned char fwif_color_INNX_Demura_pow2_inx( unsigned char read_bit)
{
    unsigned char pow_value=0;

	pow_value = (1 << read_bit);

	return pow_value;
}


static unsigned int fwif_color_INNX_Demura_crcArray_sumAll(unsigned char* data, unsigned int crcStart, unsigned int crcLength)
{
			unsigned int crc_out;

			int index = 0;

			crc_out = 0;

			for (index = crcStart; index < crcStart + crcLength; index += 1)
			{
				crc_out = crc_out + (unsigned int)data[index];
			}

			if((crc_out&0xffff) !=  (unsigned int)(data[ INNX_Demura_addr_LUTCheckSum ]<<8) +  (unsigned int)(data[ INNX_Demura_addr_LUTCheckSum+1 ])   )
			{
				rtd_pr_vpq_emerg("INNX_Demura---lut checksum error---\n");
				rtd_pr_vpq_emerg("INNX_Demura---lut checksum golden %x---\n", (unsigned int)(data[ INNX_Demura_addr_LUTCheckSum ]<<8) +  (unsigned int)(data[ INNX_Demura_addr_LUTCheckSum+1 ])   );
				rtd_pr_vpq_emerg("INNX_Demura---lut checksum compute %x---\n", crc_out   );
				return 1;
			}


			return 0;
}


static char fwif_color_INNX_Demura_Check_header_Information(unsigned char* arr, unsigned int* Block_Type,unsigned int* Block_DataChecksum, unsigned int* Block_StartAddress, unsigned int* Block_DataLength,unsigned int* gray_setting)
{
	unsigned int i,block_idx, compute_header_Sum = 0;
	unsigned char flag_find_lut1=0, Identification=0, DemuraFunctionDefinition =0;
	unsigned char ASIC[5];


// 1.check whether header is valid

	Identification = arr[INNX_Demura_addr_Identification];
	if(!(Identification == 0x99)) {
		
		return 1;
	}
	
	for(i=0 ; i<5 ; i++)
	{
		ASIC[i] = arr[INNX_Demura_addr_ASIC+i];
	}
	if(ASIC[0] == 0x09 && ASIC[1] == 0x09 && ASIC[2] == 0x09 && ASIC[3] == 0x09 && ASIC[4] == 0x09 )
	{
		rtd_pr_vpq_emerg("INNX_Demura----------ASIC error ----------\n");		
		return 2;
	}


	DemuraFunctionDefinition =  arr[INNX_Demura_addr_DemuraFunctionDefinition]&0x1;
	if(!(DemuraFunctionDefinition == 0x1)) {	
		return 3;
	}
//end : 1.check whether header is valid

	block_idx=0;
	do
	{

		if(((arr[INNX_Demura_LUT_address_find+(block_idx*12)])& 0xf )== 1)
		{
			flag_find_lut1 = 1;
			break;
		}

		block_idx = block_idx+1;

	}while(flag_find_lut1 ==0);

	*Block_Type				= (arr[INNX_Demura_LUT_address_find+(block_idx*12)-1]<<8) + (arr[INNX_Demura_LUT_address_find+(block_idx*12)]);
	*Block_DataChecksum      = (arr[INNX_Demura_LUT_address_find+(block_idx*12)+1]<<8) + (arr[INNX_Demura_LUT_address_find+(block_idx*12)+2]);//little/big endian ???? check !!!!!!!
	*Block_StartAddress      = (arr[INNX_Demura_LUT_address_find+(block_idx*12)+3]<<24) + (arr[INNX_Demura_LUT_address_find+(block_idx*12)+4]<<16)+(arr[INNX_Demura_LUT_address_find+(block_idx*12)+5]<<8)+(arr[INNX_Demura_LUT_address_find+(block_idx*12)+6]);
	*Block_DataLength        = (arr[INNX_Demura_LUT_address_find+(block_idx*12)+7]<<24) + (arr[INNX_Demura_LUT_address_find+(block_idx*12)+8]<<16)+(arr[INNX_Demura_LUT_address_find+(block_idx*12)+9]<<8)+(arr[INNX_Demura_LUT_address_find+(block_idx*12)+10]);

	
	rtd_pr_vpq_emerg("[demura], Type[0x%x]\n", *Block_Type);
	rtd_pr_vpq_emerg("[demura], DataChecksum[0x%x]\n", *Block_DataChecksum);
	rtd_pr_vpq_emerg("[demura], StartAddress[0x%x]\n", *Block_StartAddress);
	rtd_pr_vpq_emerg("[demura], DataLength[0x%x]\n", *Block_DataLength);


//compute header checksum
	for(i = 0 ; i<0x7e ; i++)
	{
		 compute_header_Sum = compute_header_Sum + arr[i];
	}

	if(compute_header_Sum !=  (unsigned int)(arr[ INNX_Demura_addr_HeaderCheckSum ]<<8) +  (unsigned int)(arr[ INNX_Demura_addr_HeaderCheckSum+1 ])   )
	{
		rtd_pr_vpq_emerg("INNX_Demura---header checksum error---\n");
		rtd_pr_vpq_emerg("INNX_Demura---header checksum golden %x---\n", (unsigned int)(arr[ INNX_Demura_addr_HeaderCheckSum ]<<8) +  (unsigned int)(arr[ INNX_Demura_addr_HeaderCheckSum+1 ])  );
		rtd_pr_vpq_emerg("INNX_Demura---header checksum compute %x---\n", compute_header_Sum );
		return 4;
	}

//read setting gray bar
	gray_setting[0]     = (unsigned int)arr[  INNX_Demura_addr_BotLimit ]<<2;// gray_setting[0] = low cutoff
	gray_setting[1]     = (unsigned int)arr[   INNX_Demura_addr_TopLimit]<<2;// gray_setting[1] = high cutoff
	gray_setting[2]     = (unsigned int)arr[   INNX_Demura_addr_Gray1	]<<2;// gray_setting[2] = low level
	gray_setting[3]     = (unsigned int)arr[   INNX_Demura_addr_Gray2	]<<2;// gray_setting[3] = mid level
	gray_setting[4]     = (unsigned int)arr[   INNX_Demura_addr_Gray3	]<<2;// gray_setting[4] = mid2 level
	gray_setting[5]     = (unsigned int)arr[   INNX_Demura_addr_Gray4	]<<2;// gray_setting[5] = mid3 level
	gray_setting[6]     = (unsigned int)arr[   INNX_Demura_addr_Gray5	]<<2;//gray_setting[6] = high level

	for (i = 0; i < 7; i++)
		rtd_pr_vpq_emerg("[demura], GS[%d] = [0x%x]\n", i, gray_setting[i]);
	return 0;

}

//static void fwif_color_INNX_Demura_Decode_AQC_inx(unsigned char Code[31*271][22], char DeLut[271][496])
static void fwif_color_INNX_Demura_Decode_AQC_inx(unsigned char *Code, short *DeLut)
{
	int H = 271;
	//int W = 481;
	int w16 = 496;

	//int Code, DeLut;
	int i=0;
	int j=0;
	int k=0;
	int m=0;
	int Mode=0;
	int Data[4]={0};

    int Min ;
    int Range;
    int M, N, Q;
    int subRange1 ;
    int subRange2 ;
    int subRange3 ;


    for ( i = 0; i < H; i++)
    {
        for ( j = 0; j < (w16 / 16); j++)
        {
            Min 	    = (int)Code[((i * 31 + j) * INNX_Demura_num_22) + 21];
            Range      = (int)Code[((i * 31 + j) * INNX_Demura_num_22) +  20];

            subRange1 = fwif_color_INNX_Demura_round_mod4_inx((Range * 1))/ 4 + Min;
            subRange2 = fwif_color_INNX_Demura_round_mod4_inx((Range * 2))/ 4 + Min;
            subRange3 = fwif_color_INNX_Demura_round_mod4_inx((Range * 3))/ 4 + Min;


            for ( k = 0; k < 4; k++)
            {
                 Mode = Code[((i * 31 + j) * INNX_Demura_num_22) +  (16 + k)];

                for ( m = 0; m < 4; m++)
                {
                    Data[m] = Code[((i * 31 + j) * INNX_Demura_num_22) +   (k * 4 + m)];
                }

                switch (Mode)
                {
                    case 0:
                        M = Min+Range;
                        N = Min;
                        break;

                    case 1:
                        M = subRange3;
                        N = Min;
                        break;

                    case 2:
                        M = subRange2;
                        N = Min;
                        break;

                    case 3:
                        M = subRange1;
                        N = Min;
                        break;

                    case 4:
                        M = Min + Range;
                        N = subRange1;
                        break;

                    case 5:
                        M = Min + Range;
                        N = subRange2;
                        break;

                    case 6:
                        M = Min + Range;
                        N = subRange3;
                        break;

                    case 7:
                        M = subRange3;
                        N = subRange1;
                        break;

                    default:
                        M = Min + Range;
                        N = Min;
                        break;
                }
                Q = M - N;

                for ( m = 0; m < 4; m++)
                {
                    if (Q != 0)
                        //DeLut[i][j*16 + k*4 + m] = (int) round((((double)Data[m] * 546 / 8192) * Q + N));
                        DeLut[(i * INNX_Demura_W16) + (j*16 + k*4 + m)] = (short) ((fwif_color_INNX_Demura_round_mod8192_inx((int)Data[m] * 546 * Q)/ 8192)  + N);
                    else
                        DeLut[(i * INNX_Demura_W16) + (j*16 + k*4 + m)] = (short)N;
                }
            }
        }
    }
}



// demura table encode: diff (for Merlin5, Merlin6)
void fwif_color_DeMura_encode_diff(short* tbl_ori_lo, short* tbl_ori_md, short* tbl_ori_md2, short* tbl_ori_md3, short* tbl_ori_hi, unsigned char table_mode, unsigned char table_separate, VIP_DeMura_TBL * Demura_TBL)
{
	fwif_color_DeMura_encode_diff_input_line_size(tbl_ori_lo, tbl_ori_md, tbl_ori_md2, tbl_ori_md3, tbl_ori_hi, table_mode, table_separate, Demura_TBL, 481);
}

void fwif_color_DeMura_encode_diff_input_line_size( short* tbl_ori_lo, short* tbl_ori_md, short* tbl_ori_md2, short* tbl_ori_md3, short* tbl_ori_hi, unsigned char table_mode, unsigned char table_separate, VIP_DeMura_TBL * Demura_TBL, unsigned short in_tbl_width)
{
	// DeMura_TBL.table_mode
	// DeMura_TBL.DeMura_CTRL_TBL.demura_rgb_table_seperate
	int i,j,k;
	unsigned short tbl_height, tbl_width, tbl_ch;
	short delta_lo, delta_md, delta_md2, delta_md3, delta_hi;
	unsigned short line_pack_bit;
	unsigned char pack_tmp;
	unsigned short line_size;
	unsigned char* pack_ptr;
	unsigned short byte_cnt;
	unsigned char* enc_data_6b;
	unsigned char scale = 4;

	if( table_mode == DeMura_TBL_481x271 )
	{
		tbl_height = 271;
		tbl_width = 481;
		line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_481x271_5Plane : VIP_DemuraTBL_LineSize_Y_481x271_5Plane;
	}
	else // DeMura_TBL_241x136
	{
		tbl_height = 136;
		tbl_width = 241;
		line_size = table_separate ? VIP_DemuraTBL_LineSize_RGB_241x136_5Plane : VIP_DemuraTBL_LineSize_Y_241x136_5Plane;
	}
	tbl_ch = table_separate ? 3 : 1;
	
	enc_data_6b = (unsigned char*)vip_malloc( (tbl_width+1)*tbl_ch*5 * sizeof(char) );

	if (NULL == enc_data_6b)
		return;

	for( i=0; i<tbl_height; i++ ) // line
	{
		for( j=0; j<tbl_width; j++ )
		{
			for( k=0; k<tbl_ch; k++ )
			{
				// raw data to delta
				if( j==0 )
				{
					delta_lo = tbl_ori_lo[i*in_tbl_width*tbl_ch + k] / scale;
					delta_md = tbl_ori_md[i*in_tbl_width*tbl_ch + k] / scale;
					delta_md2 = tbl_ori_md2[i*in_tbl_width*tbl_ch + k] / scale;
					delta_md3 = tbl_ori_md3[i*in_tbl_width*tbl_ch + k] / scale;
					delta_hi = tbl_ori_hi[i*in_tbl_width*tbl_ch + k] / scale;
				}
				else
				{
					delta_lo = (tbl_ori_lo[ (i*in_tbl_width + j)*tbl_ch + k] / scale) - (tbl_ori_lo[ (i*in_tbl_width + (j-1))*tbl_ch + k] / scale);
					delta_md = (tbl_ori_md[ (i*in_tbl_width + j)*tbl_ch + k] / scale) - (tbl_ori_md[ (i*in_tbl_width + (j-1))*tbl_ch + k] / scale);
					delta_md2 = (tbl_ori_md2[ (i*in_tbl_width + j)*tbl_ch + k] / scale) - (tbl_ori_md2[ (i*in_tbl_width + (j-1))*tbl_ch + k] / scale);
					delta_md3 = (tbl_ori_md3[ (i*in_tbl_width + j)*tbl_ch + k] / scale) - (tbl_ori_md3[ (i*in_tbl_width + (j-1))*tbl_ch + k] / scale);
					delta_hi = (tbl_ori_hi[ (i*in_tbl_width + j)*tbl_ch + k] / scale) - (tbl_ori_hi[ (i*in_tbl_width + (j-1))*tbl_ch + k] / scale);
				}


				// to signed 6-bit
				if( delta_lo < 0 ) delta_lo += (j==0) ? 256 : 64;
				if( delta_md < 0 ) delta_md += (j==0) ? 256 : 64;
				if( delta_md2 < 0 ) delta_md2 += (j==0) ? 256 : 64;
				if( delta_md3 < 0 ) delta_md3 += (j==0) ? 256 : 64;
				if( delta_hi < 0 ) delta_hi += (j==0) ? 256 : 64;

				// delta to 6bit array
				// RGB: R0_lo R0_md R0_hi G0_lo G0_md G0_hi B0_lo B0_md B0_hi
				// Y: R0_lo R0_md R0_hi
				// first element: separate to 2 elements (2+6), all others move right 1 block
				if( j==0 ) // 8bit -> 2 + 6
				{
					enc_data_6b[ (0*tbl_ch+k)*5 + 0 ] = delta_lo >> 6;
					enc_data_6b[ (0*tbl_ch+k)*5 + 1 ] = delta_md >> 6;
					enc_data_6b[ (0*tbl_ch+k)*5 + 2 ] = delta_md2 >> 6;
					enc_data_6b[ (0*tbl_ch+k)*5 + 3 ] = delta_md3 >> 6;
					enc_data_6b[ (0*tbl_ch+k)*5 + 4 ] = delta_hi >> 6;

					enc_data_6b[ (1*tbl_ch+k)*5 + 0 ] = delta_lo & 0x3f;
					enc_data_6b[ (1*tbl_ch+k)*5 + 1 ] = delta_md & 0x3f;
					enc_data_6b[ (1*tbl_ch+k)*5 + 2 ] = delta_md2 & 0x3f;
					enc_data_6b[ (1*tbl_ch+k)*5 + 3 ] = delta_md3 & 0x3f;
					enc_data_6b[ (1*tbl_ch+k)*5 + 4 ] = delta_hi & 0x3f;
				}
				else
				{
					enc_data_6b[ ((j+1)*tbl_ch+k)*5 + 0 ] = delta_lo & 0x3f;
					enc_data_6b[ ((j+1)*tbl_ch+k)*5 + 1 ] = delta_md & 0x3f;
					enc_data_6b[ ((j+1)*tbl_ch+k)*5 + 2 ] = delta_md2 & 0x3f;
					enc_data_6b[ ((j+1)*tbl_ch+k)*5 + 3 ] = delta_md3 & 0x3f;
					enc_data_6b[ ((j+1)*tbl_ch+k)*5 + 4 ] = delta_hi & 0x3f;
				}
			}
				//if(j < 10 /*|| (j > 470)*/)
					//rtd_pr_vpq_info("roger, ori[%d][%d] = [%d], JL = [%d]\n", i, j, tbl_ori_lo[ (i*in_tbl_width + j)], delta_lo);
		}

		pack_ptr = Demura_TBL->TBL + i * line_size;
		byte_cnt = 0;
		pack_tmp = 0;
		line_pack_bit = 0;
		// 6bit array to 8bit pack per line
		for( k=0; k< (tbl_width+1)*tbl_ch*5; k++ )
		{
			// 21 elements -> 126bit, dummy 2bit
			//    0     1     2     3             16    17    18    19    20
			// |  6b |  6b |  6b |  6b |  ...  |  6b |  6b |  6b |  6b |  6b |2|
			// |   8   |   8   |   8   |  ...  |   8   |   8   |   8   |   8   |
			//else
			{
				switch( line_pack_bit )
				{
					case 0:
						// |  6  | |
						pack_tmp = enc_data_6b[k] << 2;
						line_pack_bit = 6;
						break;
					case 6:
						// |     |2| 4 |   |
						pack_tmp |= ( enc_data_6b[k] & 0x30 ) >> 4;
						(*pack_ptr) = pack_tmp;
						pack_ptr++;
						byte_cnt++;

						pack_tmp = ( enc_data_6b[k] & 0x0F ) << 4;
						line_pack_bit = 4;
						break;
					case 4:
						// |   | 4 |2|     |
						pack_tmp |= ( enc_data_6b[k] & 0x3C ) >> 2;
						(*pack_ptr) = pack_tmp;
						pack_ptr++;
						byte_cnt++;

						pack_tmp = ( enc_data_6b[k] & 0x03 ) << 6;
						line_pack_bit = 2;
						break;
					case 2:
						// | |  6  |
						pack_tmp |= ( enc_data_6b[k] & 0x3F );
						(*pack_ptr) = pack_tmp;
						pack_ptr++;
						byte_cnt++;

						pack_tmp = 0;
						line_pack_bit = 0;
						break;
					default:
						break;
				}
			}

						if( k % 20 == 19 )
			{
				// dummy 8 bits
				pack_tmp = 0;
				(*pack_ptr) = pack_tmp;
				pack_ptr++;
				byte_cnt++;			
			}

		}
		// line end, add dummy until 128bits
		if( line_pack_bit != 0 )
		{
			(*pack_ptr) = pack_tmp;
			pack_ptr++;
			byte_cnt++;
		}
		while( byte_cnt % 16 != 0 )
		{
			(*pack_ptr) = 0;
			pack_ptr++;
			byte_cnt++;
		}
	}
	vip_free( enc_data_6b );

	/* set RTK control table */
	{	
	unsigned int gray_setting[7];
	unsigned int err;
	//unsigned short div_tmp;

	Demura_TBL->table_mode = table_mode;
	Demura_TBL->DeMura_CTRL_TBL.demura_rgb_table_seperate = table_separate;
	rtd_pr_vpq_info("INNX_Demura, table_mode[%d], seperate[%d]\n", table_mode, table_separate);
	
	
	// set control threshold table
	gray_setting[0] = INNX_Demura_gray_setting[0];
	gray_setting[1] = INNX_Demura_gray_setting[2];
	gray_setting[2] = INNX_Demura_gray_setting[3];
	gray_setting[3] = INNX_Demura_gray_setting[4];
	gray_setting[4] = INNX_Demura_gray_setting[5];
	gray_setting[5] = INNX_Demura_gray_setting[6];
	gray_setting[6] = INNX_Demura_gray_setting[1];

	//data check
	err = 0;
	for (i=1;i<5;i++) {
		if (gray_setting[i] <=  gray_setting[i-1]) {
			err =1;
		}
		if (err == 1) {
			rtd_pr_vpq_emerg("vpq_INNX_Demura threshold setting error,  lower_cutoff=%d, low_lv=%d, mid_lv=%d, high_lv=%d, high_cut=%d, use default\n",
				gray_setting[0], gray_setting[1], gray_setting[2], gray_setting[3], gray_setting[4]);
			return;
		}
	}

	// r, g, b low_cut threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_lower_cutoff = gray_setting[0];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_lower_cutoff = gray_setting[0];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_lower_cutoff = gray_setting[0];
	// r, g, b low level threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_l_level = gray_setting[1];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_l_level = gray_setting[1];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_l_level = gray_setting[1];
	// r, g, b mid level threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_m_level = gray_setting[2];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_m_level = gray_setting[2];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_m_level = gray_setting[2];
	// r, g, b mid2 level threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_m2_level = gray_setting[3];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_m2_level = gray_setting[3];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_m2_level = gray_setting[3];
	// r, g, b mid3 level threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_m3_level = gray_setting[4];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_m3_level = gray_setting[4];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_m3_level = gray_setting[4];
	// r, g, b high level threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_h_level = gray_setting[5];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_h_level = gray_setting[5];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_h_level = gray_setting[5];
	
	// r, g, b high_cut threshold
	Demura_TBL->DeMura_CTRL_TBL.demura_r_upper_cutoff = gray_setting[6];
	Demura_TBL->DeMura_CTRL_TBL.demura_g_upper_cutoff = gray_setting[6];
	Demura_TBL->DeMura_CTRL_TBL.demura_b_upper_cutoff = gray_setting[6];

	#if 0
	// r, g, b dvi_fac_L  threshold
	div_tmp = (65536 / (gray_setting[1] -gray_setting[0]))>>2;
	Demura_TBL->DeMura_CTRL_TBL.r_div_factor_l = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.g_div_factor_l = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.b_div_factor_l = div_tmp;
	// r, g, b dvi_fac_L_M  threshold
	div_tmp = (65536 / (gray_setting[2] -gray_setting[1]))>>2;
	Demura_TBL->DeMura_CTRL_TBL.r_div_factor_l_m = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.g_div_factor_l_m = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.b_div_factor_l_m = div_tmp;
	// r, g, b dvi_fac_M_H  threshold
	div_tmp = (65536 / (gray_setting[3] -gray_setting[2]))>>2;
	Demura_TBL->DeMura_CTRL_TBL.r_div_factor_m_h = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.g_div_factor_m_h = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.b_div_factor_m_h = div_tmp;
	// r, g, b dvi_fac_M_H  threshold
	div_tmp = (65536 / (gray_setting[4] -gray_setting[3]))>>2;
	Demura_TBL->DeMura_CTRL_TBL.r_div_factor_h = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.g_div_factor_h = div_tmp;
	Demura_TBL->DeMura_CTRL_TBL.b_div_factor_h = div_tmp;
	#endif
	}

}



char fwif_color_INNX_Demura_TBL(unsigned char * pINNX_DemuraTBL, unsigned int TBL_Size, short *pDeLut)
{
	//long binSize;
	unsigned int i,k,ii,m,n,h,startAddress;
	unsigned char  c_left_BIT,read_BIT_value, c_read_BIT;
	unsigned char c_read_BIT_arr[4] = {4,3,7,7};
	unsigned int processing_BIT;
	unsigned int Block_Type=0	;
	unsigned int Block_DataChecksum=0  ;
	unsigned int Block_StartAddress=0   ;
	unsigned int Block_DataLength=0     ;
	unsigned int lut_crc_out = 0;
	short *INNX_Demura_DeLut1;
	short *INNX_Demura_DeLut2;
	short *INNX_Demura_DeLut3;
	short *INNX_Demura_DeLut4;
	short *INNX_Demura_DeLut5;
	//unsigned char crc_out = 0;
	//unsigned char BotLimit =0;
	//unsigned char TopLimit =0;
	/*unsigned char Gray1    =0;
	unsigned char Gray2    =0;
	unsigned char Gray3    =0;
	unsigned char Gray4    =0;
	unsigned char Gray5    =0;*/
	//unsigned int gray_setting[7];
	char ret = 0;

	#if 0
	INNX_Demura_CodeLutALL_row = (unsigned char *)vip_malloc((31 * 22) * sizeof(char));
	INNX_Demura_CodeLutAll = (unsigned char *)vip_malloc((31 * INNX_Demura_h_271 * 22) * sizeof(char));
	INNX_Demura_header_infor = (unsigned char *)vip_malloc(INNX_Demura_size_header_infor * sizeof(char));
	INNX_Demura_DataByRow = (unsigned char *)vip_malloc((22 * 5 * 31 * 271) * sizeof(char));
	#else
	INNX_Demura_CodeLutALL_row = (unsigned char *)dvr_malloc_specific((31 * 22) * sizeof(char), GFP_DCU2_FIRST);
	INNX_Demura_CodeLutAll = (unsigned char *)dvr_malloc_specific((31 * INNX_Demura_h_271 * 22) * sizeof(char), GFP_DCU2_FIRST);
	INNX_Demura_header_infor = (unsigned char *)dvr_malloc_specific(INNX_Demura_size_header_infor * sizeof(char), GFP_DCU2_FIRST);
	INNX_Demura_DataByRow = (unsigned char *)dvr_malloc_specific((22 * 5 * 31 * 271) * sizeof(char), GFP_DCU2_FIRST);
	#endif

	if ((INNX_Demura_CodeLutALL_row == NULL) || (INNX_Demura_CodeLutAll == NULL) || (INNX_Demura_header_infor == NULL)
		|| (INNX_Demura_DataByRow == NULL) || (pDeLut == NULL)) {
		rtd_pr_vpq_emerg("INNX_Demura, dynamic alloc fail, CodeLutALL_row=%p, CodeLutAll=%p, header_infor=%p, DataByRow=%p, pDeLut=%p\n",
			INNX_Demura_CodeLutALL_row, INNX_Demura_CodeLutAll, INNX_Demura_header_infor, INNX_Demura_DataByRow, pDeLut);
		return -1;
	}

	if (pINNX_DemuraTBL == NULL) {
		rtd_pr_vpq_emerg("INNX_Demura----------pINNX_DemuraTBL = NULL ----------\n");
		return -1;
	}

	rtd_pr_vpq_info("INNX_Demura, set INNX Demura, INNX demura size =%d,\n", TBL_Size);

	INNX_Demura_DeLut1 = &pDeLut[INNX_Demura_DecodeLUT_Low_sta_addr];
	INNX_Demura_DeLut2 = &pDeLut[INNX_Demura_DecodeLUT_Mid_sta_addr];
	INNX_Demura_DeLut3 = &pDeLut[INNX_Demura_DecodeLUT_Mid2_sta_addr];
	INNX_Demura_DeLut4 = &pDeLut[INNX_Demura_DecodeLUT_Mid3_sta_addr];
	INNX_Demura_DeLut5 = &pDeLut[INNX_Demura_DecodeLUT_High_sta_addr];

	ret = fwif_color_INNX_Demura_Check_header_Information(pINNX_DemuraTBL, &Block_Type, &Block_DataChecksum,  &Block_StartAddress,  &Block_DataLength,INNX_Demura_gray_setting);//gray_setting :u(10,0)

	if (ret != 0) {
		rtd_pr_vpq_emerg("INNX_Demura-------header check error, error code = %d ----------\n", ret);		
		return ret;
	}

	//lut_crc_out = crcArray(buffer, lut_crc_out,Block_StartAddress, Block_DataLength);
	lut_crc_out = fwif_color_INNX_Demura_crcArray_sumAll(pINNX_DemuraTBL, Block_StartAddress, Block_DataLength);

	if (lut_crc_out != 0) {
		rtd_pr_vpq_emerg("INNX_Demura-------CRC check error, error code = %d ----------\n", lut_crc_out);		
		return lut_crc_out;
	}


	//lut 1
	c_left_BIT= 8;

	startAddress = Block_StartAddress;

	ii= startAddress;

	processing_BIT=pINNX_DemuraTBL[ii];

	k=0;//c_read_BIT idx
	c_read_BIT = c_read_BIT_arr[k%22];


	h=0;

	while(ii<Block_DataLength+startAddress)
	{

	do {
		read_BIT_value = (unsigned char)(fwif_color_INNX_Demura_pow2_inx(c_read_BIT)-1);

		INNX_Demura_DataByRow[k]  = processing_BIT&read_BIT_value;
		k=k+1;


		c_left_BIT = c_left_BIT - c_read_BIT;
		processing_BIT = processing_BIT>>c_read_BIT;

		if(k%22 < 16)
		{
			c_read_BIT = c_read_BIT_arr[0];
		}else if(k%22 < 20)
		{
			c_read_BIT = c_read_BIT_arr[1];
		}else if(k%22 == 20)
		{
			c_read_BIT = c_read_BIT_arr[2];
		}else if(k%22 == 21)
		{
			c_read_BIT = c_read_BIT_arr[3];
		}
	} while(c_read_BIT < c_left_BIT || c_read_BIT == c_left_BIT);



	if(c_read_BIT > c_left_BIT){
		if(((k % (5*22*31))==0)&&(k!=0))//start next line
		{
			ii=ii+17;
			c_left_BIT =8	;
			processing_BIT =(pINNX_DemuraTBL[ii]);

			k=0;

			for ( m = 0; m < (496 / 16); m++)
			{
			    for( n = 0; n< INNX_Demura_num_22; n++)
			    {
			        INNX_Demura_CodeLutALL_row[ (m*INNX_Demura_num_22)+n]  = INNX_Demura_DataByRow[0*22+m*110+n] ;
			    }
			}

			for ( m = 0; m < (INNX_Demura_W16 / 16); m++)
			{
			    for( n = 0; n< INNX_Demura_num_22; n++)
			    {
					INNX_Demura_CodeLutAll[((h*(INNX_Demura_W16 / 16)+m)*INNX_Demura_num_22)+n] =  INNX_Demura_CodeLutALL_row[ (m*INNX_Demura_num_22)+n] ;
			    }
			}

				h=h+1;
		}
		else
		{
			ii=ii+1;
			processing_BIT = (processing_BIT)+(pINNX_DemuraTBL[ii]<<c_left_BIT);
			c_left_BIT = c_left_BIT+8;
		}
	}
	};


	    fwif_color_INNX_Demura_Decode_AQC_inx(INNX_Demura_CodeLutAll,  INNX_Demura_DeLut1);
#if 0
	    for (i = 0; i < INNX_Demura_h_271; i++)
	    {
	        for (j = 0; j < INNX_Demura_W; j++)
	        {
	            INNX_Demura_DeLut1[i][ j] = INNX_Demura_DeLut1[i][ j]-64;
	        }
	    }
#endif
	//lut 2
	c_left_BIT= 8;

	startAddress = Block_StartAddress;

	ii= startAddress;

	processing_BIT=pINNX_DemuraTBL[ii];

	k=0;//c_read_BIT idx
	c_read_BIT = c_read_BIT_arr[k%22];


	h=0;

	while(ii<Block_DataLength+startAddress)
	{

	do {
		read_BIT_value = (unsigned char)(fwif_color_INNX_Demura_pow2_inx(c_read_BIT)-1);

		INNX_Demura_DataByRow[k]  = processing_BIT&read_BIT_value;
		k=k+1;


		c_left_BIT = c_left_BIT - c_read_BIT;
		processing_BIT = processing_BIT>>c_read_BIT;

		if(k%22 < 16)
		{
			c_read_BIT = c_read_BIT_arr[0];
		}else if(k%22 < 20)
		{
			c_read_BIT = c_read_BIT_arr[1];
		}else if(k%22 == 20)
		{
			c_read_BIT = c_read_BIT_arr[2];
		}else if(k%22 == 21)
		{
			c_read_BIT = c_read_BIT_arr[3];
		}
	} while(c_read_BIT < c_left_BIT || c_read_BIT == c_left_BIT);



	if(c_read_BIT > c_left_BIT){
		if(((k % (5*22*31))==0)&&(k!=0))//start next line
		{
			ii=ii+17;
			c_left_BIT =8	;
			processing_BIT =(pINNX_DemuraTBL[ii]);

			k=0;

			for ( m = 0; m < (496 / 16); m++)
			{
			    for( n = 0; n< INNX_Demura_num_22; n++)
			    {
			        INNX_Demura_CodeLutALL_row[ (m*INNX_Demura_num_22)+n]  = INNX_Demura_DataByRow[1*22+m*110+n] ;
			    }
			}

			for ( m = 0; m < (INNX_Demura_W16 / 16); m++)
			{
			    for( n = 0; n< INNX_Demura_num_22; n++)
			    {
					INNX_Demura_CodeLutAll[((h*(INNX_Demura_W16 / 16)+m)*INNX_Demura_num_22)+n] =  INNX_Demura_CodeLutALL_row[ (m*INNX_Demura_num_22)+n] ;
			    }
			}

				h=h+1;
		}
		else
		{
			ii=ii+1;
			processing_BIT = (processing_BIT)+(pINNX_DemuraTBL[ii]<<c_left_BIT);
			c_left_BIT = c_left_BIT+8;
		}
	}
	};

	    fwif_color_INNX_Demura_Decode_AQC_inx(INNX_Demura_CodeLutAll,  INNX_Demura_DeLut2);
#if 0
	    for (i = 0; i < INNX_Demura_h_271; i++)
	    {
	        for (j = 0; j < INNX_Demura_W; j++)
	        {
	            INNX_Demura_DeLut2[i][ j] = INNX_Demura_DeLut2[i][ j]-64;
	        }
	    }
#endif


	//lut 3
	c_left_BIT= 8;

	startAddress = Block_StartAddress;

	ii= startAddress;

	processing_BIT=pINNX_DemuraTBL[ii];

	k=0;//c_read_BIT idx
	c_read_BIT = c_read_BIT_arr[k%22];


	h=0;

	while(ii<Block_DataLength+startAddress)
	{

	do {
		read_BIT_value = (unsigned char)(fwif_color_INNX_Demura_pow2_inx(c_read_BIT)-1);

		INNX_Demura_DataByRow[k]  = processing_BIT&read_BIT_value;
		k=k+1;


		c_left_BIT = c_left_BIT - c_read_BIT;
		processing_BIT = processing_BIT>>c_read_BIT;

		if(k%22 < 16)
		{
			c_read_BIT = c_read_BIT_arr[0];
		}else if(k%22 < 20)
		{
			c_read_BIT = c_read_BIT_arr[1];
		}else if(k%22 == 20)
		{
			c_read_BIT = c_read_BIT_arr[2];
		}else if(k%22 == 21)
		{
			c_read_BIT = c_read_BIT_arr[3];
		}
	} while(c_read_BIT < c_left_BIT || c_read_BIT == c_left_BIT);



	if(c_read_BIT > c_left_BIT){
		if(((k % (5*22*31))==0)&&(k!=0))//start next line
		{
			ii=ii+17;
			c_left_BIT =8	;
			processing_BIT =(pINNX_DemuraTBL[ii]);

			k=0;

			for ( m = 0; m < (496 / 16); m++)
			{
			    for( n = 0; n< INNX_Demura_num_22; n++)
			    {
			        INNX_Demura_CodeLutALL_row[ (m*INNX_Demura_num_22)+n]  = INNX_Demura_DataByRow[2*22+m*110+n] ;
			    }
			}

			for ( m = 0; m < (INNX_Demura_W16 / 16); m++)
			{
			    for( n = 0; n< INNX_Demura_num_22; n++)
			    {
					INNX_Demura_CodeLutAll[((h*(INNX_Demura_W16 / 16)+m)*INNX_Demura_num_22)+n] =  INNX_Demura_CodeLutALL_row[ (m*INNX_Demura_num_22)+n] ;
			    }
			}

				h=h+1;
		}
		else
		{
			ii=ii+1;
			processing_BIT = (processing_BIT)+(pINNX_DemuraTBL[ii]<<c_left_BIT);
			c_left_BIT = c_left_BIT+8;
		}
	}
	};


	    fwif_color_INNX_Demura_Decode_AQC_inx(INNX_Demura_CodeLutAll,  INNX_Demura_DeLut3);
#if 0
	    for (i = 0; i < INNX_Demura_h_271; i++)
	    {
	        for (j = 0; j < INNX_Demura_W; j++)
	        {
	            INNX_Demura_DeLut3[i][ j] = INNX_Demura_DeLut3[i][ j]-64;
	        }
	    }
#endif
	//lut 4
	c_left_BIT= 8;

	startAddress = Block_StartAddress;

	ii= startAddress;

	processing_BIT=pINNX_DemuraTBL[ii];

	k=0;//c_read_BIT idx
	c_read_BIT = c_read_BIT_arr[k%22];


	h=0;

	while(ii<Block_DataLength+startAddress)
	{

	do {
		read_BIT_value = (unsigned char)(fwif_color_INNX_Demura_pow2_inx(c_read_BIT)-1);

		INNX_Demura_DataByRow[k]  = processing_BIT&read_BIT_value;
		k=k+1;


		c_left_BIT = c_left_BIT - c_read_BIT;
		processing_BIT = processing_BIT>>c_read_BIT;

		if(k%22 < 16)
		{
			c_read_BIT = c_read_BIT_arr[0];
		}else if(k%22 < 20)
		{
			c_read_BIT = c_read_BIT_arr[1];
		}else if(k%22 == 20)
		{
			c_read_BIT = c_read_BIT_arr[2];
		}else if(k%22 == 21)
		{
			c_read_BIT = c_read_BIT_arr[3];
		}
	} while(c_read_BIT < c_left_BIT || c_read_BIT == c_left_BIT);



	if(c_read_BIT > c_left_BIT){
		if(((k % (5*22*31))==0)&&(k!=0))//start next line
		{
			ii=ii+17;
			c_left_BIT =8	;
			processing_BIT =(pINNX_DemuraTBL[ii]);

			k=0;

			for ( m = 0; m < (496 / 16); m++)
			{
			    for( n = 0; n< INNX_Demura_num_22; n++)
			    {
			        INNX_Demura_CodeLutALL_row[ (m*INNX_Demura_num_22)+n]  = INNX_Demura_DataByRow[3*22+m*110+n] ;
			    }
			}

			for ( m = 0; m < (INNX_Demura_W16 / 16); m++)
			{
			    for( n = 0; n< INNX_Demura_num_22; n++)
			    {
					INNX_Demura_CodeLutAll[((h*(INNX_Demura_W16 / 16)+m)*INNX_Demura_num_22)+n] =  INNX_Demura_CodeLutALL_row[ (m*INNX_Demura_num_22)+n] ;
			    }
			}

				h=h+1;
		}
		else
		{
			ii=ii+1;
			processing_BIT = (processing_BIT)+(pINNX_DemuraTBL[ii]<<c_left_BIT);
			c_left_BIT = c_left_BIT+8;
		}
	}
	};


	    fwif_color_INNX_Demura_Decode_AQC_inx(INNX_Demura_CodeLutAll,  INNX_Demura_DeLut4);
#if 0
	    for (i = 0; i < INNX_Demura_h_271; i++)
	    {
	        for (j = 0; j < INNX_Demura_W; j++)
	        {
	            INNX_Demura_DeLut4[i][ j] = INNX_Demura_DeLut4[i][ j]-64;
	        }
	    }
#endif



	//lut 5
	c_left_BIT= 8;

	startAddress = Block_StartAddress;

	ii= startAddress;

	processing_BIT=pINNX_DemuraTBL[ii];

	k=0;//c_read_BIT idx
	c_read_BIT = c_read_BIT_arr[k%22];


	h=0;

	while(ii<Block_DataLength+startAddress)
	{

	do {
		read_BIT_value = (unsigned char)(fwif_color_INNX_Demura_pow2_inx(c_read_BIT)-1);

		INNX_Demura_DataByRow[k]  = processing_BIT&read_BIT_value;
		k=k+1;


		c_left_BIT = c_left_BIT - c_read_BIT;
		processing_BIT = processing_BIT>>c_read_BIT;

		if(k%22 < 16)
		{
			c_read_BIT = c_read_BIT_arr[0];
		}else if(k%22 < 20)
		{
			c_read_BIT = c_read_BIT_arr[1];
		}else if(k%22 == 20)
		{
			c_read_BIT = c_read_BIT_arr[2];
		}else if(k%22 == 21)
		{
			c_read_BIT = c_read_BIT_arr[3];
		}
	} while(c_read_BIT < c_left_BIT || c_read_BIT == c_left_BIT);



	if(c_read_BIT > c_left_BIT){
		if(((k % (5*22*31))==0)&&(k!=0))//start next line
		{
			ii=ii+17;
			c_left_BIT =8	;
			processing_BIT =(pINNX_DemuraTBL[ii]);

			k=0;

			for ( m = 0; m < (496 / 16); m++)
			{
			    for( n = 0; n< INNX_Demura_num_22; n++)
			    {
			        INNX_Demura_CodeLutALL_row[ (m*INNX_Demura_num_22)+n]  = INNX_Demura_DataByRow[4*22+m*110+n] ;
			    }
			}

			for ( m = 0; m < (INNX_Demura_W16 / 16); m++)
			{
			    for( n = 0; n< INNX_Demura_num_22; n++)
			    {
					INNX_Demura_CodeLutAll[((h*(INNX_Demura_W16 / 16)+m)*INNX_Demura_num_22)+n] =  INNX_Demura_CodeLutALL_row[ (m*INNX_Demura_num_22)+n] ;
			    }
			}

				h=h+1;
		}
		else
		{
			ii=ii+1;
			processing_BIT = (processing_BIT)+(pINNX_DemuraTBL[ii]<<c_left_BIT);
			c_left_BIT = c_left_BIT+8;
		}
	}
	};


	    fwif_color_INNX_Demura_Decode_AQC_inx(INNX_Demura_CodeLutAll,  INNX_Demura_DeLut5);
#if 0
	    for (i = 0; i < INNX_Demura_h_271; i++)
	    {
	        for (j = 0; j < INNX_Demura_W; j++)
	        {
	            INNX_Demura_DeLut5[i][ j] = INNX_Demura_DeLut5[i][ j]-64;
	        }
	    }
#endif

	for (i = 0; i < INNX_Demura_DecodeLUT_Size; i++)
		pDeLut[i] = pDeLut[i]-64;

	dvr_free((void *)INNX_Demura_CodeLutALL_row);
	dvr_free((void *)INNX_Demura_CodeLutAll);
	dvr_free((void *)INNX_Demura_header_infor);
	dvr_free((void *)INNX_Demura_DataByRow);

	return 0;
}


/*========================= for INNX demura =================================*/
#endif

unsigned int mixer_gamma1[] = {
	0x00001010, 0x00201010, 0x00401010, 0x00601010, 0x00801010, 0x00a01010, 0x00c01010, 0x00e01010, 0x01001010, 0x01201010, 0x01401010, 0x01601010, 0x01801010, 0x01a01010, 0x01c01010, 0x01e01010,
	0x02001010, 0x02201010, 0x02401010, 0x02601010, 0x02801010, 0x02a01010, 0x02c01010, 0x02e01010, 0x03001010, 0x03201010, 0x03401010, 0x03601010, 0x03801010, 0x03a01010, 0x03c01010, 0x03e01010,
	0x04001010, 0x04201010, 0x04401010, 0x04601010, 0x04801010, 0x04a01010, 0x04c01010, 0x04e01010, 0x05001010, 0x05201010, 0x05401010, 0x05601010, 0x05801010, 0x05a01010, 0x05c01010, 0x05e01010,
	0x06001010, 0x06201010, 0x06401010, 0x06601010, 0x06801010, 0x06a01010, 0x06c01010, 0x06e01010, 0x07001010, 0x07201010, 0x07401010, 0x07601010, 0x07801010, 0x07a01010, 0x07c01010, 0x07e01010,
	0x08001010, 0x08201010, 0x08401010, 0x08601010, 0x08801010, 0x08a01010, 0x08c01010, 0x08e01010, 0x09001010, 0x09201010, 0x09401010, 0x09601010, 0x09801010, 0x09a01010, 0x09c01010, 0x09e01010,
	0x0a001010, 0x0a201010, 0x0a401010, 0x0a601010, 0x0a801010, 0x0aa01010, 0x0ac01010, 0x0ae01010, 0x0b001010, 0x0b201010, 0x0b401010, 0x0b601010, 0x0b801010, 0x0ba01010, 0x0bc01010, 0x0be01010,
	0x0c001010, 0x0c201010, 0x0c401010, 0x0c601010, 0x0c801010, 0x0ca01010, 0x0cc01010, 0x0ce01010, 0x0d001010, 0x0d201010, 0x0d401010, 0x0d601010, 0x0d801010, 0x0da01010, 0x0dc01010, 0x0de01010,
	0x0e001010, 0x0e201010, 0x0e401010, 0x0e601010, 0x0e801010, 0x0ea01010, 0x0ec01010, 0x0ee01010, 0x0f001010, 0x0f201010, 0x0f401010, 0x0f601010, 0x0f801010, 0x0fa01010, 0x0fc01010, 0x0fe01010,
};
unsigned int mixer_gamma2[] = {
#if 0
	0x00001010, 0x00201010, 0x00401010, 0x00601010, 0x00801010, 0x00a01010, 0x00c01010, 0x00e01010, 0x01001010, 0x01201010, 0x01401010, 0x01601010, 0x01801010, 0x01a01010, 0x01c01010, 0x01e01010,
	0x02001010, 0x02201010, 0x02401010, 0x02601010, 0x02801010, 0x02a01010, 0x02c01010, 0x02e01010, 0x03001010, 0x03201010, 0x03401010, 0x03601010, 0x03801010, 0x03a01010, 0x03c01010, 0x03e01010,
	0x04001010, 0x04201010, 0x04401010, 0x04601010, 0x04801010, 0x04a01010, 0x04c01010, 0x04e01010, 0x05001010, 0x05201010, 0x05401010, 0x05601010, 0x05801010, 0x05a01010, 0x05c01010, 0x05e01010,
	0x06001010, 0x06201010, 0x06401010, 0x06601010, 0x06801010, 0x06a01010, 0x06c01010, 0x06e01010, 0x07001010, 0x07201010, 0x07401010, 0x07601010, 0x07801010, 0x07a01010, 0x07c01010, 0x07e01010,
	0x08001010, 0x08201010, 0x08401010, 0x08601010, 0x08801010, 0x08a01010, 0x08c01010, 0x08e01010, 0x09001010, 0x09201010, 0x09401010, 0x09601010, 0x09801010, 0x09a01010, 0x09c01010, 0x09e01010,
	0x0a001010, 0x0a201010, 0x0a401010, 0x0a601010, 0x0a801010, 0x0aa01010, 0x0ac01010, 0x0ae01010, 0x0b001010, 0x0b201010, 0x0b401010, 0x0b601010, 0x0b801010, 0x0ba01010, 0x0bc01010, 0x0be01010,
	0x0c001010, 0x0c201010, 0x0c401010, 0x0c601010, 0x0c801010, 0x0ca01010, 0x0cc01010, 0x0ce01010, 0x0d001010, 0x0d201010, 0x0d401010, 0x0d601010, 0x0d801010, 0x0da01010, 0x0dc01010, 0x0de01010,
	0x0e001010, 0x0e201010, 0x0e401010, 0x0e601010, 0x0e801010, 0x0ea01010, 0x0ec01010, 0x0ee01010, 0x0f001010, 0x0f201010, 0x0f401010, 0x0f601010, 0x0f801010, 0x0fa01010, 0x0fc01010, 0x0fe01010,
#else
0x00000505,	0x000a0506,	0x00150506,	0x00200606,	0x002c0607,	0x00390607,	0x00460708,	0x00550707, 0x00630808,	0x00730808,	0x00830809,	0x00940909,	0x00a60909,	0x00b8090a,	0x00cb0a0a,	0x00df0a0a,
0x00f30b0b,	0x01090a0b,	0x011e0b0c,	0x01350b0c,	0x014c0c0c,	0x01640c0d,	0x017d0c0d,	0x01960d0d, 0x01b00d0e,	0x01cb0d0e,	0x01e60e0f,	0x02030e0e,	0x021f0f0f,	0x023d0f0f,	0x025b0f10,	0x027a1010,
0x029a1010,	0x02ba1011,	0x02db1111,	0x02fd1111,	0x031f1212,	0x03431112,	0x03661213,	0x038b1213, 0x03b01313,	0x03d61314,	0x03fd1314,	0x04241414,	0x044c1415,	0x04751415,	0x049e1516,	0x04c91515,
0x04f31616,	0x051f1616,	0x054b1617,	0x05781717,	0x05a61717,	0x05d41718,	0x06031818,	0x06331818,	0x06631919,	0x06951819,	0x06c6191a,	0x06f9191a,	0x072c1a1a,	0x07601a1b,	0x07951a1b,	0x07ca1b1b,
0x08001b1b,	0x08361b1a,	0x086b1b1a,	0x08a01a1a,	0x08d41a1a,	0x09081919,	0x093a1919,	0x096c1819,	0x099d1819,	0x09ce1718,	0x09fd1817,	0x0a2c1717,	0x0a5a1717,	0x0a881716,	0x0ab51617,	0x0ae21516,
0x0b0d1516,	0x0b381515,	0x0b621515,	0x0b8c1414,	0x0bb41414,	0x0bdc1413,	0x0c031413,	0x0c2a1313,	0x0c501313,	0x0c761212,	0x0c9a1212,	0x0cbe1112,	0x0ce11112,	0x0d041011,	0x0d251110,	0x0d461010,
0x0d661010,	0x0d86100f,	0x0da50f10,	0x0dc40e0f,	0x0de10e0f,	0x0dfe0e0e,	0x0e1a0e0e,	0x0e360d0d,	0x0e500d0d,	0x0e6a0d0c,	0x0e830d0c,	0x0e9c0c0c,	0x0eb40c0c,	0x0ecc0b0b,	0x0ee20b0b,	0x0ef80a0b,
0x0f0d0a0b,	0x0f22090a,	0x0f350a09,	0x0f480909,	0x0f5a0909,	0x0f6c0908,	0x0f7d0809,	0x0f8e0708,	0x0f9d0708,	0x0fac0707,	0x0fba0707,	0x0fc80606,	0x0fd40606,	0x0fe00605,	0x0feb0605,	0x0ff60504,
#endif

};
unsigned int mixer_3x3[2][15] = {
	{0, 0 ,0, 0x0d49, 0x3b4c, 0x3f6b, 0x3f01, 0x0910,  0x3fef, 0x3fdb, 0x3f32, 0x08f3, 0, 0, 0,},		//2020->709
	{0, 0 ,0, 0x0505, 0x02A2, 0x0059, 0x008E, 0x075B,  0x0017, 0x0022, 0x00B4, 0x072A, 0, 0, 0,},		//709->2020
};

void fwif_color_set_OSD_enhance_init(void)
{

	drvif_color_colorwrite_mixer_gamma1_Enable(0);
	drvif_color_colorwrite_mixer_gamma1_Enable(0);
	drvif_color_set_mixer_osd3x3_Enable(0);

	//	drvif_color_set_mixer_osd3x3(mixer_3x3);

	drvif_color_colorwrite_mixer_gamma1(mixer_gamma1, GAMMA_CHANNEL_R);
	drvif_color_colorwrite_mixer_gamma1(mixer_gamma1, GAMMA_CHANNEL_G);
	drvif_color_colorwrite_mixer_gamma1(mixer_gamma1, GAMMA_CHANNEL_B);

	drvif_color_colorwrite_mixer_gamma2(mixer_gamma2, GAMMA_CHANNEL_R);
	drvif_color_colorwrite_mixer_gamma2(mixer_gamma2, GAMMA_CHANNEL_G);
	drvif_color_colorwrite_mixer_gamma2(mixer_gamma2, GAMMA_CHANNEL_B);
}

void fwif_color_set_OSD_enhance_enable(unsigned char Enable)
{
//	drvif_color_set_mixer_osd3x3(mixer_3x3[(Enable-1)]);
	if(Enable==1){
		drvif_color_set_mixer_osd3x3(mixer_3x3[0]);
		Enable = 1;
	}else if(Enable==2){
		drvif_color_set_mixer_osd3x3(mixer_3x3[1]);
		Enable = 1;
	}else{
		Enable = 0;
	}
	drvif_color_set_mixer_osd3x3_Enable(Enable);

	drvif_color_colorwrite_mixer_gamma1_Enable(Enable);
	drvif_color_colorwrite_mixer_gamma2_Enable(Enable);
}

#if 0 //thread+semaphore have risk if STR retry many times
struct semaphore OD_Semaphore;

static int thread_set_od_bits(void *p)
{
	unsigned int *pBits;

	if (p != NULL)
		pBits = (unsigned int*)p;

	down(&OD_Semaphore);
	drvif_color_set_od_bits(*pBits); //10bit color depth
	up(&OD_Semaphore);

	return 0;
}
#endif

/*
char check_at_uzudtg_disp_area(void)
{
	UINT32 	den_start=0;
	UINT32 	den_end=0;
	UINT32	vtotal=0;
	INT32	line_cnt=0;
	INT32 	dtgm2uzu_sft=0;
	INT32	line_cnt_sft=0;

	ppoverlay_dv_den_start_end_RBUS dv_den_start_end_reg;
	dv_den_start_end_reg.regValue = IoReg_Read32(PPOVERLAY_DV_DEN_Start_End_reg);
	den_start = dv_den_start_end_reg.dv_den_sta;
	den_end = dv_den_start_end_reg.dv_den_end;

	ppoverlay_new_meas2_linecnt_real_RBUS new_meas2_linecnt_real_reg;
	new_meas2_linecnt_real_reg.regValue = IoReg_Read32(PPOVERLAY_new_meas2_linecnt_real_reg);
	line_cnt = new_meas2_linecnt_real_reg.uzudtg_dly_line_cnt_rt;

	ppoverlay_uzudtg_control1_RBUS ppoverlay_uzudtg_control1_reg;
	ppoverlay_uzudtg_control1_reg.regValue = IoReg_Read32(PPOVERLAY_uzudtg_control1_reg);
	dtgm2uzu_sft = ppoverlay_uzudtg_control1_reg.dtgm2uzuvs_line;

	ppoverlay_dv_total_RBUS dv_total_reg;
	dv_total_reg.regValue = IoReg_Read32(PPOVERLAY_DV_total_reg);
	vtotal = dv_total_reg.dv_total;

	if((line_cnt - dtgm2uzu_sft) < 0) {
		line_cnt_sft = line_cnt - dtgm2uzu_sft + vtotal;
	} else {
		line_cnt_sft = line_cnt - dtgm2uzu_sft;
	}

	if((line_cnt_sft >= (den_start + 5)) && (line_cnt_sft < (den_end - 5))) {
		return 1;	// at disp area
	} else {
		return 0;	// fail, not at disp area
	}
}
*/

char check_at_uzudtg_front_porch(unsigned char waitFixedLine, unsigned int FixedLine)
{
	UINT32 	den_end=0;
	UINT32	vtotal=0;
	INT32	line_cnt=0;
	INT32 	dtgm2uzu_sft=0;
	INT32	line_cnt_sft=0;

	ppoverlay_dv_den_start_end_RBUS dv_den_start_end_reg;
	ppoverlay_new_meas2_linecnt_real_RBUS new_meas2_linecnt_real_reg;
	ppoverlay_uzudtg_control1_RBUS ppoverlay_uzudtg_control1_reg;
	ppoverlay_dv_total_RBUS dv_total_reg;
	dv_den_start_end_reg.regValue = IoReg_Read32(PPOVERLAY_DV_DEN_Start_End_reg);
	den_end = dv_den_start_end_reg.dv_den_end;

	new_meas2_linecnt_real_reg.regValue = IoReg_Read32(PPOVERLAY_new_meas2_linecnt_real_reg);
	line_cnt = new_meas2_linecnt_real_reg.uzudtg_dly_line_cnt_rt;

	ppoverlay_uzudtg_control1_reg.regValue = IoReg_Read32(PPOVERLAY_uzudtg_control1_reg);
	dtgm2uzu_sft = ppoverlay_uzudtg_control1_reg.dtgm2uzuvs_line;

	dv_total_reg.regValue = IoReg_Read32(PPOVERLAY_DV_total_reg);
	vtotal = dv_total_reg.dv_total;

	if((line_cnt - dtgm2uzu_sft) < 0) {
		line_cnt_sft = line_cnt - dtgm2uzu_sft + vtotal;
	} else {
		line_cnt_sft = line_cnt - dtgm2uzu_sft;
	}

	if (!waitFixedLine) {
		if((line_cnt_sft >= (den_end + 5)) && (line_cnt_sft < (vtotal - 2))) {
			return 1;	// at front porch
		} else {
			return 0;	// fail, not at front porch
		}
	} else {
		if (line_cnt_sft == FixedLine)
			return 1;
		else
			return 0;
	}
}

unsigned int rand32(void)
{
	unsigned int rand;
	get_random_bytes(&rand, sizeof(unsigned int));
	return rand;
}

unsigned char fwif_Set_VIP_Disable_PQ(VPQ_ModuleTest_Item ModuleTest_Item, unsigned char Enable)
{
	unsigned char i;
	unsigned char isIMode_Flag = 0;
	isIMode_Flag = Scaler_DispGetStatus(SLR_MAIN_DISPLAY, SLR_DISP_INTERLACE);

	switch (ModuleTest_Item) {
		case Disable_init:
			fwif_color_SetAutoMAFlag(0);
		break;
		case Disable_HDR:
			drvif_color_Disable_HDR(Enable);
		break;
		case Disable_VPQ_ByPass:
			for (i=0; i<VIP_PQ_ByPass_ITEMS_Max; i++) {
				if( (i!=PQ_ByPass_I_DI_IP_Enable) ){
					if( (isIMode_Flag) && (i!=PQ_ByPass_I_DI) ){
						drvif_color_set_PQ_ByPass(i,isIMode_Flag);
					}else{
						if( i!=PQ_ByPass_I_DI ){
							drvif_color_set_PQ_ByPass(i,isIMode_Flag);
						}
					}
				}
			}
			drvif_color_VPQ_ByPass(Enable);
		break;
		case Disable_MEMC:
			drvif_color_Disable_MEMC(Enable);
		break;

		default:
		break;

	}

	return TRUE;
}

char fwif_color_set_PQ_SOURCE_TYPE_From_AP(unsigned char pq_src)
{
	_RPC_system_setting_info *sys_RPC_info =(_RPC_system_setting_info *) Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	if (sys_RPC_info == NULL) {
		rtd_pr_vpq_emerg("fwif_color_set_PQ_SOURCE_TYPE_From_AP, table NULL.\n");
		return -1;
	}

	if (pq_src >= PQ_SRC_From_AP_ITEM_MAX)
		pq_src = PQ_SRC_From_AP_UNKNOW;

	sys_RPC_info->PQ_source_type_from_AP = pq_src;
	rtd_pr_vpq_info("fwif_color_set_PQ_SOURCE_TYPE_From_AP, pq_src = %d,\n", pq_src);
	return 0;
}

unsigned char fwif_color_Get_PQ_SOURCE_TYPE_From_AP(void)
{
	_RPC_system_setting_info *sys_RPC_info =(_RPC_system_setting_info *) Scaler_GetShareMemVirAddr(SCALERIOC_VIP_RPC_system_info_structure);

	if (sys_RPC_info == NULL) {
		rtd_pr_vpq_emerg("fwif_color_Get_PQ_SOURCE_TYPE_From_AP, table NULL.\n");
		return PQ_SRC_From_AP_UNKNOW;
	}

	return sys_RPC_info->PQ_source_type_from_AP;
}
 /* ====  Dither ======*/
 void fwif_color_dither_mode(KADP_DISP_TCON_DITHER_T mode)
{
	switch (mode) {
	case KADP_DISP_TCON_DITHER_TRUNC:
			drvif_color_Panel_Dither_mode(0);
			break;
	case KADP_DISP_TCON_DITHER_ROUND:
	case KADP_DISP_TCON_DITHER_RANDOM:
			drvif_color_Panel_Dither_mode(1);
			break;
	}
}
 void fwif_color_set_Main_Dither(unsigned char enable,unsigned char nTableType)
{
	drvif_color_set_Dither_Sequence(VIP_DITHER_IP_MAIN,tDITHER_SEQUENCE[VIP_DITHER_SEQUENCE_MAIN]);
	drvif_color_set_MainType_Dither_Table(VIP_DITHER_IP_MAIN,tDITHER_MAIN_LUT[nTableType]);
	drvif_color_set_Dither_Temporal(VIP_DITHER_IP_MAIN,tDITHER_TEMPORAL[VIP_DITHER_TEMPORAL_MAIN_GENERAL]);
	drvif_color_set_Main_Dither_Enable(enable);
}
 void fwif_color_set_HDMI_Dither(unsigned char enable,unsigned char nTableType)
{
	drvif_color_set_Dither_Sequence(VIP_DITHER_IP_HDMI,tDITHER_SEQUENCE[VIP_DITHER_SEQUENCE_MAIN]);
	drvif_color_set_MainType_Dither_Table(VIP_DITHER_IP_HDMI,tDITHER_MAIN_LUT[drvif_color_get_HDMI_dither_table_index()]);	/* dither table need to sync with bit number decide by i3ddma */
	drvif_color_set_Dither_Temporal(VIP_DITHER_IP_HDMI,tDITHER_TEMPORAL[VIP_DITHER_TEMPORAL_MAIN_GENERAL]);
	drvif_color_set_HDMI_Dither_Enable(enable);
}
void fwif_color_set_MEMC_dither(unsigned char enable,VIP_PANEL_BIT default_vip_panel_bit,unsigned char nTableType)
{
	drvif_color_Setditherbit(default_vip_panel_bit);
	drvif_color_set_Dither_Sequence(VIP_DITHER_IP_MEMC_MUX,tDITHER_SEQUENCE[VIP_DITHER_SEQUENCE_PANEL]);
	drvif_color_set_PanelType_Dither_Table(VIP_DITHER_IP_MEMC_MUX,tDITHER_MEMC_LUT[nTableType]);
	drvif_color_set_Dither_Temporal(VIP_DITHER_IP_MEMC_MUX,tDITHER_TEMPORAL[VIP_DITHER_TEMPORAL_MEMC]);
	drvif_memc_mux_Dither_ctrl(enable, enable);
}
void fwif_color_set_Panel_Dither(unsigned char enable,VIP_PANEL_BIT default_vip_panel_bit,unsigned char nTableType)
{
	drvif_color_Setditherbit(default_vip_panel_bit);
	drvif_color_set_Dither_Sequence(VIP_DITHER_IP_PANEL,tDITHER_SEQUENCE[VIP_DITHER_SEQUENCE_PANEL]);
	drvif_color_set_PanelType_Dither_Table(VIP_DITHER_IP_PANEL,tDITHER_PANEL_LUT[nTableType]);
	drvif_color_set_Dither_Temporal(VIP_DITHER_IP_PANEL,tDITHER_TEMPORAL[VIP_DITHER_TEMPORAL_MAIN_GENERAL]);
	drvif_color_set_Panel_Dither_Enable(enable);
}
 void fwif_color_set_LGD_Dither(unsigned char enable,unsigned char nTableType)
{
	drvif_color_set_Dither_Sequence(VIP_DITHER_IP_LGD,tDITHER_SEQUENCE[VIP_DITHER_SEQUENCE_MAIN]);
	drvif_color_set_MainType_Dither_Table(VIP_DITHER_IP_LGD,tDITHER_MAIN_LUT[nTableType]);
	drvif_color_set_Dither_Temporal(VIP_DITHER_IP_LGD,tDITHER_TEMPORAL[VIP_DITHER_TEMPORAL_MAIN_GENERAL]);
	drvif_color_set_LGD_Dither_Enable(enable);
}
unsigned char MEX_MODE_Force_En_All = 0;
void fwif_color_MEX_MODE_init(void)
{
	unsigned char mode = MEX_UNKNOW;
	
#ifdef VPQ_K7_TO_MERLIN6_COMPILE	
	unsigned int panel_id;
	panel_id = Get_PANEL_iCONFIG_CUSTOMER_PANEL_ID();
	// how to get mode?
	if (MEX_MODE_Force_En_All == 1) {
		mode = MEX_Force_En_All;
	} else if (strcmp(webos_strToolOption.eModelModuleType, "LGD") == 0) {
		if (Get_DISPLAY_REFRESH_RATE() == 60)
			mode = MEX_LGD;
		else
			mode = MEX_LGD_120;
	} else if (strcmp(webos_strToolOption.eModelModuleType, "BOE") == 0) {
		if (Get_DISPLAY_REFRESH_RATE() == 60)
			mode = MEX_BOE;
		else
			mode = MEX_BOE_120;
	} else if (strcmp(webos_strToolOption.eModelModuleType, "INNOL") == 0) {
		mode = MEX_INX;
	} else if (strcmp(webos_strToolOption.eBackLight, "oled") == 0) {
		mode = MEX_LGD_OLED;
	} else if ((panel_id >=  MEX_LGD) && ((panel_id <=  MEX_S_AUO))) {
		mode = panel_id;
	} else {
		mode = MEX_UNKNOW;
	}

	rtd_pr_vpq_info("MEX, mode = %d,panel_id=%d, MMT=%s, BL=%s, fr=%d,\n",
		mode, panel_id, webos_strToolOption.eModelModuleType, webos_strToolOption.eBackLight, Get_DISPLAY_REFRESH_RATE());
#endif
	drvif_color_set_HW_MEX_MODE(mode);

#if 0
	Get_DISPLAY_PANEL_TYPE() == P_VBY1_4K2K;
	Get_DISPLAY_REFRESH_RATE() == 60 or 120;
	Get_DISPLAY_PANEL_OLED_TYPE() == pPanelCOnfigParameter->iCONFIG_CUSTOMER_PANEL_ID;;
#endif
}

unsigned char fwif_color_set_PIP_overlap_area_color_selection(unsigned char sel)
{
	return drvif_color_set_PIP_overlap_area_color_selection(sel);
}

void fwif_color_set_HDR_sub_en(unsigned char bEnable)
{
	drvif_color_set_HDR_sub_en(bEnable);
}

void fwif_color_HDR_sub_set422to444(unsigned char bEnable)
{
	drvif_color_HDR_sub_set422to444(bEnable);
}

void fwif_color_HDR_Sub_gamma_encode(unsigned int *final_R, unsigned int *final_G, unsigned int *final_B, UINT16 *Out_R, UINT16 *Out_G, UINT16 *Out_B)
{
	UINT16 i;
	UINT16 d0, d1;
	UINT8 d_max = 255;

	for (i = 0; i < Bin_Num_HDR2_Gamma-1; i++) {
		if (i % 2 == 0) {
			d0 = (Out_R[i + 1] >=  Out_R[i]) ? (Out_R[i + 1] - Out_R[i]) : 0;
			d1 = (Out_R[i + 2] >=  Out_R[i + 1]) ? (Out_R[i + 2] - Out_R[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_R[i / 2] = (Out_R[i] << 16) + (d0 << 8) + d1;

			d0 = (Out_G[i + 1] >=  Out_G[i]) ? (Out_G[i + 1] - Out_G[i]) : 0;
			d1 = (Out_G[i + 2] >=  Out_G[i + 1]) ? (Out_G[i + 2] - Out_G[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_G[i / 2] = (Out_G[i] << 16) + (d0 << 8) + d1;


			d0 = (Out_B[i + 1] >= Out_B[i]) ? (Out_B[i + 1] - Out_B[i]) : 0;
			d1 = (Out_B[i + 2] >= Out_B[i + 1]) ? (Out_B[i + 2] - Out_B[i + 1]) : 0;
			d0 = (d0 >=  d_max) ? d_max : d0;
			d1 = (d1 >=  d_max) ? d_max : d1;
			final_B[i / 2] = (Out_B[i] << 16) + (d0 << 8) + d1;

		}
	}

}

void fwif_color_set_HDR_Sub_Gamma1(unsigned char en, unsigned short *Gamma_R, unsigned short *Gamma_G,  unsigned short *Gamma_B)
{
	drvif_color_HDR_Sub_Gamma1_Enable( en );
	fwif_color_HDR_Sub_gamma_encode(final_HDR2_GAMMA_R, final_HDR2_GAMMA_G, final_HDR2_GAMMA_B, Gamma_R, Gamma_G, Gamma_B);
	drvif_color_HDR_Sub_write_Gamma1(final_HDR2_GAMMA_R, 0);
	drvif_color_HDR_Sub_write_Gamma1(final_HDR2_GAMMA_G, 1);
	drvif_color_HDR_Sub_write_Gamma1(final_HDR2_GAMMA_B, 2);
}

void fwif_color_set_HDR_Sub_Gamma2(unsigned char en, unsigned short *Gamma_R, unsigned short *Gamma_G,  unsigned short *Gamma_B)
{
	drvif_color_HDR_Sub_Gamma2_Enable( en );
	fwif_color_HDR_Sub_gamma_encode(final_HDR2_GAMMA_R, final_HDR2_GAMMA_G, final_HDR2_GAMMA_B, Gamma_R, Gamma_G, Gamma_B);
	drvif_color_HDR_Sub_write_Gamma2(final_HDR2_GAMMA_R, 0);
	drvif_color_HDR_Sub_write_Gamma2(final_HDR2_GAMMA_G, 1);
	drvif_color_HDR_Sub_write_Gamma2(final_HDR2_GAMMA_B, 2);
}

void fwif_color_HDR_sub_set_yuv2rgb(DRV_subHDR_YUV2RGB_CSMatrix *ptr)
{
/*init use bt2020, full->full*/
	drvif_color_subHDR_setYUV2RGB(ptr, subHDR_CSMatrix_YUV2RGB_Base_Ctrl);
	drvif_color_subHDR_setYUV2RGB(ptr, subHDR_CSMatrix_Coef);
	drvif_color_subHDR_setYUV2RGB(ptr, subHDR_CSMatrix_Offset_Only);
	drvif_color_subHDR_setYUV2RGB(ptr, subHDR_CSMatrix_Y_Clamp);
	drvif_color_subHDR_setYUV2RGB(ptr, subHDR_CSMatrix_Coef_BT2020_Only);
}


void fwif_color_HDR_sub_set_colorMap(DRV_Color_Mapping *ptr)
{
/*init disable hdr sub color map, full->full*/
	drvif_color_subHDR_set_Color_Mapping(ptr);
}

void bit_to_char_(char org_byte, char *rs)
{
	UINT8 i;
	for (i = 0; i < 8; i++)
		*(rs + i) = (org_byte & (1 << (7 - i))) ? '1' : '0';
}




void fwif_color_read_memc_logo(unsigned char start_byte)
{
	unsigned long outfileOffset = 0;
	unsigned long ddr_offset = 0;	/* de-garbage */
	extern unsigned int LD_size;
	extern unsigned char * LD_virAddr;


	ddr_offset = start_byte;


	linedata_memcLog[960] = '\n';

	if (LD_virAddr != NULL) {

		LD_virAddr = LD_virAddr + 0x5e0;
		outfileOffset = outfileOffset+ 0x5e0;

		while(outfileOffset < (LD_size - 0x520 )){
			unsigned int i = 0;
			while(i < 960){
				char rs[8];
				unsigned char j;
				bit_to_char_(*(LD_virAddr + ddr_offset), rs);
				for (j = 0; j < 8; j++){
					linedata_memcLog[i + j] = rs[j];
				}
				ddr_offset++;
				if( outfileOffset > (191*540 + 0x5e0)){
					printk("memc_idx[%d] = %d\n",i,linedata_memcLog[i]);
				}
				i = i + 8;
			}
			ddr_offset = ddr_offset + (192 - 120); /* garbage */

			outfileOffset = outfileOffset + 192;/*192 byte per line*/

		}

	}
	else {
		rtd_pr_vpq_info("read_memc_logo fail\n");
	}

	return;
}

void Scaler_Get_Logo_Detect_VirAddr(void)
{
#ifdef CONFIG_MEMC_NOTSUPPORT // for code size reduce, when MEMC_BYPASS
			return;
#else

	UINT32 phyAddr = 0;

	extern unsigned int LD_size;
	extern unsigned char * LD_virAddr;

	phyAddr = rtd_inl(KME_DM_TOP1_KME_DM_TOP1_48_reg); //phyAddr = 0x448b25e0
	rtd_pr_vpq_info("[%s] Get MEMC Logo PAddr = 0x%08x\n", __FUNCTION__, phyAddr);
	if (phyAddr == 0 || phyAddr == 0x00900000)
	{
		rtd_pr_vpq_info("[%s] Get PAddr error\n", __FUNCTION__);
		LD_virAddr = NULL;
		return;
	}

	phyAddr = phyAddr-4096;
	before_phyAddr = phyAddr;
	phyAddr = drvif_memory_get_data_align(phyAddr, (1 << 12));//juwen, delete 13 lines	/*448b25e0 -> 448b3000*/
	after_phyAddr = phyAddr;

	LD_size = drvif_memory_get_data_align((192 * 540), (1 << 12)); /* 192 bytes=960bit ==> 120byte + 72byte garbage */
	LD_virAddr = dvr_remap_uncached_memory(phyAddr, LD_size, __builtin_return_address(0));
	rtd_pr_vpq_info("SW_SLD,VAddr = %p, PA_reg=%x,PA_offset=%x,PA_aligned=%x,\n", 
		LD_virAddr, rtd_inl(KME_DM_TOP1_KME_DM_TOP1_48_reg), before_phyAddr, after_phyAddr);
#endif
}

void Scaler_Check_Logo_Detect_VirAddr(void)
{
#ifdef CONFIG_MEMC_NOTSUPPORT // for code size reduce, when MEMC_BYPASS
				return;
#else

	extern unsigned int LD_size;
	extern unsigned char * LD_virAddr;

	UINT32 phyAddr = 0;
	UINT32 remapPhyAddr = dvr_to_phys((void*)LD_virAddr);

	phyAddr = rtd_inl(KME_DM_TOP1_KME_DM_TOP1_48_reg);
	if( abs_value(remapPhyAddr - phyAddr) > 0xfff )
	{
		rtd_pr_vpq_info("[%s][ERROR] phyAddr = 0x%08x, remapPhyAddr = 0x%08x, do unmap and remap\n",
			__FUNCTION__, phyAddr, remapPhyAddr);
		dvr_unmap_memory(LD_virAddr, LD_size);
		LD_virAddr = NULL;
	}
#endif	
}

void fwif_color_Get_MEMC_Logo(void)
{
	static unsigned int count_frame = 0;

	Scaler_Get_Logo_Detect_VirAddr();
	if(count_frame %  10 == 0) {
		fwif_color_read_memc_logo(0);
		count_frame++;
	}
	printk("fwif_color_Get_MEMC_Logo\n");

	if(count_frame > 65535){
		count_frame = 65535;
	}

}

void fwif_color_set_ColorMap_3x3_Table(unsigned char idx)
{
	SLR_VIP_TABLE *pVipTable = fwif_colo_get_AP_vip_table_gVIP_Table();
	extern short ColorMap_Matrix_Apply[3][3];

	if (pVipTable == NULL)
		return;

	if(idx>=Color_Map_Table_NUM) {
		drvif_color_set_Color_Mapping_en(SLR_MAIN_DISPLAY, 0);
	} else {
		memcpy(ColorMap_Matrix_Apply, pVipTable->VIP_Color_Mapping_Matrix[idx], sizeof(ColorMap_Matrix_Apply));
		fwif_color_ColorMap_SetMatrix(SLR_MAIN_DISPLAY, ColorMap_Matrix_Apply, 1, 1);
	}
}

void fwif_color_ColorMap_SetMatrix(unsigned char display, short (*ColorMapMatrix)[3], unsigned char scale, unsigned char forceUpdate)
{
	extern short gColorGamutMatrix_Apply[3][3];
	static DRV_Color_Mapping CMTable;
	short ColorMapMatrix_2s_complement[3][3];
	signed short ii, jj;

	if (memcmp(gColorGamutMatrix_Apply, ColorMapMatrix, sizeof(gColorGamutMatrix_Apply)) == 0 && !forceUpdate)
		return;
	memcpy(gColorGamutMatrix_Apply, ColorMapMatrix, sizeof(gColorGamutMatrix_Apply));

	/*here have to do software clip*/

	CMTable.Color_Mapping_En=1;
	CMTable.CM_InOffset.XOffset=0;
	CMTable.CM_InOffset.YOffset=0;
	CMTable.CM_InOffset.ZOffset=0;

	CMTable.CM_OutOffset.ROffset=0;
	CMTable.CM_OutOffset.GOffset=0;
	CMTable.CM_OutOffset.BOffset=0;


	//-----------------------------------------------------------------------------------------------
	/*juwen, k5lp, for tv006 : LG K5LP only*/
	for(ii = 0;ii < 3; ii++){
		for(jj = 0;  jj < 3; jj++){
			ColorMapMatrix_2s_complement[ii][jj] = gColorGamutMatrix_Apply[ii][jj] * scale;
			if(ColorMapMatrix_2s_complement[ii][jj]  > 8191){
				ColorMapMatrix_2s_complement[ii][jj] = 8191 ;
			}
			else if(ColorMapMatrix_2s_complement[ii][jj]  < -8192){
				ColorMapMatrix_2s_complement[ii][jj] = -8192 ;
			}
		}
	}

	/*juwen, k5lp, for tv006 : LG K5LP only, 2'S complement*/
	CMTable.CM_Data.K11=ColorMapMatrix_2s_complement[0][0];
	CMTable.CM_Data.K12=ColorMapMatrix_2s_complement[0][1];
	CMTable.CM_Data.K13=ColorMapMatrix_2s_complement[0][2];
	CMTable.CM_Data.K21=ColorMapMatrix_2s_complement[1][0];
	CMTable.CM_Data.K22=ColorMapMatrix_2s_complement[1][1];
	CMTable.CM_Data.K23=ColorMapMatrix_2s_complement[1][2];
	CMTable.CM_Data.K31=ColorMapMatrix_2s_complement[2][0];
	CMTable.CM_Data.K32=ColorMapMatrix_2s_complement[2][1];
	CMTable.CM_Data.K33=ColorMapMatrix_2s_complement[2][2];
	//-----------------------------------------------------------------------------------------------

	if (!drvif_scalerdisplay_get_force_bg_status() && Scaler_DispGetInputInfoByDisp(SLR_MAIN_DISPLAY, SLR_INPUT_STATE) == _MODE_STATE_ACTIVE) {
		fwif_color_WaitFor_SYNC_START_UZUDTG();
	}
	drvif_color_set_Color_Mapping(display,(DRV_Color_Mapping *)&CMTable);
}

unsigned char fwif_get_colorspaceInfo(void)
{
	SLR_VOINFO* pVOInfo = NULL;
	HDMI_AVI_T pAviInfo;
	//unsigned char input_src_form=0;
	COLORSPACE_ITEM isColorSpaceIndex=is709;
	_system_setting_info *VIP_system_info_structure_table=NULL;

	//SrcType=Scaler_InputSrcGetMainChType();
	drvif_Hdmi_GetAviInfoFrame(&pAviInfo); //pAviInfo size = 16 bytes
	pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());
	VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);

	/*
	if (fwif_color_get_force_run_i3ddma_enable(SLR_MAIN_DISPLAY) && (Get_DisplayMode_Src(SLR_MAIN_DISPLAY) != VSC_INPUTSRC_VDEC)) {
		fwif_color_vsc_to_scaler_src_mapping(Get_DisplayMode_Src(SLR_MAIN_DISPLAY), &SrcType, &input_src_form);
		//printk("tim_li,i3ddma_enable,SrcType==%d \n",SrcType);
	}
	*/

	if(VIP_system_info_structure_table->Input_src_Type==_SRC_HDMI /*SrcType==_SRC_HDMI*/)
	{
		if(pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_SMPTE170)	//601
			isColorSpaceIndex=is601;
		else if(pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_ITU709) //709
			isColorSpaceIndex=is709;
		else if(pAviInfo.C == VFE_HDMI_AVI_COLORIMETRY_FUTURE)
		{
			if(pAviInfo.EC == 5 || pAviInfo.EC == 6)//bt2020
				isColorSpaceIndex=isBT2020;
			else if(pAviInfo.EC ==1)//709
				isColorSpaceIndex=is709;
			else if(pAviInfo.EC ==0)//601
				isColorSpaceIndex=is601;
			else if(VIP_system_info_structure_table ->HDR_flag && (VIP_system_info_structure_table ->HDR_flag != HAL_VPQ_HDR_MODE_SDR_MAX_RGB))
				isColorSpaceIndex=isBT2020;
			else //709
				isColorSpaceIndex=is709;
		}
		else if(VIP_system_info_structure_table ->HDR_flag &&(VIP_system_info_structure_table ->HDR_flag != HAL_VPQ_HDR_MODE_SDR_MAX_RGB))
			isColorSpaceIndex=isBT2020;
		else //709
			isColorSpaceIndex=is709;
	}
	else if(VIP_system_info_structure_table->Input_src_Type==_SRC_VO /*SrcType==_SRC_VO*/)
	{
		if ((pVOInfo->colour_primaries == 9 || VIP_system_info_structure_table ->HDR_flag) && (VIP_system_info_structure_table ->HDR_flag != HAL_VPQ_HDR_MODE_SDR_MAX_RGB))	/* bt2020*/
			isColorSpaceIndex=isBT2020;
		else
			isColorSpaceIndex=is709;
	}
	else//709
		isColorSpaceIndex=is709;

	//printk("tim_li,srctype=%d,pAviInfo.C=%d,pAviInfo.EC=%d \n",VIP_system_info_structure_table->Input_src_Type,pAviInfo.C,pAviInfo.EC);
	//printk("isColorSpaceIndex=%d,isBT2020=%d,is709=%d,is601=%d\n",isColorSpaceIndex,isBT2020,is709,is601);

	return (COLORSPACE_ITEM) isColorSpaceIndex;
}

void fwif_color_set_sRGBMatrix(void)
{
	extern short BT2020Target_sRGB_APPLY[3][3];
	extern short BT709Target_sRGB_APPLY[3][3];
	extern short DCIP3Target_sRGB_APPLY[3][3];
	extern short ADOBERGBTarget_sRGB_APPLY[3][3];
	extern unsigned char g_srgbForceUpdate;
	COLORSPACE_ITEM isColorSpaceIndex=is709;
	unsigned char isDCIP3=0;
	SLR_VOINFO* pVOInfo = NULL;

	_system_setting_info *VIP_system_info_structure_table=NULL;
	VIP_system_info_structure_table = (_system_setting_info*)Scaler_GetShareMemVirAddr(SCALERIOC_VIP_system_info_structure);
	pVOInfo = Scaler_VOInfoPointer(Scaler_Get_CurVoInfo_plane());

	isColorSpaceIndex=fwif_get_colorspaceInfo();

	if(VIP_system_info_structure_table ->HDR_flag==1){
		HDMI_DRM_T DRM_Info;
		drvif_Hdmi_GetDrmInfoFrame(&DRM_Info);

		#if 0//for debug
		printk("x0=%d,y0=%d\n",DRM_Info.display_primaries_x0,DRM_Info.display_primaries_y0);
		printk("x1=%d,y1=%d\n",DRM_Info.display_primaries_x1,DRM_Info.display_primaries_y1);
		printk("x2=%d,y2=%d\n",DRM_Info.display_primaries_x2,DRM_Info.display_primaries_y2);
		#endif

		if( (DRM_Info.display_primaries_x0 == 13250)&&(DRM_Info.display_primaries_y0 == 34500)
			&&(DRM_Info.display_primaries_x1 ==7500)&&(DRM_Info.display_primaries_y1 == 3000)
			&&(DRM_Info.display_primaries_x2== 34000)&&(DRM_Info.display_primaries_y2 == 16000))	/* DCIP3*/
			isDCIP3 = 1;
		else
			isDCIP3 = 0;
	}
	else
		isDCIP3 = 0;

	printk("fwif_color_set_sRGBMatrix adobe=%d\n",pVOInfo->isAdobeRGB);
	if(isColorSpaceIndex==isBT2020)
	{	printk("isBT2020\n");
		fwif_color_ColorMap_SetMatrix(SLR_MAIN_DISPLAY, BT2020Target_sRGB_APPLY, 2, g_srgbForceUpdate);
	}else if(pVOInfo->isAdobeRGB)
	{	printk("isAdobeRGB\n");
		fwif_color_ColorMap_SetMatrix(SLR_MAIN_DISPLAY, ADOBERGBTarget_sRGB_APPLY, 2, g_srgbForceUpdate);
	}
	else if(isDCIP3 ==1)
	{	printk("isDCIP3\n");
		fwif_color_ColorMap_SetMatrix(SLR_MAIN_DISPLAY, DCIP3Target_sRGB_APPLY, 2, g_srgbForceUpdate);
	}
	else if(isColorSpaceIndex == is709)
	{	printk("is709\n");
		fwif_color_ColorMap_SetMatrix(SLR_MAIN_DISPLAY, BT709Target_sRGB_APPLY, 2, g_srgbForceUpdate);
	}
	else
	{	printk("the others 709\n");
		fwif_color_ColorMap_SetMatrix(SLR_MAIN_DISPLAY, BT709Target_sRGB_APPLY, 2, g_srgbForceUpdate);
	}
}

void fwif_color_set_color_mapping_enable(unsigned char display, unsigned char enable)
{
	drvif_color_set_Color_Mapping_Enable(display, enable);
}

void fwif_color_cpy_D_3DLUT_TBL(void)
{
	extern int D_3DLUT_999_Reseult[VIP_D_3DLUT_999_SIZE][VIP_8VERTEX_RGB_MAX];

	memcpy(vip_8vertex_temp, D_3DLUT_999_Reseult, VIP_D_3DLUT_999_SIZE * VIP_8VERTEX_RGB_MAX * sizeof(UINT32));
	rtice_Set_D_LUT_9to17(vip_8vertex_temp);
	fwif_color_WaitFor_DEN_STOP_UZUDTG();
	fwif_color_set_D_3dLUT(255, vip_8vertex_temp);

}

void fwif_color_set_gamma_Magic(void)
{
	extern unsigned char ColorSpaceMode;
	unsigned char GammaBlendingFlag;
	//int i=0;
	unsigned char display = 0;
	unsigned char src_idx = 0;
	Scaler_Get_Display_info(&display, &src_idx);

	if((ColorSpaceMode==0)||(ColorSpaceMode==2))
		GammaBlendingFlag =1;
	else
		GammaBlendingFlag =0;

	if(GammaBlendingFlag==1){
		fwif_color_WaitFor_DEN_STOP_UZUDTG();
		drvif_color_inv_gamma_enable(SLR_MAIN_DISPLAY, 1, 0);
	}
	else{
		fwif_color_WaitFor_DEN_STOP_UZUDTG();
		drvif_color_inv_gamma_enable(SLR_MAIN_DISPLAY, 0, 0);
	}

	printk(" gamma, yuan,set Gamma Main function\n");
	printk("gamma,GammaBlendingFlag=%d\n",GammaBlendingFlag);
	//printk("yuan,GammaBlendingFlag=%d\n",GammaBlendingFlag);
	//printk("yuan,GammaBlendOETF=%d\n",GammaBlendOETF);

	down(&Gamma_Semaphore);
	/*0. gamma curve reg control*/
	fwif_color_gamma_control_front(display);

	/*1. choose encode gamma data*/
	fwif_color_set_gamma_curve_index(GAMMA_CURVE_identity, &tGAMMA_temp_R, &tGAMMA_temp_G, &tGAMMA_temp_B);

	/*2. decode gamma data to gamma curve*/
	fwif_color_gamma_decode(GOut_R, GOut_G, GOut_B, tGAMMA_temp_R, tGAMMA_temp_G, tGAMMA_temp_B);
	/*fwif_color_decode_gamma_debug(1);*/	/*debug*/

	/*3. 20points*/
	if(GammaBlendingFlag==1){
		//if(GammaBlendOETF==1){
			fwif_set_gamma_multiply_remapOETF(SDR_GOut_R, SDR_GOut_G, SDR_GOut_B, GOut_R, GOut_G, GOut_B);
			fwif_set_gamma_multiply_remap(HDR_GOut_R, HDR_GOut_G, HDR_GOut_B, SDR_GOut_R, SDR_GOut_G, SDR_GOut_B);
		//}
		//else
		//fwif_set_gamma_multiply_remap(HDR_GOut_R, HDR_GOut_G, HDR_GOut_B, GOut_R, GOut_G, GOut_B);

		/*4. Gain Offset*/
		//fwif_color_set_GainOffsetGamma(HDR_GOut_R, HDR_GOut_G, HDR_GOut_B);
		/*5. gamma curve data protect and debug*/
		fwif_color_gamma_curve_data_protect(HDR_GOut_R, HDR_GOut_G, HDR_GOut_B);	/*DO NOT mark this, must check*/
		fwif_color_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B, HDR_GOut_R, HDR_GOut_G, HDR_GOut_B);
	}else{
		fwif_set_gamma_multiply_remapOETF(SDR_GOut_R, SDR_GOut_G, SDR_GOut_B, GOut_R, GOut_G, GOut_B);
		/*4. Gain Offset*/
		//fwif_color_set_GainOffsetGamma(SDR_GOut_R, SDR_GOut_G, SDR_GOut_B);
		/*5. gamma curve data protect and debug*/
		fwif_color_gamma_curve_data_protect(SDR_GOut_R, SDR_GOut_G, SDR_GOut_B);		/*DO NOT mark this, must check*/
		fwif_color_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B, SDR_GOut_R, SDR_GOut_G, SDR_GOut_B);
	}

	/*7. write gamma table*/
	fwif_color_set_gamma_encode(final_GAMMA_R, final_GAMMA_G, final_GAMMA_B);
	fwif_color_gamma_control_back(display, 1);
	GammaBlendingFlag =0;
	//GammaBlendOETF =0;

	up(&Gamma_Semaphore);
}

void fwif_color_set_gamma_curve_index(unsigned char gamma_level, unsigned int **In_R, unsigned int **In_G, unsigned int **In_B)
{
	SLR_VIP_TABLE *gVip_Table = fwif_colo_get_AP_vip_table_gVIP_Table();
	unsigned char l_gamma_level;
	if (gVip_Table == NULL) {
		VIPprintf("~get vipTable Error return, %s->%d, %s~\n", __FILE__, __LINE__, __FUNCTION__);
		return;
	}
	l_gamma_level = gamma_level;
	rtd_pr_vpq_debug("Scaler_color_get_gamma_default, l_gamma_level = = %d\n",l_gamma_level);
	if(GammaEnable ==1){
		switch (l_gamma_level) {
		case GAMMA_CURVE_0:
				*In_R = gVip_Table->tGAMMA[0].R;
				*In_G = gVip_Table->tGAMMA[0].G;
				*In_B = gVip_Table->tGAMMA[0].B;
				break;
		case GAMMA_CURVE_1:
				*In_R = gVip_Table->tGAMMA[1].R;
				*In_G = gVip_Table->tGAMMA[1].G;
				*In_B = gVip_Table->tGAMMA[1].B;
				break;
		case GAMMA_CURVE_2:
				*In_R = gVip_Table->tGAMMA[2].R;
				*In_G = gVip_Table->tGAMMA[2].G;
				*In_B = gVip_Table->tGAMMA[2].B;
				break;
		case GAMMA_CURVE_3:
				*In_R = gVip_Table->tGAMMA[3].R;
				*In_G = gVip_Table->tGAMMA[3].G;
				*In_B = gVip_Table->tGAMMA[3].B;
				break;
		case GAMMA_CURVE_4:
				*In_R = gVip_Table->tGAMMA[4].R;
				*In_G = gVip_Table->tGAMMA[4].G;
				*In_B = gVip_Table->tGAMMA[4].B;
				break;
		case GAMMA_CURVE_5:
				*In_R = gVip_Table->tGAMMA[5].R;
				*In_G = gVip_Table->tGAMMA[5].G;
				*In_B = gVip_Table->tGAMMA[5].B;
				break;
		case GAMMA_CURVE_6:
				*In_R = gVip_Table->tGAMMA[6].R;
				*In_G = gVip_Table->tGAMMA[6].G;
				*In_B = gVip_Table->tGAMMA[6].B;
				break;
		case GAMMA_CURVE_7:
				*In_R = gVip_Table->tGAMMA[7].R;
				*In_G = gVip_Table->tGAMMA[7].G;
				*In_B = gVip_Table->tGAMMA[7].B;
				break;
		case GAMMA_CURVE_8:
				*In_R = gVip_Table->tGAMMA[8].R;
				*In_G = gVip_Table->tGAMMA[8].G;
				*In_B = gVip_Table->tGAMMA[8].B;
				break;
		case GAMMA_CURVE_9:
				*In_R = gVip_Table->tGAMMA[9].R;
				*In_G = gVip_Table->tGAMMA[9].G;
				*In_B = gVip_Table->tGAMMA[9].B;
				break;
		case GAMMA_CURVE_identity:
		default:
				*In_R = Identity_Gamma;
				*In_G = Identity_Gamma;
				*In_B = Identity_Gamma;
				break;
		}
	}else{
			*In_R = Identity_Gamma;
			*In_G = Identity_Gamma;
			*In_B = Identity_Gamma;
	}
}

void fwif_set_gamma_multiply_remapOETF(UINT16 *final_R, UINT16 *final_G, UINT16 *final_B, UINT16 *Out_R, UINT16 *Out_G, UINT16 *Out_B)
{
	int i, j, hdiff, qdiff;
	extern unsigned short g_GammaRemap[4097];
	extern unsigned short OEFT2Gamma[1025];

	if ((NULL == Out_R)||(NULL == Out_G)||(NULL == Out_B))
		return;

	// R
	for (i = 0, j = 0; i < 4096; i+=4, j++) {
		g_GammaRemap[i] = Out_R[j];// << 2;
	}
	g_GammaRemap[4096] = (Out_R[1023] ) + (Out_R[1023] >> 8);

	for (i = 0; i < 4096; i+=4) {
		hdiff = (g_GammaRemap[i+4]-g_GammaRemap[i])>>1;
		qdiff = hdiff>>1;
		g_GammaRemap[i+1] = g_GammaRemap[i]+qdiff;
		g_GammaRemap[i+2] = g_GammaRemap[i]+hdiff;
		g_GammaRemap[i+3] = g_GammaRemap[i+2]+qdiff;
	}

	for (i = 0; i < 1025; i++) {
		final_R[i] = g_GammaRemap[OEFT2Gamma[i]];
	}

				#if 0//for debug
				for(i=0;i<20;i++){
					printk("yuan,1.Out_R[%d]=%d\n",i,Out_R[i]);
				for(i=0;i<10;i++)
					printk("yuan,GammaRemap[%d]=%d\n",i,g_GammaRemap[i]);
				for(i=0;i<10;i++)
					printk("yuan,hdiff[%d]=%d\n",i,(g_GammaRemap[i+4]-g_GammaRemap[i])>>1);
				for(i=0;i<10;i++)
					printk("yuan,qdiff[%d]=%d\n",i,((g_GammaRemap[i+4]-g_GammaRemap[i])>>1)>>1);
				for(i=0;i<10;i++)
					printk("yuan,1.final_R[%d]=%d\n",OEFT2Gamma[i],final_R[i]);
					}


				for(i=1010;i<1024;i++){
					printk("yuan,1.Out_R[%d]=%d\n",i,Out_R[i]);
				for(i=0;i<10;i++)
					printk("yuan,GammaRemap[%d]=%d\n",i,g_GammaRemap[i]);
				for(i=0;i<10;i++)
					printk("yuan,hdiff[%d]=%d\n",i,(g_GammaRemap[i+4]-g_GammaRemap[i])>>1);
				for(i=0;i<10;i++)
					printk("yuan,qdiff[%d]=%d\n",i,((g_GammaRemap[i+4]-g_GammaRemap[i])>>1)>>1);
				for(i=0;i<10;i++)
					printk("yuan,1.final_R[%d]=%d\n",OEFT2Gamma[i],final_R[i]);
					}
				#endif

	// G
	for (i = 0, j = 0; i < 4096; i+=4, j++) {
		g_GammaRemap[i] = Out_G[j];// << 2;
	}
	g_GammaRemap[4096] = (Out_G[1023]) + (Out_G[1023] >> 8);

	for (i = 0; i < 4096; i+=4) {
		hdiff = (g_GammaRemap[i+4]-g_GammaRemap[i])>>1;
		qdiff = hdiff>>1;
		g_GammaRemap[i+1] = g_GammaRemap[i]+qdiff;
		g_GammaRemap[i+2] = g_GammaRemap[i]+hdiff;
		g_GammaRemap[i+3] = g_GammaRemap[i+2]+qdiff;
	}

	for (i = 0; i < 1025; i++) {
		final_G[i] = g_GammaRemap[OEFT2Gamma[i]];
	}



	// B
	for (i = 0, j = 0; i < 4096; i+=4, j++) {
		g_GammaRemap[i] = Out_B[j];// << 2;
	}
	g_GammaRemap[4096] = (Out_B[1023]) + (Out_B[1023] >> 8);

	for (i = 0; i < 4096; i+=4) {
		hdiff = (g_GammaRemap[i+4]-g_GammaRemap[i])>>1;
		qdiff = hdiff>>1;
		g_GammaRemap[i+1] = g_GammaRemap[i]+qdiff;
		g_GammaRemap[i+2] = g_GammaRemap[i]+hdiff;
		g_GammaRemap[i+3] = g_GammaRemap[i+2]+qdiff;
	}


	for (i = 0; i < 1025; i++) {
		final_B[i] = g_GammaRemap[OEFT2Gamma[i]];
	}
				#if 0//for debug
				for(i=0;i<20;i++){
					printk("yuan,Out_B[%d]=%d\n",i,Out_B[i]);
				for(i=0;i<10;i++)
					printk("yuan,GammaRemap[%d]=%d\n",i,g_GammaRemap[i]);
				for(i=0;i<10;i++)
					printk("yuan,hdiff[%d]=%d\n",i,(g_GammaRemap[i+4]-g_GammaRemap[i])>>1);
				for(i=0;i<10;i++)
					printk("yuan,qdiff[%d]=%d\n",i,((g_GammaRemap[i+4]-g_GammaRemap[i])>>1)>>1);
				for(i=0;i<10;i++)
					printk("yuan,final_B[%d]=%d\n",OEFT2Gamma[i],final_B[i]);
					}
				for(i=1010;i<1024;i++){
					printk("yuan,Out_B[%d]=%d\n",i,Out_B[i]);
				for(i=0;i<10;i++)
					printk("yuan,GammaRemap[%d]=%d\n",i,g_GammaRemap[i]);
				for(i=0;i<10;i++)
					printk("yuan,hdiff[%d]=%d\n",i,(g_GammaRemap[i+4]-g_GammaRemap[i])>>1);
				for(i=0;i<10;i++)
					printk("yuan,qdiff[%d]=%d\n",i,((g_GammaRemap[i+4]-g_GammaRemap[i])>>1)>>1);
				for(i=0;i<10;i++)
					printk("yuan,final_B[%d]=%d\n",OEFT2Gamma[i],final_B[i]);
					}
				#endif
}

void fwif_set_gamma_multiply_remap(UINT16 *final_R, UINT16 *final_G, UINT16 *final_B, UINT16 *Out_R, UINT16 *Out_G, UINT16 *Out_B)
{
	int i, j, hdiff, qdiff;
	extern unsigned short g_GammaRemap[4097];
	extern unsigned short Power1div22Gamma[1025];

	if ((NULL == Out_R)||(NULL == Out_G)||(NULL == Out_B))
		return;

	// R
	for (i = 0, j = 0; i < 4096; i+=4, j++) {
		g_GammaRemap[i] = Out_R[j];// << 2;
	}
	g_GammaRemap[4096] = (Out_R[1023] ) + (Out_R[1023] >> 8);

	for (i = 0; i < 4096; i+=4) {
		hdiff = (g_GammaRemap[i+4]-g_GammaRemap[i])>>1;
		qdiff = hdiff>>1;
		g_GammaRemap[i+1] = g_GammaRemap[i]+qdiff;
		g_GammaRemap[i+2] = g_GammaRemap[i]+hdiff;
		g_GammaRemap[i+3] = g_GammaRemap[i+2]+qdiff;
	}

	for (i = 0; i < 1025; i++) {
		final_R[i] = g_GammaRemap[Power1div22Gamma[i]];
	}

				#if 0//for debug
				for(i=0;i<20;i++){
					printk("yuan,1.Out_R[%d]=%d\n",i,Out_R[i]);
				for(i=0;i<10;i++)
					printk("yuan,GammaRemap[%d]=%d\n",i,g_GammaRemap[i]);
				for(i=0;i<10;i++)
					printk("yuan,hdiff[%d]=%d\n",i,(g_GammaRemap[i+4]-g_GammaRemap[i])>>1);
				for(i=0;i<10;i++)
					printk("yuan,qdiff[%d]=%d\n",i,((g_GammaRemap[i+4]-g_GammaRemap[i])>>1)>>1);
				for(i=0;i<10;i++)
					printk("yuan,1.final_R[%d]=%d\n",Power1div22Gamma[i],final_R[i]);
					}


				for(i=1010;i<1024;i++){
					printk("yuan,1.Out_R[%d]=%d\n",i,Out_R[i]);
				for(i=0;i<10;i++)
					printk("yuan,GammaRemap[%d]=%d\n",i,g_GammaRemap[i]);
				for(i=0;i<10;i++)
					printk("yuan,hdiff[%d]=%d\n",i,(g_GammaRemap[i+4]-g_GammaRemap[i])>>1);
				for(i=0;i<10;i++)
					printk("yuan,qdiff[%d]=%d\n",i,((g_GammaRemap[i+4]-g_GammaRemap[i])>>1)>>1);
				for(i=0;i<10;i++)
					printk("yuan,1.final_R[%d]=%d\n",Power1div22Gamma[i],final_R[i]);
					}
				#endif

	// G
	for (i = 0, j = 0; i < 4096; i+=4, j++) {
		g_GammaRemap[i] = Out_G[j];// << 2;
	}
	g_GammaRemap[4096] = (Out_G[1023]) + (Out_G[1023] >> 8);

	for (i = 0; i < 4096; i+=4) {
		hdiff = (g_GammaRemap[i+4]-g_GammaRemap[i])>>1;
		qdiff = hdiff>>1;
		g_GammaRemap[i+1] = g_GammaRemap[i]+qdiff;
		g_GammaRemap[i+2] = g_GammaRemap[i]+hdiff;
		g_GammaRemap[i+3] = g_GammaRemap[i+2]+qdiff;
	}

	for (i = 0; i < 1025; i++) {
		final_G[i] = g_GammaRemap[Power1div22Gamma[i]];
	}



	// B
	for (i = 0, j = 0; i < 4096; i+=4, j++) {
		g_GammaRemap[i] = Out_B[j];// << 2;
	}
	g_GammaRemap[4096] = (Out_B[1023]) + (Out_B[1023] >> 8);

	for (i = 0; i < 4096; i+=4) {
		hdiff = (g_GammaRemap[i+4]-g_GammaRemap[i])>>1;
		qdiff = hdiff>>1;
		g_GammaRemap[i+1] = g_GammaRemap[i]+qdiff;
		g_GammaRemap[i+2] = g_GammaRemap[i]+hdiff;
		g_GammaRemap[i+3] = g_GammaRemap[i+2]+qdiff;
	}


	for (i = 0; i < 1025; i++) {
		final_B[i] = g_GammaRemap[Power1div22Gamma[i]];
	}
				#if 0//for debug
				for(i=0;i<20;i++){
					printk("yuan,Out_B[%d]=%d\n",i,Out_B[i]);
				for(i=0;i<10;i++)
					printk("yuan,GammaRemap[%d]=%d\n",i,g_GammaRemap[i]);
				for(i=0;i<10;i++)
					printk("yuan,hdiff[%d]=%d\n",i,(g_GammaRemap[i+4]-g_GammaRemap[i])>>1);
				for(i=0;i<10;i++)
					printk("yuan,qdiff[%d]=%d\n",i,((g_GammaRemap[i+4]-g_GammaRemap[i])>>1)>>1);
				for(i=0;i<10;i++)
					printk("yuan,final_B[%d]=%d\n",Power1div22Gamma[i],final_B[i]);
					}
				for(i=1010;i<1024;i++){
					printk("yuan,Out_B[%d]=%d\n",i,Out_B[i]);
				for(i=0;i<10;i++)
					printk("yuan,GammaRemap[%d]=%d\n",i,g_GammaRemap[i]);
				for(i=0;i<10;i++)
					printk("yuan,hdiff[%d]=%d\n",i,(g_GammaRemap[i+4]-g_GammaRemap[i])>>1);
				for(i=0;i<10;i++)
					printk("yuan,qdiff[%d]=%d\n",i,((g_GammaRemap[i+4]-g_GammaRemap[i])>>1)>>1);
				for(i=0;i<10;i++)
					printk("yuan,final_B[%d]=%d\n",Power1div22Gamma[i],final_B[i]);
					}
				#endif
}

void fwif_color_set_GainOffsetGamma(UINT16 *GOut_R, UINT16 *GOut_G, UINT16 *GOut_B)
{
	UINT16 Red_Gain,Green_Gain,Blue_Gain;
	UINT16 Red_Offset,Green_Offset,Blue_Offset;
	unsigned int i=0;
	SINT16 *Gamma_R,*Gamma_B,*Gamma_G;

	con_bri_dm_contrast_a_RBUS		dm_contrast_a_REG;
	con_bri_dm_brightness_1_RBUS		dm_brightness_1_REG;
	dm_brightness_1_REG.regValue	= IoReg_Read32(CON_BRI_DM_Brightness_1_reg);
	dm_contrast_a_REG.regValue	= IoReg_Read32(CON_BRI_DM_CONTRAST_A_reg);

	Red_Gain		=dm_contrast_a_REG.m_con_a_r;
	Green_Gain		=dm_contrast_a_REG.m_con_a_g;
	Blue_Gain		=dm_contrast_a_REG.m_con_a_b	;

	Red_Offset		=dm_brightness_1_REG.m_bri1_r;
	Green_Offset		=dm_brightness_1_REG.m_bri1_g;
	Blue_Offset		=dm_brightness_1_REG.m_bri1_b;

	Gamma_R = (SINT16*)GOut_R;
	Gamma_G = (SINT16*)GOut_G;
	Gamma_B = (SINT16*)GOut_B;

			#if 0 //for debug
			printk("Red_Gain=%d,Green_Gain=%d,Blue_Gain=%d\n",Red_Gain,Green_Gain,Blue_Gain);
			printk("Red_Offset=%d,Green_Offset=%d,Blue_Offset=%d\n",Red_Offset,Green_Offset,Blue_Offset);
			printk("============================================================\n");
			printk("Ori_GOut_R[0] = %d, GOut_G[0] = %d, GOut_B[0] = %d\n",GOut_R[0],GOut_G[0],GOut_B[0]);
			printk("Ori_GOut_R[512] = %d, GOut_G[512] = %d, GOut_B[512] = %d\n",GOut_R[512],GOut_G[512],GOut_B[512]);
			printk("Ori_GOut_R[1020] = %d, GOut_G[1020] = %d, GOut_B[1020] = %d\n",GOut_R[1020],GOut_G[1020],GOut_B[1020]);
			printk("Ori_GOut_R[1023] = %d, GOut_G[1023] = %d, GOut_B[1023] = %d\n",GOut_R[1023],GOut_G[1023],GOut_B[1023]);
			printk("Ori_GOut_R[1024] = %d, GOut_G[1024] = %d, GOut_B[1024] = %d\n",GOut_R[1024],GOut_G[1024],GOut_B[1024]);
			#endif

	for(i=0;i<(Bin_Num_Gamma);i++){

		Gamma_R[i] = (Gamma_R[i]*Red_Gain)>>9;
		Gamma_G[i] = (Gamma_G[i]*Green_Gain)>>9;
		Gamma_B[i] = (Gamma_B[i]*Blue_Gain)>>9;
	}
			#if 0
			printk("============================================================\n");
			printk("GOut_R[0] = %d, Gamma_G[0] = %d, Gamma_B[0] = %d\n",Gamma_R[0],Gamma_G[0],Gamma_B[0]);
			printk("GOut_R[512] = %d, Gamma_G[512] = %d, Gamma_B[512] = %d\n",Gamma_R[512],Gamma_G[512],Gamma_B[512]);
			printk("GOut_R[1020] = %d, Gamma_G[1020] = %d, Gamma_B[1020] = %d\n",Gamma_R[1020],Gamma_G[1020],Gamma_B[1020]);
			printk("GOut_R[1023] = %d, Gamma_G[1023] = %d, Gamma_B[1023] = %d\n",Gamma_R[1023],Gamma_G[1023],Gamma_B[1023]);
			printk("GOut_R[1024] = %d, Gamma_G[1024] = %d, Gamma_B[1024] = %d\n",Gamma_R[1024],Gamma_G[1024],Gamma_B[1024]);
			#endif

	for(i=0;i<(Bin_Num_Gamma);i++){
		Gamma_R[i] = Gamma_R[i]+Red_Offset-512;
		Gamma_G[i] = Gamma_G[i]+Green_Offset-512;
		Gamma_B[i] = Gamma_B[i]+Blue_Offset-512;
	}

for(i=0;i<(Bin_Num_Gamma);i++){
	if (Gamma_R[i] < 0)
				Gamma_R[i] = 0;
	if (Gamma_G[i] < 0)
				Gamma_G[i] = 0;
	if (Gamma_B[i] < 0)
				Gamma_B[i] = 0;
}
#if 0 //H Rim
unsigned short* fwif_color_Get_APL(void)
{
	return &LC_APL[0];
}
#endif
for(i=0;i<(Bin_Num_Gamma);i++){
	if (Gamma_R[i] > 8192)
				Gamma_R[i] = 8192;
	if (Gamma_G[i] > 8192)
				Gamma_G[i] = 8192;
	if (Gamma_B[i] > 8192)
				Gamma_B[i] = 8192;
}

	//data protect
	Gamma_R[0]=0;
	Gamma_G[0]=0;
	Gamma_B[0]=0;
	Gamma_R[Bin_Num_Gamma] = Gamma_R[Bin_Num_Gamma - 1];
	Gamma_G[Bin_Num_Gamma] = Gamma_G[Bin_Num_Gamma - 1];
	Gamma_B[Bin_Num_Gamma] = Gamma_B[Bin_Num_Gamma - 1];

			#if 0
			printk("============================================================\n");
			printk("O_GOut_R[0] = %d, Gamma_G[0] = %d, Gamma_B[0] = %d\n",Gamma_R[0],Gamma_G[0],Gamma_B[0]);
			printk("O_GOut_R[512] = %d, Gamma_G[512] = %d, Gamma_B[512] = %d\n",Gamma_R[512],Gamma_G[512],Gamma_B[512]);
			printk("O_GOut_R[1020] = %d, Gamma_G[1020] = %d, Gamma_B[1020] = %d\n",Gamma_R[1020],Gamma_G[1020],Gamma_B[1020]);
			printk("O_GOut_R[1023] = %d, Gamma_G[1023] = %d, Gamma_B[1023] = %d\n",Gamma_R[1023],Gamma_G[1023],Gamma_B[1023]);
			printk("O_GOut_R[1024] = %d, Gamma_G[1024] = %d, Gamma_B[1024] = %d\n",Gamma_R[1024],Gamma_G[1024],Gamma_B[1024]);
			#endif
}

void fwif_color_set_frequency_detection(unsigned char idx)
{
	extern DRV_FreqDet_Ctrl_t FreqDet_TBL[t_FreqDetection_MAX];

	if( idx >= t_FreqDetection_MAX  )
		idx = t_FreqDetection_MAX-1;

	drvif_color_set_frequency_detection_enable(FreqDet_TBL[idx].Enable);
	drvif_color_set_set_frequency_detection_region(&FreqDet_TBL[idx].RgnCtrl);
	drvif_color_set_set_frequency_detection_filter(&FreqDet_TBL[idx].Tap21, _FD_FLT_TAP21_);
	drvif_color_set_set_frequency_detection_filter(&FreqDet_TBL[idx].Tap15[0], _FD_FLT_TAP15_1);
	drvif_color_set_set_frequency_detection_filter(&FreqDet_TBL[idx].Tap15[1], _FD_FLT_TAP15_2);
	drvif_color_set_set_frequency_detection_filter(&FreqDet_TBL[idx].Tap15[2], _FD_FLT_TAP15_3);
}

void fwif_color_get_LC_Hist_dat(unsigned int *plc_out)
{
	 drvif_color_get_LC_Histogram(plc_out);
}

void fwif_color_set_color_temp(unsigned char enable, unsigned short Red_Con, unsigned short Green_Con, unsigned short Blue_Con, short Red_Bri, short Green_Bri, short Blue_Bri, unsigned char waitSync)
{
	if (waitSync)
		fwif_color_WaitFor_SYNC_START_UZUDTG();
	drvif_color_set_color_temp(enable, Red_Con, Green_Con, Blue_Con, Red_Bri, Green_Bri, Blue_Bri);
}

void fwif_color_set_PDF(unsigned char idx)
{
	extern DRV_PDF_Ctrl_t PDF_tbl[NUM_PDF_tbl];

	if(idx >= NUM_PDF_tbl) idx = NUM_PDF_tbl - 1;

	drvif_color_set_pdf_enable(PDF_tbl[idx].Enable);
	drvif_color_set_pdf_fg_range(&(PDF_tbl[idx].fg_range));

	drvif_color_set_pdf_fg_gl(&PDF_tbl[idx].fg);
	drvif_color_set_pdf_fg_temporal_det(&PDF_tbl[idx].fg.fg_temporal_det);
	drvif_color_set_pdf_fg_temporal_undet(&PDF_tbl[idx].fg.fg_temporal_undet);
	drvif_color_set_pdf_fg_area_hit(&PDF_tbl[idx].fg.fg_area_hit);
	drvif_color_set_pdf_fg_gl_inUnit(&PDF_tbl[idx].fg.fg_gl_inUnit);
	drvif_color_set_pdf_fg_sel_opr(&PDF_tbl[idx].fg.fg_sel_opr);

	
	drvif_color_set_pdf_bg_gl(&PDF_tbl[idx].bg);
	drvif_color_set_pdf_bg_temporal_det(&PDF_tbl[idx].bg.bg_temporal_det);
	drvif_color_set_pdf_bg_temporal_undet(&PDF_tbl[idx].bg.bg_temporal_undet);
	drvif_color_set_pdf_bg_area_hit(&PDF_tbl[idx].bg.bg_area_hit);
	drvif_color_set_pdf_bg_gl_inUnit(&PDF_tbl[idx].bg.bg_gl_inUnit);
	drvif_color_set_pdf_bg_sel_opr(&PDF_tbl[idx].bg.bg_sel_opr);

}


